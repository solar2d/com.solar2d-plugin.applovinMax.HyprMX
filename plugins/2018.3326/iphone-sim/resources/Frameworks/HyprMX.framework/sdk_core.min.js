!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).sdk_core={})}(this,(function(exports){"use strict";var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function commonjsRequire(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ajv_min={exports:{}};!function(e,t){e.exports=function e(t,r,i){function a(o,n){if(!r[o]){if(!t[o]){var l="function"==typeof commonjsRequire&&commonjsRequire;if(!n&&l)return l(o,!0);if(s)return s(o,!0);var d=new Error("Cannot find module '"+o+"'");throw d.code="MODULE_NOT_FOUND",d}var c=r[o]={exports:{}};t[o][0].call(c.exports,(function(e){return a(t[o][1][e]||e)}),c,c.exports,e,t,r,i)}return r[o].exports}for(var s="function"==typeof commonjsRequire&&commonjsRequire,o=0;o<i.length;o++)a(i[o]);return a}({1:[function(e,t,r){var i=t.exports=function(){this._cache={}};i.prototype.put=function(e,t){this._cache[e]=t},i.prototype.get=function(e){return this._cache[e]},i.prototype.del=function(e){delete this._cache[e]},i.prototype.clear=function(){this._cache={}}},{}],2:[function(e,t,r){var i=e("./error_classes").MissingRef;t.exports=function e(t,r,a){var s=this;if("function"!=typeof this._opts.loadSchema)throw new Error("options.loadSchema should be a function");"function"==typeof r&&(a=r,r=void 0);var o=n(t).then((function(){var e=s._addSchema(t,void 0,r);return e.validate||function(e){try{return s._compile(e)}catch(t){if(t instanceof i)return function(t){var i=t.missingSchema;if(d(i))throw new Error("Schema "+i+" is loaded but "+t.missingRef+" cannot be resolved");var a=s._loadingSchemas[i];return a||(a=s._loadingSchemas[i]=s._opts.loadSchema(i)).then(o,o),a.then((function(e){if(!d(i))return n(e).then((function(){d(i)||s.addSchema(e,i,void 0,r)}))})).then((function(){return l(e)}));function o(){delete s._loadingSchemas[i]}function d(e){return s._refs[e]||s._schemas[e]}}(t);throw t}}(e)}));return a&&o.then((function(e){a(null,e)}),a),o;function n(t){var r=t.$schema;return r&&!s.getSchema(r)?e.call(s,{$ref:r},!0):Promise.resolve()}function l(e){try{return s._compile(e)}catch(t){if(t instanceof i)return function(t){var i=t.missingSchema;if(d(i))throw new Error("Schema "+i+" is loaded but "+t.missingRef+" cannot be resolved");var a=s._loadingSchemas[i];return a||(a=s._loadingSchemas[i]=s._opts.loadSchema(i)).then(o,o),a.then((function(e){if(!d(i))return n(e).then((function(){d(i)||s.addSchema(e,i,void 0,r)}))})).then((function(){return l(e)}));function o(){delete s._loadingSchemas[i]}function d(e){return s._refs[e]||s._schemas[e]}}(t);throw t}}}},{"./error_classes":3}],3:[function(e,t,r){var i=e("./resolve");function a(e,t,r){this.message=r||a.message(e,t),this.missingRef=i.url(e,t),this.missingSchema=i.normalizeId(i.fullPath(this.missingRef))}function s(e){return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e}t.exports={Validation:s((function(e){this.message="validation failed",this.errors=e,this.ajv=this.validation=!0})),MissingRef:s(a)},a.message=function(e,t){return"can't resolve reference "+t+" from id "+e}},{"./resolve":6}],4:[function(e,t,r){var i=e("./util"),a=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,s=[0,31,28,31,30,31,30,31,31,30,31,30,31],o=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d:\d\d)?$/i,n=/^[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*$/i,l=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,d=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,c=/^(?:(?:http[s\u017F]?|ftp):\/\/)(?:(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+(?::(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?@)?(?:(?!10(?:\.[0-9]{1,3}){3})(?!127(?:\.[0-9]{1,3}){3})(?!169\.254(?:\.[0-9]{1,3}){2})(?!192\.168(?:\.[0-9]{1,3}){2})(?!172\.(?:1[6-9]|2[0-9]|3[01])(?:\.[0-9]{1,3}){2})(?:[1-9][0-9]?|1[0-9][0-9]|2[01][0-9]|22[0-3])(?:\.(?:1?[0-9]{1,2}|2[0-4][0-9]|25[0-5])){2}(?:\.(?:[1-9][0-9]?|1[0-9][0-9]|2[0-4][0-9]|25[0-4]))|(?:(?:(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-?)*(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)(?:\.(?:(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-?)*(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)*(?:\.(?:(?:[KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]){2,})))(?::[0-9]{2,5})?(?:\/(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?$/i,u=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,h=/^(?:\/(?:[^~/]|~0|~1)*)*$/,p=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,m=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/;function f(e){return i.copy(f[e="full"==e?"full":"fast"])}function g(e){var t=e.match(a);if(!t)return!1;var r,i=+t[2],o=+t[3];return 1<=i&&i<=12&&1<=o&&o<=(2!=i||(r=+t[1])%4!=0||r%100==0&&r%400!=0?s[i]:29)}function v(e,t){var r=e.match(o);if(!r)return!1;var i=r[1],a=r[2],s=r[3];return(i<=23&&a<=59&&s<=59||23==i&&59==a&&60==s)&&(!t||r[5])}(t.exports=f).fast={date:/^\d\d\d\d-[0-1]\d-[0-3]\d$/,time:/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d:\d\d)?$/i,"date-time":/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d:\d\d)$/i,uri:/^(?:[a-z][a-z0-9+-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,"uri-template":d,url:c,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i,hostname:n,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:P,uuid:u,"json-pointer":h,"json-pointer-uri-fragment":p,"relative-json-pointer":m},f.full={date:g,time:v,"date-time":function(e){var t=e.split(E);return 2==t.length&&g(t[0])&&v(t[1],!0)},uri:function(e){return _.test(e)&&l.test(e)},"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":d,url:c,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:function(e){return e.length<=255&&n.test(e)},ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:P,uuid:u,"json-pointer":h,"json-pointer-uri-fragment":p,"relative-json-pointer":m};var E=/t|\s/i,_=/\/|:/,y=/[^\\]\\Z/;function P(e){if(y.test(e))return!1;try{return new RegExp(e),!0}catch(e){return!1}}},{"./util":10}],5:[function(e,t,r){var i=e("./resolve"),a=e("./util"),s=e("./error_classes"),o=e("fast-json-stable-stringify"),n=e("../dotjs/validate"),l=a.ucs2length,d=e("fast-deep-equal"),c=s.Validation;function u(e,t,r){for(var i=0;i<this._compilations.length;i++){var a=this._compilations[i];if(a.schema==e&&a.root==t&&a.baseId==r)return i}return-1}function h(e,t){return"var pattern"+e+" = new RegExp("+a.toQuotedString(t[e])+");"}function p(e){return"var default"+e+" = defaults["+e+"];"}function m(e,t){return void 0===t[e]?"":"var refVal"+e+" = refVal["+e+"];"}function f(e){return"var customRule"+e+" = customRules["+e+"];"}function g(e,t){if(!e.length)return"";for(var r="",i=0;i<e.length;i++)r+=t(i,e);return r}t.exports=function e(t,r,v,E){var _=this,y=this._opts,P=[void 0],S={},b=[],A={},T=[],R={},C=[],O=function(e,t,r){var i=u.call(this,e,t,r);return 0<=i?{index:i,compiling:!0}:{index:i=this._compilations.length,compiling:(this._compilations[i]={schema:e,root:t,baseId:r},!1)}}.call(this,t,r=r||{schema:t,refVal:P,refs:S},E),N=this._compilations[O.index];if(O.compiling)return N.callValidate=function e(){var t=N.validate,r=t.apply(this,arguments);return e.errors=t.errors,r};var w=this._formats,I=this.RULES;try{var D=V(t,r,v,E);N.validate=D;var F=N.callValidate;return F&&(F.schema=D.schema,F.errors=null,F.refs=D.refs,F.refVal=D.refVal,F.root=D.root,F.$async=D.$async,y.sourceCode&&(F.source=D.source)),D}finally{(function(e,t,r){var i=u.call(this,e,t,r);0<=i&&this._compilations.splice(i,1)}).call(this,t,r,E)}function V(t,o,u,v){var E=!o||o&&o.schema==t;if(o.schema!=r.schema)return e.call(_,t,o,u,v);var A,R=!0===t.$async,O=n({isTop:!0,schema:t,isRoot:E,baseId:v,root:o,schemaPath:"",errSchemaPath:"#",errorPath:'""',MissingRefError:s.MissingRef,RULES:I,validate:n,util:a,resolve:i,resolveRef:x,usePattern:k,useDefault:$,useCustomRule:H,opts:y,formats:w,logger:_.logger,self:_});O=g(P,m)+g(b,h)+g(T,p)+g(C,f)+O,y.processCode&&(O=y.processCode(O));try{A=new Function("self","RULES","formats","root","refVal","defaults","customRules","equal","ucs2length","ValidationError",O)(_,I,w,r,P,T,C,d,l,c),P[0]=A}catch(t){throw _.logger.error("Error compiling schema, function code:",O),t}return A.schema=t,A.errors=null,A.refs=S,A.refVal=P,A.root=E?A:o,R&&(A.$async=!0),!0===y.sourceCode&&(A.source={code:O,patterns:b,defaults:T}),A}function x(t,a,s){a=i.url(t,a);var o,n,l=S[a];if(void 0!==l)return M(o=P[l],n="refVal["+l+"]");if(!s&&r.refs){var d=r.refs[a];if(void 0!==d)return n=L(a,o=r.refVal[d]),M(o,n)}n=L(a);var c=i.call(_,V,r,a);if(void 0===c){var u=v&&v[a];u&&(c=i.inlineRef(u,y.inlineRefs)?u:e.call(_,u,r,v,t))}if(void 0!==c)return P[S[a]]=c,M(c,n);delete S[a]}function L(e,t){var r=P.length;return P[r]=t,"refVal"+(S[e]=r)}function M(e,t){return"object"==typeof e||"boolean"==typeof e?{code:t,schema:e,inline:!0}:{code:t,$async:e&&!!e.$async}}function k(e){var t=A[e];return void 0===t&&(t=A[e]=b.length,b[t]=e),"pattern"+t}function $(e){switch(typeof e){case"boolean":case"number":return""+e;case"string":return a.toQuotedString(e);case"object":if(null===e)return"null";var t=o(e),r=R[t];return void 0===r&&(r=R[t]=T.length,T[r]=e),"default"+r}}function H(e,t,r,i){var a=e.definition.validateSchema;if(a&&!1!==_._opts.validateSchema&&!a(t)){var s="keyword schema is invalid: "+_.errorsText(a.errors);if("log"!=_._opts.validateSchema)throw new Error(s);_.logger.error(s)}var o,n=e.definition.compile,l=e.definition.inline,d=e.definition.macro;if(n)o=n.call(_,t,r,i);else if(d)o=d.call(_,t,r,i),!1!==y.validateSchema&&_.validateSchema(o,!0);else if(l)o=l.call(_,i,e.keyword,t,r);else if(!(o=e.definition.validate))return;if(void 0===o)throw new Error('custom keyword "'+e.keyword+'"failed to compile');var c=C.length;return{code:"customRule"+c,validate:C[c]=o}}}},{"../dotjs/validate":37,"./error_classes":3,"./resolve":6,"./util":10,"fast-deep-equal":41,"fast-json-stable-stringify":42}],6:[function(e,t,r){var i=e("uri-js"),a=e("fast-deep-equal"),s=e("./util"),o=e("./schema_obj"),n=e("json-schema-traverse");function l(e,t,r){var i=this._refs[r];if("string"==typeof i){if(!this._refs[i])return l.call(this,e,t,i);i=this._refs[i]}if((i=i||this._schemas[r])instanceof o)return p(i.schema,this._opts.inlineRefs)?i.schema:i.validate||this._compile(i);var a,s,n,c=d.call(this,t,r);return c&&(a=c.schema,t=c.root,n=c.baseId),a instanceof o?s=a.validate||e.call(this,a.schema,t,void 0,n):void 0!==a&&(s=p(a,this._opts.inlineRefs)?a:e.call(this,a,t,void 0,n)),s}function d(e,t){var r=i.parse(t),a=f(r),s=m(this._getId(e.schema));if(0===Object.keys(e.schema).length||a!==s){var n=v(a),l=this._refs[n];if("string"==typeof l)return function(e,t,r){var i=d.call(this,e,t);if(i){var a=i.schema,s=i.baseId;e=i.root;var o=this._getId(a);return o&&(s=E(s,o)),u.call(this,r,s,a,e)}}.call(this,e,l,r);if(l instanceof o)l.validate||this._compile(l),e=l;else{if(!((l=this._schemas[n])instanceof o))return;if(l.validate||this._compile(l),n==v(t))return{schema:l,root:e,baseId:s};e=l}if(!e.schema)return;s=m(this._getId(e.schema))}return u.call(this,r,s,e.schema,e)}(t.exports=l).normalizeId=v,l.fullPath=m,l.url=E,l.ids=function(e){var t=v(this._getId(e)),r={"":t},o={"":m(t,!1)},l={},d=this;return n(e,{allKeys:!0},(function(e,t,n,c,u,h,p){if(""!==t){var m=d._getId(e),f=r[c],g=o[c]+"/"+u;if(void 0!==p&&(g+="/"+("number"==typeof p?p:s.escapeFragment(p))),"string"==typeof m){m=f=v(f?i.resolve(f,m):m);var E=d._refs[m];if("string"==typeof E&&(E=d._refs[E]),E&&E.schema){if(!a(e,E.schema))throw new Error('id "'+m+'" resolves to more than one schema')}else if(m!=v(g))if("#"==m[0]){if(l[m]&&!a(e,l[m]))throw new Error('id "'+m+'" resolves to more than one schema');l[m]=e}else d._refs[m]=g}r[t]=f,o[t]=g}})),l},l.inlineRef=p,l.schema=d;var c=s.toHash(["properties","patternProperties","enum","dependencies","definitions"]);function u(e,t,r,i){if(e.fragment=e.fragment||"","/"==e.fragment.slice(0,1)){for(var a=e.fragment.split("/"),o=1;o<a.length;o++){var n=a[o];if(n){if(void 0===(r=r[n=s.unescapeFragment(n)]))break;var l;if(!c[n]&&((l=this._getId(r))&&(t=E(t,l)),r.$ref)){var u=E(t,r.$ref),h=d.call(this,i,u);h&&(r=h.schema,i=h.root,t=h.baseId)}}}return void 0!==r&&r!==i.schema?{schema:r,root:i,baseId:t}:void 0}}var h=s.toHash(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum"]);function p(e,t){return!1!==t&&(void 0===t||!0===t?function e(t){var r;if(Array.isArray(t)){for(var i=0;i<t.length;i++)if("object"==typeof(r=t[i])&&!e(r))return!1}else for(var a in t){if("$ref"==a)return!1;if("object"==typeof(r=t[a])&&!e(r))return!1}return!0}(e):t?function e(t){var r,i=0;if(Array.isArray(t)){for(var a=0;a<t.length;a++)if("object"==typeof(r=t[a])&&(i+=e(r)),i==1/0)return 1/0}else for(var s in t){if("$ref"==s)return 1/0;if(h[s])i++;else if("object"==typeof(r=t[s])&&(i+=e(r)+1),i==1/0)return 1/0}return i}(e)<=t:void 0)}function m(e,t){return!1!==t&&(e=v(e)),f(i.parse(e))}function f(e){return i.serialize(e).split("#")[0]+"#"}var g=/#\/?$/;function v(e){return e?e.replace(g,""):""}function E(e,t){return t=v(t),i.resolve(e,t)}},{"./schema_obj":8,"./util":10,"fast-deep-equal":41,"json-schema-traverse":43,"uri-js":44}],7:[function(e,t,r){var i=e("../dotjs"),a=e("./util").toHash;t.exports=function(){var e=[{type:"number",rules:[{maximum:["exclusiveMaximum"]},{minimum:["exclusiveMinimum"]},"multipleOf","format"]},{type:"string",rules:["maxLength","minLength","pattern","format"]},{type:"array",rules:["maxItems","minItems","items","contains","uniqueItems"]},{type:"object",rules:["maxProperties","minProperties","required","dependencies","propertyNames",{properties:["additionalProperties","patternProperties"]}]},{rules:["$ref","const","enum","not","anyOf","oneOf","allOf","if"]}],t=["type","$comment"];return e.all=a(t),e.types=a(["number","integer","string","array","object","boolean","null"]),e.forEach((function(r){r.rules=r.rules.map((function(r){var a;if("object"==typeof r){var s=Object.keys(r)[0];a=r[s],r=s,a.forEach((function(r){t.push(r),e.all[r]=!0}))}return t.push(r),e.all[r]={keyword:r,code:i[r],implements:a}})),e.all.$comment={keyword:"$comment",code:i.$comment},r.type&&(e.types[r.type]=r)})),e.keywords=a(t.concat(["$schema","$id","id","$data","title","description","default","definitions","examples","readOnly","writeOnly","contentMediaType","contentEncoding","additionalItems","then","else"])),e.custom={},e}},{"../dotjs":26,"./util":10}],8:[function(e,t,r){var i=e("./util");t.exports=function(e){i.copy(e,this)}},{"./util":10}],9:[function(e,t,r){t.exports=function(e){for(var t,r=0,i=e.length,a=0;a<i;)r++,55296<=(t=e.charCodeAt(a++))&&t<=56319&&a<i&&56320==(64512&(t=e.charCodeAt(a)))&&a++;return r}},{}],10:[function(e,t,r){function i(e,t,r){var i=r?" !== ":" === ",a=r?" || ":" && ",s=r?"!":"",o=r?"":"!";switch(e){case"null":return t+i+"null";case"array":return s+"Array.isArray("+t+")";case"object":return"("+s+t+a+"typeof "+t+i+'"object"'+a+o+"Array.isArray("+t+"))";case"integer":return"(typeof "+t+i+'"number"'+a+o+"("+t+" % 1)"+a+t+i+t+")";default:return"typeof "+t+i+'"'+e+'"'}}t.exports={copy:function(e,t){for(var r in t=t||{},e)t[r]=e[r];return t},checkDataType:i,checkDataTypes:function(e,t){switch(e.length){case 1:return i(e[0],t,!0);default:var r="",a=s(e);for(var o in a.array&&a.object&&(r=a.null?"(":"(!"+t+" || ",r+="typeof "+t+' !== "object")',delete a.null,delete a.array,delete a.object),a.number&&delete a.integer,a)r+=(r?" && ":"")+i(o,t,!0);return r}},coerceToTypes:function(e,t){if(Array.isArray(t)){for(var r=[],i=0;i<t.length;i++){var s=t[i];(a[s]||"array"===e&&"array"===s)&&(r[r.length]=s)}if(r.length)return r}else{if(a[t])return[t];if("array"===e&&"array"===t)return["array"]}},toHash:s,getProperty:l,escapeQuotes:d,equal:e("fast-deep-equal"),ucs2length:e("./ucs2length"),varOccurences:function(e,t){var r=e.match(new RegExp(t+="[^0-9]","g"));return r?r.length:0},varReplace:function(e,t,r){return t+="([^0-9])",r=r.replace(/\$/g,"$$$$"),e.replace(new RegExp(t,"g"),r+"$1")},cleanUpCode:function(e){return e.replace(c,"").replace(u,"").replace(h,"if (!($1))")},finalCleanUpCode:function(e,t){var r=e.match(p);return r&&2==r.length&&(e=t?e.replace(f,"").replace(E,_):e.replace(m,"").replace(g,v)),(r=e.match(y))&&3===r.length?e.replace(P,""):e},schemaHasRules:function(e,t){if("boolean"==typeof e)return!e;for(var r in e)if(t[r])return!0},schemaHasRulesExcept:function(e,t,r){if("boolean"==typeof e)return!e&&"not"!=r;for(var i in e)if(i!=r&&t[i])return!0},toQuotedString:S,getPathExpr:function(e,t,r,i){return T(e,r?"'/' + "+t+(i?"":".replace(/~/g, '~0').replace(/\\//g, '~1')"):i?"'[' + "+t+" + ']'":"'[\\'' + "+t+" + '\\']'")},getPath:function(e,t,r){return T(e,S(r?"/"+R(t):l(t)))},getData:function(e,t,r){var i,a,s,o;if(""===e)return"rootData";if("/"==e[0]){if(!b.test(e))throw new Error("Invalid JSON-pointer: "+e);a=e,s="rootData"}else{if(!(o=e.match(A)))throw new Error("Invalid JSON-pointer: "+e);if(i=+o[1],"#"==(a=o[2])){if(t<=i)throw new Error("Cannot access property/index "+i+" levels up, current level is "+t);return r[t-i]}if(t<i)throw new Error("Cannot access data "+i+" levels up, current level is "+t);if(s="data"+(t-i||""),!a)return s}for(var n=s,d=a.split("/"),c=0;c<d.length;c++){var u=d[c];u&&(n+=" && "+(s+=l(C(u))))}return n},unescapeFragment:function(e){return C(decodeURIComponent(e))},unescapeJsonPointer:C,escapeFragment:function(e){return encodeURIComponent(R(e))},escapeJsonPointer:R};var a=s(["string","number","integer","boolean","null"]);function s(e){for(var t={},r=0;r<e.length;r++)t[e[r]]=!0;return t}var o=/^[a-z$_][a-z$_0-9]*$/i,n=/'|\\/g;function l(e){return"number"==typeof e?"["+e+"]":o.test(e)?"."+e:"['"+d(e)+"']"}function d(e){return e.replace(n,"\\$&").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\f/g,"\\f").replace(/\t/g,"\\t")}var c=/else\s*{\s*}/g,u=/if\s*\([^)]+\)\s*\{\s*\}(?!\s*else)/g,h=/if\s*\(([^)]+)\)\s*\{\s*\}\s*else(?!\s*if)/g,p=/[^v.]errors/g,m=/var errors = 0;|var vErrors = null;|validate.errors = vErrors;/g,f=/var errors = 0;|var vErrors = null;/g,g="return errors === 0;",v="validate.errors = null; return true;",E=/if \(errors === 0\) return data;\s*else throw new ValidationError\(vErrors\);/,_="return data;",y=/[^A-Za-z_$]rootData[^A-Za-z0-9_$]/g,P=/if \(rootData === undefined\) rootData = data;/;function S(e){return"'"+d(e)+"'"}var b=/^\/(?:[^~]|~0|~1)*$/,A=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function T(e,t){return'""'==e?t:(e+" + "+t).replace(/' \+ '/g,"")}function R(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}function C(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}},{"./ucs2length":9,"fast-deep-equal":41}],11:[function(e,t,r){var i=["multipleOf","maximum","exclusiveMaximum","minimum","exclusiveMinimum","maxLength","minLength","pattern","additionalItems","maxItems","minItems","uniqueItems","maxProperties","minProperties","required","additionalProperties","enum","format","const"];t.exports=function(e,t){for(var r=0;r<t.length;r++){e=JSON.parse(JSON.stringify(e));var a,s=t[r].split("/"),o=e;for(a=1;a<s.length;a++)o=o[s[a]];for(a=0;a<i.length;a++){var n=i[a],l=o[n];l&&(o[n]={anyOf:[l,{$ref:"https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/data.json#"}]})}}return e}},{}],12:[function(e,t,r){t.exports=function(e,t,r){var i,a=" ",s=e.level,o=e.dataLevel,n=e.schema[t],l=e.schemaPath+e.util.getProperty(t),d=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,u="data"+(o||""),h=e.opts.$data&&n&&n.$data;h?(a+=" var schema"+s+" = "+e.util.getData(n.$data,o,e.dataPathArr)+"; ",i="schema"+s):i=n;var p="maximum"==t,m=p?"exclusiveMaximum":"exclusiveMinimum",f=e.schema[m],g=e.opts.$data&&f&&f.$data,v=p?"<":">",E=p?">":"<",_=void 0;if(g){var y,P=e.util.getData(f.$data,o,e.dataPathArr),S="exclusive"+s,b="exclType"+s,A="exclIsNumber"+s,T="' + "+(C="op"+s)+" + '";a+=" var schemaExcl"+s+" = "+P+"; ",_=m,(y=y||[]).push(a+=" var "+S+"; var "+b+" = typeof "+(P="schemaExcl"+s)+"; if ("+b+" != 'boolean' && "+b+" != 'undefined' && "+b+" != 'number') { "),a="",!1!==e.createErrors?(a+=" { keyword: '"+(_||"_exclusiveLimit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(d)+" , params: {} ",!1!==e.opts.messages&&(a+=" , message: '"+m+" should be boolean' "),e.opts.verbose&&(a+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),a+=" } "):a+=" {} ";var R=a;a=y.pop(),a+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+R+"]); ":" validate.errors = ["+R+"]; return false; ":" var err = "+R+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",a+=" } else if ( ",h&&(a+=" ("+i+" !== undefined && typeof "+i+" != 'number') || "),a+=" "+b+" == 'number' ? ( ("+S+" = "+i+" === undefined || "+P+" "+v+"= "+i+") ? "+u+" "+E+"= "+P+" : "+u+" "+E+" "+i+" ) : ( ("+S+" = "+P+" === true) ? "+u+" "+E+"= "+i+" : "+u+" "+E+" "+i+" ) || "+u+" !== "+u+") { var op"+s+" = "+S+" ? '"+v+"' : '"+v+"='; ",void 0===n&&(d=e.errSchemaPath+"/"+(_=m),i=P,h=g)}else if(T=v,(A="number"==typeof f)&&h){var C="'"+T+"'";a+=" if ( ",h&&(a+=" ("+i+" !== undefined && typeof "+i+" != 'number') || "),a+=" ( "+i+" === undefined || "+f+" "+v+"= "+i+" ? "+u+" "+E+"= "+f+" : "+u+" "+E+" "+i+" ) || "+u+" !== "+u+") { "}else A&&void 0===n?(S=!0,d=e.errSchemaPath+"/"+(_=m),i=f,E+="="):(A&&(i=Math[p?"min":"max"](f,n)),f===(!A||i)?(S=!0,d=e.errSchemaPath+"/"+(_=m),E+="="):(S=!1,T+="=")),C="'"+T+"'",a+=" if ( ",h&&(a+=" ("+i+" !== undefined && typeof "+i+" != 'number') || "),a+=" "+u+" "+E+" "+i+" || "+u+" !== "+u+") { ";return _=_||t,(y=y||[]).push(a),a="",!1!==e.createErrors?(a+=" { keyword: '"+(_||"_limit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(d)+" , params: { comparison: "+C+", limit: "+i+", exclusive: "+S+" } ",!1!==e.opts.messages&&(a+=" , message: 'should be "+T+" ",a+=h?"' + "+i:i+"'"),e.opts.verbose&&(a+=" , schema:  ",a+=h?"validate.schema"+l:""+n,a+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),a+=" } "):a+=" {} ",R=a,a=y.pop(),a+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+R+"]); ":" validate.errors = ["+R+"]; return false; ":" var err = "+R+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",a+=" } ",c&&(a+=" else { "),a}},{}],13:[function(e,t,r){t.exports=function(e,t,r){var i,a=" ",s=e.level,o=e.dataLevel,n=e.schema[t],l=e.schemaPath+e.util.getProperty(t),d=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,u="data"+(o||""),h=e.opts.$data&&n&&n.$data;h?(a+=" var schema"+s+" = "+e.util.getData(n.$data,o,e.dataPathArr)+"; ",i="schema"+s):i=n,a+="if ( ",h&&(a+=" ("+i+" !== undefined && typeof "+i+" != 'number') || ");var p=t,m=m||[];m.push(a+=" "+u+".length "+("maxItems"==t?">":"<")+" "+i+") { "),a="",!1!==e.createErrors?(a+=" { keyword: '"+(p||"_limitItems")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(d)+" , params: { limit: "+i+" } ",!1!==e.opts.messages&&(a+=" , message: 'should NOT have ",a+="maxItems"==t?"more":"fewer",a+=" than ",a+=h?"' + "+i+" + '":""+n,a+=" items' "),e.opts.verbose&&(a+=" , schema:  ",a+=h?"validate.schema"+l:""+n,a+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),a+=" } "):a+=" {} ";var f=a;return a=m.pop(),a+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+f+"]); ":" validate.errors = ["+f+"]; return false; ":" var err = "+f+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",a+="} ",c&&(a+=" else { "),a}},{}],14:[function(e,t,r){t.exports=function(e,t,r){var i,a=" ",s=e.level,o=e.dataLevel,n=e.schema[t],l=e.schemaPath+e.util.getProperty(t),d=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,u="data"+(o||""),h=e.opts.$data&&n&&n.$data;h?(a+=" var schema"+s+" = "+e.util.getData(n.$data,o,e.dataPathArr)+"; ",i="schema"+s):i=n,a+="if ( ",h&&(a+=" ("+i+" !== undefined && typeof "+i+" != 'number') || "),a+=!1===e.opts.unicode?" "+u+".length ":" ucs2length("+u+") ";var p=t,m=m||[];m.push(a+=" "+("maxLength"==t?">":"<")+" "+i+") { "),a="",!1!==e.createErrors?(a+=" { keyword: '"+(p||"_limitLength")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(d)+" , params: { limit: "+i+" } ",!1!==e.opts.messages&&(a+=" , message: 'should NOT be ",a+="maxLength"==t?"longer":"shorter",a+=" than ",a+=h?"' + "+i+" + '":""+n,a+=" characters' "),e.opts.verbose&&(a+=" , schema:  ",a+=h?"validate.schema"+l:""+n,a+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),a+=" } "):a+=" {} ";var f=a;return a=m.pop(),a+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+f+"]); ":" validate.errors = ["+f+"]; return false; ":" var err = "+f+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",a+="} ",c&&(a+=" else { "),a}},{}],15:[function(e,t,r){t.exports=function(e,t,r){var i,a=" ",s=e.level,o=e.dataLevel,n=e.schema[t],l=e.schemaPath+e.util.getProperty(t),d=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,u="data"+(o||""),h=e.opts.$data&&n&&n.$data;h?(a+=" var schema"+s+" = "+e.util.getData(n.$data,o,e.dataPathArr)+"; ",i="schema"+s):i=n,a+="if ( ",h&&(a+=" ("+i+" !== undefined && typeof "+i+" != 'number') || ");var p=t,m=m||[];m.push(a+=" Object.keys("+u+").length "+("maxProperties"==t?">":"<")+" "+i+") { "),a="",!1!==e.createErrors?(a+=" { keyword: '"+(p||"_limitProperties")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(d)+" , params: { limit: "+i+" } ",!1!==e.opts.messages&&(a+=" , message: 'should NOT have ",a+="maxProperties"==t?"more":"fewer",a+=" than ",a+=h?"' + "+i+" + '":""+n,a+=" properties' "),e.opts.verbose&&(a+=" , schema:  ",a+=h?"validate.schema"+l:""+n,a+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),a+=" } "):a+=" {} ";var f=a;return a=m.pop(),a+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+f+"]); ":" validate.errors = ["+f+"]; return false; ":" var err = "+f+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",a+="} ",c&&(a+=" else { "),a}},{}],16:[function(e,t,r){t.exports=function(e,t,r){var i=" ",a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),o=e.errSchemaPath+"/"+t,n=!e.opts.allErrors,l=e.util.copy(e),d="";l.level++;var c="valid"+l.level,u=l.baseId,h=!0,p=a;if(p)for(var m,f=-1,g=p.length-1;f<g;)m=p[f+=1],e.util.schemaHasRules(m,e.RULES.all)&&(h=!1,l.schema=m,l.schemaPath=s+"["+f+"]",l.errSchemaPath=o+"/"+f,i+="  "+e.validate(l)+" ",l.baseId=u,n&&(i+=" if ("+c+") { ",d+="}"));return n&&(i+=h?" if (true) { ":" "+d.slice(0,-1)+" "),e.util.cleanUpCode(i)}},{}],17:[function(e,t,r){t.exports=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],n=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,c="data"+(s||""),u="valid"+a,h="errs__"+a,p=e.util.copy(e),m="";p.level++;var f="valid"+p.level;if(o.every((function(t){return e.util.schemaHasRules(t,e.RULES.all)}))){var g=p.baseId;i+=" var "+h+" = errors; var "+u+" = false;  ";var v=e.compositeRule;e.compositeRule=p.compositeRule=!0;var E=o;if(E)for(var _,y=-1,P=E.length-1;y<P;)_=E[y+=1],p.schema=_,p.schemaPath=n+"["+y+"]",p.errSchemaPath=l+"/"+y,i+="  "+e.validate(p)+" ",p.baseId=g,i+=" "+u+" = "+u+" || "+f+"; if (!"+u+") { ",m+="}";e.compositeRule=p.compositeRule=v,i+=" "+m+" if (!"+u+") {   var err =   ",!1!==e.createErrors?(i+=" { keyword: 'anyOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(i+=" , message: 'should match some schema in anyOf' "),e.opts.verbose&&(i+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),i+=" } "):i+=" {} ",i+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&d&&(i+=e.async?" throw new ValidationError(vErrors); ":" validate.errors = vErrors; return false; "),i+=" } else {  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; } ",e.opts.allErrors&&(i+=" } "),i=e.util.cleanUpCode(i)}else d&&(i+=" if (true) { ");return i}},{}],18:[function(e,t,r){t.exports=function(e,t,r){var i=" ",a=e.errSchemaPath+"/"+t,s=e.util.toQuotedString(e.schema[t]);return!0===e.opts.$comment?i+=" console.log("+s+");":"function"==typeof e.opts.$comment&&(i+=" self._opts.$comment("+s+", "+e.util.toQuotedString(a)+", validate.root.schema);"),i}},{}],19:[function(e,t,r){t.exports=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],n=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,c="data"+(s||""),u="valid"+a,h=e.opts.$data&&o&&o.$data;h&&(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; "),h||(i+=" var schema"+a+" = validate.schema"+n+";");var p=p||[];p.push(i+="var "+u+" = equal("+c+", schema"+a+"); if (!"+u+") {   "),i="",!1!==e.createErrors?(i+=" { keyword: 'const' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { allowedValue: schema"+a+" } ",!1!==e.opts.messages&&(i+=" , message: 'should be equal to constant' "),e.opts.verbose&&(i+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),i+=" } "):i+=" {} ";var m=i;return i=p.pop(),i+=!e.compositeRule&&d?e.async?" throw new ValidationError(["+m+"]); ":" validate.errors = ["+m+"]; return false; ":" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" }",d&&(i+=" else { "),i}},{}],20:[function(e,t,r){t.exports=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],n=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,c="data"+(s||""),u="valid"+a,h="errs__"+a,p=e.util.copy(e);p.level++;var m="valid"+p.level,f="i"+a,g=p.dataLevel=e.dataLevel+1,v="data"+g,E=e.baseId,_=e.util.schemaHasRules(o,e.RULES.all);if(i+="var "+h+" = errors;var "+u+";",_){var y=e.compositeRule;e.compositeRule=p.compositeRule=!0,p.schema=o,p.schemaPath=n,p.errSchemaPath=l,i+=" var "+m+" = false; for (var "+f+" = 0; "+f+" < "+c+".length; "+f+"++) { ",p.errorPath=e.util.getPathExpr(e.errorPath,f,e.opts.jsonPointers,!0);var P=c+"["+f+"]";p.dataPathArr[g]=f;var S=e.validate(p);p.baseId=E,e.util.varOccurences(S,v)<2?i+=" "+e.util.varReplace(S,v,P)+" ":i+=" var "+v+" = "+P+"; "+S+" ",i+=" if ("+m+") break; }  ",e.compositeRule=p.compositeRule=y,i+="  if (!"+m+") {"}else i+=" if ("+c+".length == 0) {";var b=b||[];b.push(i),i="",!1!==e.createErrors?(i+=" { keyword: 'contains' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(i+=" , message: 'should contain a valid item' "),e.opts.verbose&&(i+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),i+=" } "):i+=" {} ";var A=i;return i=b.pop(),i+=!e.compositeRule&&d?e.async?" throw new ValidationError(["+A+"]); ":" validate.errors = ["+A+"]; return false; ":" var err = "+A+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } else { ",_&&(i+="  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; } "),e.opts.allErrors&&(i+=" } "),e.util.cleanUpCode(i)}},{}],21:[function(e,t,r){t.exports=function(e,t,r){var i,a,s=" ",o=e.level,n=e.dataLevel,l=e.schema[t],d=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,h="data"+(n||""),p="valid"+o,m="errs__"+o,f=e.opts.$data&&l&&l.$data;f?(s+=" var schema"+o+" = "+e.util.getData(l.$data,n,e.dataPathArr)+"; ",a="schema"+o):a=l;var g,v,E,_,y,P=this,S="definition"+o,b=P.definition,A="";if(f&&b.$data){var T=b.validateSchema;s+=" var "+S+" = RULES.custom['"+t+"'].definition; var "+(y="keywordValidate"+o)+" = "+S+".validate;"}else{if(!(_=e.useCustomRule(P,l,e.schema,e)))return;a="validate.schema"+d,y=_.code,g=b.compile,v=b.inline,E=b.macro}var R=y+".errors",C="i"+o,O="ruleErr"+o,N=b.async;if(N&&!e.async)throw new Error("async keyword in sync schema");if(v||E||(s+=R+" = null;"),s+="var "+m+" = errors;var "+p+";",f&&b.$data&&(A+="}",s+=" if ("+a+" === undefined) { "+p+" = true; } else { ",T&&(A+="}",s+=" "+p+" = "+S+".validateSchema("+a+"); if ("+p+") { ")),v)s+=b.statements?" "+_.validate+" ":" "+p+" = "+_.validate+"; ";else if(E){var w=e.util.copy(e);A="",w.level++;var I="valid"+w.level;w.schema=_.validate,w.schemaPath="";var D=e.compositeRule;e.compositeRule=w.compositeRule=!0;var F=e.validate(w).replace(/validate\.schema/g,y);e.compositeRule=w.compositeRule=D,s+=" "+F}else{(M=M||[]).push(s),s="",s+="  "+y+".call( ",s+=e.opts.passContext?"this":"self",s+=g||!1===b.schema?" , "+h+" ":" , "+a+" , "+h+" , validate.schema"+e.schemaPath+" ",s+=" , (dataPath || '')",'""'!=e.errorPath&&(s+=" + "+e.errorPath);var V=n?"data"+(n-1||""):"parentData",x=n?e.dataPathArr[n]:"parentDataProperty",L=s+=" , "+V+" , "+x+" , rootData )  ";s=M.pop(),!1===b.errors?(s+=" "+p+" = ",N&&(s+="await "),s+=L+"; "):s+=N?" var "+(R="customErrors"+o)+" = null; try { "+p+" = await "+L+"; } catch (e) { "+p+" = false; if (e instanceof ValidationError) "+R+" = e.errors; else throw e; } ":" "+R+" = null; "+p+" = "+L+"; "}if(b.modifying&&(s+=" if ("+V+") "+h+" = "+V+"["+x+"];"),s+=""+A,b.valid)u&&(s+=" if (true) { ");else{var M;s+=" if ( ",void 0===b.valid?(s+=" !",s+=E?""+I:""+p):s+=" "+!b.valid+" ",i=P.keyword,(M=M||[]).push(s+=") { "),(M=M||[]).push(s=""),s="",!1!==e.createErrors?(s+=" { keyword: '"+(i||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { keyword: '"+P.keyword+"' } ",!1!==e.opts.messages&&(s+=" , message: 'should pass \""+P.keyword+"\" keyword validation' "),e.opts.verbose&&(s+=" , schema: validate.schema"+d+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),s+=" } "):s+=" {} ";var k=s;s=M.pop();var $=s+=!e.compositeRule&&u?e.async?" throw new ValidationError(["+k+"]); ":" validate.errors = ["+k+"]; return false; ":" var err = "+k+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";s=M.pop(),v?b.errors?"full"!=b.errors&&(s+="  for (var "+C+"="+m+"; "+C+"<errors; "+C+"++) { var "+O+" = vErrors["+C+"]; if ("+O+".dataPath === undefined) "+O+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+O+".schemaPath === undefined) { "+O+'.schemaPath = "'+c+'"; } ',e.opts.verbose&&(s+=" "+O+".schema = "+a+"; "+O+".data = "+h+"; "),s+=" } "):!1===b.errors?s+=" "+$+" ":(s+=" if ("+m+" == errors) { "+$+" } else {  for (var "+C+"="+m+"; "+C+"<errors; "+C+"++) { var "+O+" = vErrors["+C+"]; if ("+O+".dataPath === undefined) "+O+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+O+".schemaPath === undefined) { "+O+'.schemaPath = "'+c+'"; } ',e.opts.verbose&&(s+=" "+O+".schema = "+a+"; "+O+".data = "+h+"; "),s+=" } } "):E?(s+="   var err =   ",!1!==e.createErrors?(s+=" { keyword: '"+(i||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { keyword: '"+P.keyword+"' } ",!1!==e.opts.messages&&(s+=" , message: 'should pass \""+P.keyword+"\" keyword validation' "),e.opts.verbose&&(s+=" , schema: validate.schema"+d+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),s+=" } "):s+=" {} ",s+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&u&&(s+=e.async?" throw new ValidationError(vErrors); ":" validate.errors = vErrors; return false; ")):!1===b.errors?s+=" "+$+" ":(s+=" if (Array.isArray("+R+")) { if (vErrors === null) vErrors = "+R+"; else vErrors = vErrors.concat("+R+"); errors = vErrors.length;  for (var "+C+"="+m+"; "+C+"<errors; "+C+"++) { var "+O+" = vErrors["+C+"]; if ("+O+".dataPath === undefined) "+O+".dataPath = (dataPath || '') + "+e.errorPath+";  "+O+'.schemaPath = "'+c+'";  ',e.opts.verbose&&(s+=" "+O+".schema = "+a+"; "+O+".data = "+h+"; "),s+=" } } else { "+$+" } "),s+=" } ",u&&(s+=" else { ")}return s}},{}],22:[function(e,t,r){t.exports=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],n=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,c="data"+(s||""),u="errs__"+a,h=e.util.copy(e),p="";h.level++;var m="valid"+h.level,f={},g={},v=e.opts.ownProperties;for(P in o){var E=o[P],_=Array.isArray(E)?g:f;_[P]=E}i+="var "+u+" = errors;";var y=e.errorPath;for(var P in i+="var missing"+a+";",g)if((_=g[P]).length){if(i+=" if ( "+c+e.util.getProperty(P)+" !== undefined ",v&&(i+=" && Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(P)+"') "),d){i+=" && ( ";var S=_;if(S)for(var b=-1,A=S.length-1;b<A;)w=S[b+=1],b&&(i+=" || "),i+=" ( ( "+(V=c+(F=e.util.getProperty(w)))+" === undefined ",v&&(i+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(w)+"') "),i+=") && (missing"+a+" = "+e.util.toQuotedString(e.opts.jsonPointers?w:F)+") ) ";i+=")) {  ";var T="missing"+a,R="' + "+T+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(y,T,!0):y+" + "+T);var C=C||[];C.push(i),i="",!1!==e.createErrors?(i+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { property: '"+e.util.escapeQuotes(P)+"', missingProperty: '"+R+"', depsCount: "+_.length+", deps: '"+e.util.escapeQuotes(1==_.length?_[0]:_.join(", "))+"' } ",!1!==e.opts.messages&&(i+=" , message: 'should have ",i+=1==_.length?"property "+e.util.escapeQuotes(_[0]):"properties "+e.util.escapeQuotes(_.join(", ")),i+=" when property "+e.util.escapeQuotes(P)+" is present' "),e.opts.verbose&&(i+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),i+=" } "):i+=" {} ";var O=i;i=C.pop(),i+=!e.compositeRule&&d?e.async?" throw new ValidationError(["+O+"]); ":" validate.errors = ["+O+"]; return false; ":" var err = "+O+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else{i+=" ) { ";var N=_;if(N)for(var w,I=-1,D=N.length-1;I<D;){w=N[I+=1];var F=e.util.getProperty(w),V=(R=e.util.escapeQuotes(w),c+F);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(y,w,e.opts.jsonPointers)),i+=" if ( "+V+" === undefined ",v&&(i+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(w)+"') "),i+=") {  var err =   ",!1!==e.createErrors?(i+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { property: '"+e.util.escapeQuotes(P)+"', missingProperty: '"+R+"', depsCount: "+_.length+", deps: '"+e.util.escapeQuotes(1==_.length?_[0]:_.join(", "))+"' } ",!1!==e.opts.messages&&(i+=" , message: 'should have ",i+=1==_.length?"property "+e.util.escapeQuotes(_[0]):"properties "+e.util.escapeQuotes(_.join(", ")),i+=" when property "+e.util.escapeQuotes(P)+" is present' "),e.opts.verbose&&(i+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),i+=" } "):i+=" {} ",i+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}i+=" }   ",d&&(p+="}",i+=" else { ")}e.errorPath=y;var x=h.baseId;for(var P in f)e.util.schemaHasRules(E=f[P],e.RULES.all)&&(i+=" "+m+" = true; if ( "+c+e.util.getProperty(P)+" !== undefined ",v&&(i+=" && Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(P)+"') "),i+=") { ",h.schema=E,h.schemaPath=n+e.util.getProperty(P),h.errSchemaPath=l+"/"+e.util.escapeFragment(P),i+="  "+e.validate(h)+" ",h.baseId=x,i+=" }  ",d&&(i+=" if ("+m+") { ",p+="}"));return d&&(i+="   "+p+" if ("+u+" == errors) {"),e.util.cleanUpCode(i)}},{}],23:[function(e,t,r){t.exports=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],n=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,c="data"+(s||""),u="valid"+a,h=e.opts.$data&&o&&o.$data;h&&(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; ");var p="i"+a,m="schema"+a;h||(i+=" var "+m+" = validate.schema"+n+";"),i+="var "+u+";",h&&(i+=" if (schema"+a+" === undefined) "+u+" = true; else if (!Array.isArray(schema"+a+")) "+u+" = false; else {"),i+=u+" = false;for (var "+p+"=0; "+p+"<"+m+".length; "+p+"++) if (equal("+c+", "+m+"["+p+"])) { "+u+" = true; break; }",h&&(i+="  }  ");var f=f||[];f.push(i+=" if (!"+u+") {   "),i="",!1!==e.createErrors?(i+=" { keyword: 'enum' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { allowedValues: schema"+a+" } ",!1!==e.opts.messages&&(i+=" , message: 'should be equal to one of the allowed values' "),e.opts.verbose&&(i+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),i+=" } "):i+=" {} ";var g=i;return i=f.pop(),i+=!e.compositeRule&&d?e.async?" throw new ValidationError(["+g+"]); ":" validate.errors = ["+g+"]; return false; ":" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" }",d&&(i+=" else { "),i}},{}],24:[function(e,t,r){t.exports=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],n=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,c="data"+(s||"");if(!1===e.opts.format)return d&&(i+=" if (true) { "),i;var u,h=e.opts.$data&&o&&o.$data;h?(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; ",u="schema"+a):u=o;var p=e.opts.unknownFormats,m=Array.isArray(p);if(h)i+=" var "+(f="format"+a)+" = formats["+u+"]; var "+(g="isObject"+a)+" = typeof "+f+" == 'object' && !("+f+" instanceof RegExp) && "+f+".validate; var "+(v="formatType"+a)+" = "+g+" && "+f+".type || 'string'; if ("+g+") { ",e.async&&(i+=" var async"+a+" = "+f+".async; "),i+=" "+f+" = "+f+".validate; } if (  ",h&&(i+=" ("+u+" !== undefined && typeof "+u+" != 'string') || "),i+=" (","ignore"!=p&&(i+=" ("+u+" && !"+f+" ",m&&(i+=" && self._opts.unknownFormats.indexOf("+u+") == -1 "),i+=") || "),i+=" ("+f+" && "+v+" == '"+r+"' && !(typeof "+f+" == 'function' ? ",i+=e.async?" (async"+a+" ? await "+f+"("+c+") : "+f+"("+c+")) ":" "+f+"("+c+") ",i+=" : "+f+".test("+c+"))))) {";else{var f;if(!(f=e.formats[o])){if("ignore"==p)return e.logger.warn('unknown format "'+o+'" ignored in schema at path "'+e.errSchemaPath+'"'),d&&(i+=" if (true) { "),i;if(m&&0<=p.indexOf(o))return d&&(i+=" if (true) { "),i;throw new Error('unknown format "'+o+'" is used in schema at path "'+e.errSchemaPath+'"')}var g,v=(g="object"==typeof f&&!(f instanceof RegExp)&&f.validate)&&f.type||"string";if(g){var E=!0===f.async;f=f.validate}if(v!=r)return d&&(i+=" if (true) { "),i;if(E){if(!e.async)throw new Error("async format in sync schema");i+=" if (!(await "+(_="formats"+e.util.getProperty(o)+".validate")+"("+c+"))) { "}else{i+=" if (! ";var _="formats"+e.util.getProperty(o);g&&(_+=".validate"),i+="function"==typeof f?" "+_+"("+c+") ":" "+_+".test("+c+") ",i+=") { "}}var y=y||[];y.push(i),i="",!1!==e.createErrors?(i+=" { keyword: 'format' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { format:  ",i+=h?""+u:""+e.util.toQuotedString(o),i+="  } ",!1!==e.opts.messages&&(i+=" , message: 'should match format \"",i+=h?"' + "+u+" + '":""+e.util.escapeQuotes(o),i+="\"' "),e.opts.verbose&&(i+=" , schema:  ",i+=h?"validate.schema"+n:""+e.util.toQuotedString(o),i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),i+=" } "):i+=" {} ";var P=i;return i=y.pop(),i+=!e.compositeRule&&d?e.async?" throw new ValidationError(["+P+"]); ":" validate.errors = ["+P+"]; return false; ":" var err = "+P+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } ",d&&(i+=" else { "),i}},{}],25:[function(e,t,r){t.exports=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],n=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,c="data"+(s||""),u="valid"+a,h="errs__"+a,p=e.util.copy(e);p.level++;var m="valid"+p.level,f=e.schema.then,g=e.schema.else,v=void 0!==f&&e.util.schemaHasRules(f,e.RULES.all),E=void 0!==g&&e.util.schemaHasRules(g,e.RULES.all),_=p.baseId;if(v||E){var y;p.createErrors=!1,p.schema=o,p.schemaPath=n,p.errSchemaPath=l,i+=" var "+h+" = errors; var "+u+" = true;  ";var P=e.compositeRule;e.compositeRule=p.compositeRule=!0,i+="  "+e.validate(p)+" ",p.baseId=_,p.createErrors=!0,i+="  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; }  ",e.compositeRule=p.compositeRule=P,v?(i+=" if ("+m+") {  ",p.schema=e.schema.then,p.schemaPath=e.schemaPath+".then",p.errSchemaPath=e.errSchemaPath+"/then",i+="  "+e.validate(p)+" ",p.baseId=_,i+=" "+u+" = "+m+"; ",v&&E?i+=" var "+(y="ifClause"+a)+" = 'then'; ":y="'then'",i+=" } ",E&&(i+=" else { ")):i+=" if (!"+m+") { ",E&&(p.schema=e.schema.else,p.schemaPath=e.schemaPath+".else",p.errSchemaPath=e.errSchemaPath+"/else",i+="  "+e.validate(p)+" ",p.baseId=_,i+=" "+u+" = "+m+"; ",v&&E?i+=" var "+(y="ifClause"+a)+" = 'else'; ":y="'else'",i+=" } "),i+=" if (!"+u+") {   var err =   ",!1!==e.createErrors?(i+=" { keyword: 'if' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { failingKeyword: "+y+" } ",!1!==e.opts.messages&&(i+=" , message: 'should match \"' + "+y+" + '\" schema' "),e.opts.verbose&&(i+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),i+=" } "):i+=" {} ",i+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&d&&(i+=e.async?" throw new ValidationError(vErrors); ":" validate.errors = vErrors; return false; "),i+=" }   ",d&&(i+=" else { "),i=e.util.cleanUpCode(i)}else d&&(i+=" if (true) { ");return i}},{}],26:[function(e,t,r){t.exports={$ref:e("./ref"),allOf:e("./allOf"),anyOf:e("./anyOf"),$comment:e("./comment"),const:e("./const"),contains:e("./contains"),dependencies:e("./dependencies"),enum:e("./enum"),format:e("./format"),if:e("./if"),items:e("./items"),maximum:e("./_limit"),minimum:e("./_limit"),maxItems:e("./_limitItems"),minItems:e("./_limitItems"),maxLength:e("./_limitLength"),minLength:e("./_limitLength"),maxProperties:e("./_limitProperties"),minProperties:e("./_limitProperties"),multipleOf:e("./multipleOf"),not:e("./not"),oneOf:e("./oneOf"),pattern:e("./pattern"),properties:e("./properties"),propertyNames:e("./propertyNames"),required:e("./required"),uniqueItems:e("./uniqueItems"),validate:e("./validate")}},{"./_limit":12,"./_limitItems":13,"./_limitLength":14,"./_limitProperties":15,"./allOf":16,"./anyOf":17,"./comment":18,"./const":19,"./contains":20,"./dependencies":22,"./enum":23,"./format":24,"./if":25,"./items":27,"./multipleOf":28,"./not":29,"./oneOf":30,"./pattern":31,"./properties":32,"./propertyNames":33,"./ref":34,"./required":35,"./uniqueItems":36,"./validate":37}],27:[function(e,t,r){t.exports=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],n=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,c="data"+(s||""),u="valid"+a,h="errs__"+a,p=e.util.copy(e),m="";p.level++;var f="valid"+p.level,g="i"+a,v=p.dataLevel=e.dataLevel+1,E="data"+v,_=e.baseId;if(i+="var "+h+" = errors;var "+u+";",Array.isArray(o)){var y=e.schema.additionalItems;if(!1===y){i+=" "+u+" = "+c+".length <= "+o.length+"; ";var P=l;l=e.errSchemaPath+"/additionalItems";var S=S||[];S.push(i+="  if (!"+u+") {   "),i="",!1!==e.createErrors?(i+=" { keyword: 'additionalItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { limit: "+o.length+" } ",!1!==e.opts.messages&&(i+=" , message: 'should NOT have more than "+o.length+" items' "),e.opts.verbose&&(i+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),i+=" } "):i+=" {} ";var b=i;i=S.pop(),i+=!e.compositeRule&&d?e.async?" throw new ValidationError(["+b+"]); ":" validate.errors = ["+b+"]; return false; ":" var err = "+b+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } ",l=P,d&&(m+="}",i+=" else { ")}var A=o;if(A)for(var T,R=-1,C=A.length-1;R<C;)if(T=A[R+=1],e.util.schemaHasRules(T,e.RULES.all)){i+=" "+f+" = true; if ("+c+".length > "+R+") { ";var O=c+"["+R+"]";p.schema=T,p.schemaPath=n+"["+R+"]",p.errSchemaPath=l+"/"+R,p.errorPath=e.util.getPathExpr(e.errorPath,R,e.opts.jsonPointers,!0),p.dataPathArr[v]=R;var N=e.validate(p);p.baseId=_,e.util.varOccurences(N,E)<2?i+=" "+e.util.varReplace(N,E,O)+" ":i+=" var "+E+" = "+O+"; "+N+" ",i+=" }  ",d&&(i+=" if ("+f+") { ",m+="}")}"object"==typeof y&&e.util.schemaHasRules(y,e.RULES.all)&&(p.schema=y,p.schemaPath=e.schemaPath+".additionalItems",p.errSchemaPath=e.errSchemaPath+"/additionalItems",i+=" "+f+" = true; if ("+c+".length > "+o.length+") {  for (var "+g+" = "+o.length+"; "+g+" < "+c+".length; "+g+"++) { ",p.errorPath=e.util.getPathExpr(e.errorPath,g,e.opts.jsonPointers,!0),O=c+"["+g+"]",p.dataPathArr[v]=g,N=e.validate(p),p.baseId=_,e.util.varOccurences(N,E)<2?i+=" "+e.util.varReplace(N,E,O)+" ":i+=" var "+E+" = "+O+"; "+N+" ",d&&(i+=" if (!"+f+") break; "),i+=" } }  ",d&&(i+=" if ("+f+") { ",m+="}"))}else e.util.schemaHasRules(o,e.RULES.all)&&(p.schema=o,p.schemaPath=n,p.errSchemaPath=l,i+="  for (var "+g+" = 0; "+g+" < "+c+".length; "+g+"++) { ",p.errorPath=e.util.getPathExpr(e.errorPath,g,e.opts.jsonPointers,!0),O=c+"["+g+"]",p.dataPathArr[v]=g,N=e.validate(p),p.baseId=_,e.util.varOccurences(N,E)<2?i+=" "+e.util.varReplace(N,E,O)+" ":i+=" var "+E+" = "+O+"; "+N+" ",d&&(i+=" if (!"+f+") break; "),i+=" }");return d&&(i+=" "+m+" if ("+h+" == errors) {"),e.util.cleanUpCode(i)}},{}],28:[function(e,t,r){t.exports=function(e,t,r){var i,a=" ",s=e.level,o=e.dataLevel,n=e.schema[t],l=e.schemaPath+e.util.getProperty(t),d=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,u="data"+(o||""),h=e.opts.$data&&n&&n.$data;h?(a+=" var schema"+s+" = "+e.util.getData(n.$data,o,e.dataPathArr)+"; ",i="schema"+s):i=n,a+="var division"+s+";if (",h&&(a+=" "+i+" !== undefined && ( typeof "+i+" != 'number' || "),a+=" (division"+s+" = "+u+" / "+i+", ",a+=e.opts.multipleOfPrecision?" Math.abs(Math.round(division"+s+") - division"+s+") > 1e-"+e.opts.multipleOfPrecision+" ":" division"+s+" !== parseInt(division"+s+") ",a+=" ) ",h&&(a+="  )  ");var p=p||[];p.push(a+=" ) {   "),a="",!1!==e.createErrors?(a+=" { keyword: 'multipleOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(d)+" , params: { multipleOf: "+i+" } ",!1!==e.opts.messages&&(a+=" , message: 'should be multiple of ",a+=h?"' + "+i:i+"'"),e.opts.verbose&&(a+=" , schema:  ",a+=h?"validate.schema"+l:""+n,a+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),a+=" } "):a+=" {} ";var m=a;return a=p.pop(),a+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+m+"]); ":" validate.errors = ["+m+"]; return false; ":" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",a+="} ",c&&(a+=" else { "),a}},{}],29:[function(e,t,r){t.exports=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],n=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,c="data"+(s||""),u="errs__"+a,h=e.util.copy(e);h.level++;var p="valid"+h.level;if(e.util.schemaHasRules(o,e.RULES.all)){h.schema=o,h.schemaPath=n,h.errSchemaPath=l,i+=" var "+u+" = errors;  ";var m,f=e.compositeRule;e.compositeRule=h.compositeRule=!0,h.createErrors=!1,h.opts.allErrors&&(m=h.opts.allErrors,h.opts.allErrors=!1),i+=" "+e.validate(h)+" ",h.createErrors=!0,m&&(h.opts.allErrors=m),e.compositeRule=h.compositeRule=f;var g=g||[];g.push(i+=" if ("+p+") {   "),i="",!1!==e.createErrors?(i+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(i+=" , message: 'should NOT be valid' "),e.opts.verbose&&(i+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),i+=" } "):i+=" {} ";var v=i;i=g.pop(),i+=!e.compositeRule&&d?e.async?" throw new ValidationError(["+v+"]); ":" validate.errors = ["+v+"]; return false; ":" var err = "+v+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } else {  errors = "+u+"; if (vErrors !== null) { if ("+u+") vErrors.length = "+u+"; else vErrors = null; } ",e.opts.allErrors&&(i+=" } ")}else i+="  var err =   ",!1!==e.createErrors?(i+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(i+=" , message: 'should NOT be valid' "),e.opts.verbose&&(i+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),i+=" } "):i+=" {} ",i+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",d&&(i+=" if (false) { ");return i}},{}],30:[function(e,t,r){t.exports=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],n=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,c="data"+(s||""),u="valid"+a,h="errs__"+a,p=e.util.copy(e),m="";p.level++;var f="valid"+p.level,g=p.baseId,v="prevValid"+a,E="passingSchemas"+a;i+="var "+h+" = errors , "+v+" = false , "+u+" = false , "+E+" = null; ";var _=e.compositeRule;e.compositeRule=p.compositeRule=!0;var y=o;if(y)for(var P,S=-1,b=y.length-1;S<b;)P=y[S+=1],e.util.schemaHasRules(P,e.RULES.all)?(p.schema=P,p.schemaPath=n+"["+S+"]",p.errSchemaPath=l+"/"+S,i+="  "+e.validate(p)+" ",p.baseId=g):i+=" var "+f+" = true; ",S&&(i+=" if ("+f+" && "+v+") { "+u+" = false; "+E+" = ["+E+", "+S+"]; } else { ",m+="}"),i+=" if ("+f+") { "+u+" = "+v+" = true; "+E+" = "+S+"; }";return e.compositeRule=p.compositeRule=_,i+=m+"if (!"+u+") {   var err =   ",!1!==e.createErrors?(i+=" { keyword: 'oneOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { passingSchemas: "+E+" } ",!1!==e.opts.messages&&(i+=" , message: 'should match exactly one schema in oneOf' "),e.opts.verbose&&(i+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),i+=" } "):i+=" {} ",i+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&d&&(i+=e.async?" throw new ValidationError(vErrors); ":" validate.errors = vErrors; return false; "),i+="} else {  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; }",e.opts.allErrors&&(i+=" } "),i}},{}],31:[function(e,t,r){t.exports=function(e,t,r){var i,a=" ",s=e.level,o=e.dataLevel,n=e.schema[t],l=e.schemaPath+e.util.getProperty(t),d=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,u="data"+(o||""),h=e.opts.$data&&n&&n.$data;h?(a+=" var schema"+s+" = "+e.util.getData(n.$data,o,e.dataPathArr)+"; ",i="schema"+s):i=n;var p=h?"(new RegExp("+i+"))":e.usePattern(n);a+="if ( ",h&&(a+=" ("+i+" !== undefined && typeof "+i+" != 'string') || ");var m=m||[];m.push(a+=" !"+p+".test("+u+") ) {   "),a="",!1!==e.createErrors?(a+=" { keyword: 'pattern' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(d)+" , params: { pattern:  ",a+=h?""+i:""+e.util.toQuotedString(n),a+="  } ",!1!==e.opts.messages&&(a+=" , message: 'should match pattern \"",a+=h?"' + "+i+" + '":""+e.util.escapeQuotes(n),a+="\"' "),e.opts.verbose&&(a+=" , schema:  ",a+=h?"validate.schema"+l:""+e.util.toQuotedString(n),a+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),a+=" } "):a+=" {} ";var f=a;return a=m.pop(),a+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+f+"]); ":" validate.errors = ["+f+"]; return false; ":" var err = "+f+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",a+="} ",c&&(a+=" else { "),a}},{}],32:[function(e,t,r){t.exports=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],n=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,c="data"+(s||""),u="errs__"+a,h=e.util.copy(e),p="";h.level++;var m="valid"+h.level,f="key"+a,g="idx"+a,v=h.dataLevel=e.dataLevel+1,E="data"+v,_="dataProperties"+a,y=Object.keys(o||{}),P=e.schema.patternProperties||{},S=Object.keys(P),b=e.schema.additionalProperties,A=y.length||S.length,T=!1===b,R="object"==typeof b&&Object.keys(b).length,C=e.opts.removeAdditional,O=T||R||C,N=e.opts.ownProperties,w=e.baseId,I=e.schema.required;if(I&&(!e.opts.$data||!I.$data)&&I.length<e.opts.loopRequired)var D=e.util.toHash(I);if(i+="var "+u+" = errors;var "+m+" = true;",N&&(i+=" var "+_+" = undefined;"),O){if(i+=N?" "+_+" = "+_+" || Object.keys("+c+"); for (var "+g+"=0; "+g+"<"+_+".length; "+g+"++) { var "+f+" = "+_+"["+g+"]; ":" for (var "+f+" in "+c+") { ",A){if(i+=" var isAdditional"+a+" = !(false ",y.length)if(8<y.length)i+=" || validate.schema"+n+".hasOwnProperty("+f+") ";else{var F=y;if(F)for(var V=-1,x=F.length-1;V<x;)W=F[V+=1],i+=" || "+f+" == "+e.util.toQuotedString(W)+" "}if(S.length){var L=S;if(L)for(var M=-1,k=L.length-1;M<k;)ie=L[M+=1],i+=" || "+e.usePattern(ie)+".test("+f+") "}i+=" ); if (isAdditional"+a+") { "}if("all"==C)i+=" delete "+c+"["+f+"]; ";else{var $=e.errorPath,H="' + "+f+" + '";if(e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(e.errorPath,f,e.opts.jsonPointers)),T)if(C)i+=" delete "+c+"["+f+"]; ";else{var j=l;l=e.errSchemaPath+"/additionalProperties",(ee=ee||[]).push(i+=" "+m+" = false; "),i="",!1!==e.createErrors?(i+=" { keyword: 'additionalProperties' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { additionalProperty: '"+H+"' } ",!1!==e.opts.messages&&(i+=" , message: '",i+=e.opts._errorDataPathProperty?"is an invalid additional property":"should NOT have additional properties",i+="' "),e.opts.verbose&&(i+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),i+=" } "):i+=" {} ";var U=i;i=ee.pop(),i+=!e.compositeRule&&d?e.async?" throw new ValidationError(["+U+"]); ":" validate.errors = ["+U+"]; return false; ":" var err = "+U+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",l=j,d&&(i+=" break; ")}else if(R)if("failing"==C){i+=" var "+u+" = errors;  ";var q=e.compositeRule;e.compositeRule=h.compositeRule=!0,h.schema=b,h.schemaPath=e.schemaPath+".additionalProperties",h.errSchemaPath=e.errSchemaPath+"/additionalProperties",h.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,f,e.opts.jsonPointers);var B=c+"["+f+"]";h.dataPathArr[v]=f;var Y=e.validate(h);h.baseId=w,e.util.varOccurences(Y,E)<2?i+=" "+e.util.varReplace(Y,E,B)+" ":i+=" var "+E+" = "+B+"; "+Y+" ",i+=" if (!"+m+") { errors = "+u+"; if (validate.errors !== null) { if (errors) validate.errors.length = errors; else validate.errors = null; } delete "+c+"["+f+"]; }  ",e.compositeRule=h.compositeRule=q}else h.schema=b,h.schemaPath=e.schemaPath+".additionalProperties",h.errSchemaPath=e.errSchemaPath+"/additionalProperties",h.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,f,e.opts.jsonPointers),B=c+"["+f+"]",h.dataPathArr[v]=f,Y=e.validate(h),h.baseId=w,e.util.varOccurences(Y,E)<2?i+=" "+e.util.varReplace(Y,E,B)+" ":i+=" var "+E+" = "+B+"; "+Y+" ",d&&(i+=" if (!"+m+") break; ");e.errorPath=$}A&&(i+=" } "),i+=" }  ",d&&(i+=" if ("+m+") { ",p+="}")}var J=e.opts.useDefaults&&!e.compositeRule;if(y.length){var z=y;if(z)for(var W,G=-1,K=z.length-1;G<K;){if(W=z[G+=1],e.util.schemaHasRules(oe=o[W],e.RULES.all)){var Q=e.util.getProperty(W),X=(B=c+Q,J&&void 0!==oe.default);if(h.schema=oe,h.schemaPath=n+Q,h.errSchemaPath=l+"/"+e.util.escapeFragment(W),h.errorPath=e.util.getPath(e.errorPath,W,e.opts.jsonPointers),h.dataPathArr[v]=e.util.toQuotedString(W),Y=e.validate(h),h.baseId=w,e.util.varOccurences(Y,E)<2){Y=e.util.varReplace(Y,E,B);var Z=B}else Z=E,i+=" var "+E+" = "+B+"; ";if(X)i+=" "+Y+" ";else{if(D&&D[W]){i+=" if ( "+Z+" === undefined ",N&&(i+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(W)+"') "),i+=") { "+m+" = false; ",$=e.errorPath,j=l;var ee,te=e.util.escapeQuotes(W);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath($,W,e.opts.jsonPointers)),l=e.errSchemaPath+"/required",(ee=ee||[]).push(i),i="",!1!==e.createErrors?(i+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+te+"' } ",!1!==e.opts.messages&&(i+=" , message: '",i+=e.opts._errorDataPathProperty?"is a required property":"should have required property \\'"+te+"\\'",i+="' "),e.opts.verbose&&(i+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),i+=" } "):i+=" {} ",U=i,i=ee.pop(),i+=!e.compositeRule&&d?e.async?" throw new ValidationError(["+U+"]); ":" validate.errors = ["+U+"]; return false; ":" var err = "+U+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",l=j,e.errorPath=$,i+=" } else { "}else d?(i+=" if ( "+Z+" === undefined ",N&&(i+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(W)+"') "),i+=") { "+m+" = true; } else { "):(i+=" if ("+Z+" !== undefined ",N&&(i+=" &&   Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(W)+"') "),i+=" ) { ");i+=" "+Y+" } "}}d&&(i+=" if ("+m+") { ",p+="}")}}if(S.length){var re=S;if(re)for(var ie,ae=-1,se=re.length-1;ae<se;){var oe;ie=re[ae+=1],e.util.schemaHasRules(oe=P[ie],e.RULES.all)&&(h.schema=oe,h.schemaPath=e.schemaPath+".patternProperties"+e.util.getProperty(ie),h.errSchemaPath=e.errSchemaPath+"/patternProperties/"+e.util.escapeFragment(ie),i+=N?" "+_+" = "+_+" || Object.keys("+c+"); for (var "+g+"=0; "+g+"<"+_+".length; "+g+"++) { var "+f+" = "+_+"["+g+"]; ":" for (var "+f+" in "+c+") { ",i+=" if ("+e.usePattern(ie)+".test("+f+")) { ",h.errorPath=e.util.getPathExpr(e.errorPath,f,e.opts.jsonPointers),B=c+"["+f+"]",h.dataPathArr[v]=f,Y=e.validate(h),h.baseId=w,e.util.varOccurences(Y,E)<2?i+=" "+e.util.varReplace(Y,E,B)+" ":i+=" var "+E+" = "+B+"; "+Y+" ",d&&(i+=" if (!"+m+") break; "),i+=" } ",d&&(i+=" else "+m+" = true; "),i+=" }  ",d&&(i+=" if ("+m+") { ",p+="}"))}}return d&&(i+=" "+p+" if ("+u+" == errors) {"),e.util.cleanUpCode(i)}},{}],33:[function(e,t,r){t.exports=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],n=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,c="data"+(s||""),u="errs__"+a,h=e.util.copy(e);h.level++;var p="valid"+h.level;if(i+="var "+u+" = errors;",e.util.schemaHasRules(o,e.RULES.all)){h.schema=o,h.schemaPath=n,h.errSchemaPath=l;var m="key"+a,f="idx"+a,g="i"+a,v="' + "+m+" + '",E="data"+(h.dataLevel=e.dataLevel+1),_="dataProperties"+a,y=e.opts.ownProperties,P=e.baseId;y&&(i+=" var "+_+" = undefined; "),i+=y?" "+_+" = "+_+" || Object.keys("+c+"); for (var "+f+"=0; "+f+"<"+_+".length; "+f+"++) { var "+m+" = "+_+"["+f+"]; ":" for (var "+m+" in "+c+") { ",i+=" var startErrs"+a+" = errors; ";var S=m,b=e.compositeRule;e.compositeRule=h.compositeRule=!0;var A=e.validate(h);h.baseId=P,e.util.varOccurences(A,E)<2?i+=" "+e.util.varReplace(A,E,S)+" ":i+=" var "+E+" = "+S+"; "+A+" ",e.compositeRule=h.compositeRule=b,i+=" if (!"+p+") { for (var "+g+"=startErrs"+a+"; "+g+"<errors; "+g+"++) { vErrors["+g+"].propertyName = "+m+"; }   var err =   ",!1!==e.createErrors?(i+=" { keyword: 'propertyNames' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { propertyName: '"+v+"' } ",!1!==e.opts.messages&&(i+=" , message: 'property name \\'"+v+"\\' is invalid' "),e.opts.verbose&&(i+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),i+=" } "):i+=" {} ",i+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&d&&(i+=e.async?" throw new ValidationError(vErrors); ":" validate.errors = vErrors; return false; "),d&&(i+=" break; "),i+=" } }"}return d&&(i+="  if ("+u+" == errors) {"),e.util.cleanUpCode(i)}},{}],34:[function(e,t,r){t.exports=function(e,t,r){var i,a,s=" ",o=e.dataLevel,n=e.schema[t],l=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,c="data"+(o||""),u="valid"+e.level;if("#"==n||"#/"==n)e.isRoot?(i=e.async,a="validate"):(i=!0===e.root.schema.$async,a="root.refVal[0]");else{var h=e.resolveRef(e.baseId,n,e.isRoot);if(void 0===h){var p=e.MissingRefError.message(e.baseId,n);if("fail"==e.opts.missingRefs){e.logger.error(p),(v=v||[]).push(s),s="",!1!==e.createErrors?(s+=" { keyword: '$ref' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { ref: '"+e.util.escapeQuotes(n)+"' } ",!1!==e.opts.messages&&(s+=" , message: 'can\\'t resolve reference "+e.util.escapeQuotes(n)+"' "),e.opts.verbose&&(s+=" , schema: "+e.util.toQuotedString(n)+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),s+=" } "):s+=" {} ";var m=s;s=v.pop(),s+=!e.compositeRule&&d?e.async?" throw new ValidationError(["+m+"]); ":" validate.errors = ["+m+"]; return false; ":" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",d&&(s+=" if (false) { ")}else{if("ignore"!=e.opts.missingRefs)throw new e.MissingRefError(e.baseId,n,p);e.logger.warn(p),d&&(s+=" if (true) { ")}}else if(h.inline){var f=e.util.copy(e);f.level++;var g="valid"+f.level;f.schema=h.schema,f.schemaPath="",f.errSchemaPath=n,s+=" "+e.validate(f).replace(/validate\.schema/g,h.code)+" ",d&&(s+=" if ("+g+") { ")}else i=!0===h.$async||e.async&&!1!==h.$async,a=h.code}if(a){var v;(v=v||[]).push(s),s="",s+=e.opts.passContext?" "+a+".call(this, ":" "+a+"( ",s+=" "+c+", (dataPath || '')",'""'!=e.errorPath&&(s+=" + "+e.errorPath);var E=s+=" , "+(o?"data"+(o-1||""):"parentData")+" , "+(o?e.dataPathArr[o]:"parentDataProperty")+", rootData)  ";if(s=v.pop(),i){if(!e.async)throw new Error("async schema referenced by sync schema");d&&(s+=" var "+u+"; "),s+=" try { await "+E+"; ",d&&(s+=" "+u+" = true; "),s+=" } catch (e) { if (!(e instanceof ValidationError)) throw e; if (vErrors === null) vErrors = e.errors; else vErrors = vErrors.concat(e.errors); errors = vErrors.length; ",d&&(s+=" "+u+" = false; "),s+=" } ",d&&(s+=" if ("+u+") { ")}else s+=" if (!"+E+") { if (vErrors === null) vErrors = "+a+".errors; else vErrors = vErrors.concat("+a+".errors); errors = vErrors.length; } ",d&&(s+=" else { ")}return s}},{}],35:[function(e,t,r){t.exports=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],n=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,c="data"+(s||""),u="valid"+a,h=e.opts.$data&&o&&o.$data;h&&(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; ");var p="schema"+a;if(!h)if(o.length<e.opts.loopRequired&&e.schema.properties&&Object.keys(e.schema.properties).length){var m=[],f=o;if(f)for(var g,v=-1,E=f.length-1;v<E;){g=f[v+=1];var _=e.schema.properties[g];_&&e.util.schemaHasRules(_,e.RULES.all)||(m[m.length]=g)}}else m=o;if(h||m.length){var y=e.errorPath,P=h||e.opts.loopRequired<=m.length,S=e.opts.ownProperties;if(d)if(i+=" var missing"+a+"; ",P){h||(i+=" var "+p+" = validate.schema"+n+"; ");var b="' + "+(N="schema"+a+"["+(C="i"+a)+"]")+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(y,N,e.opts.jsonPointers)),i+=" var "+u+" = true; ",h&&(i+=" if (schema"+a+" === undefined) "+u+" = true; else if (!Array.isArray(schema"+a+")) "+u+" = false; else {"),i+=" for (var "+C+" = 0; "+C+" < "+p+".length; "+C+"++) { "+u+" = "+c+"["+p+"["+C+"]] !== undefined ",S&&(i+=" &&   Object.prototype.hasOwnProperty.call("+c+", "+p+"["+C+"]) "),i+="; if (!"+u+") break; } ",h&&(i+="  }  "),(T=T||[]).push(i+="  if (!"+u+") {   "),i="",!1!==e.createErrors?(i+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+b+"' } ",!1!==e.opts.messages&&(i+=" , message: '",i+=e.opts._errorDataPathProperty?"is a required property":"should have required property \\'"+b+"\\'",i+="' "),e.opts.verbose&&(i+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),i+=" } "):i+=" {} ";var A=i;i=T.pop(),i+=!e.compositeRule&&d?e.async?" throw new ValidationError(["+A+"]); ":" validate.errors = ["+A+"]; return false; ":" var err = "+A+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } else { "}else{i+=" if ( ";var T,R=m;if(R)for(var C=-1,O=R.length-1;C<O;)I=R[C+=1],C&&(i+=" || "),i+=" ( ( "+(x=c+(V=e.util.getProperty(I)))+" === undefined ",S&&(i+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(I)+"') "),i+=") && (missing"+a+" = "+e.util.toQuotedString(e.opts.jsonPointers?I:V)+") ) ";i+=") {  ",b="' + "+(N="missing"+a)+" + '",e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(y,N,!0):y+" + "+N),(T=T||[]).push(i),i="",!1!==e.createErrors?(i+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+b+"' } ",!1!==e.opts.messages&&(i+=" , message: '",i+=e.opts._errorDataPathProperty?"is a required property":"should have required property \\'"+b+"\\'",i+="' "),e.opts.verbose&&(i+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),i+=" } "):i+=" {} ",A=i,i=T.pop(),i+=!e.compositeRule&&d?e.async?" throw new ValidationError(["+A+"]); ":" validate.errors = ["+A+"]; return false; ":" var err = "+A+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } else { "}else if(P){var N;h||(i+=" var "+p+" = validate.schema"+n+"; "),b="' + "+(N="schema"+a+"["+(C="i"+a)+"]")+" + '",e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(y,N,e.opts.jsonPointers)),h&&(i+=" if ("+p+" && !Array.isArray("+p+")) {  var err =   ",!1!==e.createErrors?(i+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+b+"' } ",!1!==e.opts.messages&&(i+=" , message: '",i+=e.opts._errorDataPathProperty?"is a required property":"should have required property \\'"+b+"\\'",i+="' "),e.opts.verbose&&(i+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),i+=" } "):i+=" {} ",i+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } else if ("+p+" !== undefined) { "),i+=" for (var "+C+" = 0; "+C+" < "+p+".length; "+C+"++) { if ("+c+"["+p+"["+C+"]] === undefined ",S&&(i+=" || ! Object.prototype.hasOwnProperty.call("+c+", "+p+"["+C+"]) "),i+=") {  var err =   ",!1!==e.createErrors?(i+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+b+"' } ",!1!==e.opts.messages&&(i+=" , message: '",i+=e.opts._errorDataPathProperty?"is a required property":"should have required property \\'"+b+"\\'",i+="' "),e.opts.verbose&&(i+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),i+=" } "):i+=" {} ",i+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } } ",h&&(i+="  }  ")}else{var w=m;if(w)for(var I,D=-1,F=w.length-1;D<F;){I=w[D+=1];var V=e.util.getProperty(I),x=(b=e.util.escapeQuotes(I),c+V);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(y,I,e.opts.jsonPointers)),i+=" if ( "+x+" === undefined ",S&&(i+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(I)+"') "),i+=") {  var err =   ",!1!==e.createErrors?(i+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+b+"' } ",!1!==e.opts.messages&&(i+=" , message: '",i+=e.opts._errorDataPathProperty?"is a required property":"should have required property \\'"+b+"\\'",i+="' "),e.opts.verbose&&(i+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),i+=" } "):i+=" {} ",i+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}e.errorPath=y}else d&&(i+=" if (true) {");return i}},{}],36:[function(e,t,r){t.exports=function(e,t,r){var i,a=" ",s=e.level,o=e.dataLevel,n=e.schema[t],l=e.schemaPath+e.util.getProperty(t),d=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,u="data"+(o||""),h="valid"+s,p=e.opts.$data&&n&&n.$data;if(p?(a+=" var schema"+s+" = "+e.util.getData(n.$data,o,e.dataPathArr)+"; ",i="schema"+s):i=n,(n||p)&&!1!==e.opts.uniqueItems){p&&(a+=" var "+h+"; if ("+i+" === false || "+i+" === undefined) "+h+" = true; else if (typeof "+i+" != 'boolean') "+h+" = false; else { "),a+=" var i = "+u+".length , "+h+" = true , j; if (i > 1) { ";var m=e.schema.items&&e.schema.items.type,f=Array.isArray(m);!m||"object"==m||"array"==m||f&&(0<=m.indexOf("object")||0<=m.indexOf("array"))?a+=" outer: for (;i--;) { for (j = i; j--;) { if (equal("+u+"[i], "+u+"[j])) { "+h+" = false; break outer; } } } ":(a+=" var itemIndices = {}, item; for (;i--;) { var item = "+u+"[i]; ",a+=" if ("+e.util["checkDataType"+(f?"s":"")](m,"item",!0)+") continue; ",f&&(a+=" if (typeof item == 'string') item = '\"' + item; "),a+=" if (typeof itemIndices[item] == 'number') { "+h+" = false; j = itemIndices[item]; break; } itemIndices[item] = i; } "),a+=" } ",p&&(a+="  }  ");var g=g||[];g.push(a+=" if (!"+h+") {   "),a="",!1!==e.createErrors?(a+=" { keyword: 'uniqueItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(d)+" , params: { i: i, j: j } ",!1!==e.opts.messages&&(a+=" , message: 'should NOT have duplicate items (items ## ' + j + ' and ' + i + ' are identical)' "),e.opts.verbose&&(a+=" , schema:  ",a+=p?"validate.schema"+l:""+n,a+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),a+=" } "):a+=" {} ";var v=a;a=g.pop(),a+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+v+"]); ":" validate.errors = ["+v+"]; return false; ":" var err = "+v+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",a+=" } ",c&&(a+=" else { ")}else c&&(a+=" if (true) { ");return a}},{}],37:[function(e,t,r){t.exports=function(e,t,r){var i="",a=!0===e.schema.$async,s=e.util.schemaHasRulesExcept(e.schema,e.RULES.all,"$ref"),o=e.self._getId(e.schema);if(e.isTop&&(i+=" var validate = ",a&&(e.async=!0,i+="async "),i+="function(data, dataPath, parentData, parentDataProperty, rootData) { 'use strict'; ",o&&(e.opts.sourceCode||e.opts.processCode)&&(i+=" /*# sourceURL="+o+" */ ")),"boolean"==typeof e.schema||!s&&!e.schema.$ref){var n=e.level,l=e.dataLevel,d=e.schema[t="false schema"],c=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,h=!e.opts.allErrors,p="data"+(l||""),m="valid"+n;if(!1===e.schema){e.isTop?h=!0:i+=" var "+m+" = false; ",(U=U||[]).push(i),i="",!1!==e.createErrors?(i+=" { keyword: 'false schema' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: {} ",!1!==e.opts.messages&&(i+=" , message: 'boolean schema is false' "),e.opts.verbose&&(i+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),i+=" } "):i+=" {} ";var f=i;i=U.pop(),i+=!e.compositeRule&&h?e.async?" throw new ValidationError(["+f+"]); ":" validate.errors = ["+f+"]; return false; ":" var err = "+f+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else i+=e.isTop?a?" return data; ":" validate.errors = null; return true; ":" var "+m+" = true; ";return e.isTop&&(i+=" }; return validate; "),i}if(e.isTop){var g=e.isTop;n=e.level=0,l=e.dataLevel=0,p="data",e.rootId=e.resolve.fullPath(e.self._getId(e.root.schema)),e.baseId=e.baseId||e.rootId,delete e.isTop,e.dataPathArr=[void 0],i+=" var vErrors = null; ",i+=" var errors = 0;     ",i+=" if (rootData === undefined) rootData = data; "}else{if(n=e.level,p="data"+((l=e.dataLevel)||""),o&&(e.baseId=e.resolve.url(e.baseId,o)),a&&!e.async)throw new Error("async schema in sync schema");i+=" var errs_"+n+" = errors;"}m="valid"+n,h=!e.opts.allErrors;var v="",E="",_=e.schema.type,y=Array.isArray(_);if(y&&1==_.length&&(_=_[0],y=!1),e.schema.$ref&&s){if("fail"==e.opts.extendRefs)throw new Error('$ref: validation keywords used in schema at path "'+e.errSchemaPath+'" (see option extendRefs)');!0!==e.opts.extendRefs&&(s=!1,e.logger.warn('$ref: keywords ignored in schema at path "'+e.errSchemaPath+'"'))}if(e.schema.$comment&&e.opts.$comment&&(i+=" "+e.RULES.all.$comment.code(e,"$comment")),_){if(e.opts.coerceTypes)var P=e.util.coerceToTypes(e.opts.coerceTypes,_);var S=e.RULES.types[_];if(P||y||!0===S||S&&!W(S)){if(c=e.schemaPath+".type",u=e.errSchemaPath+"/type",c=e.schemaPath+".type",u=e.errSchemaPath+"/type",i+=" if ("+e.util[y?"checkDataTypes":"checkDataType"](_,p,!0)+") { ",P){var b="dataType"+n,A="coerced"+n;i+=" var "+b+" = typeof "+p+"; ","array"==e.opts.coerceTypes&&(i+=" if ("+b+" == 'object' && Array.isArray("+p+")) "+b+" = 'array'; "),i+=" var "+A+" = undefined; ";var T="",R=P;if(R)for(var C,O=-1,N=R.length-1;O<N;)C=R[O+=1],O&&(i+=" if ("+A+" === undefined) { ",T+="}"),"array"==e.opts.coerceTypes&&"array"!=C&&(i+=" if ("+b+" == 'array' && "+p+".length == 1) { "+A+" = "+p+" = "+p+"[0]; "+b+" = typeof "+p+";  } "),"string"==C?i+=" if ("+b+" == 'number' || "+b+" == 'boolean') "+A+" = '' + "+p+"; else if ("+p+" === null) "+A+" = ''; ":"number"==C||"integer"==C?(i+=" if ("+b+" == 'boolean' || "+p+" === null || ("+b+" == 'string' && "+p+" && "+p+" == +"+p+" ","integer"==C&&(i+=" && !("+p+" % 1)"),i+=")) "+A+" = +"+p+"; "):"boolean"==C?i+=" if ("+p+" === 'false' || "+p+" === 0 || "+p+" === null) "+A+" = false; else if ("+p+" === 'true' || "+p+" === 1) "+A+" = true; ":"null"==C?i+=" if ("+p+" === '' || "+p+" === 0 || "+p+" === false) "+A+" = null; ":"array"==e.opts.coerceTypes&&"array"==C&&(i+=" if ("+b+" == 'string' || "+b+" == 'number' || "+b+" == 'boolean' || "+p+" == null) "+A+" = ["+p+"]; ");(U=U||[]).push(i+=" "+T+" if ("+A+" === undefined) {   "),i="",!1!==e.createErrors?(i+=" { keyword: 'type' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { type: '",i+=y?""+_.join(","):""+_,i+="' } ",!1!==e.opts.messages&&(i+=" , message: 'should be ",i+=y?""+_.join(","):""+_,i+="' "),e.opts.verbose&&(i+=" , schema: validate.schema"+c+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),i+=" } "):i+=" {} ",f=i,i=U.pop(),i+=!e.compositeRule&&h?e.async?" throw new ValidationError(["+f+"]); ":" validate.errors = ["+f+"]; return false; ":" var err = "+f+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } else {  ";var w=l?"data"+(l-1||""):"parentData";i+=" "+p+" = "+A+"; ",l||(i+="if ("+w+" !== undefined)"),i+=" "+w+"["+(l?e.dataPathArr[l]:"parentDataProperty")+"] = "+A+"; } "}else(U=U||[]).push(i),i="",!1!==e.createErrors?(i+=" { keyword: 'type' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { type: '",i+=y?""+_.join(","):""+_,i+="' } ",!1!==e.opts.messages&&(i+=" , message: 'should be ",i+=y?""+_.join(","):""+_,i+="' "),e.opts.verbose&&(i+=" , schema: validate.schema"+c+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),i+=" } "):i+=" {} ",f=i,i=U.pop(),i+=!e.compositeRule&&h?e.async?" throw new ValidationError(["+f+"]); ":" validate.errors = ["+f+"]; return false; ":" var err = "+f+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";i+=" } "}}if(e.schema.$ref&&!s)i+=" "+e.RULES.all.$ref.code(e,"$ref")+" ",h&&(i+=" } if (errors === ",i+=g?"0":"errs_"+n,i+=") { ",E+="}");else{var I=e.RULES;if(I)for(var D=-1,F=I.length-1;D<F;)if(W(S=I[D+=1])){if(S.type&&(i+=" if ("+e.util.checkDataType(S.type,p)+") { "),e.opts.useDefaults&&!e.compositeRule)if("object"==S.type&&e.schema.properties){d=e.schema.properties;var V=Object.keys(d);if(V)for(var x,L=-1,M=V.length-1;L<M;)void 0!==($=d[x=V[L+=1]]).default&&(i+="  if ("+(j=p+e.util.getProperty(x))+" === undefined) "+j+" = ",i+="shared"==e.opts.useDefaults?" "+e.useDefault($.default)+" ":" "+JSON.stringify($.default)+" ",i+="; ")}else if("array"==S.type&&Array.isArray(e.schema.items)){var k=e.schema.items;if(k){O=-1;for(var $,H=k.length-1;O<H;){var j;void 0!==($=k[O+=1]).default&&(i+="  if ("+(j=p+"["+O+"]")+" === undefined) "+j+" = ",i+="shared"==e.opts.useDefaults?" "+e.useDefault($.default)+" ":" "+JSON.stringify($.default)+" ",i+="; ")}}}var U,q=S.rules;if(q)for(var B,Y=-1,J=q.length-1;Y<J;)if(G(B=q[Y+=1])){var z=B.code(e,B.keyword,S.type);z&&(i+=" "+z+" ",h&&(v+="}"))}h&&(i+=" "+v+" ",v=""),S.type&&(i+=" } ",_&&_===S.type&&!P)&&(c=e.schemaPath+".type",u=e.errSchemaPath+"/type",(U=U||[]).push(i+=" else { "),i="",!1!==e.createErrors?(i+=" { keyword: 'type' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { type: '",i+=y?""+_.join(","):""+_,i+="' } ",!1!==e.opts.messages&&(i+=" , message: 'should be ",i+=y?""+_.join(","):""+_,i+="' "),e.opts.verbose&&(i+=" , schema: validate.schema"+c+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),i+=" } "):i+=" {} ",f=i,i=U.pop(),i+=!e.compositeRule&&h?e.async?" throw new ValidationError(["+f+"]); ":" validate.errors = ["+f+"]; return false; ":" var err = "+f+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } "),h&&(i+=" if (errors === ",i+=g?"0":"errs_"+n,i+=") { ",E+="}")}}function W(e){for(var t=e.rules,r=0;r<t.length;r++)if(G(t[r]))return!0}function G(t){return void 0!==e.schema[t.keyword]||t.implements&&function(t){for(var r=t.implements,i=0;i<r.length;i++)if(void 0!==e.schema[r[i]])return!0}(t)}return h&&(i+=" "+E+" "),g?(a?(i+=" if (errors === 0) return data;           ",i+=" else throw new ValidationError(vErrors); "):(i+=" validate.errors = vErrors; ",i+=" return errors === 0;       "),i+=" }; return validate;"):i+=" var "+m+" = errors === errs_"+n+";",i=e.util.cleanUpCode(i),g&&(i=e.util.finalCleanUpCode(i,a)),i}},{}],38:[function(e,t,r){var i=/^[a-z_$][a-z0-9_$-]*$/i,a=e("./dotjs/custom");t.exports={add:function(e,t){var r=this.RULES;if(r.keywords[e])throw new Error("Keyword "+e+" is already defined");if(!i.test(e))throw new Error("Keyword "+e+" is not a valid identifier");if(t){if(t.macro&&void 0!==t.valid)throw new Error('"valid" option cannot be used with macro keywords');var s=t.type;if(Array.isArray(s)){var o,n=s.length;for(o=0;o<n;o++)u(s[o]);for(o=0;o<n;o++)c(e,s[o],t)}else s&&u(s),c(e,s,t);var l=!0===t.$data&&this._opts.$data;if(l&&!t.validate)throw new Error('$data support: "validate" function is not defined');var d=t.metaSchema;d&&(l&&(d={anyOf:[d,{$ref:"https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/data.json#"}]}),t.validateSchema=this.compile(d,!0))}function c(e,t,i){for(var s,o=0;o<r.length;o++){var n=r[o];if(n.type==t){s=n;break}}s||r.push(s={type:t,rules:[]});var l={keyword:e,definition:i,custom:!0,code:a,implements:i.implements};s.rules.push(l),r.custom[e]=l}function u(e){if(!r.types[e])throw new Error("Unknown type "+e)}return r.keywords[e]=r.all[e]=!0,this},get:function(e){var t=this.RULES.custom[e];return t?t.definition:this.RULES.keywords[e]||!1},remove:function(e){var t=this.RULES;delete t.keywords[e],delete t.all[e],delete t.custom[e];for(var r=0;r<t.length;r++)for(var i=t[r].rules,a=0;a<i.length;a++)if(i[a].keyword==e){i.splice(a,1);break}return this}}},{"./dotjs/custom":21}],39:[function(e,t,r){t.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON Schema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1}},{}],40:[function(e,t,r){t.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0}},{}],41:[function(e,t,r){var i=Array.isArray,a=Object.keys,s=Object.prototype.hasOwnProperty;t.exports=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){var o,n,l,d=i(t),c=i(r);if(d&&c){if((n=t.length)!=r.length)return!1;for(o=n;0!=o--;)if(!e(t[o],r[o]))return!1;return!0}if(d!=c)return!1;var u=t instanceof Date,h=r instanceof Date;if(u!=h)return!1;if(u&&h)return t.getTime()==r.getTime();var p=t instanceof RegExp,m=r instanceof RegExp;if(p!=m)return!1;if(p&&m)return t.toString()==r.toString();var f=a(t);if((n=f.length)!==a(r).length)return!1;for(o=n;0!=o--;)if(!s.call(r,f[o]))return!1;for(o=n;0!=o--;)if(!e(t[l=f[o]],r[l]))return!1;return!0}return t!=t&&r!=r}},{}],42:[function(e,t,r){t.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var r,i="boolean"==typeof t.cycles&&t.cycles,a=t.cmp&&(r=t.cmp,function(e){return function(t,i){return r({key:t,value:e[t]},{key:i,value:e[i]})}}),s=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var r,o;if(Array.isArray(t)){for(o="[",r=0;r<t.length;r++)r&&(o+=","),o+=e(t[r])||"null";return o+"]"}if(null===t)return"null";if(-1!==s.indexOf(t)){if(i)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var n=s.push(t)-1,l=Object.keys(t).sort(a&&a(t));for(o="",r=0;r<l.length;r++){var d=l[r],c=e(t[d]);c&&(o&&(o+=","),o+=JSON.stringify(d)+":"+c)}return s.splice(n,1),"{"+o+"}"}}(e)}},{}],43:[function(e,t,r){var i=t.exports=function(e,t,r){"function"==typeof t&&(r=t,t={}),function e(t,r,a,s,o,n,l,d,c){if(a&&"object"==typeof a&&!Array.isArray(a))for(var u in r(a,s,o,n,l,d,c),a){var h=a[u];if(Array.isArray(h)){if(u in i.arrayKeywords)for(var p=0;p<h.length;p++)e(t,r,h[p],s+"/"+u+"/"+p,o,s,u,a,p)}else if(u in i.propsKeywords){if(h&&"object"==typeof h)for(var m in h)e(t,r,h[m],s+"/"+u+"/"+m.replace(/~/g,"~0").replace(/\//g,"~1"),o,s,u,a,m)}else(u in i.keywords||t.allKeys&&!(u in i.skipKeywords))&&e(t,r,h,s+"/"+u,o,s,u,a)}}(t,r,e,"",e)};i.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0},i.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0},i.propsKeywords={definitions:!0,properties:!0,patternProperties:!0,dependencies:!0},i.skipKeywords={enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0}},{}],44:[function(e,t,r){var i;i=this,function(e){function t(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];if(1<t.length){t[0]=t[0].slice(0,-1);for(var i=t.length-1,a=1;a<i;++a)t[a]=t[a].slice(1,-1);return t[i]=t[i].slice(1),t.join("")}return t[0]}function r(e){return"(?:"+e+")"}function i(e){return void 0===e?"undefined":null===e?"null":Object.prototype.toString.call(e).split(" ").pop().split("]").shift().toLowerCase()}function a(e){return e.toUpperCase()}function s(e){var i="[A-Za-z]",a="[0-9]",s=t(a,"[A-Fa-f]"),o=r(r("%[EFef]"+s+"%"+s+s+"%"+s+s)+"|"+r("%[89A-Fa-f]"+s+"%"+s+s)+"|"+r("%"+s+s)),n="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",l=t("[\\:\\/\\?\\#\\[\\]\\@]",n),d=e?"[\\uE000-\\uF8FF]":"[]",c=t(i,a,"[\\-\\.\\_\\~]",e?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]");r(i+t(i,a,"[\\+\\-\\.]")+"*"),r(r(o+"|"+t(c,n,"[\\:]"))+"*");var u=r(r("25[0-5]")+"|"+r("2[0-4]"+a)+"|"+r("1"+a+a)+"|"+r("0?[1-9]"+a)+"|0?0?"+a),h=r(u+"\\."+u+"\\."+u+"\\."+u),p=r(s+"{1,4}"),m=r(r(p+"\\:"+p)+"|"+h),f=r([r(r(p+"\\:")+"{6}"+m),r("\\:\\:"+r(p+"\\:")+"{5}"+m),r(r(p)+"?\\:\\:"+r(p+"\\:")+"{4}"+m),r(r(r(p+"\\:")+"{0,1}"+p)+"?\\:\\:"+r(p+"\\:")+"{3}"+m),r(r(r(p+"\\:")+"{0,2}"+p)+"?\\:\\:"+r(p+"\\:")+"{2}"+m),r(r(r(p+"\\:")+"{0,3}"+p)+"?\\:\\:"+p+"\\:"+m),r(r(r(p+"\\:")+"{0,4}"+p)+"?\\:\\:"+m),r(r(r(p+"\\:")+"{0,5}"+p)+"?\\:\\:"+p),r(r(r(p+"\\:")+"{0,6}"+p)+"?\\:\\:")].join("|")),g=r(r(c+"|"+o)+"+");r("\\["+r(r(f+r("\\%25|\\%(?!"+s+"{2})")+g)+"|"+f+"|"+r("[vV]"+s+"+\\."+t(c,n,"[\\:]")+"+"))+"\\]"),r(r(o+"|"+t(c,n))+"*");var v=r(o+"|"+t(c,n,"[\\:\\@]"));return r(r(o+"|"+t(c,n,"[\\@]"))+"+"),r(r(v+"|"+t("[\\/\\?]",d))+"*"),{NOT_SCHEME:new RegExp(t("[^]",i,a,"[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(t("[^\\%\\:]",c,n),"g"),NOT_HOST:new RegExp(t("[^\\%\\[\\]\\:]",c,n),"g"),NOT_PATH:new RegExp(t("[^\\%\\/\\:\\@]",c,n),"g"),NOT_PATH_NOSCHEME:new RegExp(t("[^\\%\\/\\@]",c,n),"g"),NOT_QUERY:new RegExp(t("[^\\%]",c,n,"[\\:\\@\\/\\?]",d),"g"),NOT_FRAGMENT:new RegExp(t("[^\\%]",c,n,"[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(t("[^]",c,n),"g"),UNRESERVED:new RegExp(c,"g"),OTHER_CHARS:new RegExp(t("[^\\%]",c,l),"g"),PCT_ENCODED:new RegExp(o,"g"),IPV4ADDRESS:new RegExp("^("+h+")$"),IPV6ADDRESS:new RegExp("^\\[?("+f+")"+r(r("\\%25|\\%(?!"+s+"{2})")+"("+g+")")+"?\\]?$")}}var o=s(!1),n=s(!0),l=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],i=!0,a=!1,s=void 0;try{for(var o,n=e[Symbol.iterator]();!(i=(o=n.next()).done)&&(r.push(o.value),!t||r.length!==t);i=!0);}catch(e){a=!0,s=e}finally{try{!i&&n.return&&n.return()}finally{if(a)throw s}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},d=2147483647,c=/^xn--/,u=/[^\0-\x7E]/,h=/[\x2E\u3002\uFF0E\uFF61]/g,p={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},m=Math.floor,f=String.fromCharCode;function g(e){throw new RangeError(p[e])}function v(e,t){var r=e.split("@"),i="";return 1<r.length&&(i=r[0]+"@",e=r[1]),i+function(e,t){for(var r=[],i=e.length;i--;)r[i]=t(e[i]);return r}((e=e.replace(h,".")).split("."),t).join(".")}function E(e){for(var t=[],r=0,i=e.length;r<i;){var a=e.charCodeAt(r++);if(55296<=a&&a<=56319&&r<i){var s=e.charCodeAt(r++);56320==(64512&s)?t.push(((1023&a)<<10)+(1023&s)+65536):(t.push(a),r--)}else t.push(a)}return t}var _=function(e,t){return e+22+75*(e<26)-((0!=t)<<5)},y=function(e,t,r){var i=0;for(e=r?m(e/700):e>>1,e+=m(e/t);455<e;i+=36)e=m(e/35);return m(i+36*e/(e+38))},P=function(e){var t,r=[],i=e.length,a=0,s=128,o=72,n=e.lastIndexOf("-");n<0&&(n=0);for(var l=0;l<n;++l)128<=e.charCodeAt(l)&&g("not-basic"),r.push(e.charCodeAt(l));for(var c=0<n?n+1:0;c<i;){for(var u=a,h=1,p=36;;p+=36){i<=c&&g("invalid-input");var f=(t=e.charCodeAt(c++))-48<10?t-22:t-65<26?t-65:t-97<26?t-97:36;(36<=f||f>m((d-a)/h))&&g("overflow"),a+=f*h;var v=p<=o?1:o+26<=p?26:p-o;if(f<v)break;var E=36-v;h>m(d/E)&&g("overflow"),h*=E}var _=r.length+1;o=y(a-u,_,0==u),m(a/_)>d-s&&g("overflow"),s+=m(a/_),a%=_,r.splice(a++,0,s)}return String.fromCodePoint.apply(String,r)},S=function(e){var t=[],r=(e=E(e)).length,i=128,a=0,s=72,o=!0,n=!1,l=void 0;try{for(var c,u=e[Symbol.iterator]();!(o=(c=u.next()).done);o=!0){var h=c.value;h<128&&t.push(f(h))}}catch(e){n=!0,l=e}finally{try{!o&&u.return&&u.return()}finally{if(n)throw l}}var p=t.length,v=p;for(p&&t.push("-");v<r;){var P=d,S=!0,b=!1,A=void 0;try{for(var T,R=e[Symbol.iterator]();!(S=(T=R.next()).done);S=!0){var C=T.value;i<=C&&C<P&&(P=C)}}catch(e){b=!0,A=e}finally{try{!S&&R.return&&R.return()}finally{if(b)throw A}}var O=v+1;P-i>m((d-a)/O)&&g("overflow"),a+=(P-i)*O,i=P;var N=!0,w=!1,I=void 0;try{for(var D,F=e[Symbol.iterator]();!(N=(D=F.next()).done);N=!0){var V=D.value;if(V<i&&++a>d&&g("overflow"),V==i){for(var x=a,L=36;;L+=36){var M=L<=s?1:s+26<=L?26:L-s;if(x<M)break;var k=x-M,$=36-M;t.push(f(_(M+k%$,0))),x=m(k/$)}t.push(f(_(x,0))),s=y(a,O,v==p),a=0,++v}}}catch(e){w=!0,I=e}finally{try{!N&&F.return&&F.return()}finally{if(w)throw I}}++a,++i}return t.join("")},b={version:"2.1.0",ucs2:{decode:E,encode:function(e){return String.fromCodePoint.apply(String,function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(e))}},decode:P,encode:S,toASCII:function(e){return v(e,(function(e){return u.test(e)?"xn--"+S(e):e}))},toUnicode:function(e){return v(e,(function(e){return c.test(e)?P(e.slice(4).toLowerCase()):e}))}},A={};function T(e){var t=e.charCodeAt(0);return t<16?"%0"+t.toString(16).toUpperCase():t<128?"%"+t.toString(16).toUpperCase():t<2048?"%"+(t>>6|192).toString(16).toUpperCase()+"%"+(63&t|128).toString(16).toUpperCase():"%"+(t>>12|224).toString(16).toUpperCase()+"%"+(t>>6&63|128).toString(16).toUpperCase()+"%"+(63&t|128).toString(16).toUpperCase()}function R(e){for(var t="",r=0,i=e.length;r<i;){var a=parseInt(e.substr(r+1,2),16);if(a<128)t+=String.fromCharCode(a),r+=3;else if(194<=a&&a<224){if(6<=i-r){var s=parseInt(e.substr(r+4,2),16);t+=String.fromCharCode((31&a)<<6|63&s)}else t+=e.substr(r,6);r+=6}else if(224<=a){if(9<=i-r){var o=parseInt(e.substr(r+4,2),16),n=parseInt(e.substr(r+7,2),16);t+=String.fromCharCode((15&a)<<12|(63&o)<<6|63&n)}else t+=e.substr(r,9);r+=9}else t+=e.substr(r,3),r+=3}return t}function C(e,t){function r(e){var r=R(e);return r.match(t.UNRESERVED)?r:e}return e.scheme&&(e.scheme=String(e.scheme).replace(t.PCT_ENCODED,r).toLowerCase().replace(t.NOT_SCHEME,"")),void 0!==e.userinfo&&(e.userinfo=String(e.userinfo).replace(t.PCT_ENCODED,r).replace(t.NOT_USERINFO,T).replace(t.PCT_ENCODED,a)),void 0!==e.host&&(e.host=String(e.host).replace(t.PCT_ENCODED,r).toLowerCase().replace(t.NOT_HOST,T).replace(t.PCT_ENCODED,a)),void 0!==e.path&&(e.path=String(e.path).replace(t.PCT_ENCODED,r).replace(e.scheme?t.NOT_PATH:t.NOT_PATH_NOSCHEME,T).replace(t.PCT_ENCODED,a)),void 0!==e.query&&(e.query=String(e.query).replace(t.PCT_ENCODED,r).replace(t.NOT_QUERY,T).replace(t.PCT_ENCODED,a)),void 0!==e.fragment&&(e.fragment=String(e.fragment).replace(t.PCT_ENCODED,r).replace(t.NOT_FRAGMENT,T).replace(t.PCT_ENCODED,a)),e}function O(e){return e.replace(/^0*(.*)/,"$1")||"0"}function N(e,t){var r=e.match(t.IPV4ADDRESS)||[],i=l(r,2)[1];return i?i.split(".").map(O).join("."):e}function w(e,t){var r=e.match(t.IPV6ADDRESS)||[],i=l(r,3),a=i[1],s=i[2];if(a){for(var o=a.toLowerCase().split("::").reverse(),n=l(o,2),d=n[0],c=n[1],u=c?c.split(":").map(O):[],h=d.split(":").map(O),p=t.IPV4ADDRESS.test(h[h.length-1]),m=p?7:8,f=h.length-m,g=Array(m),v=0;v<m;++v)g[v]=u[v]||h[f+v]||"";p&&(g[m-1]=N(g[m-1],t));var E=g.reduce((function(e,t,r){if(!t||"0"===t){var i=e[e.length-1];i&&i.index+i.length===r?i.length++:e.push({index:r,length:1})}return e}),[]).sort((function(e,t){return t.length-e.length}))[0],_=void 0;if(E&&1<E.length){var y=g.slice(0,E.index),P=g.slice(E.index+E.length);_=y.join(":")+"::"+P.join(":")}else _=g.join(":");return s&&(_+="%"+s),_}return e}var I=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,D=void 0==="".match(/(){0}/)[1];function F(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r={},i=!1!==t.iri?n:o;"suffix"===t.reference&&(e=(t.scheme?t.scheme+":":"")+"//"+e);var a=e.match(I);if(a){D?(r.scheme=a[1],r.userinfo=a[3],r.host=a[4],r.port=parseInt(a[5],10),r.path=a[6]||"",r.query=a[7],r.fragment=a[8],isNaN(r.port)&&(r.port=a[5])):(r.scheme=a[1]||void 0,r.userinfo=-1!==e.indexOf("@")?a[3]:void 0,r.host=-1!==e.indexOf("//")?a[4]:void 0,r.port=parseInt(a[5],10),r.path=a[6]||"",r.query=-1!==e.indexOf("?")?a[7]:void 0,r.fragment=-1!==e.indexOf("#")?a[8]:void 0,isNaN(r.port)&&(r.port=e.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?a[4]:void 0)),r.host&&(r.host=w(N(r.host,i),i)),r.reference=void 0!==r.scheme||void 0!==r.userinfo||void 0!==r.host||void 0!==r.port||r.path||void 0!==r.query?void 0===r.scheme?"relative":void 0===r.fragment?"absolute":"uri":"same-document",t.reference&&"suffix"!==t.reference&&t.reference!==r.reference&&(r.error=r.error||"URI is not a "+t.reference+" reference.");var s=A[(t.scheme||r.scheme||"").toLowerCase()];if(t.unicodeSupport||s&&s.unicodeSupport)C(r,i);else{if(r.host&&(t.domainHost||s&&s.domainHost))try{r.host=b.toASCII(r.host.replace(i.PCT_ENCODED,R).toLowerCase())}catch(e){r.error=r.error||"Host's domain name can not be converted to ASCII via punycode: "+e}C(r,o)}s&&s.parse&&s.parse(r,t)}else r.error=r.error||"URI can not be parsed.";return r}var V=/^\.\.?\//,x=/^\/\.(\/|$)/,L=/^\/\.\.(\/|$)/,M=/^\/?(?:.|\n)*?(?=\/|$)/;function k(e){for(var t=[];e.length;)if(e.match(V))e=e.replace(V,"");else if(e.match(x))e=e.replace(x,"/");else if(e.match(L))e=e.replace(L,"/"),t.pop();else if("."===e||".."===e)e="";else{var r=e.match(M);if(!r)throw new Error("Unexpected dot segment condition");var i=r[0];e=e.slice(i.length),t.push(i)}return t.join("")}function $(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=t.iri?n:o,i=[],a=A[(t.scheme||e.scheme||"").toLowerCase()];if(a&&a.serialize&&a.serialize(e,t),e.host)if(r.IPV6ADDRESS.test(e.host));else if(t.domainHost||a&&a.domainHost)try{e.host=t.iri?b.toUnicode(e.host):b.toASCII(e.host.replace(r.PCT_ENCODED,R).toLowerCase())}catch(r){e.error=e.error||"Host's domain name can not be converted to "+(t.iri?"Unicode":"ASCII")+" via punycode: "+r}C(e,r),"suffix"!==t.reference&&e.scheme&&(i.push(e.scheme),i.push(":"));var s,l,d,c=(l=!1!==t.iri?n:o,d=[],void 0!==(s=e).userinfo&&(d.push(s.userinfo),d.push("@")),void 0!==s.host&&d.push(w(N(String(s.host),l),l).replace(l.IPV6ADDRESS,(function(e,t,r){return"["+t+(r?"%25"+r:"")+"]"}))),"number"==typeof s.port&&(d.push(":"),d.push(s.port.toString(10))),d.length?d.join(""):void 0);if(void 0!==c&&("suffix"!==t.reference&&i.push("//"),i.push(c),e.path&&"/"!==e.path.charAt(0)&&i.push("/")),void 0!==e.path){var u=e.path;t.absolutePath||a&&a.absolutePath||(u=k(u)),void 0===c&&(u=u.replace(/^\/\//,"/%2F")),i.push(u)}return void 0!==e.query&&(i.push("?"),i.push(e.query)),void 0!==e.fragment&&(i.push("#"),i.push(e.fragment)),i.join("")}function H(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i={};return arguments[3]||(e=F($(e,r),r),t=F($(t,r),r)),!(r=r||{}).tolerant&&t.scheme?(i.scheme=t.scheme,i.userinfo=t.userinfo,i.host=t.host,i.port=t.port,i.path=k(t.path||""),i.query=t.query):(void 0!==t.userinfo||void 0!==t.host||void 0!==t.port?(i.userinfo=t.userinfo,i.host=t.host,i.port=t.port,i.path=k(t.path||""),i.query=t.query):(t.path?("/"===t.path.charAt(0)?i.path=k(t.path):(i.path=void 0===e.userinfo&&void 0===e.host&&void 0===e.port||e.path?e.path?e.path.slice(0,e.path.lastIndexOf("/")+1)+t.path:t.path:"/"+t.path,i.path=k(i.path)),i.query=t.query):(i.path=e.path,i.query=void 0!==t.query?t.query:e.query),i.userinfo=e.userinfo,i.host=e.host,i.port=e.port),i.scheme=e.scheme),i.fragment=t.fragment,i}function j(e,t){return e&&e.toString().replace(t&&t.iri?n.PCT_ENCODED:o.PCT_ENCODED,R)}var U={scheme:"http",domainHost:!0,parse:function(e,t){return e.host||(e.error=e.error||"HTTP URIs must have a host."),e},serialize:function(e,t){return e.port!==("https"!==String(e.scheme).toLowerCase()?80:443)&&""!==e.port||(e.port=void 0),e.path||(e.path="/"),e}},q={scheme:"https",domainHost:U.domainHost,parse:U.parse,serialize:U.serialize},B={},Y="[A-Za-z0-9\\-\\.\\_\\~\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]",J="[0-9A-Fa-f]",z=r(r("%[EFef]"+J+"%"+J+J+"%"+J+J)+"|"+r("%[89A-Fa-f]"+J+"%"+J+J)+"|"+r("%"+J+J)),W=t("[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",'[\\"\\\\]'),G=new RegExp(Y,"g"),K=new RegExp(z,"g"),Q=new RegExp(t("[^]","[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]","[\\.]",'[\\"]',W),"g"),X=new RegExp(t("[^]",Y,"[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]"),"g"),Z=X;function ee(e){var t=R(e);return t.match(G)?t:e}var te={scheme:"mailto",parse:function(e,t){var r=e,i=r.to=r.path?r.path.split(","):[];if(r.path=void 0,r.query){for(var a=!1,s={},o=r.query.split("&"),n=0,l=o.length;n<l;++n){var d=o[n].split("=");switch(d[0]){case"to":for(var c=d[1].split(","),u=0,h=c.length;u<h;++u)i.push(c[u]);break;case"subject":r.subject=j(d[1],t);break;case"body":r.body=j(d[1],t);break;default:a=!0,s[j(d[0],t)]=j(d[1],t)}}a&&(r.headers=s)}r.query=void 0;for(var p=0,m=i.length;p<m;++p){var f=i[p].split("@");if(f[0]=j(f[0]),t.unicodeSupport)f[1]=j(f[1],t).toLowerCase();else try{f[1]=b.toASCII(j(f[1],t).toLowerCase())}catch(e){r.error=r.error||"Email address's domain name can not be converted to ASCII via punycode: "+e}i[p]=f.join("@")}return r},serialize:function(e,t){var r,i=e,s=null!=(r=e.to)?r instanceof Array?r:"number"!=typeof r.length||r.split||r.setInterval||r.call?[r]:Array.prototype.slice.call(r):[];if(s){for(var o=0,n=s.length;o<n;++o){var l=String(s[o]),d=l.lastIndexOf("@"),c=l.slice(0,d).replace(K,ee).replace(K,a).replace(Q,T),u=l.slice(d+1);try{u=t.iri?b.toUnicode(u):b.toASCII(j(u,t).toLowerCase())}catch(e){i.error=i.error||"Email address's domain name can not be converted to "+(t.iri?"Unicode":"ASCII")+" via punycode: "+e}s[o]=c+"@"+u}i.path=s.join(",")}var h=e.headers=e.headers||{};e.subject&&(h.subject=e.subject),e.body&&(h.body=e.body);var p=[];for(var m in h)h[m]!==B[m]&&p.push(m.replace(K,ee).replace(K,a).replace(X,T)+"="+h[m].replace(K,ee).replace(K,a).replace(Z,T));return p.length&&(i.query=p.join("&")),i}},re=/^([^\:]+)\:(.*)/,ie={scheme:"urn",parse:function(e,t){var r=e.path&&e.path.match(re),i=e;if(r){var a=t.scheme||i.scheme||"urn",s=r[1].toLowerCase(),o=r[2],n=A[a+":"+(t.nid||s)];i.nid=s,i.nss=o,i.path=void 0,n&&(i=n.parse(i,t))}else i.error=i.error||"URN can not be parsed.";return i},serialize:function(e,t){var r=e.nid,i=A[(t.scheme||e.scheme||"urn")+":"+(t.nid||r)];i&&(e=i.serialize(e,t));var a=e;return a.path=(r||t.nid)+":"+e.nss,a}},ae=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/,se={scheme:"urn:uuid",parse:function(e,t){var r=e;return r.uuid=r.nss,r.nss=void 0,t.tolerant||r.uuid&&r.uuid.match(ae)||(r.error=r.error||"UUID is not valid."),r},serialize:function(e,t){var r=e;return r.nss=(e.uuid||"").toLowerCase(),r}};A[U.scheme]=U,A[q.scheme]=q,A[te.scheme]=te,A[ie.scheme]=ie,A[se.scheme]=se,e.SCHEMES=A,e.pctEncChar=T,e.pctDecChars=R,e.parse=F,e.removeDotSegments=k,e.serialize=$,e.resolveComponents=H,e.resolve=function(e,t,r){var i=function(e,t){var r={scheme:"null"};if(t)for(var i in t)r[i]=t[i];return r}(0,r);return $(H(F(e,i),F(t,i),i,!0),i)},e.normalize=function(e,t){return"string"==typeof e?e=$(F(e,t),t):"object"===i(e)&&(e=F($(e,t),t)),e},e.equal=function(e,t,r){return"string"==typeof e?e=$(F(e,r),r):"object"===i(e)&&(e=$(e,r)),"string"==typeof t?t=$(F(t,r),r):"object"===i(t)&&(t=$(t,r)),e===t},e.escapeComponent=function(e,t){return e&&e.toString().replace(t&&t.iri?n.ESCAPE:o.ESCAPE,T)},e.unescapeComponent=j,Object.defineProperty(e,"__esModule",{value:!0})}("object"==typeof r&&void 0!==t?r:i.URI=i.URI||{})},{}],ajv:[function(e,t,r){var i=e("./compile"),a=e("./compile/resolve"),s=e("./cache"),o=e("./compile/schema_obj"),n=e("fast-json-stable-stringify"),l=e("./compile/formats"),d=e("./compile/rules"),c=e("./data"),u=e("./compile/util");(t.exports=v).prototype.validate=function(e,t){var r;if("string"==typeof e){if(!(r=this.getSchema(e)))throw new Error('no schema with key or ref "'+e+'"')}else{var i=this._addSchema(e);r=i.validate||this._compile(i)}var a=r(t);return!0!==r.$async&&(this.errors=r.errors),a},v.prototype.compile=function(e,t){var r=this._addSchema(e,void 0,t);return r.validate||this._compile(r)},v.prototype.addSchema=function(e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)this.addSchema(e[s],void 0,r,i);return this}var o=this._getId(e);if(void 0!==o&&"string"!=typeof o)throw new Error("schema id must be string");return b(this,t=a.normalizeId(t||o)),this._schemas[t]=this._addSchema(e,r,i,!0),this},v.prototype.addMetaSchema=function(e,t,r){return this.addSchema(e,t,r,!0),this},v.prototype.validateSchema=function(e,t){var r,i,a=e.$schema;if(void 0!==a&&"string"!=typeof a)throw new Error("$schema must be a string");if(!(a=a||this._opts.defaultMeta||(r=this,i=r._opts.meta,r._opts.defaultMeta="object"==typeof i?r._getId(i)||i:r.getSchema(m)?m:void 0,r._opts.defaultMeta)))return this.logger.warn("meta-schema not available"),!(this.errors=null);var s,o=this._formats.uri;this._formats.uri="function"==typeof o?this._schemaUriFormatFunc:this._schemaUriFormat;try{s=this.validate(a,e)}finally{this._formats.uri=o}if(!s&&t){var n="schema is invalid: "+this.errorsText();if("log"!=this._opts.validateSchema)throw new Error(n);this.logger.error(n)}return s},v.prototype.getSchema=function(e){var t=E(this,e);switch(typeof t){case"object":return t.validate||this._compile(t);case"string":return this.getSchema(t);case"undefined":return function(e,t){var r=a.schema.call(e,{schema:{}},t);if(r){var s=r.schema,n=r.root,l=r.baseId,d=i.call(e,s,n,void 0,l);return e._fragments[t]=new o({ref:t,fragment:!0,schema:s,root:n,baseId:l,validate:d}),d}}(this,e)}},v.prototype.removeSchema=function(e){if(e instanceof RegExp)return _(this,this._schemas,e),_(this,this._refs,e),this;switch(typeof e){case"undefined":return _(this,this._schemas),_(this,this._refs),this._cache.clear(),this;case"string":var t=E(this,e);return t&&this._cache.del(t.cacheKey),delete this._schemas[e],delete this._refs[e],this;case"object":var r=this._opts.serialize,i=r?r(e):e;this._cache.del(i);var s=this._getId(e);s&&(s=a.normalizeId(s),delete this._schemas[s],delete this._refs[s])}return this},v.prototype.addFormat=function(e,t){return"string"==typeof t&&(t=new RegExp(t)),this._formats[e]=t,this},v.prototype.errorsText=function(e,t){if(!(e=e||this.errors))return"No errors";for(var r=void 0===(t=t||{}).separator?", ":t.separator,i=void 0===t.dataVar?"data":t.dataVar,a="",s=0;s<e.length;s++){var o=e[s];o&&(a+=i+o.dataPath+" "+o.message+r)}return a.slice(0,-r.length)},v.prototype._addSchema=function(e,t,r,i){if("object"!=typeof e&&"boolean"!=typeof e)throw new Error("schema should be object or boolean");var s=this._opts.serialize,n=s?s(e):e,l=this._cache.get(n);if(l)return l;i=i||!1!==this._opts.addUsedSchema;var d=a.normalizeId(this._getId(e));d&&i&&b(this,d);var c,u=!1!==this._opts.validateSchema&&!t;u&&!(c=d&&d==a.normalizeId(e.$schema))&&this.validateSchema(e,!0);var h=a.ids.call(this,e),p=new o({id:d,schema:e,localRefs:h,cacheKey:n,meta:r});return"#"!=d[0]&&i&&(this._refs[d]=p),this._cache.put(n,p),u&&c&&this.validateSchema(e,!0),p},v.prototype._compile=function(e,t){if(e.compiling)return(e.validate=s).schema=e.schema,s.errors=null,s.root=t||s,!0===e.schema.$async&&(s.$async=!0),s;var r,a;e.compiling=!0,e.meta&&(r=this._opts,this._opts=this._metaOpts);try{a=i.call(this,e.schema,t,e.localRefs)}catch(t){throw delete e.validate,t}finally{e.compiling=!1,e.meta&&(this._opts=r)}return e.validate=a,e.refs=a.refs,e.refVal=a.refVal,e.root=a.root,a;function s(){var t=e.validate,r=t.apply(this,arguments);return s.errors=t.errors,r}},v.prototype.compileAsync=e("./compile/async");var h=e("./keyword");v.prototype.addKeyword=h.add,v.prototype.getKeyword=h.get,v.prototype.removeKeyword=h.remove;var p=e("./compile/error_classes");v.ValidationError=p.Validation,v.MissingRefError=p.MissingRef,v.$dataMetaSchema=c;var m="http://json-schema.org/draft-07/schema",f=["removeAdditional","useDefaults","coerceTypes"],g=["/properties"];function v(t){if(!(this instanceof v))return new v(t);t=this._opts=u.copy(t)||{},function(e){var t=e._opts.logger;if(!1===t)e.logger={log:A,warn:A,error:A};else{if(void 0===t&&(t=console),!("object"==typeof t&&t.log&&t.warn&&t.error))throw new Error("logger must implement log, warn and error methods");e.logger=t}}(this),this._schemas={},this._refs={},this._fragments={},this._formats=l(t.format);var r=this._schemaUriFormat=this._formats["uri-reference"];this._schemaUriFormatFunc=function(e){return r.test(e)},this._cache=t.cache||new s,this._loadingSchemas={},this._compilations=[],this.RULES=d(),this._getId=function(e){switch(e.schemaId){case"auto":return S;case"id":return y;default:return P}}(t),t.loopRequired=t.loopRequired||1/0,"property"==t.errorDataPath&&(t._errorDataPathProperty=!0),void 0===t.serialize&&(t.serialize=n),this._metaOpts=function(e){for(var t=u.copy(e._opts),r=0;r<f.length;r++)delete t[f[r]];return t}(this),t.formats&&function(e){for(var t in e._opts.formats){var r=e._opts.formats[t];e.addFormat(t,r)}}(this),function(t){var r;if(t._opts.$data&&(r=e("./refs/data.json"),t.addMetaSchema(r,r.$id,!0)),!1!==t._opts.meta){var i=e("./refs/json-schema-draft-07.json");t._opts.$data&&(i=c(i,g)),t.addMetaSchema(i,m,!0),t._refs["http://json-schema.org/schema"]=m}}(this),"object"==typeof t.meta&&this.addMetaSchema(t.meta),function(e){var t=e._opts.schemas;if(t)if(Array.isArray(t))e.addSchema(t);else for(var r in t)e.addSchema(t[r],r)}(this)}function E(e,t){return t=a.normalizeId(t),e._schemas[t]||e._refs[t]||e._fragments[t]}function _(e,t,r){for(var i in t){var a=t[i];a.meta||r&&!r.test(i)||(e._cache.del(a.cacheKey),delete t[i])}}function y(e){return e.$id&&this.logger.warn("schema $id ignored",e.$id),e.id}function P(e){return e.id&&this.logger.warn("schema id ignored",e.id),e.$id}function S(e){if(e.$id&&e.id&&e.$id!=e.id)throw new Error("schema $id is different from id");return e.$id||e.id}function b(e,t){if(e._schemas[t]||e._refs[t])throw new Error('schema with key or id "'+t+'" already exists')}function A(){}},{"./cache":1,"./compile":5,"./compile/async":2,"./compile/error_classes":3,"./compile/formats":4,"./compile/resolve":6,"./compile/rules":7,"./compile/schema_obj":8,"./compile/util":10,"./data":11,"./keyword":38,"./refs/data.json":39,"./refs/json-schema-draft-07.json":40,"fast-json-stable-stringify":42}]},{},[])("ajv")}(ajv_min);var Ajv=getDefaultExportFromCjs(ajv_min.exports),validate_min={exports:{}};
/*!
	 * validate.js 0.13.1
	 * http://validatejs.org/
	 * (c) 2013-2015 Nicklas Ansman, 2013 Wrapp
	 * validate.js may be freely distributed under the MIT license.
	*/
!function(e,t){(function(e,t,r){var i=function(e,t,r){r=a.extend({},a.options,r);var s=a.runValidations(e,t,r);if(s.some((function(e){return a.isPromise(e.error)})))throw new Error("Use validate.async if you want support for promises");return i.processValidationResults(s,r)},a=i;a.extend=function(e){return[].slice.call(arguments,1).forEach((function(t){for(var r in t)e[r]=t[r]})),e},a.extend(i,{version:{major:0,minor:13,patch:1,metadata:null,toString:function(){var e=a.format("%{major}.%{minor}.%{patch}",a.version);return a.isEmpty(a.version.metadata)||(e+="+"+a.version.metadata),e}},Promise:"undefined"!=typeof Promise?Promise:null,EMPTY_STRING_REGEXP:/^\s*$/,runValidations:function(e,t,r){var i,s,o,n,l,d,c,u=[];for(i in(a.isDomElement(e)||a.isJqueryElement(e))&&(e=a.collectFormValues(e)),t)for(s in o=a.getDeepObjectValue(e,i),n=a.result(t[i],o,e,i,r,t)){if(!(l=a.validators[s]))throw c=a.format("Unknown validator %{name}",{name:s}),new Error(c);d=n[s],(d=a.result(d,o,e,i,r,t))&&u.push({attribute:i,value:o,validator:s,globalOptions:r,attributes:e,options:d,error:l.call(l,o,d,i,e,r)})}return u},processValidationResults:function(e,t){e=a.pruneEmptyErrors(e,t),e=a.expandMultipleErrors(e,t),e=a.convertErrorMessages(e,t);var r=t.format||"grouped";if("function"!=typeof a.formatters[r])throw new Error(a.format("Unknown format %{format}",t));return e=a.formatters[r](e),a.isEmpty(e)?void 0:e},async:function(e,t,r){var i=(r=a.extend({},a.async.options,r)).wrapErrors||function(e){return e};!1!==r.cleanAttributes&&(e=a.cleanAttributes(e,t));var s=a.runValidations(e,t,r);return new a.Promise((function(o,n){a.waitForResults(s).then((function(){var l=a.processValidationResults(s,r);l?n(new i(l,r,e,t)):o(e)}),(function(e){n(e)}))}))},single:function(e,t,r){return r=a.extend({},a.single.options,r,{format:"flat",fullMessages:!1}),a({single:e},{single:t},r)},waitForResults:function(e){return e.reduce((function(e,t){return a.isPromise(t.error)?e.then((function(){return t.error.then((function(e){t.error=e||null}))})):e}),new a.Promise((function(e){e()})))},result:function(e){var t=[].slice.call(arguments,1);return"function"==typeof e&&(e=e.apply(null,t)),e},isNumber:function(e){return"number"==typeof e&&!isNaN(e)},isFunction:function(e){return"function"==typeof e},isInteger:function(e){return a.isNumber(e)&&e%1==0},isBoolean:function(e){return"boolean"==typeof e},isObject:function(e){return e===Object(e)},isDate:function(e){return e instanceof Date},isDefined:function(e){return null!=e},isPromise:function(e){return!!e&&a.isFunction(e.then)},isJqueryElement:function(e){return e&&a.isString(e.jquery)},isDomElement:function(e){return!!e&&!(!e.querySelectorAll||!e.querySelector)&&(!(!a.isObject(document)||e!==document)||("object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName))},isEmpty:function(e){var t;if(!a.isDefined(e))return!0;if(a.isFunction(e))return!1;if(a.isString(e))return a.EMPTY_STRING_REGEXP.test(e);if(a.isArray(e))return 0===e.length;if(a.isDate(e))return!1;if(a.isObject(e)){for(t in e)return!1;return!0}return!1},format:a.extend((function(e,t){return a.isString(e)?e.replace(a.format.FORMAT_REGEXP,(function(e,r,i){return"%"===r?"%{"+i+"}":String(t[i])})):e}),{FORMAT_REGEXP:/(%?)%\{([^\}]+)\}/g}),prettify:function(e){return a.isNumber(e)?100*e%1==0?""+e:parseFloat(Math.round(100*e)/100).toFixed(2):a.isArray(e)?e.map((function(e){return a.prettify(e)})).join(", "):a.isObject(e)?a.isDefined(e.toString)?e.toString():JSON.stringify(e):(e=""+e).replace(/([^\s])\.([^\s])/g,"$1 $2").replace(/\\+/g,"").replace(/[_-]/g," ").replace(/([a-z])([A-Z])/g,(function(e,t,r){return t+" "+r.toLowerCase()})).toLowerCase()},stringifyValue:function(e,t){return(t&&t.prettify||a.prettify)(e)},isString:function(e){return"string"==typeof e},isArray:function(e){return"[object Array]"==={}.toString.call(e)},isHash:function(e){return a.isObject(e)&&!a.isArray(e)&&!a.isFunction(e)},contains:function(e,t){return!!a.isDefined(e)&&(a.isArray(e)?-1!==e.indexOf(t):t in e)},unique:function(e){return a.isArray(e)?e.filter((function(e,t,r){return r.indexOf(e)==t})):e},forEachKeyInKeypath:function(e,t,r){if(a.isString(t)){var i,s="",o=!1;for(i=0;i<t.length;++i)switch(t[i]){case".":o?(o=!1,s+="."):(e=r(e,s,!1),s="");break;case"\\":o?(o=!1,s+="\\"):o=!0;break;default:o=!1,s+=t[i]}return r(e,s,!0)}},getDeepObjectValue:function(e,t){if(a.isObject(e))return a.forEachKeyInKeypath(e,t,(function(e,t){if(a.isObject(e))return e[t]}))},collectFormValues:function(e,t){var r,i,s,o,n,l,d={};if(a.isJqueryElement(e)&&(e=e[0]),!e)return d;for(t=t||{},o=e.querySelectorAll("input[name], textarea[name]"),r=0;r<o.length;++r)if(s=o.item(r),!a.isDefined(s.getAttribute("data-ignored"))){var c=s.name.replace(/\./g,"\\\\.");l=a.sanitizeFormValue(s.value,t),"number"===s.type?l=l?+l:null:"checkbox"===s.type?s.attributes.value?s.checked||(l=d[c]||null):l=s.checked:"radio"===s.type&&(s.checked||(l=d[c]||null)),d[c]=l}for(o=e.querySelectorAll("select[name]"),r=0;r<o.length;++r)if(s=o.item(r),!a.isDefined(s.getAttribute("data-ignored"))){if(s.multiple)for(i in l=[],s.options)(n=s.options[i])&&n.selected&&l.push(a.sanitizeFormValue(n.value,t));else{var u=void 0!==s.options[s.selectedIndex]?s.options[s.selectedIndex].value:"";l=a.sanitizeFormValue(u,t)}d[s.name]=l}return d},sanitizeFormValue:function(e,t){return t.trim&&a.isString(e)&&(e=e.trim()),!1!==t.nullify&&""===e?null:e},capitalize:function(e){return a.isString(e)?e[0].toUpperCase()+e.slice(1):e},pruneEmptyErrors:function(e){return e.filter((function(e){return!a.isEmpty(e.error)}))},expandMultipleErrors:function(e){var t=[];return e.forEach((function(e){a.isArray(e.error)?e.error.forEach((function(r){t.push(a.extend({},e,{error:r}))})):t.push(e)})),t},convertErrorMessages:function(e,t){var r=[],i=(t=t||{}).prettify||a.prettify;return e.forEach((function(e){var s=a.result(e.error,e.value,e.attribute,e.options,e.attributes,e.globalOptions);return a.isString(s)?("^"===s[0]?s=s.slice(1):!1!==t.fullMessages&&(s=a.capitalize(i(e.attribute))+" "+s),s=s.replace(/\\\^/g,"^"),s=a.format(s,{value:a.stringifyValue(e.value,t)}),void r.push(a.extend({},e,{error:s}))):void r.push(e)})),r},groupErrorsByAttribute:function(e){var t={};return e.forEach((function(e){var r=t[e.attribute];r?r.push(e):t[e.attribute]=[e]})),t},flattenErrorsToArray:function(e){return e.map((function(e){return e.error})).filter((function(e,t,r){return r.indexOf(e)===t}))},cleanAttributes:function(e,t){function r(e,t,r){return a.isObject(e[t])?e[t]:e[t]=!!r||{}}return a.isObject(t)&&a.isObject(e)?function e(t,r){if(!a.isObject(t))return t;var i,s,o=a.extend({},t);for(s in t)i=r[s],a.isObject(i)?o[s]=e(o[s],i):i||delete o[s];return o}(e,t=function(e){var t,i={};for(t in e)e[t]&&a.forEachKeyInKeypath(i,t,r);return i}(t)):{}},exposeModule:function(e,t,r,i,a){r?(i&&i.exports&&(r=i.exports=e),r.validate=e):(t.validate=e,e.isFunction(a)&&a.amd&&a([],(function(){return e})))},warn:function(e){"undefined"!=typeof console&&console.warn&&console.warn("[validate.js] "+e)},error:function(e){"undefined"!=typeof console&&console.error&&console.error("[validate.js] "+e)}}),i.validators={presence:function(e,t){if(!1!==(t=a.extend({},this.options,t)).allowEmpty?!a.isDefined(e):a.isEmpty(e))return t.message||this.message||"can't be blank"},length:function(e,t,r){if(a.isDefined(e)){var i,s=(t=a.extend({},this.options,t)).is,o=t.maximum,n=t.minimum,l=[],d=(e=(t.tokenizer||function(e){return e})(e)).length;return a.isNumber(d)?(a.isNumber(s)&&d!==s&&(i=t.wrongLength||this.wrongLength||"is the wrong length (should be %{count} characters)",l.push(a.format(i,{count:s}))),a.isNumber(n)&&d<n&&(i=t.tooShort||this.tooShort||"is too short (minimum is %{count} characters)",l.push(a.format(i,{count:n}))),a.isNumber(o)&&d>o&&(i=t.tooLong||this.tooLong||"is too long (maximum is %{count} characters)",l.push(a.format(i,{count:o}))),l.length>0?t.message||l:void 0):t.message||this.notValid||"has an incorrect length"}},numericality:function(e,t,r,i,s){if(a.isDefined(e)){var o,n,l=[],d={greaterThan:function(e,t){return e>t},greaterThanOrEqualTo:function(e,t){return e>=t},equalTo:function(e,t){return e===t},lessThan:function(e,t){return e<t},lessThanOrEqualTo:function(e,t){return e<=t},divisibleBy:function(e,t){return e%t==0}},c=(t=a.extend({},this.options,t)).prettify||s&&s.prettify||a.prettify;if(a.isString(e)&&t.strict){var u="^-?(0|[1-9]\\d*)";if(t.onlyInteger||(u+="(\\.\\d+)?"),u+="$",!new RegExp(u).test(e))return t.message||t.notValid||this.notValid||this.message||"must be a valid number"}if(!0!==t.noStrings&&a.isString(e)&&!a.isEmpty(e)&&(e=+e),!a.isNumber(e))return t.message||t.notValid||this.notValid||this.message||"is not a number";if(t.onlyInteger&&!a.isInteger(e))return t.message||t.notInteger||this.notInteger||this.message||"must be an integer";for(o in d)if(n=t[o],a.isNumber(n)&&!d[o](e,n)){var h="not"+a.capitalize(o),p=t[h]||this[h]||this.message||"must be %{type} %{count}";l.push(a.format(p,{count:n,type:c(o)}))}return t.odd&&e%2!=1&&l.push(t.notOdd||this.notOdd||this.message||"must be odd"),t.even&&e%2!=0&&l.push(t.notEven||this.notEven||this.message||"must be even"),l.length?t.message||l:void 0}},datetime:a.extend((function(e,t){if(!a.isFunction(this.parse)||!a.isFunction(this.format))throw new Error("Both the parse and format functions needs to be set to use the datetime/date validator");if(a.isDefined(e)){var r,i=[],s=(t=a.extend({},this.options,t)).earliest?this.parse(t.earliest,t):NaN,o=t.latest?this.parse(t.latest,t):NaN;return e=this.parse(e,t),isNaN(e)||t.dateOnly&&e%864e5!=0?(r=t.notValid||t.message||this.notValid||"must be a valid date",a.format(r,{value:arguments[0]})):(!isNaN(s)&&e<s&&(r=t.tooEarly||t.message||this.tooEarly||"must be no earlier than %{date}",r=a.format(r,{value:this.format(e,t),date:this.format(s,t)}),i.push(r)),!isNaN(o)&&e>o&&(r=t.tooLate||t.message||this.tooLate||"must be no later than %{date}",r=a.format(r,{date:this.format(o,t),value:this.format(e,t)}),i.push(r)),i.length?a.unique(i):void 0)}}),{parse:null,format:null}),date:function(e,t){return t=a.extend({},t,{dateOnly:!0}),a.validators.datetime.call(a.validators.datetime,e,t)},format:function(e,t){(a.isString(t)||t instanceof RegExp)&&(t={pattern:t});var r,i=(t=a.extend({},this.options,t)).message||this.message||"is invalid",s=t.pattern;if(a.isDefined(e))return a.isString(e)?(a.isString(s)&&(s=new RegExp(t.pattern,t.flags)),(r=s.exec(e))&&r[0].length==e.length?void 0:i):i},inclusion:function(e,t){if(a.isDefined(e)&&(a.isArray(t)&&(t={within:t}),t=a.extend({},this.options,t),!a.contains(t.within,e))){var r=t.message||this.message||"^%{value} is not included in the list";return a.format(r,{value:e})}},exclusion:function(e,t){if(a.isDefined(e)&&(a.isArray(t)&&(t={within:t}),t=a.extend({},this.options,t),a.contains(t.within,e))){var r=t.message||this.message||"^%{value} is restricted";return a.isString(t.within[e])&&(e=t.within[e]),a.format(r,{value:e})}},email:a.extend((function(e,t){var r=(t=a.extend({},this.options,t)).message||this.message||"is not a valid email";if(a.isDefined(e))return a.isString(e)&&this.PATTERN.exec(e)?void 0:r}),{PATTERN:/^(?:[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i}),equality:function(e,t,r,i,s){if(a.isDefined(e)){a.isString(t)&&(t={attribute:t});var o=(t=a.extend({},this.options,t)).message||this.message||"is not equal to %{attribute}";if(a.isEmpty(t.attribute)||!a.isString(t.attribute))throw new Error("The attribute must be a non empty string");var n=a.getDeepObjectValue(i,t.attribute),l=t.comparator||function(e,t){return e===t},d=t.prettify||s&&s.prettify||a.prettify;return l(e,n,t,r,i)?void 0:a.format(o,{attribute:d(t.attribute)})}},url:function(e,t){if(a.isDefined(e)){var r=(t=a.extend({},this.options,t)).message||this.message||"is not a valid url",i=t.schemes||this.schemes||["http","https"],s=t.allowLocal||this.allowLocal||!1,o=t.allowDataUrl||this.allowDataUrl||!1;if(!a.isString(e))return r;var n="^(?:(?:"+i.join("|")+")://)(?:\\S+(?::\\S*)?@)?(?:",l="(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))";if(s?l+="?":n+="(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})",n+="(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*"+l+")(?::\\d{2,5})?(?:[/?#]\\S*)?$",o){n="(?:"+n+")|(?:^data:(?:\\w+\\/[-+.\\w]+(?:;[\\w=]+)*)?(?:;base64)?,[A-Za-z0-9-_.!~\\*'();\\/?:@&=+$,%]*$)"}return new RegExp(n,"i").exec(e)?void 0:r}},type:a.extend((function(e,t,r,i,s){if(a.isString(t)&&(t={type:t}),a.isDefined(e)){var o,n=a.extend({},this.options,t),l=n.type;if(!a.isDefined(l))throw new Error("No type was specified");if(o=a.isFunction(l)?l:this.types[l],!a.isFunction(o))throw new Error("validate.validators.type.types."+l+" must be a function.");if(!o(e,n,r,i,s)){var d=t.message||this.messages[l]||this.message||n.message||(a.isFunction(l)?"must be of the correct type":"must be of type %{type}");return a.isFunction(d)&&(d=d(e,t,r,i,s)),a.format(d,{attribute:a.prettify(r),type:l})}}}),{types:{object:function(e){return a.isObject(e)&&!a.isArray(e)},array:a.isArray,integer:a.isInteger,number:a.isNumber,string:a.isString,date:a.isDate,boolean:a.isBoolean},messages:{}})},i.formatters={detailed:function(e){return e},flat:a.flattenErrorsToArray,grouped:function(e){var t;for(t in e=a.groupErrorsByAttribute(e))e[t]=a.flattenErrorsToArray(e[t]);return e},constraint:function(e){var t;for(t in e=a.groupErrorsByAttribute(e))e[t]=e[t].map((function(e){return e.validator})).sort();return e}},i.exposeModule(i,this,e,t,r)}).call(commonjsGlobal,t,e,null)}(validate_min,validate_min.exports);var validate=validate_min.exports;const PRESERVE_KEYS=["app_bound_domains"],validationErrorCollection="json_validation_error",jsonNotAnObjectError="json_validation_not_valid_object",jsonValidationExceptionError="json_validation_raised_exception",jsonValidationParsingError="json_validation_failed_schema",validationErrorSeverity=4;class JSONValidator{static validateJSON(e,t){let r,i=!1;if(void 0===e||void 0===t||"object"!=typeof t){const e="JSONValidator could not validate. json object could not be created.";return console.debug(e),JSONValidator.sendValidationCEC(jsonNotAnObjectError,e),!1}try{r=new Ajv,r.addFormat("hypr_url",this.urlValidation),i=r.validate(e,t)}catch(e){const t=`JSONValidator Exception while validation json: ${e.message}`;return console.error(t),JSONValidator.sendValidationCEC(jsonValidationExceptionError,t),!1}if(!i){let e="";return r.errors.forEach((t=>{const r=`JSONValidator reported the following parse error: ${t.dataPath} ${t.message}. `;e+=r,console.debug(r)})),JSONValidator.sendValidationCEC(jsonValidationParsingError,e),!1}return!0}static sendValidationCEC(e,t){globalThis.HYPRErrorController.sendClientErrorCapture(validationErrorCollection,e,t,validationErrorSeverity)}static urlValidation(e,t=["https"]){return void 0===validate({website:e},{website:{url:{schemes:t}}})}static compact(e){const t=JSON.parse(JSON.stringify(e));JSONValidator.compactHelper(t);for(const r of PRESERVE_KEYS)void 0!==e[r]&&(t[r]=e[r]);return t}static compactHelper(e){null!=e&&(this.compactJsonArray(e),Object.keys(e).forEach((t=>{(this.isObject(e[t])||Array.isArray(e[t]))&&this.compactHelper(e[t]),this.isEmpty(e[t])&&delete e[t]})))}static compactJsonArray(e){if(Array.isArray(e)){e.forEach((e=>this.compactHelper(e)));for(let t=Object.keys(e).length-1;t>=0;t-=1)this.isEmpty(e[t])&&e.splice(t,1)}}static isEmpty(e){return!!(null==e||Array.isArray(e)&&0===e.length||this.isObject(e)&&0===Object.keys(e).length||""===e)}static isObject(e){return"[object Object]"===Object.prototype.toString.call(e)}}class NetworkRequestController{constructor(){this.requestMap=new Map,this.requestId=0}request(e,t,r,i,a=(()=>{})){const s=this.requestId.toString();return this.requestId+=1,HYPRNativeNetworkController.request(s,e,t,r,JSON.stringify(i),"HYPRNetworkController.onNetworkResponse"),this.requestMap[s]=a,s}abortRequest(e){console.debug(`Network request aborted for ${e}`),HYPRNativeNetworkController.abortRequest(e),this.requestMap[e]=null}onNetworkResponse(e,t){console.debug(`Network response for ${e} with response ${JSON.stringify(t)}`);const r=this.requestMap[e];this.requestMap[e]=null,"function"==typeof r&&r(t.code,t.body,t.error,t.headers)}static validResponseStatus(e){return!(e>=400||0===e)}static validXMLType(e){return void 0!==e&&"string"==typeof e["Content-Type"]&&e["Content-Type"].includes("application/xml")}static validateResponseBody(e){if(void 0===e)return"Response data not parseable."}static parseJSON(e){if(void 0===e)return;let t;try{t=JSON.parse(e)}catch(e){console.error(`NetworkRequestController exception parsing JSON response: ${e}`)}return t}}const CONNECTION_TYPE={GET:"GET",POST:"POST",PATCH:"PATCH"};class ConnectionConfiguration{constructor(e,t,r,i){this.followRedirect=e,this.readTimeout=t,this.connectionTimeout=r,this.headers=i}}const JSON_CONTENT_TYPE="application/json",JSON_UTF8_CONTENT_TYPE=`${JSON_CONTENT_TYPE};charset=UTF-8`,DEFAULT_READ_TIMEOUT=6e4,DEFAULT_CONNECTION_TIMEOUT=6e4,DEFAULT_JSON_HEADERS={"Content-Type":JSON_UTF8_CONTENT_TYPE},DEFAULT_QUERY_HEADERS={},DEFAULT_JSON_CONNECTION_CONFIGURATION=new ConnectionConfiguration(!0,DEFAULT_READ_TIMEOUT,DEFAULT_CONNECTION_TIMEOUT,DEFAULT_JSON_HEADERS),DEFAULT_QUERY_CONNECTION_CONFIGURATION=new ConnectionConfiguration(!0,DEFAULT_READ_TIMEOUT,DEFAULT_CONNECTION_TIMEOUT,DEFAULT_QUERY_HEADERS);class EventController{constructor(e,t,r,i,a,s,o,n=globalThis.HYPRNetworkController){this.adImpressionTrackingUrl=e,this.userInfoTrackingUrl=t,this.webTrafficVisitUrl=r,this.noAdTrackingUrl=s,this.networkRequestController=n,this.errorReportingURL=i,this.errorSeverityLevel=a,this.adProgressUrl=o}sendAdProgressTracking(e,t){void 0!==e&&void 0!==this.adProgressUrl&&this.networkRequestController.request(this.adProgressUrl,e,CONNECTION_TYPE.POST,DEFAULT_JSON_CONNECTION_CONFIGURATION,t)}sendWebTrafficVisitEvent(e,t){const r={};r.url=e,r.viewing_id=t,this.networkRequestController.request(this.webTrafficVisitUrl,JSON.stringify(JSONValidator.compact(r)),CONNECTION_TYPE.POST,DEFAULT_JSON_CONNECTION_CONFIGURATION,((t,r,i)=>{const a=parseJSON(r);void 0===i&&NetworkRequestController.validResponseStatus(t)&&void 0!==a&&void 0!==a.id?this.recordWebTrafficVisitInfo(e,a.id):console.error(`sendWebTrafficVisitEvent error received: ${i}`)}))}recordWebTrafficVisitInfo(e,t){void 0===this.webTrafficVisitInfo&&(this.webTrafficVisitInfo={}),this.webTrafficVisitInfo[e]=t}sendWebTrafficTimeSpent(e,t){const r=this.webTrafficVisitInfo[e];if(void 0===r)return;const i=`${this.webTrafficVisitUrl}/${r}`;this.networkRequestController.request(i,t,CONNECTION_TYPE.PATCH,DEFAULT_JSON_CONNECTION_CONFIGURATION)}sendNoAdTracking(e){this.sendTrackingEvent(e,this.noAdTrackingUrl)}sendAdImpressionTrackingEvent(e){this.sendTrackingEvent(e,this.adImpressionTrackingUrl)}sendUserInfoTrackingEvent(e,t){this.sendTrackingEventWithParams(e,this.userInfoTrackingUrl,EventController.extractPrequalQuestionNames(t))}sendPixelTrackingEvents(e){const t=JSON.parse(e);for(const e of t)this.networkRequestController.request(e,void 0,CONNECTION_TYPE.GET,DEFAULT_QUERY_CONNECTION_CONFIGURATION)}sendTrackingEvent(e,t){this.sendTrackingEventWithParams(e,t,void 0)}static extractPrequalQuestionNames(e){return{questions_shown:JSON.parse(e).map((e=>e.Name))}}sendTrackingEventWithParams(e,t,r){let i={placement_id:e.id,offer_identifier:e.getAdIdentifier(),offer_type:e.getAdType()};console.debug(`Requesting additional trackings params for: ${JSON.stringify(i)}`);const a=JSON.parse(HYPRRequestParamListener.getTrackingParams()||"{}");Object.assign(i,a),void 0!==r&&(i=Object.assign(i,r));const s=JSON.stringify(JSONValidator.compact(i));console.debug(`Sending trackings to ${t} with params: ${s}`),this.networkRequestController.request(t,s,CONNECTION_TYPE.POST,DEFAULT_JSON_CONNECTION_CONFIGURATION)}onClientErrorEvent(e){e.error.severity<this.errorSeverityLevel||HYPRRequestParamListener.getErrorParams(JSON.stringify(e),"HYPREventController.sendClientError")}sendClientError(e,t){const{error:r}=JSON.parse(e);t.errorTypeKey=r.type,t.errorMessage=r.message,void 0!==r.additionalInfo&&(t.value=r.additionalInfo),console.debug(`Sending CEC to ${this.errorReportingURL} with params: ${JSON.stringify(t)}`),this.networkRequestController.request(this.errorReportingURL,JSON.stringify(JSONValidator.compact(t)),CONNECTION_TYPE.POST,DEFAULT_JSON_CONNECTION_CONFIGURATION)}}class TimerController{constructor(){this.timerMap=new Map,this.requestId=0}startTimer(e,t){const r=this.requestId.toString();return this.requestId+=1,HYPRNativeTimer.startNativeTimer(r,e,`HYPRTimerController.timeoutComplete('${r}')`),this.timerMap[r]=t,r}stopTimer(e){HYPRNativeTimer.stopTimer(e),this.timerMap[e]=null}timeoutComplete(e){console.debug(`Timeout complete for id ${e}`);const t=this.timerMap[e];this.timerMap[e]=null,"function"==typeof t&&t()}}function dispatch(e,t,r){t.apply(e,r)}function dispatchToQueue(e,t,r,i,a,s){"undefined"!=typeof HYPRSharedQueueController?HYPRSharedQueueController.dispatchToQueue(e,`${t}.${r}('${s.join("','")}')`):a.apply(i,s)}function initializationHost(){return"staging.hyprmx.com"}function cdnDomain(){return"hyprmx.com"}function initializationPath(){return"/v1/initialization"}function defaultAdAvailableFor(){return 3600}function catalogFrameParametersForPlacement(e,t){const r=e.compileRequestParamsFromParams(t,e.getPromiseTokenKey(!1));return r.offer=e.getOfferName(),JSON.stringify(JSONValidator.compact(r))}function parseJSON(e){let t;try{t=JSON.parse(e)}catch(t){console.error(`Error parsing json string (${e}) with error ${t}`)}return t}function equalsIgnoreCase(e,t){return"string"==typeof e&&"string"==typeof t&&e.toUpperCase()===t.toUpperCase()}function isValidUrl(e){return new RegExp(/(http|https):\/\/(\w+:{0,1}\w*)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%!\-/]))?/).test(e)}function numberOrZero(e){const t=parseFloat(e);return Number.isNaN(t)?0:t}globalThis.TimerController=TimerController,globalThis.version=function(){return 138};const defaultWebViewReleaseSeconds=0;function createEventController(e){globalThis.HYPREventController=new EventController(e.ad_impression_tracking_endpoint,e.user_info_tracking_endpoint,e.webtraffic_visit_endpoint,e.error_reporting_endpoint,e.error_severity_level,e.no_ad_tracking_endpoint,e.ad_progress_endpoint)}globalThis.HYPREventController=void 0,globalThis.HYPRRequestParameterManager=void 0,globalThis.HYPRBiddingController=void 0,globalThis.HYPRPlacementController=void 0,globalThis.HYPRNetworkController=new NetworkRequestController,globalThis.HYPRTimerController=new TimerController;const PersistentIdKey="persistent_id",OptedOutKey="ad_id_opted_out",SKAdNetworkItemsKey="SKAdNetworkItems",APPSTORE_URL_FALLBACK_PRESENT_BROWSER=!0;globalThis.defaultUIComponents={};const VAST_VIDEO_OFFER="vast_video",MRAID_OFFER="mraid",WEB_TRAFFIC_OFFER="web_traffic",BANNER_OFFER="banner",HYPR_NEXT_BUTTON_TEXT_KEY="next_button_text",HYPR_FINISH_BUTTON_TEXT_KEY="finish_button_text",HYPR_TITLE_TEXT_KEY="title_text",HYPR_COUNTDOWN_TEXT_KEY="countdown_text",HYPR_WEB_VIEW_PROTOCOLS=["http","https","about","file","data"],HYPR_AD_STATE_PROSCENIUM="proscenium",HYPR_BANNER_URL="https://live.hyprmx.com/banner_ad",HYPR_BANNER_MIME_TYPE="text/html",HYPR_BANNER_ENCODING="utf-8",HYPR_DEFAULT_ACCEPTABLE_BANNER_SIZE_VARIANCE=1,CONSENT_STATUS={CONSENT_STATUS_UNKNOWN:0,CONSENT_GIVEN:1,CONSENT_DECLINED:2},AD_PROGRESS_STATE={COMPLETED:"COMPLETED",PAYOUT_COMPLETE:"PAYOUT_COMPLETE",BACKGROUNDED:"BACKGROUNDED",IN_PROGRESS:"IN_PROGRESS"},AD_CLOSED_ACTION={BACK_PRESS:"BACK_PRESS",PRESENT_DIALOG_OK:"PRESENT_DIALOG_OK",ERROR_DIALOG_OK:"ERROR_DIALOG_OK",CANCELLATION_DIALOG_OK:"CANCELLATION_DIALOG_OK",ABORT:"ABORT",NATIVE_CLOSE_BUTTON:"NATIVE_CLOSE_BUTTON",COMPLETE_NO_THANK_YOU:"COMPLETE_NO_THANK_YOU",MRAID_CLOSE:"MRAID_CLOSE",CLOSE_AD:"CLOSE_AD",CRASHED:"CRASHED",WEBVIEW_CRASH:"WEBVIEW_CRASH",UNKNOWN:"UNKNOWN"};function addToArray(e,t){void 0!==t&&(Array.isArray(t)?e.push(...t):e.push(t))}function isIOS6_0_0(){try{return!0===globalThis.HYPRInitializationController.deviceConfiguration.isIos()&&220===globalThis.HYPRRequestParameterManager.cache.msdkv}catch(e){return!1}}globalThis.isIOS6_0_0=isIOS6_0_0,globalThis.EVENT_TOPIC={BANNER_PRESENTER:"bannerPresenterTopic",WEB_VIEW_PRESENTER:"webViewPresenterTopic",HYPRMX_BROWSER_PRESENTER:"hyprmxBrowserPresenterTopic",HYPRMX_BROWSER_WEBVIEW_PRESENTER:"hyprmxBrowserWebViewPresenterTopic",FULLSCREEN_AD_PRESENTER:"fullscreenAdPresenterTopic"},globalThis.VIEW_MODEL_TYPE={BASE_AD:"baseAdViewModelMap",WEBVIEW:"webViewViewModelMap",BROWSER:"hyprmxBrowserViewModelMap"},globalThis.PRESENTATION_STATES={BROWSER:"presentingHyprMXBrowser",OUTSIDE_APP:"presentingDeepLinkOutsideApplication",APP_STORE:"presentingAppStoreOverlay"},globalThis.BANNER_VIEWPORT_SCRIPT="";class HyprError{constructor(e,t,r,i){this.error={},this.error.message=e,this.error.code=t,this.error.severity=r,this.error.type=i}}const VAST_ERROR_CODE=100,AD_PROGRESS_TRACKING_ERROR_CODE={UnexpectedSetUp:250,InvalidSetUp:251,InvalidProgressValue:252,InvalidCloseValue:253,InvalidProgressContext:254,InvalidCloseContext:255},BANNER_ERROR_CODE={MismatchedContainerSizes:300},ERROR_SEVERITY_HIGH=4,ERROR_SEVERITY_MEDIUM=3,ERROR_SEVERITY_DO_NOT_REPORT=0,VAST_ERROR_TYPE="vast_parser_failure",AD_PROGRESS_TRACKING_ERROR_TYPE="ad_progress_tracking_error",BANNER_ERROR_TYPE="banner_error",PAGE_READY_ERROR_SUMMARY="Page Ready Timeout.",PAGE_READY_ERROR_COLLECTION="page_ready_error",PAGE_READY_ERROR_MESSAGE="Page ready timeout. pageReady was not called";class HyprErrorFactory{static getVastNoMediaError(){return new HyprError("No valid media files exist",VAST_ERROR_CODE,ERROR_SEVERITY_DO_NOT_REPORT,VAST_ERROR_TYPE)}static getVastValidateError(){return new HyprError("Could not validate VAST xml",VAST_ERROR_CODE+1,ERROR_SEVERITY_HIGH,VAST_ERROR_TYPE)}static getVastNoAdsAvailableError(){return new HyprError("No ad available",VAST_ERROR_CODE+2,ERROR_SEVERITY_DO_NOT_REPORT,VAST_ERROR_TYPE)}static getVastNoDurationError(){return new HyprError("No duration found for media",VAST_ERROR_CODE+3,ERROR_SEVERITY_DO_NOT_REPORT,VAST_ERROR_TYPE)}static getVastNoImpressionsError(){return new HyprError("No impressions found for ad",VAST_ERROR_CODE+4,ERROR_SEVERITY_DO_NOT_REPORT,VAST_ERROR_TYPE)}static getVastAdWithWrapperError(){return new HyprError("Ad with wrapper tag received",VAST_ERROR_CODE+5,ERROR_SEVERITY_HIGH,VAST_ERROR_TYPE)}static getVastTagDownloadError(){return new HyprError("Vast TAG failed to download",VAST_ERROR_CODE+6,ERROR_SEVERITY_DO_NOT_REPORT,VAST_ERROR_TYPE)}static getVastEmptyTagError(){return new HyprError("Vast tag returned empty.  Proxy error.",VAST_ERROR_CODE+7,ERROR_SEVERITY_DO_NOT_REPORT,VAST_ERROR_TYPE)}static getAdProgressInvalidSetUpError(e,t,r,i){return new HyprError(`Invalid call to AdProgressTracking.setUpTracking with viewingID: ${e} distributorID: ${t} userID: ${r} offerType: ${i}`,AD_PROGRESS_TRACKING_ERROR_CODE.InvalidSetUp,ERROR_SEVERITY_MEDIUM,AD_PROGRESS_TRACKING_ERROR_TYPE)}static getAdProgressUpdateError(e,t){return new HyprError(e,t,ERROR_SEVERITY_MEDIUM,AD_PROGRESS_TRACKING_ERROR_TYPE)}static getBannerContainerSizeMismatchedError(e){return new HyprError(e,BANNER_ERROR_CODE.MismatchedContainerSizes,ERROR_SEVERITY_MEDIUM,BANNER_ERROR_TYPE)}}const HYPR_AD_PROGRESS_STORAGE_KEY="HYPR_AD_PROGRESS_STORAGE_KEY";class AdProgressTracking{constructor(e,t,r,i){const a=[e,t,r,i];for(const s of a)if("string"!=typeof s||0===s.length){const a=HyprErrorFactory.getAdProgressInvalidSetUpError(e,t,r,i);return globalThis.HYPREventController.onClientErrorEvent(a),void(this.data=void 0)}this.data={},this.data.ad_progress_state=AD_PROGRESS_STATE.IN_PROGRESS,this.data.ad_closed_action=AD_CLOSED_ACTION.UNKNOWN,this.data.viewing_id=e,this.data.distributor_id=t,this.data.user_id=r,this.data.offer_type=i,this.send(),this.store()}send(){if(void 0!==this.data){this.data.ad_progress_timestamp=(new Date).toISOString();const e=JSON.stringify(this.data),t=AdProgressTracking.generateEventCallbackFunction(e);globalThis.HYPREventController.sendAdProgressTracking(e,t)}}store(){let e="";if(void 0!==this.data){const t=JSON.parse(JSON.stringify(this.data));t.ad_closed_action=AD_CLOSED_ACTION.CRASHED,e=JSON.stringify(t),AdProgressTracking.updateStorage(e)}return e}static updateStorage(e=""){hyprMXLocalStorage.setItem(HYPR_AD_PROGRESS_STORAGE_KEY,e)}setProgressState(e,t){if(this.dataUpdateError(e,t))return;let r=e;void 0!==this.completionState&&e===AD_PROGRESS_STATE.IN_PROGRESS&&(r=this.completionState),this.data.ad_progress_state=r,this.send(),e===AD_PROGRESS_STATE.BACKGROUNDED?AdProgressTracking.updateStorage():this.store(),e!==AD_PROGRESS_STATE.COMPLETED&&e!==AD_PROGRESS_STATE.PAYOUT_COMPLETE||(this.completionState=e)}dataUpdateError(e,t,r=!1){const i=` (value: ${e}, viewing ID: ${t})`,a=r?"InvalidCloseContext":"InvalidProgressContext",s=r?"InvalidCloseValue":"InvalidProgressValue";let o=`${r?"closed action":"progress state"} error`,n=0;if(void 0===this.data?(o+=" -- session data undefined",n=AD_PROGRESS_TRACKING_ERROR_CODE[a]):(t!==this.data.viewing_id&&(o+=` -- session viewing ID (${this.data.viewing_id}) does not match`,n=AD_PROGRESS_TRACKING_ERROR_CODE[a]),r&&void 0!==this.data&&this.data.ad_closed_action!==AD_CLOSED_ACTION.UNKNOWN&&(o+=` -- ad_closed_action already set: ${this.data.ad_closed_action}`,n=AD_PROGRESS_TRACKING_ERROR_CODE[a])),(!r&&void 0===AD_PROGRESS_STATE[e]||r&&(void 0===AD_CLOSED_ACTION[e]||e===AD_CLOSED_ACTION.UNKNOWN))&&(o+=" -- invalid value",n=AD_PROGRESS_TRACKING_ERROR_CODE[s]),n>0){o+=i;const e=HyprErrorFactory.getAdProgressUpdateError(o,n);return globalThis.HYPREventController.onClientErrorEvent(e),!0}return!1}setClosedAction(e,t){this.dataUpdateError(e,t,!0)||(this.data.ad_closed_action=e,this.send(),AdProgressTracking.updateStorage())}static checkStoredData(){const e=hyprMXLocalStorage.getItem(HYPR_AD_PROGRESS_STORAGE_KEY);if("string"==typeof e&&e.length>0){const t=AdProgressTracking.generateEventCallbackFunction(e);globalThis.HYPREventController.sendAdProgressTracking(e,t),AdProgressTracking.updateStorage()}}static generateEventCallbackFunction(e){return(t,r)=>{const i=`sent ad progress tracking: ${e}, response: ${JSON.stringify(t)}, error: ${r}`;return console.debug(i),i}}}const COLOR_PATTERN="^([A-Fa-f0-9]{8}|[A-Fa-f0-9]{6})$",SELECTOR_PATTERN="^(Date|SingleSelectSet|NaturalNumber)$",TILED_IMAGE_SCHEMA={type:"object",properties:{url:{type:"string"},x:{type:"integer",minimum:0},y:{type:"integer",minimum:0},width:{type:"integer",minimum:0},height:{type:"integer",minimum:0},scale:{type:"integer"},tiled:{type:"integer",minimum:0,maximum:1,description:"Indicates if the image should be tiled.  0 = false, 1 = true."}},required:["url","x","y","width","height","scale"]},IMAGE_SCHEMA={type:"object",properties:{portrait_url:{type:"string",format:"hypr_url",description:"The URL to retrieve the image."},height:{type:"integer",minimum:0,maximum:100,description:"The height of the image."},width:{type:"integer",minimum:0,maximum:100,description:"The width of the image"},link:{type:"string",format:"hypr_url",description:"The link to open when this image is clicked."}},required:["portrait_url","height","width"]},WEB_TRAFFIC_HEADER_SCHEMA={type:"object",properties:{header_background_color:{type:"string",pattern:COLOR_PATTERN},title_text:{type:"string"},next_button_text:{type:"string"},finish_button_text:{type:"string"},countdown_text:{type:"string"},finish_button_minimum_size:{type:"object",properties:{width:{type:"integer",minimum:0},height:{type:"integer",minimum:0}},required:["width","height"]},next_button_minimum_size:{type:"object",properties:{width:{type:"integer",minimum:0},height:{type:"integer",minimum:0}},required:["width","height"]},next_button_color:{type:"string",pattern:COLOR_PATTERN},finish_button_color:{type:"string",pattern:COLOR_PATTERN},page_indicator_color:{type:"string",pattern:COLOR_PATTERN},page_indicator_color_selected:{type:"string",pattern:COLOR_PATTERN},minimum_header_height:{type:"integer",minimum:0},close_button_color:{type:"string",pattern:COLOR_PATTERN},chevron_color:{type:"string",pattern:COLOR_PATTERN},spinner_tint_color:{type:"string",pattern:COLOR_PATTERN},close_button:{type:"object",properties:{image:{type:"object",properties:{url:{type:"string",format:"hypr_url"},width:{type:"integer",minimum:0},height:{type:"integer",minimum:0}},required:["url","width","height"]}},required:["image"]}},required:["header_background_color","title_text","next_button_text","finish_button_text","countdown_text","finish_button_minimum_size","next_button_minimum_size","next_button_color","finish_button_color","page_indicator_color","page_indicator_color_selected","minimum_header_height","close_button_color","chevron_color"]},FOOTER_SCHEMA={type:"object",properties:{images:{type:"array",items:{type:"object",properties:{image:{$ref:"#/definitions/image"}},required:["image"]}},text:{type:"string",description:"HTML formatted text to display"},background_color:{type:"string",description:"The footer background color",pattern:COLOR_PATTERN},min_height:{type:"integer",description:"The minimum height of the footer",minimum:0}},required:["text","background_color","min_height"]},ADS_TO_PRELOAD_SCHEMA={type:"object",properties:{id:{type:"string"},directive:{type:"string"},vast_tag_url:{type:"string",format:"hypr_url"}},required:["id","directive"]},AD_SCHEMA={type:"object",properties:{id:{type:"string"},title:{type:"string"},description:{type:"string"},type:{type:"string"},catalog_frame_url:{type:"string",format:"hypr_url"},preload_player_url:{type:"string",format:"hypr_url"},skip_proscenium:{type:"boolean"},skip_thank_you_screen:{type:"boolean"},thank_you_url:{type:"string",format:"hypr_url"},show_close_button:{type:"boolean"},use_skoverlay:{type:"boolean"},mute_switch_ignored:{type:"boolean"},offer_initiation_timeout_in_seconds:{type:"integer"},webview_timeout:{type:"integer"},relay_promise_token:{type:"boolean"},allowed_orientation:{type:"string"},disable_svc_for_ios_sharings:{type:"boolean"},force_status_bar_display:{type:"boolean"},available_for:{type:"integer",minimum:0},navigation_rule:{type:"string"},cancellation_dialog:{type:"object",properties:{continue:{type:"string"},exit:{type:"string"},message:{type:"string"}},required:["continue","exit","message"]},reward_text:{type:"string"},reward_token:{type:"string"},reward_id:{type:"integer"},reward_quantity:{type:"integer"},step_count:{type:"integer",minimum:0},preloaded_mraid_page_ready_timeout:{type:"integer"},footer:{$ref:"#/definitions/footer"},web_traffic_header:{$ref:"#/definitions/web_traffic_header"},user_agent:{type:"string"}},required:["id","type","relay_promise_token","offer_initiation_timeout_in_seconds","catalog_frame_url"]},UI_COMPONENTS_SCHEMA={type:"object",properties:{user_info_form:{type:"object",properties:{background_color:{type:"string",pattern:COLOR_PATTERN},navigation:{type:"object",properties:{style:{type:"object",properties:{background_color:{type:"string",pattern:COLOR_PATTERN},font:{$ref:"#/definitions/font"}}},close_button_text:{type:"string"},submit_button_text:{type:"string"},submit_button_behavior:{type:"string",enum:["Always","Complete","Auto"]},submit_disabled_color:{type:"string",pattern:COLOR_PATTERN},close_button_image:{$ref:"#/definitions/image"}}},submit:{type:"object",properties:{style:{type:"object",properties:{background_color:{type:"string",pattern:COLOR_PATTERN},disabled_background_color:{type:"string",pattern:COLOR_PATTERN},padding:{type:"array",items:{type:"integer"}},margin:{type:"array",items:{type:"integer"}},corner_radius:{type:"integer"},shadow_elevation:{type:"integer"},font:{$ref:"#/definitions/font"}}},mode:{type:"string"},text:{type:"string"}}},headers:{type:"array",items:{type:"object",properties:{style:{type:"object",properties:{background_color:{type:"string",pattern:COLOR_PATTERN},padding:{type:"array",items:{type:"integer"}},margin:{type:"array",items:{type:"integer"}},font:{$ref:"#/definitions/font"}}},text:{type:"string"}}}},footer:{$ref:"#/definitions/footer"}}},no_ad:{type:"object",properties:{title:{type:"string"},title_color:{type:"string",pattern:COLOR_PATTERN},title_size:{type:"integer",minimum:0}}},web_loading_screen:{type:"object",properties:{background_color:{type:"string",pattern:COLOR_PATTERN},image:{type:"array",items:{type:"object",properties:{image:{$ref:"#/definitions/tiled_image"}}}}}}}},PLACEMENT_OBJECT_SCHEMA={type:"object",properties:{id:{type:"integer"},type:{type:"string",enum:["rewarded","interstitial","banner"]},name:{type:"string",minLength:1},inventory_check_url:{type:"string",format:"hypr_url"}},required:["id","type","name","inventory_check_url"]},FONT_SCHEMA={type:"object",properties:{font_name:{type:"string"},font_size:{type:"integer",minimum:0},font_color:{type:"string",pattern:COLOR_PATTERN},disabled_font_color:{type:"string",pattern:COLOR_PATTERN},text_alignment:{type:"string"},text_line_height:{type:"integer",minimum:0}}},SHAPE_SCHEMA={type:"object",properties:{diameter:{type:"integer",minimum:0},corner_radius:{type:"integer",minimum:0},unselected_color:{type:"string",pattern:COLOR_PATTERN},selected_color:{type:"string",pattern:COLOR_PATTERN}},required:["diameter","unselected_color","selected_color"]},STYLE_SCHEMA={type:"object",properties:{background_color:{type:"string",pattern:COLOR_PATTERN},placeholder_color:{type:"string",pattern:COLOR_PATTERN},selected_background_color:{type:"string",pattern:COLOR_PATTERN},padding:{type:"array",minItems:2,maxItems:2,items:{type:"integer",minimum:0}},margin:{type:"array",minItems:2,maxItems:2,items:{type:"integer",minimum:0}},corner_radius:{type:"integer",minimum:0},shadow_elevation:{type:"integer",minimum:0},font:{$ref:"#/definitions/font"}}},REQUIRED_INFO_SCHEMA={type:"array",items:{type:"object",properties:{Type:{type:"string",pattern:SELECTOR_PATTERN},Name:{type:"string"},Title:{type:"string"},hint:{type:"string"},invalid_answer_message:{type:"string"},min:{type:"integer",minimum:0},max:{type:"integer"},answer_per_line_portrait:{type:"integer",minimum:0},answer_per_line_landscape:{type:"integer",minimum:0},answer_type:{type:"string"},style:{$ref:"#/definitions/style"},Values:{type:"array",minItems:1,items:{type:"object",properties:{Label:{type:"string"},Value:{type:"string"},style:{$ref:"#/definitions/style"},shape:{$ref:"#/definitions/shape"}}}}},required:["Type","Name","Title"]}},NEW_MOBILE_JS_SCHEMA={type:"object",properties:{url:{type:"string",format:"hypr_url"},version:{type:"integer",minimum:0},timeout:{type:"integer",minimum:0}},required:["url","version"]},OPEN_MEASUREMENT_SCHEMA={type:"object",properties:{omsdk_url:{type:"string",format:"hypr_url"},partner_name:{type:"string",minLength:1},api_version:{type:"string",minLength:1}},required:["omsdk_url","partner_name","api_version"]},APP_SCHEMA={type:"object",properties:{ver:{type:"string",minLength:1},bundle:{type:"string",minLength:1}},required:["ver","bundle"]},DEVICE_SCHEMA={type:"object",properties:{lmt:{type:"integer",minimum:0},ua:{type:"string",minLength:1},ifa:{type:"string",minLength:1},carrier:{type:"string",minLength:1},mccmnc:{type:"string",minLength:1},make:{type:"string",minLength:1},model:{type:"string",minLength:1},os:{type:"string",minLength:1},osv:{type:"string",minLength:1},connectiontype:{type:"integer",minimum:0},h:{type:"integer",minimum:0},w:{type:"integer",minimum:0},ext:{type:"object",properties:{device_fingerprint:{type:"string",minimum:0},device_product:{type:"string",minLength:1}}}},required:["lmt","make","model","os","osv","connectiontype","h","w"]},USER_SCHEMA={type:"object",properties:{id:{type:"string",minLength:1},data:{type:"array",items:{type:"object",properties:{segment:{type:"array",items:{type:"object",properties:{sdk_version:{type:"string",minLength:1},supported_interface_settings:{type:"array"},msdkv:{type:"integer",mimimum:"0"},ats_settings:{type:"object",properties:{NSAllowsArbitraryLoadsInWebContent:{type:"boolean"},NSAllowsArbitraryLoads:{type:"boolean"},NSAllowsArbitraryLoadsForMedia:{type:"boolean"}},required:["NSAllowsArbitraryLoadsInWebContent","NSAllowsArbitraryLoads","NSAllowsArbitraryLoadsForMedia"]},maccatalyst:{type:"boolean"},identifier_for_vendor:{type:"string",minimum:0},xcode_version:{type:"string",minimum:0},supports_multiple_scenes:{type:"boolean"},supports_multiwindow:{type:"boolean"},hypr_modules:{type:"object",properties:{HYPRPermissions:{type:"string",minLength:1}}},permissions:{type:"array",items:{type:"string"}},distributor_id:{type:"string",minLength:1},user_permissions:{type:"object",items:{type:"object",minLength:1}},framework_type:{type:"string",minLength:1},mobile_js_version:{type:"integer",minimum:0},placement_id:{type:"integer",minimum:0},low_power_enabled:{type:"boolean"},privacy_tacking_status:{type:"string"}},required:[]}}},required:["segment"]}}},required:["id","data"]},DEFINITIONS={ads_to_preload:ADS_TO_PRELOAD_SCHEMA,footer:FOOTER_SCHEMA,font:FONT_SCHEMA,image:IMAGE_SCHEMA,new_mobile_js:NEW_MOBILE_JS_SCHEMA,ad:AD_SCHEMA,placement:PLACEMENT_OBJECT_SCHEMA,required_information:REQUIRED_INFO_SCHEMA,shape:SHAPE_SCHEMA,style:STYLE_SCHEMA,tiled_image:TILED_IMAGE_SCHEMA,ui_components:UI_COMPONENTS_SCHEMA,web_traffic_header:WEB_TRAFFIC_HEADER_SCHEMA,open_measurement:OPEN_MEASUREMENT_SCHEMA,app:APP_SCHEMA,device:DEVICE_SCHEMA,user:USER_SCHEMA},INIT_SCHEMA={type:"object",definitions:DEFINITIONS,properties:{sharing_endpoint:{type:"string",format:"hypr_url"},completion_endpoint:{type:"string",format:"hypr_url"},ad_impression_tracking_endpoint:{type:"string",format:"hypr_url"},skadnetwork_signature_endpoint:{type:"string",format:"hypr_url"},user_info_tracking_endpoint:{type:"string",format:"hypr_url"},duration_update_endpoint:{type:"string",format:"hypr_url"},error_reporting_endpoint:{type:"string",format:"hypr_url"},webtraffic_visit_endpoint:{type:"string",format:"hypr_url"},ad_progress_endpoint:{type:"string",format:"hypr_url"},no_ad_tracking_endpoint:{type:"string",format:"hypr_url"},error_severity_level:{type:"integer"},enable_all_logs:{type:"boolean"},enable_tracking_prompt:{type:"boolean"},placements:{type:"array",items:{$ref:"#/definitions/placement"},uniqueItems:!0},ads_to_preload:{type:"array",items:{$ref:"#/definitions/ads_to_preload"},uniqueItems:!0},new_mobile_js:{$ref:"#/definitions/new_mobile_js"},ui_components:{$ref:"#/definitions/ui_components"},open_measurement:{$ref:"#/definitions/open_measurement"},webtraffic:{type:"object",properties:{close_button:{type:"object",properties:{image:{type:"object",properties:{url:{type:"string",format:"hypr_url"},width:{type:"integer",minimum:0},height:{type:"integer",minimum:0}},required:["url","width","height"]}},required:["image"]}},required:["close_button"]}},required:["sharing_endpoint","completion_endpoint","ad_impression_tracking_endpoint","user_info_tracking_endpoint","duration_update_endpoint","error_reporting_endpoint","webtraffic_visit_endpoint","error_severity_level","placements","ads_to_preload","ui_components","no_ad_tracking_endpoint","ad_progress_endpoint"]};class RequestParameterManager{constructor(e,t=HYPRConsentController){this.consentController=t,this.cache=JSONValidator.compact(e),this.compressedPersistentParams=void 0,e.preloaded_ads?this.vastStateCache=JSON.stringify(e.preloaded_ads):this.vastStateCache="[]",this.buildPersistentParamsObject()}getCompressedParameters(){const e=JSON.parse(this.compressedPersistentParams);return Object.assign(e,this.buildVolatileParamsObject()),JSON.stringify(e)}static persistentParameterMapping(){return{ad_id_opted_out:"ao",ats_settings:"at",bundle_id:"b",bundle_version:"bv",carrier_data:"c",cleartext_traffic_permitted:"ct",device:"d",device_brand:"db",device_fingerprint:"df",device_model:"dm",device_os_version:"do",device_product:"dp",device_type:"dt",distributor_id:"di",maccatalyst:"mc",mobile_js_version:"j",msdkv:"m",permissions:"p",screen_traits:"s",sdk_version:"sv",supported_interface_settings:"si",supports_multiple_scenes:"ss",supports_multiwindow:"sm",target_sdk_version:"sv",xcode_version:"x"}}buildPersistentParamsObject(){const e={};for(const[t,r]of Object.entries(RequestParameterManager.persistentParameterMapping()))void 0!==this.cache[t]&&(console.debug(`paramKey: ${t} compressedKey: ${r} value: ${this.cache[t]}`),"function"==typeof RequestParameterManager[t]?e[r]=RequestParameterManager[t](this.cache[t]):e[r]=this.cache[t]);this.compressedPersistentParams=JSON.stringify(JSONValidator.compact(e))}buildVolatileParamsObject(){const e={};return e.pa=RequestParameterManager.preloaded_ads(JSON.parse(this.vastStateCache)),e.cs=RequestParameterManager.compressConsent(this.consentController.getConsentParameters()),e.cn=RequestParameterManager.connection_type(HYPRRequestParamListener.getConnectionType()),e.l=RequestParameterManager.low_power_enabled(HYPRRequestParamListener.getIsLowPowerEnabled()),"function"==typeof HYPRRequestParamListener.getUserPermissions&&(e.up=RequestParameterManager.user_permissions(JSON.parse(HYPRRequestParamListener.getUserPermissions()))),JSONValidator.compact(e)}updateVastCacheState(e){const t=JSON.parse(this.vastStateCache);let r=-1;const i=e.identifier;return t.forEach(((e,t)=>{e.identifier===i&&(r=t)})),r>-1?(console.debug(`Updating cache state for identifier: ${e.identifier}`),t[r]=e):(console.debug(`Adding identifier: ${e.identifier} to cache`),t.push(e)),this.vastStateCache=JSON.stringify(t),t}static booleanToInt(e){return!0===e?1:0}static compressConsent(e){return void 0===e||void 0===e.consent||void 0===e.consent.is_consent_given?0:!0===e.consent.is_consent_given?1:2}static parseCarrierParams(e){return`${e.carrier_name||""},${e.mobile_network_code||""},${e.mobile_country_code||""},${RequestParameterManager.carrierCodeMap()[e.cellular_radio_type]||""}`}static carrierCodeMap(){return{UNKNOWN:0,GPRS:1,CTRadioAccessTechnologyGPRS:1,EDGE:2,CTRadioAccessTechnologyEdge:2,UMTS:3,HSDPA:4,CTRadioAccessTechnologyHSDPA:4,HSUPA:5,CTRadioAccessTechnologyHSUPA:5,HSPA:6,CDMA:7,CTRadioAccessTechnologyCDMA1x:7,"CDMA - EvDo rev. 0":8,CTRadioAccessTechnologyCDMAEVDORev0:8,"CDMA - EvDo rev. A":9,CTRadioAccessTechnologyCDMAEVDORevA:9,"CDMA - EvDo rev. B":10,CTRadioAccessTechnologyCDMAEVDORevB:10,"CDMA - 1xRTT":11,iDEN:12,LTE:13,CTRadioAccessTechnologyLTE:13,"CDMA - eHRPD":14,CTRadioAccessTechnologyeHRPD:14,"HSPA+":16,"NETWORK_TYPE_NR (5G)":16,CTRadioAccessTechnologyWCDMA:17}}static ad_id_opted_out(e){return RequestParameterManager.booleanToInt(e)}static ats_settings(e){let t=0;return t+=!0===e.NSAllowsArbitraryLoads?1:0,t+=!0===e.NSAllowsArbitraryLoadsInWebContent?2:0,t+=!0===e.NSAllowsArbitraryLoadsForMedia?4:0,t}static bundle_id(e){return e}static bundle_version(e){return e.substring(0,12)}static carrier_data(e){if(void 0!==e.carrier_name)return[RequestParameterManager.parseCarrierParams(e)];const t=[];for(const r of Object.keys(e))t.push(RequestParameterManager.parseCarrierParams(e[r]));return t}static cleartext_traffic_permitted(e){return RequestParameterManager.booleanToInt(e)}static connection_type(e){return"wifi"===e.toLowerCase()?1:0}static low_power_enabled(e){return RequestParameterManager.booleanToInt(e)}static maccatalyst(e){return RequestParameterManager.booleanToInt(e)}static permissions(e){let t=0;return t+=e.indexOf("NSCalendarsUsageDescription")>-1?1:0,t+=e.indexOf("NSCameraUsageDescription")>-1?2:0,t+=e.indexOf("NSContactsUsageDescription")>-1?4:0,t+=e.indexOf("NSPhotoLibraryAddUsageDescription")>-1?8:0,t+=e.indexOf("NSPhotoLibraryUsageDescription")>-1?16:0,t+=e.indexOf("NSUserTrackingUsageDescription")>-1?32:0,t+=e.indexOf("android.permission.WRITE_EXTERNAL_STORAGE")>-1?64:0,t+=e.indexOf("android.permission.VIBRATE")>-1?128:0,t+=e.indexOf("android.permission.CAMERA")>-1?256:0,t}static preloaded_ads(e){const t=[];for(const r of e)!0===r.asset_complete&&void 0!==r.last_cache_date&&t.push(r.identifier);return t}static screen_traits(e){let t="2";"dark"===e.userInterfaceStyle?t="0":"light"===e.userInterfaceStyle&&(t="1");let r="2";"compact"===e.horizontalSizeClass?r="0":"regular"===e.horizontalSizeClass&&(r="1");let i="2";"compact"===e.verticalSizeClass?i="0":"regular"===e.verticalSizeClass&&(i="1");let a="2";"high"===e.accessibilityContrast?a="0":"normal"===e.accessibilityContrast&&(a="1");let s="2";"base"===e.userInterfaceLevel?s="0":"elevated"===e.userInterfaceLevel&&(s="1");let o="2";"LTR"===e.userInterfaceLayoutDirection?o="0":"RTL"===e.userInterfaceLayoutDirection&&(o="1");let n="2";"1.0"===e.displayScale?n="0":"2.0"===e.displayScale&&(n="1");let l="4";return"iPhone"===e.userInterfaceIdiom?l="0":"iPad"===e.userInterfaceIdiom?l="1":"CarPlay"===e.userInterfaceIdiom?l="2":"Tv"===e.userInterfaceIdiom&&(l="3"),`${t}${r}${i}${a}${s}${o}${n}${l}`}static supported_interface_settings(e){let t=0;return t+=e.indexOf("UIInterfaceOrientationPortrait")>-1?1:0,t+=e.indexOf("UIInterfaceOrientationLandscapeLeft")>-1?2:0,t+=e.indexOf("UIInterfaceOrientationLandscapeRight")>-1?4:0,t+=e.indexOf("UIInterfaceOrientationPortraitUpsideDown")>-1?8:0,t}static supports_multiple_scenes(e){return RequestParameterManager.booleanToInt(e)}static supports_multiwindow(e){return RequestParameterManager.booleanToInt(e)}static user_permissions(e){let t="";return t+=RequestParameterManager.permissionValue(e.camera_permission),t+=RequestParameterManager.permissionValue(e.microphone_permission),t+=RequestParameterManager.permissionValue(e.calendar_permission),t}static permissionValue(e=""){return"not_determined"===e.toLowerCase()?"0":"restricted"===e.toLowerCase()?"1":"denied"===e.toLowerCase()?"2":"authorized"===e.toLowerCase()?"3":"7"}}class TransparencyTracking{static addStatus(e={}){if("object"==typeof HYPRTransparencyTrackingManager){const t=HYPRTransparencyTrackingManager.getTrackingPermissionStatus();console.debug(`TransparencyTracking received status of ${t}`),e.privacy_tracking_status=t}return e}static canPrompt(e={}){const t="object"==typeof HYPRTransparencyTrackingManager&&void 0!==e.enable_tracking_prompt&&e.enable_tracking_prompt&&"not_determined"===HYPRTransparencyTrackingManager.getTrackingPermissionStatus();return console.debug(`TransparencyTracking.canPrompt result: ${t}`),t}static prompt(e){if(void 0===e||e.length<1)throw new Error("No callback supplied to Transparency Tracking prompt");console.debug("TransparencyTracking will present prompt to user."),HYPRTransparencyTrackingManager.promptForTrackingPermissionWithCallback(e)}}const PLACEMENT_TYPE={REWARDED:"rewarded",INTERSTITIAL:"interstitial",BANNER:"banner"};class Placement{constructor(e,t,r,i,a,s=globalThis.HYPRNetworkController,o=globalThis.HYPRTimerController,n=HYPRConsentController){this.id=e,this.name=t,this.type=r,this.inventoryCheckURL=i,this.networkRequestController=s,this.timerController=o,this.consentController=n,this.placementListener=a,this.request=void 0,this.app=void 0,this.device=void 0,this.imp=void 0,this.user=void 0,this.userSegment={}}loadAd(e,t){}inventoryCheckCallback(e,t,r,i){}processResponse(e,t,r,i=!1){}loadBidResponse(e){return this.request&&this.request.abort(),this.clearAdAndStopAdAvailableTimer(),this.processResponse(200,parseJSON(e),void 0),this.request=void 0,!!this.isAdAvailable()&&(this.startAdAvailableTimer(),!0)}isAdAvailable(){return!1}isNavigationRuleMatch(e){return!1}getAdType(){return""}getAdString(){return"{}"}hasAd(){return!1}getUIComponentsString(){return"{}"}openClickInNativeBrowser(){return!1}getClickMode(){return void 0===this.ad||void 0===this.ad.click?"webview":this.ad.click.mode||"webview"}generateAppObject(e){void 0===this.app&&(this.app={ver:e.bundle_version,bundle:e.bundle_id})}generateDeviceObject(e){void 0===this.device?(this.device={lmt:this.formatLimitAdTracking(e.ad_id_opted_out),ifa:e.persistent_id,model:e.device_model,os:this.formatOSVersion(e.device_type),osv:e.device_os_version,h:e.device_height,w:e.device_width,pxratio:e.pxratio,ext:{device_fingerprint:e.device_fingerprint,device_product:e.device_product}},this.device.make="iOS"===this.device.os?"Apple":e.device_brand,e.device_fingerprint&&(this.device.ext.device_fingerprint=e.device_fingerprint),e.device_product&&(this.device.ext.device_product=e.device_product),this.updateDeviceCarrierData(e)):this.updateDeviceCarrierData(e)}updateDeviceCarrierData(e){switch(e.connection_type){case"Ethernet":this.device.connectiontype=1;break;case"WIFI":this.device.connectiontype=2;break;case"NR":this.device.connectiontype=3;break;case"CDMA":case"CDMA - EvDo rev. 0":case"CDMA - EvDo rev. A":case"CDMA - EvDo rev. B":case"CDMA - 1xRTT":case"CDMA - eHRPD":case"EDGE":this.device.connectiontype=4;break;case"GPRS":case"UMTS":case"HSPA":case"HSDPA":case"HSPA+":case"HSUPA":case"GSM":case"3G":this.device.connectiontype=5;break;case"LTE_CA":case"LTE":this.device.connectiontype=6;break;default:this.device.connectiontype=0}if(void 0===e.carrier_data)return;const t=Object.keys(e.carrier_data).sort();if(t.length>0){const r=e.carrier_data[t[0]];this.device.carrier=r.carrier_name,this.device.mccmnc=`${r.mobile_country_code},${r.mobile_network_code}`}}generateUserObject(e){if(void 0!==this.user){const t=this.user.data[0].segment[0];return t.user_permissions=e.user_permissions,t.privacy_tracking_status=e.privacy_tracking_status,t.low_power_enabled=e.low_power_enabled,void(t.consent=e.consent)}this.userSegment=this.buildUserSegment(e),this.user={id:e.uid,data:[{segment:[this.userSegment]}]}}buildUserSegment(e){return{sdk_version:e.sdk_version,supported_interface_settings:e.supported_interface_settings,msdkv:e.msdkv,ats_settings:e.ats_settings,maccatalyst:e.maccatalyst,ios_app_on_mac:e.ios_app_on_mac,identifier_for_vendor:e.identifier_for_vendor,xcode_version:e.xcode_version,supports_multiple_scenes:e.supports_multiple_scenes,supports_multiwindow:void 0!==e.supports_multiwindow&&e.supports_multiwindow,hypr_modules:e.hypr_modules,permissions:e.permissions,carrier_data:e.carrier_data,distributor_id:e.distributor_id,user_permissions:e.user_permissions,framework_type:e.framework_type,mobile_js_version:globalThis.version(),placement_id:e.placement_id,low_power_enabled:e.low_power_enabled,privacy_tracking_status:e.privacy_tracking_status,device_type:e.device_type,SKAdNetworkItems:e.SKAdNetworkItems,consent:e.consent,cleartext_traffic_permitted:e.cleartext_traffic_permitted,age_restricted_user:e.age_restricted_user}}generateImpressionFromParams(e={}){return[]}formatLimitAdTracking(e){return e?1:0}formatOSVersion(e){return void 0!==e&&e.length>0&&"iP"===e.substring(0,2)?"iOS":"Android"}clearAdAndStopAdAvailableTimer(e=!1){}startAdAvailableTimer(){}handleRefresh(e,t){}isEqualToPlacement(e){return this.id===e.id}compileRequestParamsFromParams(e,t){return e.placement_id=this.id,this.addStatusParamsToParams(e),e}appStoreSignatureParams(e){const t=JSON.parse(HYPRRequestParamListener.getTrackingParams()),r={app_store_params:e,device_os_version:t.device_os_version,bundle_id:t.bundle_id,distributor_id:t.distributor_id,placement_id:this.id,offer:this.getOfferName(),msdkv:t.msdkv,mobile_js_version:globalThis.version(),xcode_version:t.xcode_version};return this.addStatusParamsToParams(r),r}addStatusParamsToParams(e){const t=Object.assign(e,this.consentController.getConsentParameters());return t.low_power_enabled=!!HYPRRequestParamListener.getIsLowPowerEnabled(),void 0!==globalThis.HYPRRequestParameterManager.cache[SKAdNetworkItemsKey]&&(t[SKAdNetworkItemsKey]=globalThis.HYPRRequestParameterManager.cache[SKAdNetworkItemsKey]),TransparencyTracking.addStatus(t),t}getOfferName(){return""}isFullscreenAdType(){return this.type===PLACEMENT_TYPE.REWARDED||this.type===PLACEMENT_TYPE.INTERSTITIAL}isBannerAdType(){return this.type===PLACEMENT_TYPE.BANNER}getBrowserDurationUrl(){return""}toString(){return`${this.constructor.name}[id=${this.id}, name=${this.name}, type=${this.type}, inventoryCheckURL=${this.inventoryCheckURL}, ad=${JSON.stringify(this.ad)}]`}}const PLACEMENT_SCHEMA={type:"object",definitions:DEFINITIONS,properties:{ads_available:{type:"array",uniqueItems:!0,items:{$ref:"#/definitions/ad"}},ads_to_preload:{type:"array",items:{$ref:"#/definitions/ads_to_preload"},uniqueItems:!0},required_information:{$ref:"#/definitions/required_information"},ui_components:{$ref:"#/definitions/ui_components"}},required:["ads_available"]},POST_AD_REFRESH="refresh",CONSENT_CHANGED_REFRESH="consentChanged";class FullScreenPlacement extends Placement{constructor(e,t,r,i,a,s=globalThis.HYPRNetworkController,o=globalThis.HYPRTimerController,n=HYPRConsentController){super(e,t,r,i,a,s,o,n),this.refreshRequest=void 0,this.canShowFor=void 0}loadAd(e,t){if(this.refreshInProgress())return void this.placementListener.onLoadAdResponse(this,void 0);void 0!==this.secondaryRefreshInfo&&(console.error(`Load ad started with a secondaryRefreshInfo still set: ${JSON.stringify(this.secondaryRefreshInfo)}`),this.secondaryRefreshInfo=void 0);const r=this.compileRequestParamsFromParams(e,this.getPromiseTokenKey(!0));this.clearAdAndStopAdAvailableTimer();const i=JSON.stringify(JSONValidator.compact(r));console.debug(`Loading ads for ${this} with request params: ${i}`),this.request=this.networkRequestController.request(this.inventoryCheckURL,i,CONNECTION_TYPE.POST,DEFAULT_JSON_CONNECTION_CONFIGURATION,((e,r,i)=>{this.inventoryCheckCallback(e,r,i,t)}))}inventoryCheckCallback(e,t,r,i){NetworkRequestController.validResponseStatus(e)&&void 0===r?console.debug(`Loading ads completed for placement: ${this} with body: ${t}`):console.debug(`Loading ads completed for placement: ${this} with status code ${e} and with error: ${r}`);const a=parseJSON(t);this.processResponse(e,a,r),this.request=void 0,this.isAdAvailable()&&this.startAdAvailableTimer(),i(this,r)}processResponse(e,t,r,i=!1){if(NetworkRequestController.validResponseStatus(e)&&void 0===r&&void 0!==t&&JSONValidator.validateJSON(PLACEMENT_SCHEMA,t)){const e=t.ads_available||[];(!i||e.length>0)&&([this.ad]=e),this.required_information=t.required_information,void 0!==t.ui_components&&(this.ui_components=t.ui_components),i||(this.ads_to_preload=t.ads_to_preload)}}isAdAvailable(){return this.hasRequiredInformation()||this.hasAd()}startAdAvailableTimer(){void 0!==this.ad&&(this.canShowFor=this.ad.available_for),void 0===this.canShowFor&&(this.canShowFor=defaultAdAvailableFor()),console.debug(`FullScreenPlacement.startAdAvailableTimer(${this.name}) for ${this.canShowFor} seconds`),this.adAvailableTimer=this.timerController.startTimer(1e3*this.canShowFor,(()=>{this.clearAdAndStopAdAvailableTimer(!0)}))}stopAdAvailableTimer(){this.adAvailableTimerIsActive()&&(console.debug(`FullScreenPlacement.stopAdAvailableTimer(${this.name})`),this.timerController.stopTimer(this.adAvailableTimer),this.canShowFor=void 0,this.adAvailableTimer=void 0)}clearAd(){console.debug(`FullScreenPlacement.clearAd(${this.name})`),this.ad=void 0,this.required_information=void 0,this.ads_to_preload=void 0,this.ui_components=void 0}clearRequiredInfo(){this.required_information=void 0}clearAdsToPreload(){this.ads_to_preload=void 0}clearAdAndStopAdAvailableTimer(e=!1){console.debug(`FullScreenPlacement.clearAdAndStopTimer(${this.name})`),void 0!==this.request&&(this.networkRequestController.abortRequest(this.request),this.request=void 0),this.stopAdAvailableTimer(),this.clearAd(),this.placementListener&&!this.refreshInProgress()&&(this.placementListener.onPlacementAdCleared(this),e&&this.placementListener.onPlacementAdExpired(this))}handleRefresh(e,t){if(this.adAvailableTimerIsActive()){if(this.refreshInProgress()){console.debug(`Refresh in progress for placement ${this.name} with request ${this.refreshRequest}`);const t=void 0!==this.secondaryRefreshInfo?this.secondaryRefreshInfo.context:"",r={};return r.context=t===CONSENT_CHANGED_REFRESH?CONSENT_CHANGED_REFRESH:e,void(this.secondaryRefreshInfo=r)}console.debug(`Refresh started for placement: ${this} with context: ${e}`),e===CONSENT_CHANGED_REFRESH&&this.clearAd(),this.clearRequiredInfo(),this.clearAdsToPreload(),this.refreshAd(e,t)}}refreshAd(e,t){const r=this.compileRequestParamsFromParams(t,this.getPromiseTokenKey(!0));r.context=e,console.debug(`refresh params are: ${JSON.stringify(r)}`);const i=JSON.stringify(JSONValidator.compact(r));this.refreshRequest=this.networkRequestController.request(this.inventoryCheckURL,i,CONNECTION_TYPE.POST,DEFAULT_JSON_CONNECTION_CONFIGURATION,((e,t,r)=>{this.refreshAdCallback(e,t,r)}))}refreshAdCallback(e,t,r){console.debug(`Refresh completed for placement: ${this} with code ${e}, body ${t}, and error ${r}`),this.refreshRequest=void 0;const i=parseJSON(t);this.processResponse(e,i,r,!0);const a=this.getAdIdentifier();if(FullScreenPlacement.responseHasAd(i))console.debug((a.length>0?`Refreshed with ad id: ${a}. `:"Refreshed with new RequiredInfo. ")+"Restarted timer."),this.stopAdAvailableTimer(),this.startAdAvailableTimer();else{if(!this.adAvailableTimerIsActive())return console.debug("Refreshed completed with no ad and timer has ended"),this.placementListener.onPlacementAdCleared(this),void this.placementListener.onPlacementAdExpired(this);console.debug(`Refreshed completed with no new ad. Current ad id is: ${a}.  Timer still active.`)}this.placementListener.onRefreshAdResponse(this,r),this.secondaryRefreshInfo&&(console.debug(`Starting secondary refresh for Context: ${this.secondaryRefreshInfo.context}`),this.placementListener.startAdRefresh(this.secondaryRefreshInfo.context,this.name),this.secondaryRefreshInfo=void 0)}static responseHasAd(e){return void 0!==e&&(void 0!==e.ads_available&&e.ads_available.length>0||void 0!==e.required_information&&e.required_information.length>0)}refreshInProgress(){return void 0!==this.refreshRequest}adAvailableTimerIsActive(){return void 0!==this.adAvailableTimer}getOfferName(){return this.hasAd()?`${this.getAdType()}-${this.getAdIdentifier()}`:super.getOfferName()}hasRequiredInformation(){return void 0!==this.required_information&&this.required_information.length>0}hasUIComponents(){return void 0!==this.ui_components&&Object.keys(this.ui_components).length>0}hasAd(){return void 0!==this.ad&&Object.keys(this.ad).length>0}getRequiredInfoString(){return this.hasRequiredInformation()?JSON.stringify(this.required_information):"[]"}shouldAppStoreUseOverlay(){return this.hasAd()&&!0===this.ad.use_skoverlay}getUIComponentsString(){const e=this.hasUIComponents()?this.ui_components:globalThis.defaultUIComponents;return void 0===e.no_ad&&(e.no_ad=FullScreenPlacement.noAdDefaultUI()),JSON.stringify(e)}getPromiseTokenKey(e){let t=null;return e?void 0!==this.ad&&this.ad.relay_promise_token&&(t="last_promise_token"):t="reward_token",t}static noAdDefaultUI(){const e={title:"This ad is not available based on your response. Close to continue.",title_color:"282828",title_size:16};return e}getAdString(){if(this.hasAd()){const e=this.ad;return void 0===e.webview_release_in_seconds&&(e.webview_release_in_seconds=defaultWebViewReleaseSeconds),void 0===e.force_status_bar_display&&(e.force_status_bar_display=this.getAdType()===WEB_TRAFFIC_OFFER&&"portrait"===e.allowed_orientation),JSON.stringify(e)}return"{}"}getAdType(){return this.hasAd()&&this.ad.type?this.ad.type:""}getAdIdentifier(){return this.hasAd()&&this.ad.id?this.ad.id:""}getAdRewardText(){return this.hasAd()&&this.ad.reward_text?this.ad.reward_text:""}getAdRewardQuantity(){return this.hasAd()&&this.ad.reward_quantity?this.ad.reward_quantity:0}getAdRewardToken(){return this.hasAd()&&this.ad.reward_token?this.ad.reward_token:""}compileRequestParamsFromParams(e,t){const r=super.compileRequestParamsFromParams(e);return null!==t&&(r[t]=this.getAdRewardToken()),r}isNavigationRuleMatch(e){return!("string"!=typeof e||!this.hasAd()||"string"!=typeof this.ad.navigation_rule||this.ad.navigation_rule.length<1)&&null!==e.match(new RegExp(this.ad.navigation_rule,"i"))}openClickInNativeBrowser(){return void 0===this.ad||void 0===this.ad.click?super.openClickInNativeBrowser():"native"===this.ad.click.mode}toString(){return`${super.toString()}, isAdAvailable=${this.isAdAvailable()}, canShowFor=${this.canShowFor}]`}}var base64={exports:{}};(function(module,exports){!function(e,t){module.exports=t(e)}("undefined"!=typeof self?self:"undefined"!=typeof window?window:commonjsGlobal,(function(global){var _Base64=global.Base64,version="2.4.9",buffer;if(module.exports)try{buffer=eval("require('buffer').Buffer")}catch(e){buffer=void 0}var b64chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b64tab=function(e){for(var t={},r=0,i=e.length;r<i;r++)t[e.charAt(r)]=r;return t}(b64chars),fromCharCode=String.fromCharCode,cb_utob=function(e){if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?fromCharCode(192|t>>>6)+fromCharCode(128|63&t):fromCharCode(224|t>>>12&15)+fromCharCode(128|t>>>6&63)+fromCharCode(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return fromCharCode(240|t>>>18&7)+fromCharCode(128|t>>>12&63)+fromCharCode(128|t>>>6&63)+fromCharCode(128|63&t)},re_utob=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,utob=function(e){return e.replace(re_utob,cb_utob)},cb_encode=function(e){var t=[0,2,1][e.length%3],r=e.charCodeAt(0)<<16|(e.length>1?e.charCodeAt(1):0)<<8|(e.length>2?e.charCodeAt(2):0);return[b64chars.charAt(r>>>18),b64chars.charAt(r>>>12&63),t>=2?"=":b64chars.charAt(r>>>6&63),t>=1?"=":b64chars.charAt(63&r)].join("")},btoa=global.btoa?function(e){return global.btoa(e)}:function(e){return e.replace(/[\s\S]{1,3}/g,cb_encode)},_encode=buffer?buffer.from&&Uint8Array&&buffer.from!==Uint8Array.from?function(e){return(e.constructor===buffer.constructor?e:buffer.from(e)).toString("base64")}:function(e){return(e.constructor===buffer.constructor?e:new buffer(e)).toString("base64")}:function(e){return btoa(utob(e))},encode=function(e,t){return t?_encode(String(e)).replace(/[+\/]/g,(function(e){return"+"==e?"-":"_"})).replace(/=/g,""):_encode(String(e))},encodeURI=function(e){return encode(e,!0)},re_btou=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),cb_btou=function(e){switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return fromCharCode(55296+(t>>>10))+fromCharCode(56320+(1023&t));case 3:return fromCharCode((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return fromCharCode((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},btou=function(e){return e.replace(re_btou,cb_btou)},cb_decode=function(e){var t=e.length,r=t%4,i=(t>0?b64tab[e.charAt(0)]<<18:0)|(t>1?b64tab[e.charAt(1)]<<12:0)|(t>2?b64tab[e.charAt(2)]<<6:0)|(t>3?b64tab[e.charAt(3)]:0),a=[fromCharCode(i>>>16),fromCharCode(i>>>8&255),fromCharCode(255&i)];return a.length-=[0,0,2,1][r],a.join("")},atob=global.atob?function(e){return global.atob(e)}:function(e){return e.replace(/[\s\S]{1,4}/g,cb_decode)},_decode=buffer?buffer.from&&Uint8Array&&buffer.from!==Uint8Array.from?function(e){return(e.constructor===buffer.constructor?e:buffer.from(e,"base64")).toString()}:function(e){return(e.constructor===buffer.constructor?e:new buffer(e,"base64")).toString()}:function(e){return btou(atob(e))},decode=function(e){return _decode(String(e).replace(/[-_]/g,(function(e){return"-"==e?"+":"/"})).replace(/[^A-Za-z0-9\+\/]/g,""))},noConflict=function(){var e=global.Base64;return global.Base64=_Base64,e};if(global.Base64={VERSION:version,atob:atob,btoa:btoa,fromBase64:decode,toBase64:encode,utob:utob,encode:encode,encodeURI:encodeURI,btou:btou,decode:decode,noConflict:noConflict,__buffer__:buffer},"function"==typeof Object.defineProperty){var noEnum=function(e){return{value:e,enumerable:!1,writable:!0,configurable:!0}};global.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",noEnum((function(){return decode(this)}))),Object.defineProperty(String.prototype,"toBase64",noEnum((function(e){return encode(this,e)}))),Object.defineProperty(String.prototype,"toBase64URI",noEnum((function(){return encode(this,!0)})))}}return global.Meteor&&(Base64=global.Base64),module.exports&&(module.exports.Base64=global.Base64),{Base64:global.Base64}}))})(base64);class BiddingController{constructor(e=globalThis.HYPRPlacementController,t=globalThis.HYPRRequestParameterManager){this.placementController=e,this.requestParameterManager=t}getSessionToken(){return encodeURI(base64.exports.Base64.encode(this.requestParameterManager.getCompressedParameters()))}loadBid(e,t){const r=this.placementController.getPlacement(e),i=base64.exports.Base64.decode(decodeURI(t));return r.loadBidResponse(i)}}const BANNER_RESPONSE_SCHEMA={type:"object",definitions:DEFINITIONS,properties:{bid:{type:"array",items:{type:"object",properties:{impid:{type:"string",minLength:1},adm:{type:"object",properties:{ad_html:{type:"string",minLength:1},offer_id:{type:"string",minLength:1},click:{type:"object",properties:{on_page_js:{type:"string",minLength:1},mode:{type:"string",minLength:1}}},size:{type:"object",properties:{w:{type:"integer",minimum:0},h:{type:"integer",minimum:0}},required:["w","h"]}},required:["size","click","ad_html"]}},required:["impid","adm"]}}},required:["bid"]};class BannerAd{constructor(e={}){if(0===Object.keys(e).length||!JSONValidator.validateJSON(BANNER_RESPONSE_SCHEMA,e))return;const t=e.bid||[];if(t.length<1)return;const r=t[0];this.impid=r.impid;const i=r.adm||{};this.ad_html=i.ad_html||"",this.offerId=i.offer_id||"",this.acceptableAdSizeVariance=i.acceptable_ad_size_variance||HYPR_DEFAULT_ACCEPTABLE_BANNER_SIZE_VARIANCE;const a=i.click||{};this.onPageJS=a.on_page_load_js||"",this.clickMode=a.mode||"webview"}hasImpressionId(){return"string"==typeof this.impid&&this.impid.length>0}hasAd(){return"string"==typeof this.ad_html&&this.ad_html.length>0}}class BannerPlacement extends Placement{constructor(e,t,r,i,a,s,o,n,l=globalThis.HYPRNetworkController,d=globalThis.HYPRTimerController,c=HYPRConsentController){super(e,t,r,i,n,l,d,c),this.ad=new BannerAd,this.impressionUrl=a,this.clickTrackingUrl=s,this.browserDurationUrl=o}loadAd(e,t){this.imp=void 0;const r=this.compileRequestParamsFromParams(e),i=JSON.stringify(JSONValidator.compact(r));console.debug(`Loading ads for ${this} with request params: ${i}`),this.request=this.networkRequestController.request(this.inventoryCheckURL,i,CONNECTION_TYPE.POST,DEFAULT_JSON_CONNECTION_CONFIGURATION,((e,i,a)=>{this.bannerLoadCallback(e,i,a,r.imp,t)}))}compileRequestParamsFromParams(e,t){const r=super.compileRequestParamsFromParams(e);this.generateAppObject(r),this.generateDeviceObject(r),this.generateUserObject(r);const i=this.generateImpressionFromParams(r);return{app:this.app,device:this.device,imp:i,user:this.user}}generateImpressionFromParams(e={}){const t=super.generateImpressionFromParams(e);return void 0!==e.definedSize&&t.push({banner:{w:numberOrZero(e.definedSize.width),h:numberOrZero(e.definedSize.height)}}),t}buildUserSegment(e){const t=super.buildUserSegment(e);return void 0===e.actualSize?(console.error("Actual size params missing for banner"),t):(t.banner_container_width=numberOrZero(e.actualSize.width),t.banner_container_height=numberOrZero(e.actualSize.height),t)}updateSegmentContainerData(e){void 0!==this.userSegment&&(this.userSegment.banner_container_height=e.height||0,this.userSegment.banner_container_width=e.width||0)}getBannerImpressionSize(){return void 0!==this.imp&&this.imp[0]?this.imp[0].banner:{}}getImpressionUrl(){return this.impressionUrl}getClickThroughUrl(){return this.clickTrackingUrl}openClickInNativeBrowser(){return void 0===this.ad?super.openClickInNativeBrowser():"native"===this.ad.clickMode}getClickMode(){return void 0===this.ad?super.getClickMode():this.ad.clickMode||"webview"}bannerLoadCallback(e,t,r,i,a){let s=r;void 0!==s?console.debug(`Loading ads received error for placement: ${this} with status code ${e} and error: ${s}`):NetworkRequestController.validResponseStatus(e)?console.debug(`Loading ads completed for placement: ${this} with body: ${t}`):(console.debug(`Loading ads received invalid status code for placement: ${this} with status code ${e}`),s=`Invalid status code ${e}`),this.imp=i;const o=parseJSON(t);this.processResponse(e,o,s),a(this,s),this.request=void 0}getOfferName(){return void 0!==this.ad?this.ad.offerId:super.getOfferName()}getImpressionId(){return void 0!==this.ad?this.ad.impid:""}getAdType(){return BANNER_OFFER}isAdAvailable(){return void 0!==this.ad&&this.ad.hasImpressionId()&&this.ad.hasAd()}shouldAppStoreUseOverlay(){return!1}getBrowserDurationUrl(){return void 0!==this.browserDurationUrl?this.browserDurationUrl:""}processResponse(e,t,r,i=!1){NetworkRequestController.validResponseStatus(e)&&void 0===r&&void 0!==t&&(this.ad=new BannerAd(t))}}class PlacementFactory{static fromObject(e,t,r=globalThis.HYPRNetworkController,i=globalThis.HYPRTimerController){return equalsIgnoreCase(PLACEMENT_TYPE.BANNER,e.type)?new BannerPlacement(e.id,e.name,e.type,e.inventory_check_url,e.impression_attempts_url,e.click_reporting_url,e.time_on_site_url,t,r,i):equalsIgnoreCase(PLACEMENT_TYPE.REWARDED,e.type)||equalsIgnoreCase(PLACEMENT_TYPE.INTERSTITIAL,e.type)?new FullScreenPlacement(e.id,e.name,e.type,e.inventory_check_url,t,r,i):(console.error(`PlacementFactory received unknown placement type ${e.type}`),new Placement(e.id,e.name,e.type,e.inventory_check_url,t,r,i))}static deepCopy(e){const t=new e.constructor;for(const r in e)t[r]=e[r];return t}}class PlacementController{constructor(e,t=HYPRConsentController,r=HYPRPreloadController){if(this.placementMap=new Map,this.preloadController=r,console.debug(`Placement Controller initialized with ${JSON.stringify(e)}`),Array.isArray(e))for(const t of e)this.placementMap.set(t.name,PlacementFactory.fromObject(t,this));else void 0!==e&&"object"==typeof e&&this.placementMap.set(e.name,PlacementFactory.fromObject(e,this));t.setConsentChangedListener(this),globalThis.HYPRBiddingController=new BiddingController(this)}getPlacements(){return this.placementMap}getBannerPlacements(){return[...this.placementMap.values()].filter((e=>e.isBannerAdType()))}getPlacement(e){const t=this.placementMap.get(e);return void 0!==t&&void 0===t.placementListener&&(t.placementListener=this),this.placementMap.get(e)}isAdAvailable(e){const t=this.getPlacement(e);return void 0===t?(console.debug(`PlacementController.isAdAvailable(${e}) reports undefined placement. Returning false.`),!1):t.isAdAvailable()}clearAllPlacementsAdStateAndTimers(){this.placementMap.forEach(((e,t,r)=>{e.clearAdAndStopAdAvailableTimer()}))}startAdRefresh(e,t){console.debug(`PlacementController - Start Ad Refresh for context: ${e} placementName: ${t}`);const r={context:e};void 0!==t&&(r.placementName=t),HYPRRequestParamListener.getInventoryCheckParams("HYPRPlacementController.refreshPlacements",JSON.stringify(r))}refreshPlacements(e={},t={}){console.debug(`Refreshing placements with info: ${JSON.stringify(t)}`),void 0===t.placementName?this.placementMap.forEach(((r,i,a)=>{r.handleRefresh(t.context,e)})):this.getPlacement(t.placementName).handleRefresh(t.context,e)}loadAd(e,t={}){const r=this.getPlacement(e);void 0===r?(console.debug("PlacementController loadAd reports undefined placement. Returning onLoadAdFailure."),HYPRPlacementListener.onLoadAdFailure(e,"placement name is invalid")):r.loadAd(t,((e,t)=>{e.placementListener.onLoadAdResponse(e,t)}))}handlePreloading(e){this.preloadController.handleMraidAdToPreload(e),this.preloadController.handleAdsToPreloadResponse(e.ads_to_preload),this.preloadController.handleUIComponentsToPreloadResponse(e.ui_components)}onLoadAdResponse(e,t){void 0!==t?(console.debug(`PlacementController loadAd failure ${t}`),this.onPlacementLoadAdFailure(e,t)):(console.debug(`PlacementController onPlacementLoadAdSuccess for ${e}`),this.onPlacementLoadAdSuccess(e),this.handlePreloading(e))}onRefreshAdResponse(e,t){void 0===t&&this.handlePreloading(e)}onPlacementLoadAdSuccess(e){HYPRPlacementListener.onLoadAdSuccess(e.name,e.isAdAvailable())}onPlacementLoadAdFailure(e,t){HYPRPlacementListener.onLoadAdFailure(e.name,t)}onPlacementAdCleared(e){console.debug(`Cleared ad state for ${e}`),HYPRPlacementListener.onAdCleared(e.name)}onPlacementAdExpired(e){console.debug(`Ad expired for ${e}`),HYPRPlacementListener.onAdExpired(e.name)}onConsentChanged(){console.debug("Consent status changed.  Clearing all ad state."),this.startAdRefresh(CONSENT_CHANGED_REFRESH)}}globalThis.PlacementController=PlacementController;class NavigationDecision{constructor(e,t){this.decision=e,this.url=t}}const HYPR_NAVIGATION_DECISION={NAVIGATION_ALLOWED:"NAVIGATION_ALLOWED",NAVIGATION_BLOCKED:"NAVIGATION_BLOCKED",OPEN_OUTSIDE_APPLICATION:"OPEN_OUTSIDE_APPLICATION",NAVIGATION_REDIRECTED:"NAVIGATION_REDIRECTED"},BrowserType={NATIVE:"showNativeBrowser",HYPRMX:"showHyprMXBrowser"};class WindowOpenRequest{constructor(e,t,r){this.url=e,this.browserType=t.openClickInNativeBrowser()?BrowserType.NATIVE:BrowserType.HYPRMX,this.placement=t,this.baseAdId=r}toEventMessage(){const e={};return e[this.browserType]={url:this.url,instanceId:this.baseAdId},JSON.stringify(e)}}const FULLSCREEN_APP_STORE="fullscreen",OVERLAY_APP_STORE="overlay",HANDLE_OUTSIDE_APP="outside_app",HYPR_ITUNES_URL_DOMAINS=["itunes.apple.com","apps.apple.com"],HYPR_PLAYSTORE_URL_DOMAINS=["play.google.com"];class StorePresentationController{constructor(e,t,r=globalThis.HYPRNetworkController){this.configuration=e,this.networkRequestController=r,this.adnetworkSignatureEndpoint=t,this.presentationModes=StorePresentationController.getSupportedPresentationModes(e),this.request=void 0}presentStore(e,t,r,i){const a=this.getStorePresentationMode(t,i);this.fetchAttributionSignature(e,a,t,r)}parseUrlForAppleOverlayParams(e){let t;if(HYPR_ITUNES_URL_DOMAINS.filter((t=>e.includes(t))).length<1)return t;const r=StorePresentationController.getUrlParams(e),i=StorePresentationController.getAppStoreId(e.split("?").shift(),r);return void 0===i?t:{url:e,SKStoreProductParameterITunesItemIdentifier:i,SKStoreProductParameterAffiliateToken:r.at,SKStoreProductParameterCampaignToken:r.ct,SKStoreProductParameterProviderToken:r.pt}}fetchAttributionSignature(e,t,r,i){const a=new ConnectionConfiguration(!0,DEFAULT_READ_TIMEOUT,DEFAULT_CONNECTION_TIMEOUT,{"Content-Type":JSON_UTF8_CONTENT_TYPE,Accept:JSON_CONTENT_TYPE}),s=r.appStoreSignatureParams(e),o=JSON.stringify(JSONValidator.compact(s));this.request=this.networkRequestController.request(this.adnetworkSignatureEndpoint,o,CONNECTION_TYPE.POST,a,((r,a,s)=>{this.responseCallback(r,a,s,e,t,i)}))}responseCallback(e,t,r,i,a,s){console.log(`SKAdNetwork Signature response received with status: ${e} error: ${r}`),this.request=void 0;let o=JSON.stringify(i);204!==e&&NetworkRequestController.validResponseStatus(e)&&(o=JSON.stringify(parseJSON(t))),s.showAppStore(a,o)}static getAppStoreId(e,t){if(void 0!==t.id)return parseInt(t.id,10);let r=e.split("/").slice(-1).shift();0===r.indexOf("id")&&(r=r.split("id").slice(-1).shift());const i=parseInt(r,10);return Number.isNaN(i)?void 0:i}static getUrlParams(e){const t={},r=e.indexOf("?");if(-1===r||r+1===e.length)return t;return e.slice(e.indexOf("?")+1).split("&").map((e=>{const[r,i]=e.split("=");t[r]=decodeURIComponent(i)})),t}getStorePresentationMode(e,t){let r=t;return void 0===r&&(r=this.presentationModeForPlacement(e)),console.debug(`StorePresentationController: preferred store presentation mode: ${r}`),this.presentationModes.indexOf(r)>-1?(console.debug(`StorePresentationController: using preferred store presentation mode: ${r}`),r):(console.debug(`StorePresentationController: fallback to store presentation mode: ${this.presentationModes[0]}`),this.presentationModes[0])}presentationModeForPlacement(e){return void 0!==e&&e.shouldAppStoreUseOverlay()?OVERLAY_APP_STORE:FULLSCREEN_APP_STORE}static getSupportedPresentationModes(e){const t=[];return e.isIos()&&e.isPortraitSupported()&&t.push(FULLSCREEN_APP_STORE),e.isIos()&&e.version>=14&&t.push(OVERLAY_APP_STORE),t.push(HANDLE_OUTSIDE_APP),console.debug(`StorePresentationController: available presentation modes: ${JSON.stringify(t)}`),t}isPlayStoreUrl(e){return HYPR_PLAYSTORE_URL_DOMAINS.filter((t=>e.includes(t))).length>=1&&this.configuration.isAndroid()}}const PAUSE_TRANSITIONS=["onStop","UISceneDidEnterBackgroundNotification","UIApplicationDidEnterBackgroundNotification"],RESUME_TRANSITIONS=["onResume","UISceneWillEnterForegroundNotification","UIApplicationWillEnterForegroundNotification"];class BaseAdViewModel{constructor(e,t,r="",i=HYPREventBus,a=HYPRRequestParamListener,s=globalThis.HYPRNetworkController,o=globalThis.HYPRStorePresentationController,n=HYPRInitializationController.deviceConfiguration){this.placement=e,this.listener=t,this.eventBus=i,this.paramRequestListener=a,this.networkRequestController=s,this.storePresentationController=o,this.configuration=n,this.webViewModel=void 0,this.topic=void 0,this.presentationListener=void 0,this.instanceId=r,this.browserRequest=void 0,this.lastTransition="",this.hasParentView=!1,this.currentSizeData=void 0,this.visible=!1,this.hasBecomeVisible=!1,this.clickMode=void 0!==this.placement?this.placement.getClickMode():"webview",this.resolvedStoreUrl=void 0}postToViewModel(e){this.eventBus.postUpdate(this.topic,this.placement.name,this.instanceId,e)}setClosable(e,t){t&&globalThis.HYPRErrorController.sendClientErrorCapture(PAGE_READY_ERROR_COLLECTION,PAGE_READY_ERROR_SUMMARY,PAGE_READY_ERROR_MESSAGE,ERROR_SEVERITY_MEDIUM);const r=JSON.stringify({setClosable:{isClosable:!0,disableDialog:t}});this.postToViewModel(r)}onBackPressed(){}onLifecycleEvent(e){console.debug(`onLifecycleEvent: ${e.event} received.`),this.handleLifecycleTransition(e.event)}onParentViewChangeEvent(e){console.debug(`onParentViewChangeEvent: View has superview: ${e.parentView}.`),this.hasParentView=e.parentView,this.updateWebViewVisibility()}containerSizeChange(e){console.debug(`Received new container size: ${JSON.stringify(e)}`),this.currentSizeData=e,void 0!==this.webViewModel&&this.webViewModel.parentContainerSizeChange(e)}containerVisibleChange(e){!0===e.visible&&(this.hasBecomeVisible=!0),console.debug(`Received new visible state: ${e.visible}`),this.visible=e.visible,this.updateWebViewVisibility()}updateWebViewVisibility(){void 0!==this.webViewModel&&this.webViewModel.parentVisibilityChanged(this.visible)}handleLifecycleTransition(e){this.isBackgroundTransition(e)?(this.onBackgroundTransition(),this.lastTransition=e):this.isForegroundTransition(e)&&(this.onForegroundTransition(),this.lastTransition=e)}onForegroundTransition(){this.webViewModel.parentLifecycleChanged(!1)}onBackgroundTransition(){this.webViewModel.parentLifecycleChanged(!0)}isBackgroundTransition(e){return PAUSE_TRANSITIONS.includes(e)&&!PAUSE_TRANSITIONS.includes(this.lastTransition)}isForegroundTransition(e){return RESUME_TRANSITIONS.includes(e)&&!RESUME_TRANSITIONS.includes(this.lastTransition)}isValid(){return void 0!==this.placement}getPlacementName(){return this.isValid()?this.placement.name:""}getPlacementType(){return this.isValid()?this.placement.type:""}shouldBootstrapMraid(){return!1}shouldScrollBounce(){return!0}isPinchEnabled(){return!0}scrollingEnabled(){return!0}allowsWebViewLinkPreview(){return!0}playbackRequiresUserAction(){return!1}webViewBackground(){return"ffffff"}webViewAlpha(){return"ff"}getBasePresentationStatus(){if(void 0!==this.presentationListener)return this.presentationListener.getPresentationStatus()}handleJSMessageFromWebView(e){if(void 0===this.topic)return;const{name:t,body:r}=e;switch(t){case"open":case"openInSafariVC":this.windowOpenAttempt(r);break;case"playVideo":this.playVideo(r);break;case"createCalendarEvent":this.createCalendarEvent(r);break;case"storePicture":this.storePicture(r);break;case"setRecoveryPostParameters":this.storeRecoveryParams(r);break;case"setClosable":this.setClosable(r,!1);break;case"presentStoreView":this.willStartStorePresentation(JSON.parse(r).url,JSON.parse(r).mode);break;default:{const e=JSON.stringify({appJSEvent:{method:t,body:r}});this.postToViewModel(e);break}}}handleErrorFromWebView(e){if(void 0===this.topic)return;const{errorMessage:t}=e,{code:r}=e,{url:i}=e,a=JSON.stringify({webViewError:{message:t,code:r,url:i}});this.postToViewModel(a)}handlePageFinishFromWebView(e){if(void 0===this.topic)return;const t=JSON.stringify({webViewLoadFinished:{url:e}});this.postToViewModel(t)}handlePageStartedFromWebView(e){if(void 0===this.topic)return;const t=JSON.stringify({webViewLoadStarted:{url:e}});this.postToViewModel(t)}onWebViewHistoryChanged(e){const t=JSON.stringify({navigationViewChange:{enableBack:e.canNavigateBack,enableForward:e.canNavigateForward,title:e.currentHost}});this.postToViewModel(t)}javaScriptAlertAttempt(e){return!0}permissionRequest(e){const t=JSON.stringify({permissionRequest:{permissions:e.permissions,permissionId:e.permissionId}});this.postToViewModel(t)}permissionResponse(e){this.webViewModel.permissionResponse(e)}nativeBrowserPresented(){this.clearBrowserRequest()}windowOpenAttemptWithData(e){this.windowOpenAttempt(e.url)}windowOpenAttempt(e){if(this.willStartStorePresentation(e))return;const t=this.navigationDecisionBasedOnProtocol(e);t.decision!==HYPR_NAVIGATION_DECISION.OPEN_OUTSIDE_APPLICATION?this.showBrowser(t.url):this.openOutsideApplication(t.url)}navigationDecisionBasedOnProtocol(e){return HYPR_WEB_VIEW_PROTOCOLS.indexOf(e.split(":").shift())>=0?new NavigationDecision(HYPR_NAVIGATION_DECISION.NAVIGATION_ALLOWED,e):new NavigationDecision(HYPR_NAVIGATION_DECISION.OPEN_OUTSIDE_APPLICATION,e)}showAppStore(e,t){if(e===HANDLE_OUTSIDE_APP)return void this.openOutsideApplication(JSON.parse(t).url);const r=JSON.stringify({showAppStore:{presentationMode:e,appStoreParameters:t}});this.postToViewModel(r)}showBrowser(e){void 0===this.browserRequest?(this.browserRequest=this.generateWindowOpenRequest(e),this.postToViewModel(this.browserRequest.toEventMessage())):console.error(`window.open attempt already in process for ${this.browserRequest.url}`)}generateWindowOpenRequest(e){return new WindowOpenRequest(e,this.placement,this.instanceId)}clearBrowserRequest(){this.browserRequest=void 0}onModalClosed(){this.clearBrowserRequest()}urlNavigationAttempt(e){if(console.debug(`Navigation Attempt check for ${e.split("?").shift()}`),this.willStartStorePresentation(e))return new NavigationDecision(HYPR_NAVIGATION_DECISION.NAVIGATION_BLOCKED,e);const t=this.navigationDecisionBasedOnProtocol(e);return t.decision===HYPR_NAVIGATION_DECISION.OPEN_OUTSIDE_APPLICATION?(this.openOutsideApplication(t.url),new NavigationDecision(HYPR_NAVIGATION_DECISION.NAVIGATION_BLOCKED,e)):t}willStartStorePresentation(e,t){if(this.storePresentationController.isPlayStoreUrl(e))return this.openOutsideApplication(e),this.resolvedStoreUrl=e,!0;const r=this.storePresentationController.parseUrlForAppleOverlayParams(e);return"object"==typeof r&&(this.launchStore(r,t),this.resolvedStoreUrl=e,!0)}launchStore(e,t){this.storePresentationController.presentStore(e,this.placement,this,t)}openOutsideApplication(e){const t=JSON.stringify({openOutsideApplication:{url:e}});this.postToViewModel(t)}storeRecoveryParams(e){}playVideo(e){console.error("SDK does not support mraid.playVideo()")}createCalendarEvent(e){const t=JSON.stringify({createCalendarEvent:{data:e}});this.postToViewModel(t)}storePicture(e){const t=JSON.stringify({storePicture:{url:e}});this.postToViewModel(t)}captureImage(){const e=JSON.stringify({captureImage:{}});return this.postToViewModel(e),!0}imageCaptured(e){this.webViewModel.imageCaptured(e.url)}generateTimeOnSiteTracking(){}onDisplayError(e){const t=JSON.stringify({onDisplayError:{errorMessage:e}});this.postToViewModel(t)}requiredPageReadyTime(){return 0}onPageReadyExpired(){}onPageReadyFinished(){}onClose(){}}class CatalogFrame{constructor(e,t,r=globalThis.HYPRNetworkController){this.params=e,this.presentationListener=t,this.networkRequestController=r,this.request=void 0,this.thankYouURL=void 0,this.trampoline=void 0}startCatalogFrameRequest(e){const t=new ConnectionConfiguration(!0,DEFAULT_READ_TIMEOUT,DEFAULT_CONNECTION_TIMEOUT,{"Content-Type":JSON_UTF8_CONTENT_TYPE,Accept:JSON_CONTENT_TYPE});this.request=this.networkRequestController.request(e,this.params,CONNECTION_TYPE.POST,t,((e,t,r)=>{this.responseCallback(e,t,r)}))}abortInProgressRequest(){this.presentationListener=void 0,void 0!==this.request&&(this.networkRequestController.abortRequest(this.request),this.request=void 0)}responseCallback(e,t,r){if(void 0!==r||!NetworkRequestController.validResponseStatus(e))return console.error(`catalogFrame error received: ${r}`),void(void 0!==this.presentationListener&&this.presentationListener.catalogFrameError(`CatalogFrame error: ${r}, status Code: ${e}`));const i=parseJSON(t);CatalogFrame.validateTrampoline(i)?(this.trampoline=i,void 0!==this.presentationListener&&this.presentationListener.catalogFrameSuccess()):void 0!==this.presentationListener&&this.presentationListener.catalogFrameError("Trampoline failed validation")}static validateTrampoline(e){return"object"==typeof e&&(0!==Object.keys(e).length&&(void 0!==e.token&&(void 0!==e.reward_token&&void 0!==e.viewing_id)))}webtrafficSdkConfiguration(){return void 0===this.trampoline||Object.keys(this.trampoline).length<1?{}:{completion_url:this.completionUrl(),maximum_page_load_wait_time_in_seconds:this.trampoline.maximum_page_load_wait_time_in_seconds,viewing_id:this.trampoline.viewing_id,minimum_visit_time_in_seconds:this.trampoline.visit_length,urls:this.webTrafficPagesArray()}}completionUrl(){return void 0!==this.trampoline.redirection_url?`${this.trampoline.redirection_url}&do_completion=1&phase=thank_you&recovery=1`:""}webTrafficPagesArray(){const e="object"==typeof this.trampoline.page_load_js?this.trampoline.page_load_js:{},t=e.map,r=e.js,i=[];for(const e in this.trampoline.urls)if(this.trampoline.urls.hasOwnProperty(e)){const a=this.trampoline.urls[e];let s;void 0!==t&&void 0!==r&&(s=r[t[e]]),void 0===s&&(s="");const o={url:a,on_page_load_js:[s]};i.push(o)}return i}impressionURLs(){const e=[];if(this.trampoline.tracking_impression_html.length>0){const t=this.trampoline.tracking_impression_html.replace(/"/g,"'").split("'");for(const r of t)JSONValidator.urlValidation(r,["http","https"])&&e.push(r)}return e}}const HYPR_DEFAULT_PAGE_READY_TIME=8;class PresentationSession extends BaseAdViewModel{constructor(e,t,r,i={},a=globalThis.HYPRPlacementController,s=globalThis.HYPREventController,o,n=HYPREventBus,l=HYPRRequestParamListener){const d=a.getPlacement(e);if(super(d,t,o,n,l),void 0!==d&&(this.sessionPlacement=PlacementFactory.deepCopy(d)),void 0!==i.userId?this.userID=i.userId:this.userID="",this.topic=globalThis.EVENT_TOPIC.FULLSCREEN_AD_PRESENTER,this.placementController=a,this.eventController=s,this.presentationListener=r,this.catalogFrame=void 0,this.catalogFrameResult=void 0,this.impressionFired=!1,this.catalogFrameUrl=void 0,this.catalogFrameAdditionalParams=void 0,void 0!==this.sessionPlacement){this.clickMode=this.sessionPlacement.getClickMode();const e=this.sessionPlacement.ad||{};this.pageReadyTime=e.offer_initiation_timeout_in_seconds||HYPR_DEFAULT_PAGE_READY_TIME}else this.clickMode="webview",this.pageReadyTime=HYPR_DEFAULT_PAGE_READY_TIME}beginFullScreenPresentation(){void 0!==this.sessionPlacement.ad&&(this.catalogFrameUrl=this.sessionPlacement.ad.catalog_frame_url),this.sessionPlacement.isFullscreenAdType()?(this.impressionFired||!this.sessionPlacement.hasRequiredInformation()&&!this.sessionPlacement.hasAd()||(this.eventController.sendAdImpressionTrackingEvent(this.sessionPlacement),this.impressionFired=!0),this.sessionPlacement.hasRequiredInformation()?this.presentRequiredInfoForPlacement(this.sessionPlacement):this.sessionPlacement.hasAd()?this.presentAdForPlacement(this.sessionPlacement):this.presentNoAdForPlacement(this.sessionPlacement)):this.listener.adFailedToDisplay(this.sessionPlacement.name,"Placement not a fullscreen Ad.")}reloadPlacement(e){this.sessionPlacement.loadAd(e,((e,t)=>{void 0!==t&&console.debug(`Error received on loading Ad: ${t}`),this.listener.beginPresentation(this)}))}isSession(e){return this.placement.name===e}getAdRewardText(){return this.isValid()?this.sessionPlacement.getAdRewardText():""}getAdRewardQuantity(){return this.isValid()?this.sessionPlacement.getAdRewardQuantity():0}presentNoAdForPlacement(e){console.debug(`PresentationController.beginPresentation(${e.name}) has no ad to show`),this.eventController.sendNoAdTracking(e),this.presentationListener.showNoAd(e.getUIComponentsString()),this.clearAdStateOnPlacementForCurrentAd()}presentRequiredInfoForPlacement(e){console.debug(`PresentationController.beginPresentation(${e.name}) showing ReqInfo`),this.eventController.sendUserInfoTrackingEvent(e,e.getRequiredInfoString()),this.presentationListener.showRequiredInfo(e.getRequiredInfoString(),e.getUIComponentsString())}presentAdForPlacement(e){console.debug(`PresentationController.presentAdForPlacement(${e.name}) to show ${e.getAdType()} offer`);const t=this.catalogFrameParamsForPlacement(e);if(e.getAdType()===VAST_VIDEO_OFFER)this.presentationListener.showVastOffer(e.getAdString(),e.name,e.id,t,this.openMeasurementCustomData()),this.startCatalogFrame(t);else if(e.getAdType()===MRAID_OFFER)this.presentationListener.showMraidOffer(e.getAdString(),e.getUIComponentsString(),e.name,e.id,t);else if(e.getAdType()===WEB_TRAFFIC_OFFER)this.presentationListener.showWebtrafficOffer(e.getAdString(),e.getUIComponentsString(),e.name,e.id,t),!0===e.ad.skip_proscenium&&this.startCatalogFrame(t);else{if(!e.hasAd())return console.debug(`PresentationController.presentAdForPlacementWithCatalogFrameParams(${e.name}) has no ad to show`),void this.presentNoAdForPlacement(e);this.presentationListener.showWebOffer(e.getAdString(),e.getUIComponentsString(),e.name,e.id,t)}this.clearAdStateOnPlacementForCurrentAd()}catalogFrameParamsForPlacement(e){return catalogFrameParametersForPlacement(e,JSON.parse(HYPRRequestParamListener.getCatalogFrameParams(e.name)))}clearAdStateOnPlacementForCurrentAd(){try{this.placementController.getPlacement(this.placement.name).clearAdAndStopAdAvailableTimer()}catch(e){console.debug(`PresentationController.clearAdStateOnPlacementForCurrentAd caught error ${e.message}`)}}startCatalogFrame(e){this.catalogFrame=new CatalogFrame(e,this),this.catalogFrame.startCatalogFrameRequest(this.catalogFrameUrl)}closeCatalogFrame(){void 0!==this.catalogFrame&&(this.catalogFrame.abortInProgressRequest(),this.catalogFrame=void 0)}updateCatalogFrameUrlFromCachedQuery(){return void 0===this.catalogFrameAdditionalParams||(this.catalogFrameUrl=`${this.catalogFrameUrl.split("?")[0]}?${this.catalogFrameAdditionalParams}`,this.catalogFrameAdditionalParams=void 0),this.catalogFrameUrl}urlNavigationAttempt(e){if(e.startsWith(this.catalogFrameUrl)&&void 0!==this.catalogFrameAdditionalParams){console.debug(`CatalogFrame Reload for placement: ${this.placement.name} params: ${this.catalogFrameAdditionalParams}`);const t={url:this.updateCatalogFrameUrlFromCachedQuery(),params:JSON.stringify(this.catalogFrameParamsForPlacement(this.placement))},r=JSON.stringify({catalogFrameReload:t});return this.postToViewModel(r),new NavigationDecision(HYPR_NAVIGATION_DECISION.NAVIGATION_BLOCKED,e)}return super.urlNavigationAttempt(e)}windowOpenAttempt(e){if(this.sessionPlacement.getAdType()===WEB_TRAFFIC_OFFER){if(this.getBasePresentationStatus()===HYPR_AD_STATE_PROSCENIUM&&this.sessionPlacement.isNavigationRuleMatch(e))return void this.webViewModel.notifyWindowOpenURLBlock(e)}super.windowOpenAttempt(e)}openMeasurementCustomData(){const e={};return e.userId=this.userID,e.placementId=this.placement.id,JSON.stringify(e)}clearPlacementRequiredInfo(){this.sessionPlacement.clearRequiredInfo()}shouldBootstrapMraid(){return this.sessionPlacement.getAdType()===MRAID_OFFER}shouldScrollBounce(){return this.sessionPlacement.getAdType()!==MRAID_OFFER}webViewBackground(){return this.sessionPlacement.getAdType()===WEB_TRAFFIC_OFFER?"ffffff":"000000"}playbackRequiresUserAction(){return void 0===this.sessionPlacement.ad?super.playbackRequiresUserAction():this.sessionPlacement.ad.video_requires_user_action||super.playbackRequiresUserAction()}catalogFrameError(e){console.debug(`[CatalogFrame] received CatalogFrameError: ${e}`),this.presentationListener.onTrampolineError(e)}storeRecoveryParams(e){this.catalogFrameAdditionalParams=e,this.postToViewModel(JSON.stringify({setRecoveryParams:{params:e}}))}catalogFrameSuccess(){void 0!==this.webViewModel&&(console.debug("[CatalogFrame] Stopping Page Ready Timer on catalogFrame response"),this.webViewModel.pageReadyFinished()),this.pageReadyTime=0;const e=this.sessionPlacement.getAdType()===WEB_TRAFFIC_OFFER?this.catalogFrame.webtrafficSdkConfiguration():{};this.catalogFrameResult=[JSON.stringify(this.catalogFrame.trampoline),this.catalogFrame.completionUrl(),JSON.stringify(e),JSON.stringify(this.catalogFrame.impressionURLs())],console.debug("[CatalogFrame] Attempting Catalog Frame response from catalogFrameSuccess callback"),this.attemptCatalogFrameResponseDispatch()}attemptCatalogFrameResponseDispatch(){void 0!==this.catalogFrameResult&&!0===this.hasBecomeVisible?(console.debug("[CatalogFrame] Firing Catalog Frame response to Presentation Controller"),this.presentationListener.onTrampolineReceived.apply(this.presentationListener,this.catalogFrameResult),this.catalogFrameResult=void 0):console.debug("[CatalogFrame] CatalogFrame response not applied")}generateWindowOpenRequest(e){return new WindowOpenRequest(e,this.sessionPlacement,this.instanceId)}requiredPageReadyTime(){const e=this.pageReadyTime;return this.pageReadyTime=0,e}onPageReadyExpired(){this.setClosable(!0,!0)}onClose(){this.webViewModel.adWillClose()}containerVisibleChange(e){super.containerVisibleChange(e),this.catalogFrame&&(console.debug("[CatalogFrame] Attempting Catalog Frame response from containerVisibleChange event"),this.attemptCatalogFrameResponseDispatch())}onWebViewTermination(){return void 0!==this.sessionPlacement&&void 0!==this.sessionPlacement.ad&&void 0!==this.sessionPlacement.ad.enable_webview_reload?this.sessionPlacement.ad.enable_webview_reload:this.sessionPlacement.getAdType()!==WEB_TRAFFIC_OFFER&&super.onWebViewTermination()}launchStore(e,t){this.storePresentationController.presentStore(e,this.sessionPlacement,this,t)}}const MRAID_PLACEMENT_TYPE={INLINE:"inline",INTERSTITIAL:"interstitial"};class MraidContainerEvent{constructor(e,t,r,i,a=HYPREventBus){this.placementName=t,this.topic=r,this.data=e,this.instanceId=i,this.eventBus=a,this.willFireReady=!1,this.scripts=[]}generateEvent(e){return this.scripts.push(this[e](this.data)),this}generateBootstrapScripts(){return this.scripts.push(this.setPlacementType(this.data)),this.scripts.push(PUSH_MRAID_TO_IFRAME_SCRIPT),this.scripts.push(this.fireStateChangeEvent("loading")),this.scripts.push(this.setSupports()),this.scripts.push(this.setMaxSize()),this.scripts.push(this.setScreenSize()),this.scripts.push(this.setDefaultPosition(this.data)),this.scripts.push(this.setCurrentPosition(this.data)),this.scripts.push(this.fireStateChangeEvent("default")),void 0!==this.data.containerWidth&&void 0!==this.data.containerHeight&&this.scripts.push(this.fireSizeChangeEvent(this.data)),!0===this.data.viewable&&this.scripts.push(this.fireReadyEvent()),this.scripts.push(this.fireViewableChangeEvent(this.data)),console.log(JSON.stringify(this.scripts)),this}fire(){const e=JSON.stringify({scriptExecution:{batch:this.scripts}});return this.eventBus.postUpdate(this.topic,this.placementName,this.instanceId,e),this.willFireReady}setPlacementType(e){return"string"==typeof e.type?this.mraidEventScript("setPlacementType",`'${e.type}'`):""}fireSizeChangeEvent(e){if(void 0!==e.containerWidth&&void 0!==e.containerHeight){const t=JSON.stringify({width:e.containerWidth,height:e.containerHeight});return this.mraidEventScript("fireSizeChangeEvent",t)}return""}setCurrentPosition(e){if(void 0!==e.containerWidth&&void 0!==e.containerHeight){const t=JSON.stringify({x:0,y:0,width:e.containerWidth,height:e.containerHeight});return this.mraidEventScript("setCurrentPosition",t)}return""}setDefaultPosition(e){if(void 0!==e.containerWidth&&void 0!==e.containerHeight){const t=JSON.stringify({x:0,y:0,width:e.containerWidth,height:e.containerHeight});return this.mraidEventScript("setDefaultPosition",t)}return""}fireStateChangeEvent(e){return void 0!==e?this.mraidEventScript("fireStateChangeEvent",`'${e}'`):""}fireViewableChangeEvent(e){return void 0!==e&&void 0!==e.viewable?this.mraidEventScript("fireViewableChangeEvent",`${e.viewable}`):""}setMaxSize(){let e;if(e="object"==typeof this.data&&this.data.type===MRAID_PLACEMENT_TYPE.INLINE?{width:this.data.containerWidth,height:this.data.containerHeight}:JSON.parse(HYPRRequestParamListener.getMaxFrameSize()||"{}"),void 0!==e.width&&void 0!==e.height){const t=JSON.stringify({width:e.width,height:e.height});return this.mraidEventScript("setMaxSize",t)}return""}setScreenSize(){const e=JSON.parse(HYPRRequestParamListener.getScreenSize()||"{}");if(void 0===e||void 0!==e.width&&void 0!==e.height){const t=JSON.stringify({width:e.width,height:e.height});return this.mraidEventScript("setScreenSize",t)}return""}setSupports(){const e=HYPRRequestParamListener.getMraidSupportsString();return void 0!==e?this.mraidEventScript("setSupports",e):""}fireReadyEvent(){return this.willFireReady=!0,this.mraidEventScript("fireReadyEvent","{}")}mraidEventScript(e,t){if(void 0!==e)return`window.dispatchEvent(new CustomEvent("${e}", {detail: ${t}}));`}static getMraidJSTag(){return`<script language="javascript" type="text/javascript">\n${MRAID_JS_SCRIPT}\n<\/script>\n`}}const MRAID_JS_SCRIPT='"undefined"==typeof mraid&&function(){var e=window.mraid={VERSION:"2.0",STATES:{LOADING:"loading",DEFAULT:"default",EXPANDED:"expanded",RESIZED:"resized",HIDDEN:"hidden"},EVENTS:{READY:"ready",ERROR:"error",STATECHANGE:"stateChange",VIEWABLECHANGE:"viewableChange",SIZECHANGE:"sizeChange"}},n={sms:!1,tel:!1,calendar:!1,storePicture:!1,inlineVideo:!1},t=e.STATES.LOADING,i=!1,o="",r={x:0,y:0,width:0,height:0},E={x:0,y:0,width:0,height:0},a={width:0,height:0},s={width:0,height:0},d={width:0,height:0,useCustomClose:!1,isModal:!0},u={allowOrientationChange:!0,forceOrientation:"none"},f={};e.getVersion=function(){return e.VERSION},e.getState=function(){return t},e.getPlacementType=function(){return o},e.getDefaultPosition=function(){return E},e.getCurrentPosition=function(){return r},e.getScreenSize=function(){return a},e.getMaxSize=function(){return s},e.getExpandProperties=function(){return d},e.setExpandProperties=function(e){void 0!==e&&void 0!==e.useCustomClose&&(d.useCustomClose=e.useCustomClose)},e.getResizeProperties=function(){c("getResizeProperties unsupported","getResizeProperties")},e.setResizeProperties=function(e){c("setResizeProperties unsupported","setResizeProperties")},e.getOrientationProperties=function(){return u},e.setOrientationProperties=function(e){void 0!==e&&(void 0!==e.allowOrientationChange&&(u.allowOrientationChange=e.allowOrientationChange),void 0!==e.forceOrientation&&(u.forceOrientation=e.forceOrientation),l("setOrientationProperties",u))},e.isViewable=function(){return i},e.addEventListener=function(n,t){if((n===e.EVENTS.READY||n===e.EVENTS.ERROR||n===e.EVENTS.STATECHANGE||n===e.EVENTS.VIEWABLECHANGE||n===e.EVENTS.SIZECHANGE)&&"function"==typeof t){f[n]=f[n]||[];for(var i=f[n],o=0;o<i.length;o++)if(i[o]===t)return;f[n].push(t)}},e.removeEventListener=function(n,t){if(n===e.EVENTS.READY||n===e.EVENTS.ERROR||n===e.EVENTS.STATECHANGE||n===e.EVENTS.VIEWABLECHANGE||n===e.EVENTS.SIZECHANGE)if(f[n]=f[n]||[],t){for(var i=f[n],o=-1,r=0;r<i.length;r++)if(i[r]===t){o=r;break}i.splice(o,1),o>=0&&(f[n]=i)}else f[n]=[]},e.open=function(e){l("open",e)},e.expand=function(e){c("expand unsupported","expand")},e.resize=function(){c("resize unsupported","resize")},e.close=function(){t===e.STATES.HIDDEN?c("Ad state is already hidden so cannot close.","close"):l("close")},e.supports=function(e){return n[e]},e.useCustomClose=function(e){d.useCustomClose=e,l("useCustomClose",e)},e.createCalendarEvent=function(e){l("createCalendarEvent",JSON.stringify(e))},e.storePicture=function(e){l("storePicture",e)},e.playVideo=function(e){c("playVideo unsupported","playVideo")};var c=function(n,t){f[e.EVENTS.ERROR]=f[e.EVENTS.ERROR]||[];var i=f[e.EVENTS.ERROR];console.log("fireErrorEvent: "+n);for(var o=0;o<i.length;o++)i[o].apply(void 0,[n,t])},l=function(e,n){if("object"==typeof window.mraidJSInterface)S(e,n);else{if("object"!=typeof window.webkit||"object"!=typeof window.webkit.messageHandlers)return console.error("SDK Interface not found"),null;p(e,n)}},S=function(e,n){try{"setOrientationProperties"===e?window.mraidJSInterface[e](n.allowOrientationChange,n.forceOrientation):void 0!==n?window.mraidJSInterface[e](n):window.mraidJSInterface[e]()}catch(n){console.error("error when invoking Android mraidJSInterface."+e,n)}},p=function(e,n){try{"setOrientationProperties"===e?window.webkit.messageHandlers[e].postMessage(JSON.stringify(n)):window.webkit.messageHandlers[e].postMessage(n)}catch(n){console.error("error when invoking iosJSInterface."+e,n)}};window.addEventListener("setPlacementType",(function(e){o=e.detail})),window.addEventListener("setScreenSize",(function(e){a=e.detail})),window.addEventListener("setMaxSize",(function(e){s=e.detail})),window.addEventListener("setCurrentPosition",(function(e){r=e.detail})),window.addEventListener("setDefaultPosition",(function(e){E=e.detail})),window.addEventListener("setSupports",(function(e){n=e.detail})),window.addEventListener("fireStateChangeEvent",(function(n){!function(n){console.log("fireStateChangeEvent - "+n),t=n,f[e.EVENTS.STATECHANGE]=f[e.EVENTS.STATECHANGE]||[];for(var i=f[e.EVENTS.STATECHANGE],o=0;o<i.length;o++)i[o].apply(void 0,[n])}(n.detail)})),window.addEventListener("fireReadyEvent",(function(n){!function(){f[e.EVENTS.READY]=f[e.EVENTS.READY]||[];var n=f[e.EVENTS.READY];console.log("fireReadyEvent: "+n);for(var t=0;t<n.length;t++)n[t].apply(void 0)}()})),window.addEventListener("fireViewableChangeEvent",(function(n){!function(n){console.log("fireViewableChangeEvent - "+n),i=n,f[e.EVENTS.VIEWABLECHANGE]=f[e.EVENTS.VIEWABLECHANGE]||[];for(var t=f[e.EVENTS.VIEWABLECHANGE],o=0;o<t.length;o++)t[o].apply(void 0,[n])}(n.detail)})),window.addEventListener("fireSizeChangeEvent",(function(n){!function(n,t){f[e.EVENTS.SIZECHANGE]=f[e.EVENTS.SIZECHANGE]||[];for(var i=f[e.EVENTS.SIZECHANGE],o=0;o<i.length;o++)i[o].apply(void 0,[n,t])}(n.detail.width,n.detail.height)}))}();',PUSH_MRAID_TO_IFRAME_SCRIPT="var hyprmx_celtra_mraid_check = function(time) {if (typeof celtra !== 'undefined') { var frames = document.querySelectorAll(\"iframe\");for (let i=0; i < frames.length; i++){ frames[i].contentWindow.mraid = window.mraid; }} else {setTimeout(function() {hyprmx_celtra_mraid_check(time+1)}, time + 500);}};hyprmx_celtra_mraid_check(500);";class MraidContainerEventFactory{static bootstrapEvent(e,t,r,i,a){return new MraidContainerEvent(e,t,r,i,a).generateBootstrapScripts().fire()}static containerEvents(e,t,r,i,a,s){const o=new MraidContainerEvent(t,r,i,a,s);for(const t of e)o.generateEvent(t);return o.fire()}}const HYPR_READY_STATE_SCRIPT='document.onreadystatechange = function () {if(typeof window.webkit === "object" && typeof window.webkit.messageHandlers === "object"){window.webkit.messageHandlers["setReadyState"].postMessage(document.readyState);}}';class WebViewConfiguration{constructor(e,t,r,i="",a="ffffff",s="ff",o=!1,n=!0){this.isWebViewScrollable=e,this.isWebViewScrollBounceEnabled=t,this.allowsPinchGesture=r,this.alpha=s,this.backgroundColor=a,this.customUserAgent=i,this.headScripts=[HYPR_READY_STATE_SCRIPT],this.allowsLinkPreview=n,this.playbackRequiresUserAction=o,this.allowsInlineMediaPlayback=!0,this.allowsAirPlayForMediaPlayback=!0,this.allowsPictureInPictureMediaPlayback=!1,this.isNavigationLimited=!1,this.javaScriptEnabled=!0,this.domStorageEnabled=!0,this.loadWithOverviewMode=!0,this.useWideViewPort=!0,this.displayZoomControls=!1,this.builtInZoomControls=!0,this.supportsMultipleWindows=!0}toEventMessage(){return JSON.stringify({updateWebViewConfig:JSON.parse(JSON.stringify(this))})}setWebViewNavigationLimited(e){if("base_ad"===e&&"object"==typeof hyprAppDomainController&&hyprAppDomainController.isAppBoundDomainEnabled()){const e=hyprAppDomainController.getAppBoundDomains();this.isNavigationLimited=e.indexOf(cdnDomain())>-1}else this.isNavigationLimited=!1}}const MRAID_STATE={notInitialized:"notInitialized",initialized:"initialized",ready:"ready"},CustomEvents={PresentationChanged:{EVENT_NAME:"hyprAdPresentationChanged",EVENT_SHARING_CLOSED:"sharing_closed",EVENT_SHARING_PRESENTED:"sharing_presented",EVENT_AD_CLOSED:"ad_closed",EVENT_APP_PAUSED:"app_paused",EVENT_APP_RESUMED:"app_resumed",EVENT_NAVIGATION_BLOCKED:"hyprWebViewNavigationBlocked"},PowerState:{EVENT_NAME:"hyprDevicePowerState",EVENT_LOW_POWER_MODE_ON:"low_power_mode_on",EVENT_LOW_POWER_MODE_OFF:"low_power_mode_off"}};class WebViewHistory{constructor(e){this.currentIndex=e.currentIndex,this.currentUrl=e.currentUrl,this.currentHost=e.currentHost,this.currentTitle=e.currentTitle,this.history=e.history,this.canNavigateForward=e.canNavigateForward,this.canNavigateBack=e.canNavigateBack}}class WebViewViewModel{constructor(e,t,r,i=globalThis.EVENT_TOPIC.WEB_VIEW_PRESENTER,a=HYPREventBus,s=globalThis.HYPRTimerController){this.placement=e,this.instanceId=t,this.baseAdListener=r,this.eventBus=a,this.topic=i,this.timerController=s,this.mraidState=MRAID_STATE.notInitialized,this.visible=!1,this.backgrounded=!1,this.currentSizeData={},this.webViewHistory=void 0;const o=this.placement.ad||{};this.webViewConfiguration=new WebViewConfiguration(this.baseAdListener.scrollingEnabled(),this.baseAdListener.shouldScrollBounce(),this.baseAdListener.isPinchEnabled(),o.user_agent||"",this.baseAdListener.webViewBackground(),this.baseAdListener.webViewAlpha(),this.baseAdListener.playbackRequiresUserAction(),this.baseAdListener.allowsWebViewLinkPreview());const n=this.baseAdListener.requiredPageReadyTime();n>0&&(console.debug(`[pageReady] initiating timer for ${this.instanceId}`),this.pageReadyTimer=this.timerController.startTimer(1e3*n,(()=>{this.pageReadyExpired()})))}destroy(){console.debug(`WebView destroy for ${this.instanceId}`),this.stopPageReadyTimer()}postToViewModel(e){this.eventBus.postUpdate(this.topic,this.placement.name,this.instanceId,e)}updateListener(e){this.baseAdListener=e}getWebViewConfigurationString(e){return"object"==typeof e&&"string"==typeof e.mode&&this.webViewConfiguration.setWebViewNavigationLimited(e.mode),this.webViewConfiguration.toEventMessage()}urlNavigationAttempt(e){const t="object"==typeof e?e.url:void 0;return"string"!=typeof t||void 0===this.placement?JSON.stringify(new NavigationDecision(HYPR_NAVIGATION_DECISION.NAVIGATION_BLOCKED,t)):(console.debug(`Navigation Attempt check for ${t.split("?").shift()}; request is main frame: ${e.isMainFrame}`),JSON.stringify(this.baseAdListener.urlNavigationAttempt(t)))}windowOpenAttempt(e){console.log("this.baseAdListener.windowOpenAttempt",this.baseAdListener);const t="object"==typeof e?e.url:void 0;"string"==typeof t&&void 0!==this.placement&&(console.debug(`Window.open attempt for ${t.split("?").shift()}`),this.baseAdListener.windowOpenAttempt(t))}shouldRedirectURL(e){const t="object"==typeof e?e.url:void 0,r="object"==typeof e?e.mimeType:void 0;return"text/html"===r?JSON.stringify(new NavigationDecision(HYPR_NAVIGATION_DECISION.NAVIGATION_ALLOWED,e.url)):"string"!=typeof t||void 0===this.placement?JSON.stringify(new NavigationDecision(HYPR_NAVIGATION_DECISION.NAVIGATION_BLOCKED,t)):"application/pdf"===r||t.endsWith(".pdf")||"application/msword"===r||t.endsWith(".doc")||"application/vnd.openxmlformats-officedocument.wordprocessingml.document"===r||t.endsWith("docx")||"application/vnd.ms-excel"===r||t.endsWith("xls")||"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===r||t.endsWith("xlsx")||"application/vnd.ms-powerpoint"===r||t.endsWith("ppt")||"application/vnd.openxmlformats-officedocument.presentationml.presentation"===r||t.endsWith(".pptx")?JSON.stringify(new NavigationDecision(HYPR_NAVIGATION_DECISION.NAVIGATION_REDIRECTED,`https://docs.google.com/viewer?url=${t}&embedded=true`)):JSON.stringify(new NavigationDecision(HYPR_NAVIGATION_DECISION.NAVIGATION_ALLOWED,e.url))}shouldReleaseMessageBridge(){return void 0!==this.placement.ad&&this.placement.ad.clear_ios_message_bridge||!1}shouldInterceptRequest(e){if("http"===e.scheme){console.debug(`Insecure data loaded:  ${e.url} Removing Javascript Interface.`);const t=JSON.stringify({removeJavascriptInterface:{}});this.postToViewModel(t)}}javaScriptAlertAttempt(e){return this.baseAdListener.javaScriptAlertAttempt(e)}getContainerData(){const e={};return e.containerWidth=this.currentSizeData.width,e.containerHeight=this.currentSizeData.height,e.viewable=this.visible,e.type=this.placement.isBannerAdType()?MRAID_PLACEMENT_TYPE.INLINE:MRAID_PLACEMENT_TYPE.INTERSTITIAL,e}onPageFinished(e){if(this.baseAdListener.handlePageFinishFromWebView(e.url),this.baseAdListener.shouldBootstrapMraid()){const e=MraidContainerEventFactory.bootstrapEvent(this.getContainerData(),this.placement.name,this.topic,this.instanceId,this.eventBus);this.mraidState=e?MRAID_STATE.ready:MRAID_STATE.initialized}console.debug(`onPageFinished() MRAID State is: ${this.mraidState}`)}onJSMessage(e){const{name:t}=e;"pageReady"===t&&this.pageReadyFinished(),this.baseAdListener.handleJSMessageFromWebView(e)}onLoadData(){this.baseAdListener.onWebViewLoadData()}onPageStarted(e){this.postToViewModel(this.webViewConfiguration.toEventMessage()),this.baseAdListener.handlePageStartedFromWebView(e.url),this.mraidState=MRAID_STATE.notInitialized}onReceivedError(e){this.baseAdListener.handleErrorFromWebView(e)}onWebViewCrash(){this.baseAdListener.onDisplayError("Ad failed to Render")}webViewSizeChange(e){this.currentSizeData=e,MraidContainerEventFactory.containerEvents(["setMaxSize","setDefaultPosition","setCurrentPosition","fireSizeChangeEvent"],this.getContainerData(),this.placement.name,this.topic,this.instanceId,this.eventBus)}parentContainerSizeChange(e){this.currentSizeData=e,MraidContainerEventFactory.containerEvents(["setScreenSize","fireSizeChangeEvent"],this.getContainerData(),this.placement.name,this.topic,this.instanceId,this.eventBus),console.debug(`parentContainerSizeChange() MRAID State is: ${this.mraidState}`)}parentVisibilityChanged(e){if(this.visible!==e){this.visible=e;const t=["fireViewableChangeEvent"];this.mraidState===MRAID_STATE.initialized&&!0===this.visible&&t.push("fireReadyEvent");MraidContainerEventFactory.containerEvents(t,this.getContainerData(),this.placement.name,this.topic,this.instanceId,this.eventBus)&&(this.mraidState=MRAID_STATE.ready);const r=this.visible?CustomEvents.PresentationChanged.EVENT_SHARING_CLOSED:CustomEvents.PresentationChanged.EVENT_SHARING_PRESENTED;this.publishCustomEvent(CustomEvents.PresentationChanged.EVENT_NAME,r),console.debug(`parentVisibilityChanged() MRAID State is: ${this.mraidState}`)}}parentLifecycleChanged(e){this.backgrounded=e;const t=this.backgrounded?CustomEvents.PresentationChanged.EVENT_APP_PAUSED:CustomEvents.PresentationChanged.EVENT_APP_RESUMED;this.publishCustomEvent(CustomEvents.PresentationChanged.EVENT_NAME,t),this.publishJSExecutionState(e)}pageReadyExpired(){console.debug(`[pageReady] timer expired for ${this.instanceId}`),this.pageReadyTimer=void 0,this.baseAdListener.onPageReadyExpired()}pageReadyFinished(){this.stopPageReadyTimer(),console.debug(`[pageReady] completed successfully for ${this.instanceId}`),this.baseAdListener.onPageReadyFinished()}stopPageReadyTimer(){this.pageReadyTimerIsActive()&&(console.debug(`[pageReady] stopping timer for ${this.instanceId}`),this.timerController.stopTimer(this.pageReadyTimer),this.pageReadyTimer=void 0)}pageReadyTimerIsActive(){return void 0!==this.pageReadyTimer}adWillClose(){this.publishCustomEvent(CustomEvents.PresentationChanged.EVENT_NAME,CustomEvents.PresentationChanged.EVENT_AD_CLOSED)}setCurrentUrl(e,t){console.debug(`Setting current url to: ${e}`);const r=JSON.stringify({loadUrl:{url:e,userAgent:t}});this.postToViewModel(r)}setCurrentData(e){console.debug(`Setting current data to: ${e}`);const t=JSON.stringify({loadData:{data:e,url:this.bannerBaseURL(),mimeType:HYPR_BANNER_MIME_TYPE,encoding:HYPR_BANNER_ENCODING}});this.postToViewModel(t)}bannerBaseURL(){return void 0!==globalThis.serverHostname?`https://${globalThis.serverHostname}/banner_ad`:HYPR_BANNER_URL}permissionRequest(e){console.debug(`Permission Request for ${JSON.stringify(e)}`),1===e.permissions.length&&"android.webkit.resource.VIDEO_CAPTURE"===e.permissions[0]?(e.permissions[0]="android.permission.CAMERA",this.baseAdListener.permissionRequest(e)):(console.error(`Unsupported permission request: ${JSON.stringify(e)}`),this.permissionResponse({permissionId:e.permissionId,granted:!1}))}openFileChooser(e){return e.acceptTypes.indexOf("image/*")<0?(console.error(`Unsupported acceptTypes ${JSON.stringify(e.acceptTypes)}`),!1):this.baseAdListener.captureImage()}imageCaptured(e){const t=JSON.stringify({imageCaptured:{url:e}});this.postToViewModel(t)}permissionResponse(e){console.debug(`permissionResponse: ${JSON.stringify(e)}`);const t=JSON.stringify({permissionResponse:{permissionId:e.permissionId,granted:e.granted}});this.postToViewModel(t)}onHistoryChanged(e){console.log(JSON.stringify(e)),this.webViewHistory=new WebViewHistory(e),this.baseAdListener.onWebViewHistoryChanged(this.webViewHistory)}navigateBack(){const e=JSON.stringify({navigateBack:{}});this.postToViewModel(e)}navigateForward(){const e=JSON.stringify({navigateForward:{}});this.postToViewModel(e)}notifyWindowOpenURLBlock(e){this.publishCustomEvent(CustomEvents.PresentationChanged.EVENT_NAVIGATION_BLOCKED,e)}publishASyncScriptEvent(e){const t=JSON.stringify({scriptExecution:{batch:[e]}});this.postToViewModel(t)}publishJSExecutionState(e){const t=`{"${e?"pauseJSExecution":"resumeJSExecution"}":{}}`;this.postToViewModel(t)}publishCustomEvent(e,t){const r=`window.dispatchEvent(new CustomEvent('${e}', { detail: '${t}'}));`;this.publishASyncScriptEvent(r)}}const HYPR_AD_INFO_PATTERN="hyprmx.com/adinfo.html";class HyprMXBrowserViewModel extends BaseAdViewModel{constructor(e,t,r,i=HYPRPresentationController,a="",s,o=HYPREventBus,n=HYPRRequestParamListener){super(e,i,a,o,n),this.baseViewModel=r,this.topic=globalThis.EVENT_TOPIC.HYPRMX_BROWSER_PRESENTER,this.url=t;const l=e.ad||{};this.onPageJS=l.onPageJS||"",this.clickMode=e.getClickMode(),this.timeOnSiteTracker=void 0,this.isPresenting=!1,"store"!==this.clickMode&&(this.timeOnSiteTracker=s)}onBrowserReady(){console.debug("onBrowserReady"),this.webViewModel.pageReadyFinished(),this.webViewModel.setCurrentUrl(this.url,this.customUserAgent()),void 0!==this.timeOnSiteTracker&&this.timeOnSiteTracker.onForegrounded(),("webview"===this.clickMode||this.url.includes(this.adInfoPattern()))&&this.presentBrowserView(),this.baseViewModel.clearBrowserRequest()}adInfoPattern(){return"undefined"!=typeof HYPRInitializationController&&HYPRInitializationController.getConfiguration().ad_info_url||HYPR_AD_INFO_PATTERN}onNavigateBackPressed(){this.webViewModel.navigateBack()}onNavigateForwardPressed(){this.webViewModel.navigateForward()}onSharePressed(){const e=this.webViewModel.webViewHistory.currentUrl,t=JSON.stringify({openShareSheet:{data:e}});this.postToViewModel(t)}onClose(){void 0!==this.timeOnSiteTracker&&this.timeOnSiteTracker.onBrowserClosed(),this.baseViewModel.clearBrowserRequest(),this.baseViewModel.onModalClosed()}onBackPressed(){this.webViewModel.webViewHistory.canNavigateBack?this.webViewModel.navigateBack():this.triggerClose()}hasOnPageJS(){return this.onPageJS.length>0}showBrowser(e){this.webViewModel.setCurrentUrl(e,this.customUserAgent())}openOutsideApplication(e){const t={url:e},r=JSON.stringify({presentationStateChange:{from:globalThis.PRESENTATION_STATES.BROWSER,to:globalThis.PRESENTATION_STATES.OUTSIDE_APP,data:t}});this.postToViewModel(r)}showAppStore(e,t){const r={};let i;e===HANDLE_OUTSIDE_APP?(i=globalThis.PRESENTATION_STATES.OUTSIDE_APP,r.url=JSON.parse(t).url):(i=globalThis.PRESENTATION_STATES.APP_STORE,r.presentationMode=e,r.appStoreParameters=t);const a=JSON.stringify({presentationStateChange:{from:globalThis.PRESENTATION_STATES.BROWSER,to:i,data:r}});this.postToViewModel(a)}triggerClose(){const e=JSON.stringify({closeBrowser:{}});this.postToViewModel(e)}handlePageStartedFromWebView(e){this.hasOnPageJS()&&(console.debug(`Firing onPageJS on ClickThrough: ${this.url}, for Placement: ${this.placement}`),this.webViewModel.publishASyncScriptEvent(this.onPageJS));const t=JSON.stringify({webViewLoadStarted:{url:e}});this.postToViewModel(t)}handlePageFinishFromWebView(e){console.debug(`RESOLVED URL: ${this.resolvedStoreUrl}`),super.handlePageFinishFromWebView(e),!this.visible&&void 0===this.resolvedStoreUrl&&APPSTORE_URL_FALLBACK_PRESENT_BROWSER&&this.presentBrowserView()}onForegroundTransition(){super.onForegroundTransition(),void 0!==this.timeOnSiteTracker&&this.timeOnSiteTracker.onForegrounded()}onBackgroundTransition(){super.onBackgroundTransition(),void 0!==this.timeOnSiteTracker&&this.timeOnSiteTracker.onBackgrounded()}customUserAgent(){if("store"===this.clickMode){return`HyprMX/${globalThis.HYPRRequestParameterManager.cache.sdk_version||0}`}}presentBrowserView(){if(!0===this.isPresenting)return void console.debug("The HyprMX Browser is already presenting");this.isPresenting=!0;const e=JSON.stringify({presentBrowserView:{}});this.postToViewModel(e)}}class PreloadedAdViewModel extends BaseAdViewModel{constructor(e,t,r="",i=HYPREventBus,a=HYPRRequestParamListener){super(e,t,r,i,a)}shouldBootstrapMraid(){return!0}windowOpenAttempt(e){console.debug(`windowOpenAttempt received in ${this.constructor.name}`)}urlNavigationAttempt(e){console.debug(`Navigation Attempt check for ${e.split("?").shift()}`);const t=this.navigationDecisionBasedOnProtocol(e);return t.decision===HYPR_NAVIGATION_DECISION.NAVIGATION_ALLOWED?t:new NavigationDecision(HYPR_NAVIGATION_DECISION.NAVIGATION_BLOCKED,e)}javaScriptAlertAttempt(e){return!1}permissionRequest(e){console.error(`Unsupported permission request: ${JSON.stringify(e)}`),this.permissionResponse({permissionId:e.permissionId,granted:!1})}createCalendarEvent(e){}storePicture(e){}captureImage(){return!1}shouldScrollBounce(){return!1}requiredPageReadyTime(){return void 0===this.placement.ad?HYPR_DEFAULT_PAGE_READY_TIME:void 0!==this.placement.ad.preloaded_mraid_page_ready_timeout?this.placement.ad.preloaded_mraid_page_ready_timeout:this.placement.ad.offer_initiation_timeout_in_seconds||HYPR_DEFAULT_PAGE_READY_TIME}onPageReadyExpired(){this.listener.preloadedWebViewPageReadyExpired(this.placement)}}class TimeOnSiteTracking{constructor(e,t,r,i,a,s=globalThis.HYPRNetworkController){this.trackingUrl=e,this.impId=t,this.app=r,this.user=i,this.device=a,this.networkRequestController=s,this.startTimeStamp=void 0,this.timeDuration=0}onForegrounded(){void 0===this.startTimeStamp&&(this.startTimeStamp=Date.now())}onBackgrounded(){if(void 0===this.startTimeStamp)return;const e=Date.now()-this.startTimeStamp;this.timeDuration+=e,this.startTimeStamp=void 0}onBrowserClosed(){this.onBackgrounded(),this.onWebViewCloseTimeOnSiteTracking(this.timeDuration)}onWebViewCloseTimeOnSiteTracking(e){const t=this.trackingUrl;if(console.debug(`onWebViewCloseTimeOnSiteTracking with time ${e}`),isValidUrl(t)){const t={time_on_site:e,impid:this.impId,app:this.app,device:this.device,user:this.user},r=JSON.stringify(JSONValidator.compact(t));this.networkRequestController.request(this.trackingUrl,r,CONNECTION_TYPE.POST,DEFAULT_JSON_CONNECTION_CONFIGURATION)}else console.error("Invalid BrowserTrackingDurationUrl")}}const CLOSING_HEAD_TAG="</head>";class BannerViewModel extends BaseAdViewModel{constructor(e,t,r,i=HYPREventBus,a=HYPRRequestParamListener,s=globalThis.HYPRNetworkController,o=globalThis.HYPREventController){super(e,t,r,i,a,s),this.eventController=o,this.topic=globalThis.EVENT_TOPIC.BANNER_PRESENTER,this.contentImpressionId=void 0,this.bannerData=void 0}loadAd(e){const t=JSON.parse(this.paramRequestListener.getBannerParams());Object.assign(e,t),console.debug(`Loading ads with ${JSON.stringify(e)}`),this.placement.loadAd(e,((e,t)=>{if(console.debug(`Ad load complete for Banner Placement ${e}, isAdAvailable: ${this.placement.isAdAvailable()}, error: ${t}`),void 0===t&&this.placement.isAdAvailable()){const e=JSON.stringify({loadAdSuccess:{}});this.postToViewModel(e),this.bannerData=this.getMraidEnabledAdHTML(),this.isViewable()||this.webViewModel.setCurrentUrl("about:blank"),this.loadBannerContentIfReady()}else{const e=JSON.stringify({loadAdFailure:{error:"Ad failed to load."}});this.postToViewModel(e),this.webViewModel.setCurrentUrl("about:blank")}}))}getMraidEnabledAdHTML(){return this.placement.ad.ad_html.replace(CLOSING_HEAD_TAG,MraidContainerEvent.getMraidJSTag()+CLOSING_HEAD_TAG)}onParentViewChangeEvent(e){super.onParentViewChangeEvent(e),this.loadBannerContentIfReady()}containerVisibleChange(e){super.containerVisibleChange(e),this.loadBannerContentIfReady()}onWebViewLoadData(){this.contentImpressionId=this.placement.getImpressionId(),this.notifyAdLoaded(),this.fireBannerImpressionAttemptIfReady()}onModalClosed(){super.onModalClosed();const e=JSON.stringify({notifyAdClosed:{}});this.postToViewModel(e)}isViewable(){return this.hasParentView&&this.visible}loadBannerContentIfReady(){if(void 0===this.bannerData||!this.isViewable())return;console.debug("Loading Banner Content");const e=this.bannerData;this.bannerData=void 0,this.webViewModel.setCurrentData(e)}fireBannerImpressionAttemptIfReady(){const e=void 0!==this.currentSizeData?this.currentSizeData:{width:0,height:0};if(e.width<=0&&e.height<=0)return console.debug(`Container size not set for ${this.instanceId} when attempting impression`),!1;const t=this.contentImpressionId;this.contentImpressionId=void 0,console.debug(`Firing Impression attempt for placement: ${this.placement.name} with id ${this.instanceId} and impression id: ${t}`);const r=this.placement.getBannerImpressionSize();this.validateContainerSize(r,e);const i={impid:t,placement_id:this.placement.id.toString(),banner_size:r,app:this.placement.app,device:this.placement.device,user:this.placement.user};console.log("requestBody",i);const a=JSON.stringify(JSONValidator.compact(i));return this.networkRequestController.request(this.placement.getImpressionUrl(),a,CONNECTION_TYPE.POST,DEFAULT_JSON_CONNECTION_CONFIGURATION,((e,t,r)=>{this.trackingCallback("Impression",e,t,r)})),!0}validateContainerSize(e,t){const r=this.placement.ad.acceptableAdSizeVariance;(r<e.w-t.width||r<e.h-t.height)&&this.eventController.onClientErrorEvent(HyprErrorFactory.getBannerContainerSizeMismatchedError(`Mismatched banner size on impression(${this.instanceId}).  Expected container size (${e.w}x${e.h}) found (${t.width}x${t.height})`))}trackingCallback(e,t,r,i){NetworkRequestController.validResponseStatus(t)&&void 0===i?console.debug(`${e} Attempt completed for placement: ${this.placement} with body: ${r}`):console.debug(`${e} Attempt completed for placement: ${this.placement} with status code ${t} and with error: ${i}`)}notifyAdLoaded(){const e=JSON.stringify({onAdLoaded:{}});this.postToViewModel(e)}javaScriptAlertAttempt(e){return!1}permissionRequest(e){console.error(`Unsupported permission request: ${JSON.stringify(e)}`),this.permissionResponse({permissionId:e.permissionId,granted:!1})}shouldBootstrapMraid(){return!0}windowOpenAttempt(e){super.windowOpenAttempt(e);const t={impid:this.placement.getImpressionId(),click_through_url:e,app:this.placement.app,device:this.placement.device,user:this.placement.user},r=JSON.stringify(JSONValidator.compact(t));console.log(`Firing ClickTracking for placement: ${this.placement} to url ${this.placement.getClickThroughUrl()}`),this.networkRequestController.request(this.placement.getClickThroughUrl(),r,CONNECTION_TYPE.POST,DEFAULT_JSON_CONNECTION_CONFIGURATION,((e,t,r)=>{this.trackingCallback("ClickThrough",e,t,r)}))}containerSizeChange(e){super.containerSizeChange(e),this.placement.updateSegmentContainerData(e)}onBannerClicked(){this.notifyAdClicked()}notifyAdClicked(){const e=JSON.stringify({onAdClicked:{}});this.postToViewModel(e)}captureImage(){return!1}generateTimeOnSiteTracking(){return new TimeOnSiteTracking(this.placement.getBrowserDurationUrl(),this.placement.getImpressionId(),{...this.placement.app},{...this.placement.user},{...this.placement.device})}scrollingEnabled(){return!1}shouldScrollBounce(){return!1}allowsWebViewLinkPreview(){return!1}webViewAlpha(){return"00"}isPinchEnabled(){return!1}}const PRESENTATION_LOCKED_ERROR="PresentationController already locked by",VIEW_MODEL_PREFIX={BASE:"HyprMXAd",WEBVIEW:"HyprMXWebView",BROWSER:"HyprMXBrowser"};class PresentationController{constructor(e={},t=globalThis.HYPREventController,r=HYPRPresentationListener,i=HYPRPreloadController,a=globalThis.HYPRPlacementController){this.args=e,this.listener=r,this.eventController=t,this.preloadController=i,this.placementController=a,this.initConfiguration="undefined"!=typeof HYPRInitializationController?HYPRInitializationController.getConfiguration():void 0,this.baseAdViewModelMap=new Map,this.webViewViewModelMap=new Map,this.hyprmxBrowserViewModelMap=new Map,this.webViewIdentifierIndex=0,this.baseAdIdentifierIndex=0,this.presentedSession=void 0}showFullscreenAd(e){const t=new PresentationSession(e,this,this.listener,this.args);if(t.isValid())if(this.isPresentationLockedWithAnotherPlacement(e)){const t=this.presentedSession.getPlacementName();this.adFailedToDisplay(e,`SDK attempted to show ad for:(${e}), but is locked with ${t}.`)}else this.isPresentationLocked()?this.listener.adDisplayError(e,`PresentationController already showing ad for placement ${e}.`):this.beginPresentation(t);else this.adFailedToDisplay(e,`SDK cannot show an ad for ${e}.  Placement undefined.`)}beginPresentation(e){try{this.lockPresentationWithSession(e)}catch(t){return this.adFailedToDisplay(e.getPlacementName(),`SDK reported presentation error: ${t.message}`),void(t.message.includes(PRESENTATION_LOCKED_ERROR)||this.endPresentation(!1))}if(TransparencyTracking.canPrompt(this.initConfiguration)){console.debug("PresentationController will prompt for TransparencyTracking approval");try{return void TransparencyTracking.prompt("HYPRPresentationController.beginPresentation(HYPRPresentationController.presentedSession)")}catch(t){console.error(`PresentationController.beginPresentation(${e.getPlacementName()}) error displaying prompt.`)}}this.presentedSession.beginFullScreenPresentation()}endPresentation(e){if("object"!=typeof this.presentedSession)return void console.debug("endPresentation called without a presentedSession (see PLAYER-15335)");globalThis.isIOS6_0_0()&&void 0!==this.presentedSession.webViewModel&&(console.debug("Setting WebView Page to about:blank"),this.presentedSession.webViewModel.setCurrentUrl("about:blank"));const t=this.presentedSession.getPlacementName();console.debug(`PresentationController.endPresentation(${t})`),this.placementController.startAdRefresh(POST_AD_REFRESH),this.preloadController.refreshForPlacement(this.presentedSession.sessionPlacement),this.presentedSession.closeCatalogFrame(),this.clearFullscreenViewModel(t),this.presentedSession=void 0,e?this.listener.adFinished(t):this.listener.adCanceled(t)}clearFullscreenViewModel(e){this.baseAdViewModelMap.delete(e)}lockPresentationWithSession(e){const t=e.getPlacementName();if(this.isPresentationLockedWithAnotherPlacement(t))throw new Error(`${PRESENTATION_LOCKED_ERROR} ${this.presentedSession.getPlacementName()}`);this.placementController.getPlacement(t).stopAdAvailableTimer(),this.isPresentationLocked()||(console.debug(`PresentationController.lockPresentationWithPlacement(${t})`),this.listener.adStarted(t),this.adProgress=void 0),this.presentedSession=e}adFailedToDisplay(e,t){console.debug(t),this.presentedSession=void 0,this.listener.adStarted(e),this.listener.adDisplayError(e,t),this.listener.adFinished(e)}isPresentationLockedWithAnotherPlacement(e){return void 0!==this.presentedSession&&!this.presentedSession.isSession(e)}isPresentationLocked(){return void 0!==this.presentedSession}publishEvent(e,t,r,i){try{const a=this[t].get(e);return a[r].apply(a,i)}catch(e){return JSON.stringify({error:e})}}bindWebView(e,t="",r){let i,a,s,o;if(i=void 0!==this.presentedSession&&void 0!==this.presentedSession.sessionPlacement&&this.presentedSession.sessionPlacement.name===e?this.presentedSession.sessionPlacement:this.placementController.getPlacement(e),"object"==typeof i){if(a=t.startsWith(VIEW_MODEL_PREFIX.BASE)?this.baseAdViewModelMap.get(t):t.startsWith(VIEW_MODEL_PREFIX.BROWSER)?this.hyprmxBrowserViewModelMap.get(t):new PreloadedAdViewModel(i,HYPRPresentationController),"object"==typeof a){if(void 0!==r&&(s=this.webViewViewModelMap.get(r),void 0!==s&&(s.baseAdListener=a,o=r)),void 0===s&&(o=this.generateWebViewIdentifier(e),s=new WebViewViewModel(i,o,a)),globalThis.isIOS6_0_0()){const e=a.webViewModel;void 0!==e&&(console.debug("Setting old WebView Page to about:blank"),e.setCurrentUrl("about:blank"))}return a.webViewModel=s,this.webViewViewModelMap.set(o,s),o}console.error(`error binding webView for placement: ${e}, baseAdId: ${t}`)}else console.error(`error binding webView for placement: ${e}`)}bindBannerViewModel(e){const t=this.placementController.getPlacement(e);if("object"!=typeof t||!t.isBannerAdType())return void console.error(`error binding Banner for placement: ${e}`);const r=this.generateBaseAdIdentifier(e),i=new BannerViewModel(t,this,r);return this.baseAdViewModelMap.set(r,i),r}bindFullscreenViewModel(e){if(!this.isPresentationLocked())return void console.error("Fullscreen ViewModel attempting to bind while presenter is unlocked");const t=this.presentedSession.getPlacementName();if(this.presentedSession.getPlacementName()!==e)return void console.error(`Attempting to bind for ${e} but presenting ${t}`);const r=this.generateBaseAdIdentifier(e),i=this.presentedSession;return i.instanceId=r,this.baseAdViewModelMap.set(r,i),r}bindBrowserViewModel(e){const t=this.baseAdViewModelMap.get(e);if("object"!=typeof t)return void console.error(`error binding Browser for parent id: ${e}`);const r=t.browserRequest,i=this.generateBrowserIdentifier(e),a=t.generateTimeOnSiteTracking(),s=new HyprMXBrowserViewModel(r.placement,r.url,t,this,i,a);return this.hyprmxBrowserViewModelMap.set(i,s),i}destroyWebView(e){this.webViewViewModelMap.has(e)&&(this.webViewViewModelMap.get(e).destroy(),this.webViewViewModelMap.delete(e))}destroyBaseViewModel(e){this.baseAdViewModelMap.has(e)&&this.baseAdViewModelMap.delete(e)}destroyBrowserViewModel(e){this.hyprmxBrowserViewModelMap.has(e)&&this.hyprmxBrowserViewModelMap.delete(e)}generateWebViewIdentifier(e){const t=`${VIEW_MODEL_PREFIX.WEBVIEW}-${e}-${this.webViewIdentifierIndex}`;return this.webViewIdentifierIndex+=1,t}generateBaseAdIdentifier(e){const t=`${VIEW_MODEL_PREFIX.BASE}-${e}-${this.baseAdIdentifierIndex}`;return this.baseAdIdentifierIndex+=1,t}generateBrowserIdentifier(e){return`${VIEW_MODEL_PREFIX.BROWSER}-${e}`}requiredInfoPresentationCompletedWithParams(e){console.debug("PresentationController - Prequal form finished with questions answered"),this.presentedSession.reloadPlacement(e)}requiredInfoPresentationCancelled(){console.debug("PresentationController - Prequal form was cancelled"),console.debug(`Trying presentation for ${this.presentedSession.getPlacementName()}`),this.presentedSession.clearPlacementRequiredInfo(),this.beginPresentation(this.presentedSession)}adDismissed(e){console.debug(`PresentationController.adDismissed(${e})`),this.endPresentation(e)}adRewarded(){"rewarded"===this.presentedSession.getPlacementType()&&(console.debug(`Ad Rewarded for ${this.presentedSession.getPlacementName()}`),this.listener.adRewarded(this.presentedSession.getPlacementName(),this.presentedSession.getAdRewardText(),this.presentedSession.getAdRewardQuantity()))}presentationSceneBackgrounded(){this.isPresentationLocked()&&console.debug(`Ad Window backgrounded for ${this.presentedSession.getPlacementName()}`)}presentationSceneForegrounded(){this.isPresentationLocked()&&console.debug(`Ad Window foregrounded for ${this.presentedSession.getPlacementName()}`)}startAdProgressTracking(e){let t="";const r=Object.keys(e);for(const i of["viewingID","distributorID","userID","offerType"])r.includes(i)&&"string"==typeof e[i]||(t+=`Valid ${i} missing from parameters. `);if(t.length>0)return console.debug(`error with startAdProgressTracking() - ${t}`),t;const{viewingID:i}=e,{distributorID:a}=e,{userID:s}=e,{offerType:o}=e;return void 0===globalThis.HYPREventController.adProgressUrl?"AdProgressURL not received from initialization":void 0!==this.adProgress&&void 0!==this.adProgress.data&&this.adProgress.data.viewing_id===i?`Ad Progress already in progress for viewingID: ${i}`:(this.adProgress=new AdProgressTracking(i,a,s,o),null)}updateAdProgressState(e,t){void 0!==this.adProgress&&this.adProgress.setProgressState(e,t)}updateAdClosedAction(e,t){void 0!==this.adProgress&&this.adProgress.setClosedAction(e,t)}openUrlOutsideApplication(e){this.listener.openUrlOutsideApplication(e)}preloadedWebViewPageReadyExpired(e){this.preloadController.clearMraidPreload(e)}static attributesForWebtrafficText(e){return e===HYPR_NEXT_BUTTON_TEXT_KEY||e===HYPR_FINISH_BUTTON_TEXT_KEY?JSON.stringify({Color:"FFFFFFFF",Font:{fontName:"Helvetica Neue",size:13.33},NSKern:0,NSParagraphStyle:{alignment:"left"},NSStrokeWidth:0}):e===HYPR_TITLE_TEXT_KEY?JSON.stringify({Color:"3A3A3AFF",Font:{fontName:"Helvetica Neue",size:13.33},NSKern:0,NSParagraphStyle:{alignment:"left"},NSStrokeWidth:0}):e===HYPR_COUNTDOWN_TEXT_KEY?JSON.stringify({Color:"5D5D5DFF",Font:{fontName:"HelveticaNeue-Bold",size:18.67},NSKern:0,NSParagraphStyle:{alignment:"left",minimumLineHeight:17},NSStrokeWidth:0}):"{}"}}globalThis.PresentationController=PresentationController;class DeviceConfiguration{constructor(e){this.version=DeviceConfiguration.osVersion(e.device_os_version),this.platform=DeviceConfiguration.devicePlatform(e.device_type),this.orientations=DeviceConfiguration.supportedInterfaceSettings(e.supported_interface_settings)}isIos(){return"iOS"===this.platform}isAndroid(){return"Android"===this.platform}isPortraitSupported(){return this.version>=14||this.orientations.indexOf("portrait")>-1}static osVersion(e){return void 0===e||-1===e.indexOf(".")?0:parseFloat(e.match(/[0-9]*.[0-9]*/)[0])}static devicePlatform(e){return void 0===e?"unknown":e.includes("iP")||e.toLowerCase().includes("mac")?"iOS":e.toLowerCase().includes("android")?"Android":"unknown"}static supportedInterfaceSettings(e){const t=[];return void 0===e||e.forEach((e=>{const r=e.split("UIInterfaceOrientation")[1];void 0!==r&&t.push(r.toLowerCase())})),t}}const ResetUserDataKey="reset_user_data",MobileJSVersionDataKey="mobile_js_version",DeviceTypeKey="device_type",UIDKey="uid";class InitializationController{constructor(e=initializationHost(),t=globalThis.HYPRNetworkController,r=HYPRConsentController,i=HYPRPreloadController){this.initialized=!1,this.configuration=void 0,this.networkRequestController=t,this.initializationURL=`https://${e}${initializationPath()}`,this.consentController=r,this.preloadController=i,this.deviceConfiguration=void 0,globalThis.serverHostname=e}initialize(e){this.initialized=!1,this.configuration=void 0,"android"!==e[DeviceTypeKey]&&(globalThis.hyprMXLocalStorage=localStorage),this.uid=e[UIDKey];const t=JSON.parse(hyprMXLocalStorage.getItem(OptedOutKey)),r=hyprMXLocalStorage.getItem(PersistentIdKey);console.debug(`oldPersistentId: ${r}`),console.debug(`oldOptedOut: ${t}`),e[MobileJSVersionDataKey]=globalThis.version(),(void 0!==e[OptedOutKey]&&null!=t&&t!==e[OptedOutKey]||void 0!==e[PersistentIdKey]&&null!=r&&r!==e[PersistentIdKey])&&(console.debug("Persistent Id reset detected"),e[ResetUserDataKey]=!0,this.preloadController.resetVastCache()&&delete e.preloaded_ads),e=Object.assign(e,this.consentController.getConsentParameters()),e=Object.assign(e,JSON.parse(HYPRRequestParamListener.getUnityParams())),e=Object.assign(e,JSON.parse(HYPRRequestParamListener.getMediationParams())),TransparencyTracking.addStatus(e),"function"==typeof HYPRRequestParamListener.getInfoPlistKey&&(e=Object.assign(e,JSON.parse(HYPRRequestParamListener.getInfoPlistKey(SKAdNetworkItemsKey)))),globalThis.HYPRRequestParameterManager=new RequestParameterManager(e),this.deviceConfiguration=new DeviceConfiguration(globalThis.HYPRRequestParameterManager.cache);const i=JSON.stringify(globalThis.HYPRRequestParameterManager.cache);console.debug(`Initialization Requested to ${this.initializationURL} with ${i}`),this.networkRequestController.request(this.initializationURL,i,CONNECTION_TYPE.POST,DEFAULT_JSON_CONNECTION_CONFIGURATION,((t,r,i)=>{this.response(t,r,i,(()=>{void 0!==e[OptedOutKey]&&hyprMXLocalStorage.setItem(OptedOutKey,e[OptedOutKey].toString()),void 0!==e[PersistentIdKey]&&hyprMXLocalStorage.setItem(PersistentIdKey,e[PersistentIdKey].toString())}))}))}response(e,t,r,i=(()=>{})){const a=parseJSON(t);if(void 0!==HYPRInitListener.setEnableAllLogs&&HYPRInitListener.setEnableAllLogs(void 0!==a&&void 0!==a.enable_all_logs&&a.enable_all_logs),NetworkRequestController.validResponseStatus(e)&&void 0===r&&void 0!==a&&JSONValidator.validateJSON(INIT_SCHEMA,a)){if(i(),this.configuration=a,console.debug(`Initialization Success Response:${JSON.stringify(a)}`),this.updateDefaultUIComponents(a.ui_components),void 0!==a.new_mobile_js?this.updateJavascript(a):(this.initializeNativeControllers(a),AdProgressTracking.checkStoredData()),void 0!==a.open_measurement){const e=a.open_measurement;HYPRInitListener.initializeOMSDK(e.omsdk_url,e.partner_name,e.api_version)}}else this.initialized=!1,console.error(`Initialization Failed Response: ${t} code ${e} error: ${r}`),HYPRInitListener.initializationFailed(`${e}`)}javascriptUpgradeFailed(e){this.initializeNativeControllers(this.configuration)}initializeNativeControllers(e){this.initialized=!0;const t=JSON.stringify(e.placements);globalThis.HYPRErrorController.setErrorConfiguration(e.error_reporting_endpoint,e.error_severity_level),HYPRInitListener.setSharingEndpoint(e.sharing_endpoint),HYPRInitListener.setCompletionEndpoint(e.completion_endpoint),HYPRInitListener.setDurationUpdateEndpoint(e.duration_update_endpoint),createEventController(e),globalThis.HYPRStorePresentationController=new StorePresentationController(this.deviceConfiguration,e.skadnetwork_signature_endpoint),globalThis.HYPRPlacementController=new PlacementController(e.placements),globalThis.HYPRPresentationController=new PresentationController({userId:this.uid}),HYPRInitListener.initializationSuccessWithPlacements(t,globalThis.version()),this.preloadController.setEventController(globalThis.HYPREventController),this.preloadController.handleAdsToPreloadResponse(e.ads_to_preload),this.preloadController.handleUIComponentsToPreloadResponse(e.ui_components)}updateJavascript(e){let t=8;void 0!==e.new_mobile_js.timeout&&(t=e.new_mobile_js.timeout),HYPRInitListener.updateJavascript(e.new_mobile_js.url,e.new_mobile_js.version,t)}isInitialized(){return this.initialized}allowsInitialization(){return"object"!=typeof HYPRPresentationController||!HYPRPresentationController.isPresentationLocked()}requestInitializationAllowed(e){HYPRInitListener.initializationIsAllowed(this.allowsInitialization(),JSON.stringify(e))}getConfiguration(){return this.configuration}updateDefaultUIComponents(e){void 0!==e&&"object"==typeof JSON.parse(JSON.stringify(e))&&(globalThis.defaultUIComponents=e)}}globalThis.InitializationController=InitializationController;const IABCONSENT_CMPPRESENT_KEY="IABConsent_CMPPresent",IABCONSENT_SUBJECTTOGDPR_KEY="IABConsent_SubjectToGDPR",IABCONSENT_CONSENTSTRING_KEY="IABConsent_ConsentString",IABCONSENT_PARSEDPURPOSECONSENTS_KEY="IABConsent_ParsedPurposeConsents",IABCONSENT_PARSEDVENDORCONSENTS_KEY="IABConsent_ParsedVendorConsents",KEYS_TO_MONITOR=[IABCONSENT_CMPPRESENT_KEY,IABCONSENT_SUBJECTTOGDPR_KEY,IABCONSENT_CONSENTSTRING_KEY,IABCONSENT_PARSEDPURPOSECONSENTS_KEY,IABCONSENT_PARSEDVENDORCONSENTS_KEY],JS_CONSENT_CONTROLLER_NAME="HYPRConsentController";class ConsentController{constructor(e=HYPRNativeConsentController,t=HYPRSharedDataController){this.sharedDataController=t,this.nativeConsentController=e;for(const e of KEYS_TO_MONITOR)t.monitorSharedValue(JS_CONSENT_CONTROLLER_NAME,e)}setConsentChangedListener(e){this.consentListener=e}consentStatusChanged(e){console.debug(`Consent status changed to ${Object.keys(CONSENT_STATUS)[e]}`),void 0!==this.consentListener&&this.consentListener.onConsentChanged()}onValueChanged(e){console.debug(`Monitored consent string ${e.key} changed to ${e.value}`),void 0!==this.consentListener&&this.consentListener.onConsentChanged()}getConsentParameters(){const e={consent:{}},t=this.nativeConsentController.getConsentStatus();t!==CONSENT_STATUS.CONSENT_STATUS_UNKNOWN&&(e.consent.is_consent_given=t===CONSENT_STATUS.CONSENT_GIVEN);const r=JSON.parse(this.sharedDataController.getSharedValue(IABCONSENT_CMPPRESENT_KEY)).value;void 0!==r&&(e.consent.iab_consent_cmppresent=r);const i=JSON.parse(this.sharedDataController.getSharedValue(IABCONSENT_SUBJECTTOGDPR_KEY)).value;void 0!==i&&(e.consent.iab_consent_subject_to_gdpr=i);const a=JSON.parse(this.sharedDataController.getSharedValue(IABCONSENT_CONSENTSTRING_KEY)).value;void 0!==a&&(e.consent.iab_consent_string=a);const s=JSON.parse(this.sharedDataController.getSharedValue(IABCONSENT_PARSEDPURPOSECONSENTS_KEY)).value;void 0!==s&&(e.consent.iab_consent_parsed_purpose_consents=s);const o=JSON.parse(this.sharedDataController.getSharedValue(IABCONSENT_PARSEDVENDORCONSENTS_KEY)).value;return void 0!==o&&(e.consent.iab_consent_parsed_vendor_consents=o),console.debug(JSON.stringify(e)),e}}globalThis.ConsentController=ConsentController;var parser={},node2json={},util$4={};!function(e){const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",r="["+t+"][:A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*",i=new RegExp("^"+r+"$");e.isExist=function(e){return void 0!==e},e.isEmptyObject=function(e){return 0===Object.keys(e).length},e.merge=function(e,t,r){if(t){const i=Object.keys(t),a=i.length;for(let s=0;s<a;s++)e[i[s]]="strict"===r?[t[i[s]]]:t[i[s]]}},e.getValue=function(t){return e.isExist(t)?t:""},e.buildOptions=function(e,t,r){var i={};if(!e)return t;for(let a=0;a<r.length;a++)void 0!==e[r[a]]?i[r[a]]=e[r[a]]:i[r[a]]=t[r[a]];return i},e.isTagNameInArrayMode=function(e,t,r){return!1!==t&&(t instanceof RegExp?t.test(e):"function"==typeof t?!!t(e,r):"strict"===t)},e.isName=function(e){const t=i.exec(e);return!(null==t)},e.getAllMatches=function(e,t){const r=[];let i=t.exec(e);for(;i;){const a=[],s=i.length;for(let e=0;e<s;e++)a.push(i[e]);r.push(a),i=t.exec(e)}return r},e.nameRegexp=r}(util$4);const util$3=util$4,convertToJson=function(e,t,r){const i={};if((!e.child||util$3.isEmptyObject(e.child))&&(!e.attrsMap||util$3.isEmptyObject(e.attrsMap)))return util$3.isExist(e.val)?e.val:"";if(util$3.isExist(e.val)&&("string"!=typeof e.val||""!==e.val&&e.val!==t.cdataPositionChar)){const a=util$3.isTagNameInArrayMode(e.tagname,t.arrayMode,r);i[t.textNodeName]=a?[e.val]:e.val}util$3.merge(i,e.attrsMap,t.arrayMode);const a=Object.keys(e.child);for(let s=0;s<a.length;s++){const o=a[s];if(e.child[o]&&e.child[o].length>1){i[o]=[];for(let r in e.child[o])e.child[o].hasOwnProperty(r)&&i[o].push(convertToJson(e.child[o][r],t,o))}else{const a=convertToJson(e.child[o][0],t,o),s=!0===t.arrayMode&&"object"==typeof a||util$3.isTagNameInArrayMode(o,t.arrayMode,r);i[o]=s?[a]:a}}return i};node2json.convertToJson=convertToJson;var xmlstr2xmlnode={},xmlNode$1=function(e,t,r){this.tagname=e,this.parent=t,this.child={},this.attrsMap={},this.val=r,this.addChild=function(e){Array.isArray(this.child[e.tagname])?this.child[e.tagname].push(e):this.child[e.tagname]=[e]}};const util$2=util$4,buildOptions$3=util$4.buildOptions,xmlNode=xmlNode$1;"<((!\\[CDATA\\[([\\s\\S]*?)(]]>))|((NAME:)?(NAME))([^>]*)>|((\\/)(NAME)\\s*>))([^<]*)".replace(/NAME/g,util$2.nameRegexp),!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const defaultOptions$2={attributeNamePrefix:"@_",attrNodeName:!1,textNodeName:"#text",ignoreAttributes:!0,ignoreNameSpace:!1,allowBooleanAttributes:!1,parseNodeValue:!0,parseAttributeValue:!1,arrayMode:!1,trimValues:!0,cdataTagName:!1,cdataPositionChar:"\\c",tagValueProcessor:function(e,t){return e},attrValueProcessor:function(e,t){return e},stopNodes:[]};xmlstr2xmlnode.defaultOptions=defaultOptions$2;const props$2=["attributeNamePrefix","attrNodeName","textNodeName","ignoreAttributes","ignoreNameSpace","allowBooleanAttributes","parseNodeValue","parseAttributeValue","arrayMode","trimValues","cdataTagName","cdataPositionChar","tagValueProcessor","attrValueProcessor","parseTrueNumberOnly","stopNodes"];function processTagValue(e,t,r){return t&&(r.trimValues&&(t=t.trim()),t=parseValue(t=r.tagValueProcessor(t,e),r.parseNodeValue,r.parseTrueNumberOnly)),t}function resolveNameSpace(e,t){if(t.ignoreNameSpace){const t=e.split(":"),r="/"===e.charAt(0)?"/":"";if("xmlns"===t[0])return"";2===t.length&&(e=r+t[1])}return e}function parseValue(e,t,r){if(t&&"string"==typeof e){let t;return""===e.trim()||isNaN(e)?t="true"===e||"false"!==e&&e:(-1!==e.indexOf("0x")?t=Number.parseInt(e,16):-1!==e.indexOf(".")?(t=Number.parseFloat(e),e=e.replace(/\.?0+$/,"")):t=Number.parseInt(e,10),r&&(t=String(t)===e?t:e)),t}return util$2.isExist(e)?e:""}xmlstr2xmlnode.props=props$2;const attrsRegx=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])(.*?)\\3)?","g");function buildAttributesMap(e,t){if(!t.ignoreAttributes&&"string"==typeof e){e=e.replace(/\r?\n/g," ");const r=util$2.getAllMatches(e,attrsRegx),i=r.length,a={};for(let e=0;e<i;e++){const i=resolveNameSpace(r[e][1],t);i.length&&(void 0!==r[e][4]?(t.trimValues&&(r[e][4]=r[e][4].trim()),r[e][4]=t.attrValueProcessor(r[e][4],i),a[t.attributeNamePrefix+i]=parseValue(r[e][4],t.parseAttributeValue,t.parseTrueNumberOnly)):t.allowBooleanAttributes&&(a[t.attributeNamePrefix+i]=!0))}if(!Object.keys(a).length)return;if(t.attrNodeName){const e={};return e[t.attrNodeName]=a,e}return a}}const getTraversalObj=function(e,t){e=e.replace(/\r\n?/g,"\n"),t=buildOptions$3(t,defaultOptions$2,props$2);const r=new xmlNode("!xml");let i=r,a="";for(let r=0;r<e.length;r++){if("<"===e[r])if("/"===e[r+1]){const s=findClosingIndex(e,">",r,"Closing Tag is not closed.");let o=e.substring(r+2,s).trim();if(t.ignoreNameSpace){const e=o.indexOf(":");-1!==e&&(o=o.substr(e+1))}i&&(i.val?i.val=util$2.getValue(i.val)+""+processTagValue(o,a,t):i.val=processTagValue(o,a,t)),t.stopNodes.length&&t.stopNodes.includes(i.tagname)&&(i.child=[],null==i.attrsMap&&(i.attrsMap={}),i.val=e.substr(i.startIndex+1,r-i.startIndex-1)),i=i.parent,a="",r=s}else if("?"===e[r+1])r=findClosingIndex(e,"?>",r,"Pi Tag is not closed.");else if("!--"===e.substr(r+1,3))r=findClosingIndex(e,"--\x3e",r,"Comment is not closed.");else if("!D"===e.substr(r+1,2)){const t=findClosingIndex(e,">",r,"DOCTYPE is not closed.");r=e.substring(r,t).indexOf("[")>=0?e.indexOf("]>",r)+1:t}else if("!["===e.substr(r+1,2)){const s=findClosingIndex(e,"]]>",r,"CDATA is not closed.")-2,o=e.substring(r+9,s);if(a&&(i.val=util$2.getValue(i.val)+""+processTagValue(i.tagname,a,t),a=""),t.cdataTagName){const e=new xmlNode(t.cdataTagName,i,o);i.addChild(e),i.val=util$2.getValue(i.val)+t.cdataPositionChar,o&&(e.val=o)}else i.val=(i.val||"")+(o||"");r=s+2}else{const s=closingIndexForOpeningTag(e,r+1);let o=s.data;const n=s.index,l=o.indexOf(" ");let d=o,c=!0;if(-1!==l&&(d=o.substr(0,l).replace(/\s\s*$/,""),o=o.substr(l+1)),t.ignoreNameSpace){const e=d.indexOf(":");-1!==e&&(d=d.substr(e+1),c=d!==s.data.substr(e+1))}if(i&&a&&"!xml"!==i.tagname&&(i.val=util$2.getValue(i.val)+""+processTagValue(i.tagname,a,t)),o.length>0&&o.lastIndexOf("/")===o.length-1){"/"===d[d.length-1]?(d=d.substr(0,d.length-1),o=d):o=o.substr(0,o.length-1);const e=new xmlNode(d,i,"");d!==o&&(e.attrsMap=buildAttributesMap(o,t)),i.addChild(e)}else{const e=new xmlNode(d,i);t.stopNodes.length&&t.stopNodes.includes(e.tagname)&&(e.startIndex=n),d!==o&&c&&(e.attrsMap=buildAttributesMap(o,t)),i.addChild(e),i=e}a="",r=n}else a+=e[r]}return r};function closingIndexForOpeningTag(e,t){let r,i="";for(let a=t;a<e.length;a++){let t=e[a];if(r)t===r&&(r="");else if('"'===t||"'"===t)r=t;else{if(">"===t)return{data:i,index:a};"\t"===t&&(t=" ")}i+=t}}function findClosingIndex(e,t,r,i){const a=e.indexOf(t,r);if(-1===a)throw new Error(i);return a+t.length-1}xmlstr2xmlnode.getTraversalObj=getTraversalObj;var validator={};const util$1=util$4,defaultOptions$1={allowBooleanAttributes:!1},props$1=["allowBooleanAttributes"];function readPI(e,t){for(var r=t;t<e.length;t++)if("?"!=e[t]&&" "!=e[t]);else{var i=e.substr(r,t-r);if(t>5&&"xml"===i)return getErrorObject("InvalidXml","XML declaration allowed only at the start of the document.",getLineNumberForPosition(e,t));if("?"==e[t]&&">"==e[t+1]){t++;break}}return t}function readCommentAndCDATA(e,t){if(e.length>t+5&&"-"===e[t+1]&&"-"===e[t+2]){for(t+=3;t<e.length;t++)if("-"===e[t]&&"-"===e[t+1]&&">"===e[t+2]){t+=2;break}}else if(e.length>t+8&&"D"===e[t+1]&&"O"===e[t+2]&&"C"===e[t+3]&&"T"===e[t+4]&&"Y"===e[t+5]&&"P"===e[t+6]&&"E"===e[t+7]){let r=1;for(t+=8;t<e.length;t++)if("<"===e[t])r++;else if(">"===e[t]&&(r--,0===r))break}else if(e.length>t+9&&"["===e[t+1]&&"C"===e[t+2]&&"D"===e[t+3]&&"A"===e[t+4]&&"T"===e[t+5]&&"A"===e[t+6]&&"["===e[t+7])for(t+=8;t<e.length;t++)if("]"===e[t]&&"]"===e[t+1]&&">"===e[t+2]){t+=2;break}return t}validator.validate=function(e,t){t=util$1.buildOptions(t,defaultOptions$1,props$1);const r=[];let i=!1,a=!1;"\ufeff"===e[0]&&(e=e.substr(1));for(let s=0;s<e.length;s++)if("<"===e[s]&&"?"===e[s+1]){if(s+=2,s=readPI(e,s),s.err)return s}else{if("<"!==e[s]){if(" "===e[s]||"\t"===e[s]||"\n"===e[s]||"\r"===e[s])continue;return getErrorObject("InvalidChar","char '"+e[s]+"' is not expected.",getLineNumberForPosition(e,s))}if(s++,"!"===e[s]){s=readCommentAndCDATA(e,s);continue}{let o=!1;"/"===e[s]&&(o=!0,s++);let n="";for(;s<e.length&&">"!==e[s]&&" "!==e[s]&&"\t"!==e[s]&&"\n"!==e[s]&&"\r"!==e[s];s++)n+=e[s];if(n=n.trim(),"/"===n[n.length-1]&&(n=n.substring(0,n.length-1),s--),!validateTagName(n)){let t;return t=0===n.trim().length?"There is an unnecessary space between tag name and backward slash '</ ..'.":"Tag '"+n+"' is an invalid name.",getErrorObject("InvalidTag",t,getLineNumberForPosition(e,s))}const l=readAttributeStr(e,s);if(!1===l)return getErrorObject("InvalidAttr","Attributes for '"+n+"' have open quote.",getLineNumberForPosition(e,s));let d=l.value;if(s=l.index,"/"===d[d.length-1]){d=d.substring(0,d.length-1);const r=validateAttributeString(d,t);if(!0!==r)return getErrorObject(r.err.code,r.err.msg,getLineNumberForPosition(e,s-d.length+r.err.line));i=!0}else if(o){if(!l.tagClosed)return getErrorObject("InvalidTag","Closing tag '"+n+"' doesn't have proper closing.",getLineNumberForPosition(e,s));if(d.trim().length>0)return getErrorObject("InvalidTag","Closing tag '"+n+"' can't have attributes or invalid starting.",getLineNumberForPosition(e,s));{const t=r.pop();if(n!==t)return getErrorObject("InvalidTag","Closing tag '"+t+"' is expected inplace of '"+n+"'.",getLineNumberForPosition(e,s));0==r.length&&(a=!0)}}else{const o=validateAttributeString(d,t);if(!0!==o)return getErrorObject(o.err.code,o.err.msg,getLineNumberForPosition(e,s-d.length+o.err.line));if(!0===a)return getErrorObject("InvalidXml","Multiple possible root nodes found.",getLineNumberForPosition(e,s));r.push(n),i=!0}for(s++;s<e.length;s++)if("<"===e[s]){if("!"===e[s+1]){s++,s=readCommentAndCDATA(e,s);continue}if("?"!==e[s+1])break;if(s=readPI(e,++s),s.err)return s}else if("&"===e[s]){const t=validateAmpersand(e,s);if(-1==t)return getErrorObject("InvalidChar","char '&' is not expected.",getLineNumberForPosition(e,s));s=t}"<"===e[s]&&s--}}return i?!(r.length>0)||getErrorObject("InvalidXml","Invalid '"+JSON.stringify(r,null,4).replace(/\r?\n/g,"")+"' found.",1):getErrorObject("InvalidXml","Start tag expected.",1)};var doubleQuote='"',singleQuote="'";function readAttributeStr(e,t){let r="",i="",a=!1;for(;t<e.length;t++){if(e[t]===doubleQuote||e[t]===singleQuote)if(""===i)i=e[t];else{if(i!==e[t])continue;i=""}else if(">"===e[t]&&""===i){a=!0;break}r+=e[t]}return""===i&&{value:r,index:t,tagClosed:a}}const validAttrStrRegxp=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function validateAttributeString(e,t){const r=util$1.getAllMatches(e,validAttrStrRegxp),i={};for(let a=0;a<r.length;a++){if(0===r[a][1].length)return getErrorObject("InvalidAttr","Attribute '"+r[a][2]+"' has no space in starting.",getPositionFromMatch(e,r[a][0]));if(void 0===r[a][3]&&!t.allowBooleanAttributes)return getErrorObject("InvalidAttr","boolean attribute '"+r[a][2]+"' is not allowed.",getPositionFromMatch(e,r[a][0]));const s=r[a][2];if(!validateAttrName(s))return getErrorObject("InvalidAttr","Attribute '"+s+"' is an invalid name.",getPositionFromMatch(e,r[a][0]));if(i.hasOwnProperty(s))return getErrorObject("InvalidAttr","Attribute '"+s+"' is repeated.",getPositionFromMatch(e,r[a][0]));i[s]=1}return!0}function validateNumberAmpersand(e,t){let r=/\d/;for("x"===e[t]&&(t++,r=/[\da-fA-F]/);t<e.length;t++){if(";"===e[t])return t;if(!e[t].match(r))break}return-1}function validateAmpersand(e,t){if(";"===e[++t])return-1;if("#"===e[t])return validateNumberAmpersand(e,++t);let r=0;for(;t<e.length;t++,r++)if(!(e[t].match(/\w/)&&r<20)){if(";"===e[t])break;return-1}return t}function getErrorObject(e,t,r){return{err:{code:e,msg:t,line:r}}}function validateAttrName(e){return util$1.isName(e)}function validateTagName(e){return util$1.isName(e)}function getLineNumberForPosition(e,t){return e.substring(0,t).split(/\r?\n/).length}function getPositionFromMatch(e,t){return e.indexOf(t)+t.length}var nimndata={};const char=function(e){return String.fromCharCode(e)},chars={nilChar:char(176),missingChar:char(201),nilPremitive:char(175),missingPremitive:char(200),emptyChar:char(178),emptyValue:char(177),boundryChar:char(179),objStart:char(198),arrStart:char(204),arrayEnd:char(185)},charsArr=[chars.nilChar,chars.nilPremitive,chars.missingChar,chars.missingPremitive,chars.boundryChar,chars.emptyChar,chars.emptyValue,chars.arrayEnd,chars.objStart,chars.arrStart],_e=function(e,t,r){if("string"==typeof t)return e&&e[0]&&void 0!==e[0].val?getValue(e[0].val):getValue(e);{const i=hasData(e);if(!0===i){let i="";if(Array.isArray(t)){i+=chars.arrStart;const a=t[0],s=e.length;if("string"==typeof a)for(let t=0;t<s;t++){const r=getValue(e[t].val);i=processValue(i,r)}else for(let t=0;t<s;t++){const s=_e(e[t],a,r);i=processValue(i,s)}i+=chars.arrayEnd}else{i+=chars.objStart;const a=Object.keys(t);Array.isArray(e)&&(e=e[0]);for(let s in a){const o=a[s];let n;n=!r.ignoreAttributes&&e.attrsMap&&e.attrsMap[o]?_e(e.attrsMap[o],t[o],r):o===r.textNodeName?_e(e.val,t[o],r):_e(e.child[o],t[o],r),i=processValue(i,n)}}return i}return i}},getValue=function(e){switch(e){case void 0:return chars.missingPremitive;case null:return chars.nilPremitive;case"":return chars.emptyValue;default:return e}},processValue=function(e,t){return isAppChar(t[0])||isAppChar(e[e.length-1])||(e+=chars.boundryChar),e+t},isAppChar=function(e){return-1!==charsArr.indexOf(e)};function hasData(e){return void 0===e?chars.missingChar:null===e?chars.nilChar:!(e.child&&0===Object.keys(e.child).length&&(!e.attrsMap||0===Object.keys(e.attrsMap).length))||chars.emptyChar}const x2j$1=xmlstr2xmlnode,buildOptions$2=util$4.buildOptions,convert2nimn=function(e,t,r){return r=buildOptions$2(r,x2j$1.defaultOptions,x2j$1.props),_e(e,t,r)};nimndata.convert2nimn=convert2nimn;var node2json_str={};const util=util$4,buildOptions$1=util$4.buildOptions,x2j=xmlstr2xmlnode,convertToJsonString=function(e,t){return(t=buildOptions$1(t,x2j.defaultOptions,x2j.props)).indentBy=t.indentBy||"",_cToJsonStr(e,t)},_cToJsonStr=function(e,t,r){let i="{";const a=Object.keys(e.child);for(let r=0;r<a.length;r++){var s=a[r];if(e.child[s]&&e.child[s].length>1){for(var o in i+='"'+s+'" : [ ',e.child[s])i+=_cToJsonStr(e.child[s][o],t)+" , ";i=i.substr(0,i.length-1)+" ] "}else i+='"'+s+'" : '+_cToJsonStr(e.child[s][0],t)+" ,"}return util.merge(i,e.attrsMap),util.isEmptyObject(i)?util.isExist(e.val)?e.val:"":(util.isExist(e.val)&&("string"!=typeof e.val||""!==e.val&&e.val!==t.cdataPositionChar)&&(i+='"'+t.textNodeName+'" : '+stringval(e.val)),","===i[i.length-1]&&(i=i.substr(0,i.length-2)),i+"}")};function stringval(e){return!0!==e&&!1!==e&&isNaN(e)?'"'+e+'"':e}node2json_str.convertToJsonString=convertToJsonString;const buildOptions=util$4.buildOptions,defaultOptions={attributeNamePrefix:"@_",attrNodeName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataTagName:!1,cdataPositionChar:"\\c",format:!1,indentBy:"  ",supressEmptyNode:!1,tagValueProcessor:function(e){return e},attrValueProcessor:function(e){return e}},props=["attributeNamePrefix","attrNodeName","textNodeName","ignoreAttributes","cdataTagName","cdataPositionChar","format","indentBy","supressEmptyNode","tagValueProcessor","attrValueProcessor"];function Parser(e){this.options=buildOptions(e,defaultOptions,props),this.options.ignoreAttributes||this.options.attrNodeName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=isAttribute),this.options.cdataTagName?this.isCDATA=isCDATA:this.isCDATA=function(){return!1},this.replaceCDATAstr=replaceCDATAstr,this.replaceCDATAarr=replaceCDATAarr,this.options.format?(this.indentate=indentate,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine=""),this.options.supressEmptyNode?(this.buildTextNode=buildEmptyTextNode,this.buildObjNode=buildEmptyObjNode):(this.buildTextNode=buildTextValNode,this.buildObjNode=buildObjectNode),this.buildTextValNode=buildTextValNode,this.buildObjectNode=buildObjectNode}function replaceCDATAstr(e,t){return e=this.options.tagValueProcessor(""+e),""===this.options.cdataPositionChar||""===e?e+"<![CDATA["+t+"]]"+this.tagEndChar:e.replace(this.options.cdataPositionChar,"<![CDATA["+t+"]]"+this.tagEndChar)}function replaceCDATAarr(e,t){if(e=this.options.tagValueProcessor(""+e),""===this.options.cdataPositionChar||""===e)return e+"<![CDATA["+t.join("]]><![CDATA[")+"]]"+this.tagEndChar;for(let r in t)e=e.replace(this.options.cdataPositionChar,"<![CDATA["+t[r]+"]]>");return e+this.newLine}function buildObjectNode(e,t,r,i){return r&&!e.includes("<")?this.indentate(i)+"<"+t+r+">"+e+"</"+t+this.tagEndChar:this.indentate(i)+"<"+t+r+this.tagEndChar+e+this.indentate(i)+"</"+t+this.tagEndChar}function buildEmptyObjNode(e,t,r,i){return""!==e?this.buildObjectNode(e,t,r,i):this.indentate(i)+"<"+t+r+"/"+this.tagEndChar}function buildTextValNode(e,t,r,i){return this.indentate(i)+"<"+t+r+">"+this.options.tagValueProcessor(e)+"</"+t+this.tagEndChar}function buildEmptyTextNode(e,t,r,i){return""!==e?this.buildTextValNode(e,t,r,i):this.indentate(i)+"<"+t+r+"/"+this.tagEndChar}function indentate(e){return this.options.indentBy.repeat(e)}function isAttribute(e){return!!e.startsWith(this.options.attributeNamePrefix)&&e.substr(this.attrPrefixLen)}function isCDATA(e){return e===this.options.cdataTagName}Parser.prototype.parse=function(e){return this.j2x(e,0).val},Parser.prototype.j2x=function(e,t){let r="",i="";const a=Object.keys(e),s=a.length;for(let o=0;o<s;o++){const s=a[o];if(void 0===e[s]);else if(null===e[s])i+=this.indentate(t)+"<"+s+"/"+this.tagEndChar;else if(e[s]instanceof Date)i+=this.buildTextNode(e[s],s,"",t);else if("object"!=typeof e[s]){const a=this.isAttribute(s);a?r+=" "+a+'="'+this.options.attrValueProcessor(""+e[s])+'"':this.isCDATA(s)?e[this.options.textNodeName]?i+=this.replaceCDATAstr(e[this.options.textNodeName],e[s]):i+=this.replaceCDATAstr("",e[s]):s===this.options.textNodeName?e[this.options.cdataTagName]||(i+=this.options.tagValueProcessor(""+e[s])):i+=this.buildTextNode(e[s],s,"",t)}else if(Array.isArray(e[s]))if(this.isCDATA(s))i+=this.indentate(t),e[this.options.textNodeName]?i+=this.replaceCDATAarr(e[this.options.textNodeName],e[s]):i+=this.replaceCDATAarr("",e[s]);else{const r=e[s].length;for(let a=0;a<r;a++){const r=e[s][a];if(void 0===r);else if(null===r)i+=this.indentate(t)+"<"+s+"/"+this.tagEndChar;else if("object"==typeof r){const e=this.j2x(r,t+1);i+=this.buildObjNode(e.val,s,e.attrStr,t)}else i+=this.buildTextNode(r,s,"",t)}}else if(this.options.attrNodeName&&s===this.options.attrNodeName){const t=Object.keys(e[s]),i=t.length;for(let a=0;a<i;a++)r+=" "+t[a]+'="'+this.options.attrValueProcessor(""+e[s][t[a]])+'"'}else{const r=this.j2x(e[s],t+1);i+=this.buildObjNode(r.val,s,r.attrStr,t)}}return{attrStr:r,val:i}};var json2xml=Parser;!function(e){const t=node2json,r=xmlstr2xmlnode,i=xmlstr2xmlnode,a=util$4.buildOptions,s=validator;e.parse=function(e,o,n){if(n){!0===n&&(n={});const t=s.validate(e,n);if(!0!==t)throw Error(t.err.msg)}o=a(o,i.defaultOptions,i.props);const l=r.getTraversalObj(e,o);return t.convertToJson(l,o)},e.convertTonimn=nimndata.convert2nimn,e.getTraversalObj=r.getTraversalObj,e.convertToJson=t.convertToJson,e.convertToJsonString=node2json_str.convertToJsonString,e.validate=s.validate,e.j2xParser=json2xml,e.parseToNimn=function(t,r,i){return e.convertTonimn(e.getTraversalObj(t,i),r,i)}}(parser);class VastParsingController{constructor(e,t,r=globalThis.HYPRNetworkController){this.width=e,this.height=t,this.networkRequestController=r}parse(e,t,r){console.debug(`Requesting vast tag for ${e}`),this.request=this.networkRequestController.request(e,void 0,CONNECTION_TYPE.GET,DEFAULT_QUERY_CONNECTION_CONFIGURATION,((i,a,s,o)=>{NetworkRequestController.validResponseStatus(i)&&void 0===s&&NetworkRequestController.validXMLType(o)?(console.debug(`Requesting vast tag ${e} completed with response.`),this.handleRequestSuccess(a,t,r)):(console.debug(`Requesting vast tag for ${e} failed with error: ${s}`),this.handleRequestFailure(s,t,r))}))}static parseXML(e){return void 0===e||!0!==parser.validate(e)?HyprErrorFactory.getVastValidateError():parser.parse(e,{attributeNamePrefix:"",attrNodeName:"attr",textNodeName:"value",ignoreAttributes:!1,parseAttributeValue:!0})}static selectFirstAd(e){return void 0===e||0===e.length?HyprErrorFactory.getVastNoAdsAvailableError():void 0===e[0].attr.sequence?e[0]:e.reduce(((e,t)=>parseInt(t.attr.sequence,10)<parseInt(e.attr.sequence,10)?t:e),e[0])}static selectAdsContainingLinear(e){let t=HyprErrorFactory.getVastNoAdsAvailableError();if(void 0===e||void 0===e.VAST||void 0===e.VAST.Ad)return t;const r=[];addToArray(r,e.VAST.Ad);const i=r.filter((e=>void 0!==this.selectFirstLinearFromAd(e)));return 0===i.length&&void 0!==r.find((e=>void 0!==e.Wrapper))&&(t=HyprErrorFactory.getVastAdWithWrapperError()),i.length>0?i:t}static selectFirstLinearFromAd(e){if(void 0===e||void 0===e.InLine||void 0===e.InLine.Creatives||void 0===e.InLine.Creatives.Creative)return;const t=[];return addToArray(t,e.InLine.Creatives.Creative),t.find((e=>void 0!==e.Linear))}static convertToSimplifiedModel(e,t,r){if(void 0===e||void 0===e.VAST)return HyprErrorFactory.getVastEmptyTagError();if(void 0===e.VAST.attr&&0===Object.keys(e.VAST).length)return HyprErrorFactory.getVastEmptyTagError();if(void 0!==e.VAST.attr&&1===Object.keys(e.VAST).length)return HyprErrorFactory.getVastEmptyTagError();if(void 0!==e.VAST.Error)return HyprErrorFactory.getVastNoAdsAvailableError();const i=this.selectAdsContainingLinear(e);if(void 0!==i.error)return i;const a=this.selectFirstAd(i);if(void 0!==a.error)return a;const s=this.selectFirstLinearFromAd(a),o=this.extractVerificationFromExtensions(a.InLine.Extensions);if(void 0===s.Linear||void 0===s.Linear.MediaFiles)return HyprErrorFactory.getVastNoMediaError();const n=this.extractMediaFiles(s.Linear.MediaFiles.MediaFile);if(void 0!==n.error)return n;const l=this.getBestFitMediaFile(n,t,r),d=this.extractDuration(s.Linear.Duration);if(void 0!==d.error)return d;const c=this.extractImpressions(a.InLine.Impression);if(void 0!==c.error)return c;const u={Ad:{Impressions:c,Linear:{MediaFile:l,skipoffset:this.extractSkipOffset(s.Linear),Duration:d,Trackings:this.extractTrackings(s.Linear.TrackingEvents),VideoClicks:this.extractVideoClicks(s.Linear.VideoClicks)},ViewableImpression:this.extractViewableImpressions(a.InLine.ViewableImpression),AdVerifications:this.extractAdVerifications(a.InLine.AdVerifications,o)}};return VastParsingController.postProcessTimes(u.Ad),u}static extractMediaFiles(e){let t=[];return t.push(...this.buildArrayOfBasicElements("MediaFile",e)),t=t.filter((e=>this.isSupportedMediaFileType(e.type))),t.length>0?t:HyprErrorFactory.getVastNoMediaError()}static isSupportedMediaFileType(e){return!!new RegExp("video/3gpp","i").test(e)||(!!new RegExp("video/3gp","i").test(e)||(!!new RegExp("video/m4v","i").test(e)||!!new RegExp("video/mp4","i").test(e)))}static extractSkipOffset(e){if(void 0!==e&&void 0!==e.attr)return e.attr.skipoffset}static extractDuration(e){return void 0===e?HyprErrorFactory.getVastNoDurationError():e}static extractTrackings(e){const t=[];if(void 0!==e&&void 0!==e.Tracking)return t.push(...this.buildArrayOfBasicElements("Tracking",e.Tracking)),t.length>0?t:void 0}static extractVideoClicks(e){const t=[];if(void 0!==e)return t.push(...VastParsingController.buildArrayOfBasicElements("ClickThrough",e.ClickThrough)),t.push(...VastParsingController.buildArrayOfBasicElements("ClickTracking",e.ClickTracking)),t.length>0?t:void 0}static extractImpressions(e){const t=[];return void 0===e?HyprErrorFactory.getVastNoImpressionsError():(t.push(...this.buildArrayOfBasicElements("Impression",e)),t.length>0?t:"NO_IMPRESSIONS_ERROR")}static extractViewableImpressions(e){const t=[];if(void 0!==e)return t.push(...this.buildArrayOfBasicElements("Viewable",e.Viewable)),t.push(...this.buildArrayOfBasicElements("NotViewable",e.NotViewable)),t.push(...this.buildArrayOfBasicElements("ViewUndetermined",e.ViewUndetermined)),t.length>0?t:void 0}static extractAdVerifications(e,t){const r=[],i=[];return void 0!==e&&void 0!==e.Verification&&addToArray(i,e.Verification),void 0!==t&&t.forEach((e=>{addToArray(i,e.Verification)})),i.forEach((e=>{r.push(VastParsingController.buildVerification(e))})),r.length>0?r:void 0}static extractVerificationFromExtensions(e){const t=[];if(void 0===e||void 0===e.Extension)return t;const r=[];return addToArray(r,e.Extension),r.forEach((e=>{addToArray(t,e.AdVerifications)})),t}static buildVerification(e){const t=this.buildArrayOfBasicElements("JavaScriptResource",e.JavaScriptResource);return{name:"Verification",value:e.value,vendor:void 0!==e.attr?e.attr.vendor:void 0,Trackings:this.extractTrackings(e.TrackingEvents),JavaScriptResources:t.length>0?t:void 0,VerificationParameters:this.buildBasicElement("VerificationParameters",e.VerificationParameters)}}static buildArrayOfBasicElements(e,t){const r=[],i=[];return void 0===t||(addToArray(i,t),i.forEach((t=>{r.push(VastParsingController.buildBasicElement(e,t))}))),r}static buildBasicElement(e,t){if(void 0===t)return;let r="";void 0!==t.value?r=t.value:"string"==typeof t&&(r=t);const i={name:e,value:r};return void 0!==t.attr&&Object.keys(t.attr).forEach((e=>{i[e]=t.attr[e]})),i}handleRequestFailure(e,t,r){void 0!==r&&r.parsingFailed(HyprErrorFactory.getVastTagDownloadError(),t)}handleRequestSuccess(e,t,r){if(void 0===r)return;const i=VastParsingController.parseXML(e);if(void 0!==i.error)return void r.parsingFailed(i,t);const a=VastParsingController.convertToSimplifiedModel(i,this.width,this.height);void 0!==a.error?r.parsingFailed(a,t):r.parsingCompleted(a,t)}static convertTimeToMS(e){const t=e.split(":");let r=0;if(t[2].includes(".")){const e=t[2].split(".");t[2]=e[0],r=e[1]}return 60*+t[0]*60*1e3+60*+t[1]*1e3+1e3*+t[2]+ +r}static convertPercentageTimeToMS(e,t){return t*(+e.split("%")[0]/100)}static postProcessTimes(e){e.Linear.Duration=this.convertTimeToMS(e.Linear.Duration),void 0!==e.Linear.skipoffset&&(e.Linear.skipoffset=e.Linear.skipoffset.includes("%")?this.convertPercentageTimeToMS(e.Linear.skipoffset,e.Linear.Duration):this.convertTimeToMS(e.Linear.skipoffset)),void 0!==e.Linear.Trackings&&e.Linear.Trackings.forEach((t=>{void 0!==t.offset&&(t.offset=t.offset.includes("%")?VastParsingController.convertPercentageTimeToMS(t.offset,e.Linear.Duration):VastParsingController.convertTimeToMS(t.offset))}))}static getBestFitMediaFile(e,t,r){const i=Math.max(t,r),a=Math.min(t,r),s=e.sort(((e,t)=>{const r=i-e.width,s=a-e.height,o=i-t.width,n=a-t.height,l=Math.max(Math.abs(r),Math.abs(s)),d=Math.max(Math.abs(o),Math.abs(n));return l===d?(0|t.bitrate)-(0|e.bitrate):l-d}));if(s.length>0)return s[0]}}class PreloadController{constructor(e,t,r=HYPRCacheListener,i=globalThis.HYPREventController){this.width=e,this.height=t,this.nativeCacheListener=r}setEventController(e){this.eventController=e}handleAdsToPreloadResponse(e){if(void 0!==e&&void 0!==this.nativeCacheListener)for(const t of e)switch(console.debug(`Requesting preload for (id = ${t.id}, directive=${t.directive}, url=${t.vast_tag_url})`),t.directive){case"cache":case"retain":case"refresh":console.debug(JSON.stringify(t)),this.nativeCacheListener.retrieveVastOffer(JSON.stringify(t));break;case"remove":this.nativeCacheListener.removeVastOffer(t.id)}}refreshForPlacement(e){if(void 0!==e&&e.getAdType()===VAST_VIDEO_OFFER){const t=[{directive:"refresh",id:e.ad.id,vast_tag_url:void 0}];this.handleAdsToPreloadResponse(t)}}handleUIComponentsToPreloadResponse(e){void 0!==e&&void 0!==this.nativeCacheListener&&this.preloadImages(e)}preloadImages(e){if(void 0===e||void 0===this.nativeCacheListener)return;for(const t in e)if(e.hasOwnProperty(t))if("image"!==t&&"submit_button_image"!==t&&"close_button_image"!==t||e[t]instanceof Array)"object"==typeof e[t]&&this.preloadImages(e[t]);else{const r=e[t];r.hasOwnProperty("portrait_url")?(console.debug(`Requesting image to preload for (url = ${r.portrait_url}, height=${r.height}, width=${r.width}, fill_screen_width=${r.fill_screen_width})`),this.nativeCacheListener.preloadPortraitImage(r.portrait_url,r.height,r.width,r.fill_screen_width)):r.hasOwnProperty("url")&&(console.debug(`Requesting image to preload for (url = ${r.url}, height=${r.height}, width=${r.width}, scale=${r.scale}, tiled=${r.tiled}, x=${r.x}, y=${r.y})`),this.nativeCacheListener.preloadUIImage(r.url,r.height,r.width,r.scale,r.tiled,r.x,r.y))}}handleMraidAdToPreload(e){if(void 0===e||void 0===this.nativeCacheListener||"mraid"!==e.getAdType()||void 0===e.ad.preload_player_url||"number"!=typeof e.ad.webview_timeout)return;if(e.ad.webview_timeout<1)return void this.clearMraidPreload(e);const t=JSON.parse(HYPRRequestParamListener.getCatalogFrameParams(e.name));console.debug(`Preload MRAID offer for placement ${e.name}`),this.nativeCacheListener.onMraidOfferToPreload(e.getAdString(),e.name,e.id,catalogFrameParametersForPlacement(e,t))}clearMraidPreload(e){this.nativeCacheListener.clearPreloadedMraid(e.name)}resetVastCache(){return void 0!==this.nativeCacheListener.resetVastCache&&(this.nativeCacheListener.resetVastCache(),!0)}cacheVastOffer(e,t,r=new VastParsingController(this.width,this.height)){console.debug("cacheVastOffer");const i={parsingCompleted:(e,r)=>{console.debug(`cacheVastOffer:Parsing succeeded offer ${r}`),console.debug(`cacheVastOffer:offer ${JSON.stringify(e)}`),t.last_parse_date=(new Date).toISOString(),t.vastJSONString=base64.exports.Base64.encode(JSON.stringify(e)),t.mediaAssetURL=e.Ad.Linear.MediaFile.value,this.nativeCacheListener.commitVastOffer(JSON.stringify(t),r),this.nativeCacheListener.cacheVastAssetForOffer(r,t.mediaAssetURL,!0)},parsingFailed:(i,a)=>{console.debug(`cacheVastOffer:Parsing failed ${i.error.message}`),i.error.code===HyprErrorFactory.getVastTagDownloadError().error.code?t.tag_download_failures+=1:t.tag_parse_failures+=1,this.nativeCacheListener.commitVastOffer(JSON.stringify(t),a),i.error.code===HyprErrorFactory.getVastEmptyTagError().error.code&&t.tag_parse_failures<3&&t.tag_download_failures<3&&this.cacheVastOffer(e,t,r),void 0!==this.eventController&&(i.error.additionalInfo=`Vast tag url: ${t.url}`,this.eventController.onClientErrorEvent(i))}};r.parse(t.url,t.identifier,i)}refreshVastOffer(e,t){console.debug("refreshVastOffer"),t.tag_download_failures=0,t.tag_parse_failures=0,t.media_download_failures=0,delete t.last_parse_date,delete t.vastJSONString,this.nativeCacheListener.commitVastOffer(JSON.stringify(t),t.identifier),this.cacheVastOffer(e,t)}retainVastOffer(e,t){console.debug(`retainVastOffer for ${e.id} with url ${t.mediaAssetURL}`),void 0!==t.vastJSONString?this.nativeCacheListener.cacheVastAssetForOffer(e.id,t.mediaAssetURL,!1):this.cacheVastOffer(e,t)}cachedVastOfferWithDirective(e,t){switch(console.debug(`cachedVastOfferWithDirective -- offerState: ${JSON.stringify(t)}`),e.directive){case"cache":this.cacheVastOffer(e,t);break;case"retain":this.retainVastOffer(e,t);break;case"refresh":this.refreshVastOffer(e,t)}}}globalThis.PreloadController=PreloadController,exports.AD_CLOSED_ACTION=AD_CLOSED_ACTION,exports.AD_PROGRESS_STATE=AD_PROGRESS_STATE,exports.APPSTORE_URL_FALLBACK_PRESENT_BROWSER=APPSTORE_URL_FALLBACK_PRESENT_BROWSER,exports.BANNER_OFFER=BANNER_OFFER,exports.CONSENT_STATUS=CONSENT_STATUS,exports.ConsentController=ConsentController,exports.HYPR_AD_STATE_PROSCENIUM=HYPR_AD_STATE_PROSCENIUM,exports.HYPR_BANNER_ENCODING=HYPR_BANNER_ENCODING,exports.HYPR_BANNER_MIME_TYPE=HYPR_BANNER_MIME_TYPE,exports.HYPR_BANNER_URL=HYPR_BANNER_URL,exports.HYPR_COUNTDOWN_TEXT_KEY=HYPR_COUNTDOWN_TEXT_KEY,exports.HYPR_DEFAULT_ACCEPTABLE_BANNER_SIZE_VARIANCE=HYPR_DEFAULT_ACCEPTABLE_BANNER_SIZE_VARIANCE,exports.HYPR_FINISH_BUTTON_TEXT_KEY=HYPR_FINISH_BUTTON_TEXT_KEY,exports.HYPR_NEXT_BUTTON_TEXT_KEY=HYPR_NEXT_BUTTON_TEXT_KEY,exports.HYPR_TITLE_TEXT_KEY=HYPR_TITLE_TEXT_KEY,exports.HYPR_WEB_VIEW_PROTOCOLS=HYPR_WEB_VIEW_PROTOCOLS,exports.InitializationController=InitializationController,exports.MRAID_OFFER=MRAID_OFFER,exports.OptedOutKey=OptedOutKey,exports.PLACEMENT_TYPE=PLACEMENT_TYPE,exports.PersistentIdKey=PersistentIdKey,exports.Placement=Placement,exports.PlacementController=PlacementController,exports.PreloadController=PreloadController,exports.PresentationController=PresentationController,exports.SKAdNetworkItemsKey=SKAdNetworkItemsKey,exports.TimerController=TimerController,exports.VAST_VIDEO_OFFER=VAST_VIDEO_OFFER,exports.VIEW_MODEL_PREFIX=VIEW_MODEL_PREFIX,exports.WEB_TRAFFIC_OFFER=WEB_TRAFFIC_OFFER,exports.addToArray=addToArray,exports.catalogFrameParametersForPlacement=catalogFrameParametersForPlacement,exports.cdnDomain=cdnDomain,exports.createEventController=createEventController,exports.defaultAdAvailableFor=defaultAdAvailableFor,exports.defaultWebViewReleaseSeconds=defaultWebViewReleaseSeconds,exports.dispatch=dispatch,exports.dispatchToQueue=dispatchToQueue,exports.equalsIgnoreCase=equalsIgnoreCase,exports.initializationHost=initializationHost,exports.initializationPath=initializationPath,exports.isIOS6_0_0=isIOS6_0_0,exports.isValidUrl=isValidUrl,exports.numberOrZero=numberOrZero,exports.parseJSON=parseJSON,Object.defineProperty(exports,"__esModule",{value:!0})}));

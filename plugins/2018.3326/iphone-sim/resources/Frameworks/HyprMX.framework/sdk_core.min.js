!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).sdk_core={})}(this,(function(e){"use strict";class t{constructor(e,t,i,r){this.followRedirect=e,this.readTimeout=t,this.connectionTimeout=i,this.headers=r}}const i="application/json",r="application/json;charset=UTF-8",s=6e4,n=6e4,o={"Content-Type":r},a=new t(!0,s,n,o),l=new t(!0,2e4,2e4,o),d=new t(!0,s,n,{}),c=["app_bound_domains"];class h{static compact(e){const t=JSON.parse(JSON.stringify(e));h.compactHelper(t);for(const i of c)void 0!==e[i]&&(t[i]=e[i]);return t}static compactHelper(e){null!=e&&(this.compactJsonArray(e),Object.keys(e).forEach((t=>{(this.isObject(e[t])||Array.isArray(e[t]))&&this.compactHelper(e[t]),this.isEmpty(e[t])&&delete e[t]})))}static compactJsonArray(e){if(Array.isArray(e)){e.forEach((e=>this.compactHelper(e)));for(let t=Object.keys(e).length-1;t>=0;t-=1)this.isEmpty(e[t])&&e.splice(t,1)}}static isEmpty(e){return!!(null==e||Array.isArray(e)&&0===e.length||this.isObject(e)&&0===Object.keys(e).length||""===e)}static isObject(e){return"[object Object]"===Object.prototype.toString.call(e)}}const u="GET",p="POST",g="PATCH",m="PUT";class f{constructor(){this.requestMap=new Map,this.requestId=0}request(e,t,i,r,s=(()=>{})){const n=this.requestId.toString();return this.prettyLogEvent(!0,n,e,JSON.parse(t||"{}")),this.requestId+=1,HYPRNativeNetworkController.request(n,e,t,i,JSON.stringify(r),"HYPRNetworkController.onNetworkResponse"),this.requestMap[n]=s,n}get(e,t=(()=>{}),i=d){return this.request(e,void 0,u,i,t)}async getAsync(e,t=d){return await new Promise((i=>{this.get(e,((e,t,r,s)=>{i({response:e,body:t,error:r,headers:s})}),t)}))}post(e,t,i=(()=>{}),r=!0,s=a){let n;return n=r?JSON.stringify(h.compact(t)):JSON.stringify(t),this.request(e,n,p,s,i)}async postAsync(e,t,i=a){return await new Promise((r=>{this.post(e,t,((e,t,i,s)=>{r({response:e,body:t,error:i,headers:s})}),!0,i)}))}put(e,t,i=(()=>{}),r=!0,s=a){let n;return n=r?JSON.stringify(h.compact(t)):JSON.stringify(t),this.request(e,n,m,s,i)}abortRequest(e){console.debug(`Network request aborted for ${e}`),HYPRNativeNetworkController.abortRequest(e),this.requestMap[e]=null}onNetworkResponse(e,t){f.validJSONType(t.headers)?this.prettyLogEvent(!1,e,"",JSON.parse(t.body||"{}"),t.headers):console.debug(`Network response received for id: ${e}`);const i=this.requestMap[e];this.requestMap[e]=null,"function"==typeof i&&i(t.code,t.body,t.error,t.headers)}prettyLogEvent(e,t,i,r={},s){const n=JSON.stringify(r,null,2);let o="";"object"==typeof s&&(o=`\nHeaders: ${JSON.stringify(s,null,2)}`);const a=e?`URL: ${i}`:"";console.debug(`\n\nNetwork ${e?"Request":"Response"}: ${t}\n${a}\n Body:\n${n}${o}\n`)}static validResponseStatus(e){return!(e>=400||0===e)}static validXMLType(e){return void 0!==e&&"string"==typeof e["Content-Type"]&&e["Content-Type"].includes("application/xml")}static validHtmlType(e){return void 0!==e&&"string"==typeof e["Content-Type"]&&e["Content-Type"].includes("text/html")}static validJSONType(e){return void 0!==e&&"string"==typeof e["Content-Type"]&&e["Content-Type"].includes("application/json")}static validateResponseBody(e){if(void 0===e)return"Response data not parseable."}}class v{constructor(e,t,i){this.timerId=t,this.callback=i,this.setExpirationDate(e)}setExpirationDate(e){const t=1e3*e;this.expirationDate=new Date((new Date).getTime()+t)}timeLeft(){const e=this.expirationDate-new Date;return e<=0?0:e/1e3}}class b{constructor(){this.timerMap=new Map,this.requestId=0}startTimer(e,t){const i=this.requestId.toString();this.requestId+=1,HYPRNativeTimer.startNativeTimer(i,e,`HYPRTimerController.timeoutComplete('${i}')`);const r=new v(e,i,t);return this.timerMap.set(i,r),i}updateTimeRemaining(e,t){HYPRNativeTimer.updateTimer(e,t);this.timerMap.get(e).setExpirationDate(t)}getTimeLeft(e){if(!this.timerMap.has(e))return;return this.timerMap.get(e).timeLeft()}stopTimer(e){HYPRNativeTimer.stopTimer(e),this.timerMap.delete(e)}timeoutComplete(e){console.debug(`Timeout complete for id ${e}`);const t=this.timerMap.get(e)?.callback;this.timerMap.delete(e),"function"==typeof t&&t()}}globalThis.TimerController=b;const w=parseInt("1.1.3+231".split("+").pop(),10)||0;function P(){return"staging.hyprmx.com"}function A(){return"hyprmx.com"}function S(){return"/v1/initialization"}function C(){return 3600}function y(e){return null==e||"string"==typeof e&&0===e.trim().length}function E(e,t){return"string"==typeof e&&"string"==typeof t&&e.toUpperCase()===t.toUpperCase()}function T(e){return new RegExp(/(http|https):\/\/(\w+:{0,1}\w*)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%!\-/]))?/).test(e)}function _(e){return JSON.parse(JSON.stringify(e))}globalThis.version=function(){return w};const R=e=>e&&"object"==typeof e&&!Array.isArray(e),N=(e,...t)=>{if(!t.length)return e;const i=t.shift();if(R(e)&&R(i))for(const t in i)R(i[t])?(e[t]||Object.assign(e,{[t]:{}}),N(e[t],i[t])):Object.assign(e,{[t]:i[t]});return N(e,...t)};globalThis.HYPREventController=void 0,globalThis.HYPRRequestParameterManager=void 0,globalThis.HYPRBiddingController=void 0,globalThis.HYPRPlacementController=void 0,globalThis.HYPRAudioEventPublisher=void 0,globalThis.HYPRNetworkController=new f;const V=new b;globalThis.HYPRTimerController=V;const O="persistent_id",I="ad_id_opted_out";globalThis.defaultUIComponents={};const k="vast_video",M="mraid",x="web_traffic",F="banner",D="next_button_text",B="finish_button_text",L="title_text",$="countdown_text",U=["http","https","about","file","data"],W="https://live.hyprmx.com/banner_ad",q="text/html",H="utf-8",J={CONSENT_STATUS_UNKNOWN:0,CONSENT_GIVEN:1,CONSENT_DECLINED:2},Y={COMPLETED:"COMPLETED",PAYOUT_COMPLETE:"PAYOUT_COMPLETE",BACKGROUNDED:"BACKGROUNDED",IN_PROGRESS:"IN_PROGRESS"},j={BACK_PRESS:"BACK_PRESS",PRESENT_DIALOG_OK:"PRESENT_DIALOG_OK",ERROR_DIALOG_OK:"ERROR_DIALOG_OK",CANCELLATION_DIALOG_OK:"CANCELLATION_DIALOG_OK",ABORT:"ABORT",NATIVE_CLOSE_BUTTON:"NATIVE_CLOSE_BUTTON",COMPLETE_NO_THANK_YOU:"COMPLETE_NO_THANK_YOU",MRAID_CLOSE:"MRAID_CLOSE",CLOSE_AD:"CLOSE_AD",CRASHED:"CRASHED",WEBVIEW_CRASH:"WEBVIEW_CRASH",UNKNOWN:"UNKNOWN",VAST_VIDEO_DOES_NOT_EXIST:"vastVideoDoesNotExist"};function z(e,t){void 0!==t&&(Array.isArray(t)?e.push(...t):e.push(t))}globalThis.PRESENTATION_STATES={BROWSER:"presentingHyprMXBrowser",OUTSIDE_APP:"presentingDeepLinkOutsideApplication",APP_STORE:"presentingAppStoreOverlay"};const K={TOKEN:"token",USER_ID:"uid",VIEWING_ID:"viewing_id",REWARD_TOKEN:"reward_token",DISTRIBUTOR_ID:"distributor_id",DURATION:"duration"},G={LOADED:"loaded",TIMED_OUT:"timed_out"};globalThis.COMPLETION_URL="",globalThis.DURATION_URL="";class X{constructor(e,t,i,r){this.error={},this.error.message=e,this.error.code=t,this.error.severity=i,this.error.type=r}}const Q=100,Z={UnexpectedSetUp:250,InvalidSetUp:251,InvalidProgressValue:252,InvalidCloseValue:253,InvalidProgressContext:254,InvalidCloseContext:255},ee=300,te="vast_parser_failure",ie="ad_progress_tracking_error";class re{static getVastNoMediaError(){return new X("No valid media files exist",Q,0,te)}static getVastValidateError(){return new X("Could not validate VAST xml",101,4,te)}static getVastNoAdsAvailableError(){return new X("No ad available",102,0,te)}static getVastNoDurationError(){return new X("No duration found for media",103,0,te)}static getVastNoImpressionsError(){return new X("No impressions found for ad",104,0,te)}static getVastAdWithWrapperError(){return new X("Ad with wrapper tag received",105,4,te)}static getVastTagDownloadError(){return new X("Vast TAG failed to download",106,0,te)}static getVastEmptyTagError(){return new X("Vast tag returned empty.  Proxy error.",107,0,te)}static getAdProgressInvalidSetUpError(e,t,i,r){return new X(`Invalid call to AdProgressTracking.setUpTracking with viewingID: ${e} distributorID: ${t} userID: ${i} offerType: ${r}`,Z.InvalidSetUp,3,ie)}static getAdProgressUpdateError(e,t){return new X(e,t,3,ie)}static getBannerContainerSizeMismatchedError(e){return new X(e,ee,3,"banner_error")}}const se="HYPR_AD_PROGRESS_STORAGE_KEY";class ne{constructor(e,t,i,r){const s=[e,t,i,r];for(const n of s)if("string"!=typeof n||0===n.length){const s=re.getAdProgressInvalidSetUpError(e,t,i,r);return globalThis.HYPREventController.onClientErrorEvent(s),void(this.data=void 0)}this.data={},this.data.ad_progress_state=Y.IN_PROGRESS,this.data.ad_closed_action=j.UNKNOWN,this.data.viewing_id=e,this.data.distributor_id=t,this.data.user_id=i,this.data.offer_type=r,this.send(),this.store(),this.adClosedActionSent=!1}send(){if(void 0!==this.data){this.data.ad_progress_timestamp=(new Date).toISOString();const e=JSON.stringify(this.data),t=ne.generateEventCallbackFunction(e);globalThis.HYPREventController.sendAdProgressTracking(e,t)}}store(){let e="";if(void 0!==this.data){const t=JSON.parse(JSON.stringify(this.data));t.ad_closed_action=j.CRASHED,e=JSON.stringify(t),ne.updateStorage(e)}return e}static updateStorage(e=""){hyprMXLocalStorage.setItem(se,e)}setProgressState(e){if(this.adClosedActionSent)return void console.debug(`[APT] Ad progress state change (${e}) received after ad finished. Ignoring.`);if(void 0===this.data)return void console.debug("Cannot update progress state.  Data undefined");if(this.dataUpdateError(e))return;let t=e;void 0!==this.completionState&&e===Y.IN_PROGRESS&&(t=this.completionState),this.data.ad_progress_state=t,this.send(),e===Y.BACKGROUNDED?ne.updateStorage():this.store(),e!==Y.COMPLETED&&e!==Y.PAYOUT_COMPLETE||(this.completionState=e)}dataUpdateError(e,t=!1){const i=t?"closed action":"progress state",r=` (value: ${e}, viewing ID: ${this.data?.viewing_id})`,s=t?"InvalidCloseContext":"InvalidProgressContext",n=t?"InvalidCloseValue":"InvalidProgressValue";let o=`${i} error`,a=0;if(void 0===this.data?(o+=" -- session data undefined",a=Z[s]):t&&void 0!==this.data&&this.data.ad_closed_action!==j.UNKNOWN&&(o+=` -- ad_closed_action already set: ${this.data.ad_closed_action}`,a=Z[s]),(!t&&void 0===Y[e]||t&&(void 0===j[e]||e===j.UNKNOWN))&&(o+=" -- invalid value",a=Z[n]),a>0){o+=r;const e=re.getAdProgressUpdateError(o,a);return globalThis.HYPREventController.onClientErrorEvent(e),!0}return!1}setClosedAction(e){this.adClosedActionSent?console.debug("[APT] Ad closed tracking already sent"):(this.adClosedActionSent=!0,this.dataUpdateError(e,!0)||(this.data.ad_closed_action=e,this.send(),ne.updateStorage()))}static checkStoredData(){const e=hyprMXLocalStorage.getItem(se);if("string"==typeof e&&e.length>0){console.debug("[APT] checkStoredData");const t=ne.generateEventCallbackFunction(e);globalThis.HYPREventController.sendAdProgressTracking(e,t),ne.updateStorage()}}static generateEventCallbackFunction(e){return(t,i)=>{const r=`sent ad progress tracking: ${e}, response: ${JSON.stringify(t)}, error: ${i}`;return console.debug(`[APT] ${r}`),r}}}var oe="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function ae(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var le={exports:{}};
/*!
   * validate.js 0.13.1
   * http://validatejs.org/
   * (c) 2013-2015 Nicklas Ansman, 2013 Wrapp
   * validate.js may be freely distributed under the MIT license.
  */!function(e,t){(function(e,t,i){var r=function(e,t,i){i=s.extend({},s.options,i);var n=s.runValidations(e,t,i);if(n.some((function(e){return s.isPromise(e.error)})))throw new Error("Use validate.async if you want support for promises");return r.processValidationResults(n,i)},s=r;s.extend=function(e){return[].slice.call(arguments,1).forEach((function(t){for(var i in t)e[i]=t[i]})),e},s.extend(r,{version:{major:0,minor:13,patch:1,metadata:null,toString:function(){var e=s.format("%{major}.%{minor}.%{patch}",s.version);return s.isEmpty(s.version.metadata)||(e+="+"+s.version.metadata),e}},Promise:"undefined"!=typeof Promise?Promise:null,EMPTY_STRING_REGEXP:/^\s*$/,runValidations:function(e,t,i){var r,n,o,a,l,d,c,h=[];for(r in(s.isDomElement(e)||s.isJqueryElement(e))&&(e=s.collectFormValues(e)),t)for(n in o=s.getDeepObjectValue(e,r),a=s.result(t[r],o,e,r,i,t)){if(!(l=s.validators[n]))throw c=s.format("Unknown validator %{name}",{name:n}),new Error(c);d=a[n],(d=s.result(d,o,e,r,i,t))&&h.push({attribute:r,value:o,validator:n,globalOptions:i,attributes:e,options:d,error:l.call(l,o,d,r,e,i)})}return h},processValidationResults:function(e,t){e=s.pruneEmptyErrors(e,t),e=s.expandMultipleErrors(e,t),e=s.convertErrorMessages(e,t);var i=t.format||"grouped";if("function"!=typeof s.formatters[i])throw new Error(s.format("Unknown format %{format}",t));return e=s.formatters[i](e),s.isEmpty(e)?void 0:e},async:function(e,t,i){var r=(i=s.extend({},s.async.options,i)).wrapErrors||function(e){return e};!1!==i.cleanAttributes&&(e=s.cleanAttributes(e,t));var n=s.runValidations(e,t,i);return new s.Promise((function(o,a){s.waitForResults(n).then((function(){var l=s.processValidationResults(n,i);l?a(new r(l,i,e,t)):o(e)}),(function(e){a(e)}))}))},single:function(e,t,i){return i=s.extend({},s.single.options,i,{format:"flat",fullMessages:!1}),s({single:e},{single:t},i)},waitForResults:function(e){return e.reduce((function(e,t){return s.isPromise(t.error)?e.then((function(){return t.error.then((function(e){t.error=e||null}))})):e}),new s.Promise((function(e){e()})))},result:function(e){var t=[].slice.call(arguments,1);return"function"==typeof e&&(e=e.apply(null,t)),e},isNumber:function(e){return"number"==typeof e&&!isNaN(e)},isFunction:function(e){return"function"==typeof e},isInteger:function(e){return s.isNumber(e)&&e%1==0},isBoolean:function(e){return"boolean"==typeof e},isObject:function(e){return e===Object(e)},isDate:function(e){return e instanceof Date},isDefined:function(e){return null!=e},isPromise:function(e){return!!e&&s.isFunction(e.then)},isJqueryElement:function(e){return e&&s.isString(e.jquery)},isDomElement:function(e){return!!e&&!(!e.querySelectorAll||!e.querySelector)&&(!(!s.isObject(document)||e!==document)||("object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName))},isEmpty:function(e){var t;if(!s.isDefined(e))return!0;if(s.isFunction(e))return!1;if(s.isString(e))return s.EMPTY_STRING_REGEXP.test(e);if(s.isArray(e))return 0===e.length;if(s.isDate(e))return!1;if(s.isObject(e)){for(t in e)return!1;return!0}return!1},format:s.extend((function(e,t){return s.isString(e)?e.replace(s.format.FORMAT_REGEXP,(function(e,i,r){return"%"===i?"%{"+r+"}":String(t[r])})):e}),{FORMAT_REGEXP:/(%?)%\{([^\}]+)\}/g}),prettify:function(e){return s.isNumber(e)?100*e%1==0?""+e:parseFloat(Math.round(100*e)/100).toFixed(2):s.isArray(e)?e.map((function(e){return s.prettify(e)})).join(", "):s.isObject(e)?s.isDefined(e.toString)?e.toString():JSON.stringify(e):(e=""+e).replace(/([^\s])\.([^\s])/g,"$1 $2").replace(/\\+/g,"").replace(/[_-]/g," ").replace(/([a-z])([A-Z])/g,(function(e,t,i){return t+" "+i.toLowerCase()})).toLowerCase()},stringifyValue:function(e,t){return(t&&t.prettify||s.prettify)(e)},isString:function(e){return"string"==typeof e},isArray:function(e){return"[object Array]"==={}.toString.call(e)},isHash:function(e){return s.isObject(e)&&!s.isArray(e)&&!s.isFunction(e)},contains:function(e,t){return!!s.isDefined(e)&&(s.isArray(e)?-1!==e.indexOf(t):t in e)},unique:function(e){return s.isArray(e)?e.filter((function(e,t,i){return i.indexOf(e)==t})):e},forEachKeyInKeypath:function(e,t,i){if(s.isString(t)){var r,n="",o=!1;for(r=0;r<t.length;++r)switch(t[r]){case".":o?(o=!1,n+="."):(e=i(e,n,!1),n="");break;case"\\":o?(o=!1,n+="\\"):o=!0;break;default:o=!1,n+=t[r]}return i(e,n,!0)}},getDeepObjectValue:function(e,t){if(s.isObject(e))return s.forEachKeyInKeypath(e,t,(function(e,t){if(s.isObject(e))return e[t]}))},collectFormValues:function(e,t){var i,r,n,o,a,l,d={};if(s.isJqueryElement(e)&&(e=e[0]),!e)return d;for(t=t||{},o=e.querySelectorAll("input[name], textarea[name]"),i=0;i<o.length;++i)if(n=o.item(i),!s.isDefined(n.getAttribute("data-ignored"))){var c=n.name.replace(/\./g,"\\\\.");l=s.sanitizeFormValue(n.value,t),"number"===n.type?l=l?+l:null:"checkbox"===n.type?n.attributes.value?n.checked||(l=d[c]||null):l=n.checked:"radio"===n.type&&(n.checked||(l=d[c]||null)),d[c]=l}for(o=e.querySelectorAll("select[name]"),i=0;i<o.length;++i)if(n=o.item(i),!s.isDefined(n.getAttribute("data-ignored"))){if(n.multiple)for(r in l=[],n.options)(a=n.options[r])&&a.selected&&l.push(s.sanitizeFormValue(a.value,t));else{var h=void 0!==n.options[n.selectedIndex]?n.options[n.selectedIndex].value:"";l=s.sanitizeFormValue(h,t)}d[n.name]=l}return d},sanitizeFormValue:function(e,t){return t.trim&&s.isString(e)&&(e=e.trim()),!1!==t.nullify&&""===e?null:e},capitalize:function(e){return s.isString(e)?e[0].toUpperCase()+e.slice(1):e},pruneEmptyErrors:function(e){return e.filter((function(e){return!s.isEmpty(e.error)}))},expandMultipleErrors:function(e){var t=[];return e.forEach((function(e){s.isArray(e.error)?e.error.forEach((function(i){t.push(s.extend({},e,{error:i}))})):t.push(e)})),t},convertErrorMessages:function(e,t){var i=[],r=(t=t||{}).prettify||s.prettify;return e.forEach((function(e){var n=s.result(e.error,e.value,e.attribute,e.options,e.attributes,e.globalOptions);return s.isString(n)?("^"===n[0]?n=n.slice(1):!1!==t.fullMessages&&(n=s.capitalize(r(e.attribute))+" "+n),n=n.replace(/\\\^/g,"^"),n=s.format(n,{value:s.stringifyValue(e.value,t)}),void i.push(s.extend({},e,{error:n}))):void i.push(e)})),i},groupErrorsByAttribute:function(e){var t={};return e.forEach((function(e){var i=t[e.attribute];i?i.push(e):t[e.attribute]=[e]})),t},flattenErrorsToArray:function(e){return e.map((function(e){return e.error})).filter((function(e,t,i){return i.indexOf(e)===t}))},cleanAttributes:function(e,t){function i(e,t,i){return s.isObject(e[t])?e[t]:e[t]=!!i||{}}return s.isObject(t)&&s.isObject(e)?(t=function(e){var t,r={};for(t in e)e[t]&&s.forEachKeyInKeypath(r,t,i);return r}(t),function e(t,i){if(!s.isObject(t))return t;var r,n,o=s.extend({},t);for(n in t)r=i[n],s.isObject(r)?o[n]=e(o[n],r):r||delete o[n];return o}(e,t)):{}},exposeModule:function(e,t,i,r,s){i?(r&&r.exports&&(i=r.exports=e),i.validate=e):(t.validate=e,e.isFunction(s)&&s.amd&&s([],(function(){return e})))},warn:function(e){"undefined"!=typeof console&&console.warn&&console.warn("[validate.js] "+e)},error:function(e){"undefined"!=typeof console&&console.error&&console.error("[validate.js] "+e)}}),r.validators={presence:function(e,t){if(!1!==(t=s.extend({},this.options,t)).allowEmpty?!s.isDefined(e):s.isEmpty(e))return t.message||this.message||"can't be blank"},length:function(e,t,i){if(s.isDefined(e)){var r,n=(t=s.extend({},this.options,t)).is,o=t.maximum,a=t.minimum,l=t.tokenizer||function(e){return e},d=[],c=(e=l(e)).length;return s.isNumber(c)?(s.isNumber(n)&&c!==n&&(r=t.wrongLength||this.wrongLength||"is the wrong length (should be %{count} characters)",d.push(s.format(r,{count:n}))),s.isNumber(a)&&c<a&&(r=t.tooShort||this.tooShort||"is too short (minimum is %{count} characters)",d.push(s.format(r,{count:a}))),s.isNumber(o)&&c>o&&(r=t.tooLong||this.tooLong||"is too long (maximum is %{count} characters)",d.push(s.format(r,{count:o}))),d.length>0?t.message||d:void 0):t.message||this.notValid||"has an incorrect length"}},numericality:function(e,t,i,r,n){if(s.isDefined(e)){var o,a,l=[],d={greaterThan:function(e,t){return e>t},greaterThanOrEqualTo:function(e,t){return e>=t},equalTo:function(e,t){return e===t},lessThan:function(e,t){return e<t},lessThanOrEqualTo:function(e,t){return e<=t},divisibleBy:function(e,t){return e%t==0}},c=(t=s.extend({},this.options,t)).prettify||n&&n.prettify||s.prettify;if(s.isString(e)&&t.strict){var h="^-?(0|[1-9]\\d*)";if(t.onlyInteger||(h+="(\\.\\d+)?"),h+="$",!new RegExp(h).test(e))return t.message||t.notValid||this.notValid||this.message||"must be a valid number"}if(!0!==t.noStrings&&s.isString(e)&&!s.isEmpty(e)&&(e=+e),!s.isNumber(e))return t.message||t.notValid||this.notValid||this.message||"is not a number";if(t.onlyInteger&&!s.isInteger(e))return t.message||t.notInteger||this.notInteger||this.message||"must be an integer";for(o in d)if(a=t[o],s.isNumber(a)&&!d[o](e,a)){var u="not"+s.capitalize(o),p=t[u]||this[u]||this.message||"must be %{type} %{count}";l.push(s.format(p,{count:a,type:c(o)}))}return t.odd&&e%2!=1&&l.push(t.notOdd||this.notOdd||this.message||"must be odd"),t.even&&e%2!=0&&l.push(t.notEven||this.notEven||this.message||"must be even"),l.length?t.message||l:void 0}},datetime:s.extend((function(e,t){if(!s.isFunction(this.parse)||!s.isFunction(this.format))throw new Error("Both the parse and format functions needs to be set to use the datetime/date validator");if(s.isDefined(e)){var i,r=[],n=(t=s.extend({},this.options,t)).earliest?this.parse(t.earliest,t):NaN,o=t.latest?this.parse(t.latest,t):NaN;return e=this.parse(e,t),isNaN(e)||t.dateOnly&&e%864e5!=0?(i=t.notValid||t.message||this.notValid||"must be a valid date",s.format(i,{value:arguments[0]})):(!isNaN(n)&&e<n&&(i=t.tooEarly||t.message||this.tooEarly||"must be no earlier than %{date}",i=s.format(i,{value:this.format(e,t),date:this.format(n,t)}),r.push(i)),!isNaN(o)&&e>o&&(i=t.tooLate||t.message||this.tooLate||"must be no later than %{date}",i=s.format(i,{date:this.format(o,t),value:this.format(e,t)}),r.push(i)),r.length?s.unique(r):void 0)}}),{parse:null,format:null}),date:function(e,t){return t=s.extend({},t,{dateOnly:!0}),s.validators.datetime.call(s.validators.datetime,e,t)},format:function(e,t){(s.isString(t)||t instanceof RegExp)&&(t={pattern:t});var i,r=(t=s.extend({},this.options,t)).message||this.message||"is invalid",n=t.pattern;if(s.isDefined(e))return s.isString(e)?(s.isString(n)&&(n=new RegExp(t.pattern,t.flags)),(i=n.exec(e))&&i[0].length==e.length?void 0:r):r},inclusion:function(e,t){if(s.isDefined(e)&&(s.isArray(t)&&(t={within:t}),t=s.extend({},this.options,t),!s.contains(t.within,e))){var i=t.message||this.message||"^%{value} is not included in the list";return s.format(i,{value:e})}},exclusion:function(e,t){if(s.isDefined(e)&&(s.isArray(t)&&(t={within:t}),t=s.extend({},this.options,t),s.contains(t.within,e))){var i=t.message||this.message||"^%{value} is restricted";return s.isString(t.within[e])&&(e=t.within[e]),s.format(i,{value:e})}},email:s.extend((function(e,t){var i=(t=s.extend({},this.options,t)).message||this.message||"is not a valid email";if(s.isDefined(e))return s.isString(e)&&this.PATTERN.exec(e)?void 0:i}),{PATTERN:/^(?:[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i}),equality:function(e,t,i,r,n){if(s.isDefined(e)){s.isString(t)&&(t={attribute:t});var o=(t=s.extend({},this.options,t)).message||this.message||"is not equal to %{attribute}";if(s.isEmpty(t.attribute)||!s.isString(t.attribute))throw new Error("The attribute must be a non empty string");var a=s.getDeepObjectValue(r,t.attribute),l=t.comparator||function(e,t){return e===t},d=t.prettify||n&&n.prettify||s.prettify;return l(e,a,t,i,r)?void 0:s.format(o,{attribute:d(t.attribute)})}},url:function(e,t){if(s.isDefined(e)){var i=(t=s.extend({},this.options,t)).message||this.message||"is not a valid url",r=t.schemes||this.schemes||["http","https"],n=t.allowLocal||this.allowLocal||!1,o=t.allowDataUrl||this.allowDataUrl||!1;if(!s.isString(e))return i;var a="^(?:(?:"+r.join("|")+")://)(?:\\S+(?::\\S*)?@)?(?:",l="(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))";if(n?l+="?":a+="(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})",a+="(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*"+l+")(?::\\d{2,5})?(?:[/?#]\\S*)?$",o){a="(?:"+a+")|(?:^data:(?:\\w+\\/[-+.\\w]+(?:;[\\w=]+)*)?(?:;base64)?,[A-Za-z0-9-_.!~\\*'();\\/?:@&=+$,%]*$)"}return new RegExp(a,"i").exec(e)?void 0:i}},type:s.extend((function(e,t,i,r,n){if(s.isString(t)&&(t={type:t}),s.isDefined(e)){var o,a=s.extend({},this.options,t),l=a.type;if(!s.isDefined(l))throw new Error("No type was specified");if(o=s.isFunction(l)?l:this.types[l],!s.isFunction(o))throw new Error("validate.validators.type.types."+l+" must be a function.");if(!o(e,a,i,r,n)){var d=t.message||this.messages[l]||this.message||a.message||(s.isFunction(l)?"must be of the correct type":"must be of type %{type}");return s.isFunction(d)&&(d=d(e,t,i,r,n)),s.format(d,{attribute:s.prettify(i),type:l})}}}),{types:{object:function(e){return s.isObject(e)&&!s.isArray(e)},array:s.isArray,integer:s.isInteger,number:s.isNumber,string:s.isString,date:s.isDate,boolean:s.isBoolean},messages:{}})},r.formatters={detailed:function(e){return e},flat:s.flattenErrorsToArray,grouped:function(e){var t;for(t in e=s.groupErrorsByAttribute(e))e[t]=s.flattenErrorsToArray(e[t]);return e},constraint:function(e){var t;for(t in e=s.groupErrorsByAttribute(e))e[t]=e[t].map((function(e){return e.validator})).sort();return e}},r.exposeModule(r,this,e,t,i)}).call(oe,t,e,null)}(le,le.exports);var de=ae(le.exports);class ce{static parseJSON(e){let t;try{t=JSON.parse(e)}catch(t){console.error(`Error parsing json string (${e}) with error ${t}`)}return t}static hasRequiredKeys(e={},t=[],i="string"){let r;r="url"===i?e=>ce.urlValidation(e):e=>ce.typeValidation(e,i);for(const i of t)if(void 0===e[i]||!r(e[i]))return!1;return!0}static typeValidation(e,t){return typeof e===t}static urlValidation(e,t=["https","http","localhost","data","file"]){return void 0===de({website:e},{website:{url:{schemes:t}}})}}class he{constructor(e,t,i,r,s,n,o,a,l=globalThis.HYPRNetworkController,d=HYPRRequestParameterManager){this.adImpressionTrackingUrl=e,this.userInfoTrackingUrl=t,this.webTrafficVisitUrl=i,this.noAdTrackingUrl=n,this.networkRequestController=l,this.errorReportingURL=r,this.errorSeverityLevel=s,this.adProgressUrl=o,this.durationTrackingUrl=a,this.requestParameterManager=d,this.webTrafficVisitInfo={}}sendAdProgressTracking(e,t){void 0!==e&&void 0!==this.adProgressUrl&&this.networkRequestController.post(this.adProgressUrl,JSON.parse(e),t)}async sendWebTrafficVisitEvent(e,t,i){const r={};r.url=e,r.viewing_id=t,r.wtu_id=i;const{code:s,body:n,error:o}=await this.networkRequestController.postAsync(this.webTrafficVisitUrl,r),a=ce.parseJSON(n);void 0===o&&f.validResponseStatus(s)&&void 0!==a&&void 0!==a.id?this.recordWebTrafficVisitInfo(e,a.id):console.error(`[EC] sendWebTrafficVisitEvent error received: ${o}`)}recordWebTrafficVisitInfo(e,t){this.webTrafficVisitInfo[e]=t}sendWebTrafficTimeSpent(e,t){const i=this.webTrafficVisitInfo[e];if(void 0===i)return void console.error("[EC] Cannot find id for WTTS");const r=`${this.webTrafficVisitUrl}/${i}`;this.networkRequestController.request(r,t,g,a)}sendNoAdTracking(e){this.sendTrackingEventWithParams(e,this.noAdTrackingUrl)}sendAdImpressionTrackingEvent(e,t){this.sendTrackingEventWithParams(e,this.adImpressionTrackingUrl,t)}sendUserInfoTrackingEvent(e,t,i){this.sendTrackingEventWithParams(e,this.userInfoTrackingUrl,i,he.extractPrequalQuestionNames(t))}sendPixelTrackingEvents(e=[]){for(const t of e)console.debug(`[EC] firing impression url: ${t}`),this.networkRequestController.get(t)}static extractPrequalQuestionNames(e){return{questions_shown:JSON.parse(e).map((e=>e.Name))}}sendTrackingEventWithParams(e,t,i,r){const s=void 0!==i?i.getAdIdentifier():"",n=void 0!==i?i.getAdType():e.getAdType();let o={placement_id:e.id,offer_identifier:s,offer_type:n};console.debug(`[EC] Requesting additional trackings params for: ${JSON.stringify(o)}`);const a=this.requestParameterManager.getTrackingParams();Object.assign(o,a),void 0!==r&&(o=Object.assign(o,r)),console.debug(`[EC] Sending trackings to ${t}`),this.networkRequestController.post(t,o)}onClientErrorEvent(e,t){const{message:i,severity:r,type:s}=e.error;if(r<this.errorSeverityLevel)return;const n=this.requestParameterManager.getErrorParams();n.errorTypeKey=s,n.errorMessage=i,void 0!==t&&(n.value=t),console.debug(`[EC] Sending CEC to ${this.errorReportingURL} with params: ${JSON.stringify(n)}`),this.networkRequestController.post(this.errorReportingURL,n)}sendDurationUpdateTracking(e,t,i){const r={};r[K.DURATION]=t,r.distributorid=this.requestParameterManager.getDistributorID(),r[K.USER_ID]=this.requestParameterManager.getUserId(),r[K.TOKEN]=e,this.networkRequestController.put(`${this.durationTrackingUrl}/${i}`,r)}}const ue={REWARDED:"rewarded",INTERSTITIAL:"interstitial",BANNER:"banner"};class pe{constructor(e,t,i,r,s,n=globalThis.HYPRNetworkController,o=globalThis.HYPRTimerController,a=HYPRConsentController,l=HYPRRequestParameterManager){this.id=e,this.name=t,this.type=i,this.inventoryCheckURL=r,this.networkRequestController=n,this.timerController=o,this.consentController=a,this.placementListener=s,this.requestParameterManager=l,this.request=void 0,this.imp=void 0}loadAd(e,t){}inventoryCheckCallback(e,t,i,r){}processResponse(e,t,i,r=!1){}loadBidResponse(e){return this.request&&this.request.abort(),this.clearAdAndStopAdAvailableTimer(),this.processResponse(200,ce.parseJSON(e),void 0),this.request=void 0,!!this.isAdAvailable()&&(this.startAdAvailableTimer(),!0)}isAdAvailable(){return!1}getAdType(){return""}getUIComponentsString(){return"{}"}clearAdAndStopAdAvailableTimer(e=!1){}startAdAvailableTimer(){}handleRefresh(e,t){}isEqualToPlacement(e){return this.id===e.id}compileRequestParamsFromParams(e={},t=!0,i=this.ad){return e.placement_id=this.id,e}appStoreSignatureParams(e,t){const i=this.requestParameterManager.getTrackingParams();return{app_store_params:e,device_os_version:i.device_os_version,bundle_id:i.bundle_id,distributor_id:i.distributor_id,placement_id:this.id,offer:t.getOfferName(),msdkv:i.msdkv,mobile_js_version:globalThis.version(),xcode_version:i.xcode_version}}getOfferName(){return""}isFullscreenAdType(){return this.type===ue.REWARDED||this.type===ue.INTERSTITIAL}isBannerAdType(){return this.type===ue.BANNER}getBrowserDurationUrl(){return""}toString(){return`[id=${this.id}, name=${this.name}, type=${this.type}, inventoryCheckURL=${this.inventoryCheckURL}, ad=${JSON.stringify(this.ad)}]`}}class ge{constructor(e={}){Object.assign(this,e),void 0===this.webview_release_in_seconds&&(this.webview_release_in_seconds=0),void 0===this.force_status_bar_display&&(this.force_status_bar_display=this.type===x&&"portrait"===this.allowed_orientation)}static fromAdsArray(e=[]){const t=e.shift();if("object"==typeof t&&ce.hasRequiredKeys(t,["id","type"],"string")&&ce.hasRequiredKeys(t,["offer_initiation_timeout_in_seconds"],"number")&&ce.hasRequiredKeys(t,["catalog_frame_url"],"url"))return new ge(t)}appendRequestData(e,t){return t?this.relay_promise_token&&Object.assign(e,{last_promise_token:this.getAdRewardToken()}):Object.assign(e,{reward_token:this.getAdRewardToken(),offer:this.getOfferName()}),e}getAdType(){return this.type||""}getAdIdentifier(){return this.id||""}hasAd(){return""!==this.getAdIdentifier()}getOfferName(){return`${this.getAdType()}-${this.getAdIdentifier()}`}getAdString(){return JSON.stringify(this)}getAdRewardText(){return this.reward_text||""}getAdRewardQuantity(){return this.reward_quantity||0}getAdRewardToken(){return this.reward_token||""}isNavigationRuleMatch(e){return!("string"!=typeof e||"string"!=typeof this.navigation_rule||this.navigation_rule.length<1)&&null!==e.match(new RegExp(this.navigation_rule,"i"))}shouldAppStoreUseOverlay(){return!0===this.use_skoverlay}openClickInNativeBrowser(){return void 0!==this.click&&"native"===this.click.mode}getClickMode(){return this.click?.mode||"webview"}}const me="consentChanged";class fe extends pe{constructor(...e){super(...e),this.refreshRequest=void 0,this.canShowFor=void 0}loadAd(e,t){if(this.refreshInProgress())return void this.placementListener.onLoadAdResponse(this,void 0);void 0!==this.secondaryRefreshInfo&&(console.error(`Load ad started with a secondaryRefreshInfo still set: ${JSON.stringify(this.secondaryRefreshInfo)}`),this.secondaryRefreshInfo=void 0);const i=this.compileRequestParamsFromParams(e);this.clearAdAndStopAdAvailableTimer(),console.debug(`Loading ads for ${this}`),this.request=this.networkRequestController.post(this.inventoryCheckURL,i,((e,i,r)=>{this.inventoryCheckCallback(e,i,r,t)}))}inventoryCheckCallback(e,t,i,r){f.validResponseStatus(e)&&void 0===i||console.debug(`Loading ads completed for placement: ${this} with status code ${e} and with error: ${i}`);const s=ce.parseJSON(t);this.processResponse(e,s,i),this.request=void 0,this.isAdAvailable()&&this.startAdAvailableTimer(),r(this,i)}processResponse(e,t,i,r=!1){let s=!1;if(f.validResponseStatus(e)&&void 0===i&&this.validResponse(t)){s=fe.responseHasAd(t);const e=ge.fromAdsArray(t.ads_available);r&&void 0===e||(this.ad=e),this.required_information=t.required_information||[],void 0!==t.ui_components&&(this.ui_components=t.ui_components),r||(this.ads_to_preload=t.ads_to_preload)}return s}validResponse(e){return void 0!==e&&ce.hasRequiredKeys(e,["ads_available"],"object")}isAdAvailable(){return this.hasRequiredInformation()||void 0!==this.ad&&this.ad.hasAd()}startAdAvailableTimer(){void 0!==this.ad&&(this.canShowFor=this.ad.available_for),void 0===this.canShowFor&&(this.canShowFor=3600),console.debug(`FullScreenPlacement.startAdAvailableTimer(${this.name}) for ${this.canShowFor} seconds`),this.adAvailableTimer=this.timerController.startTimer(1e3*this.canShowFor,(()=>{this.clearAdAndStopAdAvailableTimer(!0)}))}stopAdAvailableTimer(){this.adAvailableTimerIsActive()&&(console.debug(`FullScreenPlacement.stopAdAvailableTimer(${this.name})`),this.timerController.stopTimer(this.adAvailableTimer),this.canShowFor=void 0,this.adAvailableTimer=void 0)}clearAd(){console.debug(`FullScreenPlacement.clearAd(${this.name})`),this.ad=void 0,this.required_information=void 0,this.ads_to_preload=void 0,this.ui_components=void 0}clearRequiredInfo(){this.required_information=void 0}clearAdsToPreload(){this.ads_to_preload=void 0}popAdData(){const{ad:e}=this,t=this.required_information||[],i=this.ui_components;return this.clearAdAndStopAdAvailableTimer(),{ad:e,requiredInfo:t,uiComponents:i}}clearAdAndStopAdAvailableTimer(e=!1){console.debug(`FullScreenPlacement.clearAdAndStopTimer(${this.name})`),void 0!==this.request&&(this.networkRequestController.abortRequest(this.request),this.request=void 0),this.stopAdAvailableTimer(),this.clearAd(),this.placementListener&&!this.refreshInProgress()&&(this.placementListener.onPlacementAdCleared(this),e&&this.placementListener.onPlacementAdExpired(this))}handleRefresh(e,t){if(this.adAvailableTimerIsActive()){if(this.refreshInProgress()){console.debug(`Refresh in progress for placement ${this.name} with request ${this.refreshRequest}`);const t=void 0!==this.secondaryRefreshInfo?this.secondaryRefreshInfo.context:"",i={};return i.context=t===me?me:e,void(this.secondaryRefreshInfo=i)}console.debug(`Refresh started for placement: ${this} with context: ${e}`),e===me&&this.clearAd(),this.clearRequiredInfo(),this.clearAdsToPreload(),this.refreshAd(t)}}refreshAd(e){const t=this.compileRequestParamsFromParams(e);console.debug(`refresh params are: ${JSON.stringify(t)}`),this.refreshRequest=this.networkRequestController.post(this.inventoryCheckURL,t,((e,t,i)=>{this.refreshAdCallback(e,t,i)}))}refreshAdCallback(e,t,i){i?console.debug(`Refresh completed for placement: ${this} with code ${e}, and error ${i}`):console.debug(`Refresh completed for placement: ${this} with code ${e}`),this.refreshRequest=void 0;const r=ce.parseJSON(t),s=this.processResponse(e,r,i,!0),n=void 0!==this.ad?this.ad.getAdIdentifier():"";if(s)console.debug((n.length>0?`Refreshed with ad id: ${n}. `:"Refreshed with new RequiredInfo. ")+"Restarted timer."),this.stopAdAvailableTimer(),this.startAdAvailableTimer();else{if(!this.adAvailableTimerIsActive())return console.debug("Refreshed completed with no ad and timer has ended"),this.placementListener.onPlacementAdCleared(this),void this.placementListener.onPlacementAdExpired(this);console.debug(`Refreshed completed with no new ad. Current ad id is: ${n}.  Timer still active.`)}this.placementListener.onRefreshAdResponse(this,i),this.secondaryRefreshInfo&&(console.debug(`Starting secondary refresh for Context: ${this.secondaryRefreshInfo.context}`),this.placementListener.startAdRefresh(this.secondaryRefreshInfo.context,this.name),this.secondaryRefreshInfo=void 0)}static responseHasAd(e){return void 0!==e&&(void 0!==e.ads_available&&e.ads_available.length>0||void 0!==e.required_information&&e.required_information.length>0)}refreshInProgress(){return void 0!==this.refreshRequest}adAvailableTimerIsActive(){return void 0!==this.adAvailableTimer}hasRequiredInformation(){return void 0!==this.required_information&&this.required_information.length>0}hasUIComponents(){return void 0!==this.ui_components&&Object.keys(this.ui_components).length>0}getAdType(){return void 0!==this.ad?this.ad?.getAdType():super.getAdType()}getOfferName(){return void 0!==this.ad?this.ad?.getOfferName():super.getOfferName()}getRequiredInfoString(){return this.hasRequiredInformation()?JSON.stringify(this.required_information):"[]"}getUIComponentsString(){const e=this.hasUIComponents()?this.ui_components:globalThis.defaultUIComponents;return void 0===e.no_ad&&(e.no_ad=fe.noAdDefaultUI()),JSON.stringify(e)}compileRequestParamsFromParams(e={},t=!0,i=this.ad){const r=super.compileRequestParamsFromParams(e,t,i);return i?.appendRequestData(r,t),this.requestParameterManager.getInventoryCheckParams(r)}static noAdDefaultUI(){const e={title:"This ad is not available based on your response. Close to continue.",title_color:"282828",title_size:16};return e}toString(){return`${super.toString()}, isAdAvailable=${this.isAdAvailable()}, canShowFor=${this.canShowFor}]`}}const ve="function"==typeof atob,be="function"==typeof btoa,we="function"==typeof Buffer,Pe="function"==typeof TextDecoder?new TextDecoder:void 0,Ae="function"==typeof TextEncoder?new TextEncoder:void 0,Se=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),Ce=(e=>{let t={};return e.forEach(((e,i)=>t[e]=i)),t})(Se),ye=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,Ee=String.fromCharCode.bind(String),Te="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),_e=e=>e.replace(/=/g,"").replace(/[+\/]/g,(e=>"+"==e?"-":"_")),Re=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),Ne=e=>{let t,i,r,s,n="";const o=e.length%3;for(let o=0;o<e.length;){if((i=e.charCodeAt(o++))>255||(r=e.charCodeAt(o++))>255||(s=e.charCodeAt(o++))>255)throw new TypeError("invalid character found");t=i<<16|r<<8|s,n+=Se[t>>18&63]+Se[t>>12&63]+Se[t>>6&63]+Se[63&t]}return o?n.slice(0,o-3)+"===".substring(o):n},Ve=be?e=>btoa(e):we?e=>Buffer.from(e,"binary").toString("base64"):Ne,Oe=we?e=>Buffer.from(e).toString("base64"):e=>{let t=[];for(let i=0,r=e.length;i<r;i+=4096)t.push(Ee.apply(null,e.subarray(i,i+4096)));return Ve(t.join(""))},Ie=e=>{if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?Ee(192|t>>>6)+Ee(128|63&t):Ee(224|t>>>12&15)+Ee(128|t>>>6&63)+Ee(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return Ee(240|t>>>18&7)+Ee(128|t>>>12&63)+Ee(128|t>>>6&63)+Ee(128|63&t)},ke=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,Me=e=>e.replace(ke,Ie),xe=we?e=>Buffer.from(e,"utf8").toString("base64"):Ae?e=>Oe(Ae.encode(e)):e=>Ve(Me(e)),Fe=(e,t=!1)=>t?_e(xe(e)):xe(e),De=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,Be=e=>{switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return Ee(55296+(t>>>10))+Ee(56320+(1023&t));case 3:return Ee((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return Ee((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},Le=e=>e.replace(De,Be),$e=e=>{if(e=e.replace(/\s+/g,""),!ye.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(3&e.length));let t,i,r,s="";for(let n=0;n<e.length;)t=Ce[e.charAt(n++)]<<18|Ce[e.charAt(n++)]<<12|(i=Ce[e.charAt(n++)])<<6|(r=Ce[e.charAt(n++)]),s+=64===i?Ee(t>>16&255):64===r?Ee(t>>16&255,t>>8&255):Ee(t>>16&255,t>>8&255,255&t);return s},Ue=ve?e=>atob(Re(e)):we?e=>Buffer.from(e,"base64").toString("binary"):$e,We=we?e=>Te(Buffer.from(e,"base64")):e=>Te(Ue(e).split("").map((e=>e.charCodeAt(0)))),qe=we?e=>Buffer.from(e,"base64").toString("utf8"):Pe?e=>Pe.decode(We(e)):e=>Le(Ue(e)),He=e=>Re(e.replace(/[-_]/g,(e=>"-"==e?"+":"/"))),Je=e=>qe(He(e)),Ye=Fe,je=Je;class ze{constructor(e=globalThis.HYPRPlacementController,t=HYPRRequestParameterManager){this.placementController=e,this.requestParameterManager=t}getSessionToken(){return encodeURI(Ye(this.requestParameterManager.getCompressedParameters()))}loadBid(e,t){const i=this.placementController.getPlacement(e),r=je(decodeURI(t));return i.loadBidResponse(r)}}const Ke="webview",Ge="native",Xe="CLICK_REPORTING_URL";class Qe{static wrapperHtml='\n  <html>\n  <head>\n    <meta name="viewport" content="width=device-width" />\n    <style type="text/css">\n      html,\n      body {\n        margin: 0;\n        padding: 0;\n        width: 100%;\n        height: 100%;\n      }\n      html {\n        display: table;\n      }\n      body {\n        display: table-cell;\n        vertical-align: middle;\n        text-align: center;\n      }\n    </style>\n  </head>\n  <body>\n    BANNER_ADM\n  </body>\n  </html>\n  ';constructor(e={},t=Ke){if(0===Object.keys(e).length)return;const i=e.seatbid||[];if(i.length<1)return;const r=i[0]||[];if(r.length<1)return;const s=r.bid[0]||{};this.id=s.id,this.impid=s.impid,y(s.adm)?this.ad_html="":this.ad_html=Qe.wrapperHtml.replace("BANNER_ADM",s.adm),this.hyprAd=void 0!==s.ext?.hyprmx;const n=s.ext?.hyprmx||{};this.audioAd=n?.audio_ad||!1,this.offerId=n?.offer_id||"",this.clickMode=n?.click?.mode||t,this.onPageJS=n?.click?.on_page_load_js||"",this.clickReportingUrl=n?.click_reporting_url,this.timeOnSiteUrl=n?.time_on_site_url,this.acceptableAdSizeVariance=n.acceptable_ad_size_variance||1,this.isHyprAd()?(console.debug("[BA] Hypr ad detected."),this.impressionUrl=s.burl):(console.debug("[BA] Prebid ad detected."),this.impressionUrl=s.ext?.prebid?.events?.imp,this.winUrl=s.ext?.prebid?.events?.win,console.debug(`[BA] Prebid ad.  imp url is ${this.impressionUrl}`),console.debug(`[BA] Prebid ad.  win url is ${this.winUrl}`))}isHyprAd(){return this.hyprAd}hasImpressionId(){return"string"==typeof this.impid&&this.impid.length>0}getImpressionUrl(){return this.impressionUrl}getWinUrl(){return this.winUrl}getClickReportingUrl(){return this.clickReportingUrl}getTimeOnSiteUrl(){return this.timeOnSiteUrl}hasAd(){return"string"==typeof this.ad_html&&this.ad_html.length>0}shouldAppStoreUseOverlay(){return!1}openClickInNativeBrowser(){return"native"===this.clickMode}getOfferName(){return this.offerId}getClickMode(){return this.clickMode||"webview"}isAudioAd(){return this.audioAd}}class Ze extends pe{constructor(e,t,i,r,s,n,o=globalThis.HYPRNetworkController,a=globalThis.HYPRTimerController,l=HYPRConsentController,d=HYPRRequestParameterManager){super(e,t,i,r,s,o,a,l,d),this.ad=new Qe,this.rtbParameterBuilder=n,this.rtbClickMode=Ke}loadAd(e,t){console.debug("[BP] loadAd for banner"),this.imp=void 0,console.debug(`[BP] Loading ads for ${this}`);const i=this.rtbParameterBuilder(e,this.id);this.rtbClickMode=1===i.imp[0]?.clickbrowser?Ge:Ke,this.request=this.networkRequestController.post(this.inventoryCheckURL,i,((e,r,s)=>{this.bannerLoadCallback(e,r,s,i.imp,t)}))}getBannerImpressionSize(){return void 0!==this.imp&&this.imp[0]?this.imp[0].banner:{}}getImpressionUrl(){return this.ad?.getImpressionUrl()}getWinUrl(){return this.ad?.getWinUrl()}getClickReportingUrl(){return this.ad?.getClickReportingUrl()}getTimeOnSiteUrl(){return this.ad?.getTimeOnSiteUrl()}bannerLoadCallback(e,t,i,r,s){let n=i;void 0!==n?console.debug(`[BP] Loading ads received error for placement: ${this} with status code ${e} and error: ${n}`):f.validResponseStatus(e)?console.debug(`[BP] Loading ads completed for placement: ${this}`):(console.debug(`[BP] Loading ads received invalid status code for placement: ${this} with status code ${e}`),n=`Invalid status code ${e}`),this.imp=r;const o=ce.parseJSON(t);this.processResponse(e,o,n),s(this,n),this.request=void 0}getOfferName(){return void 0!==this.ad?this.ad.offerId:super.getOfferName()}getImpressionId(){return void 0!==this.ad?this.ad.impid:""}isHyprAd(){return void 0!==this.ad&&this.ad.isHyprAd()}getAdType(){return F}isAdAvailable(){return void 0!==this.ad&&this.ad.hasImpressionId()&&this.ad.hasAd()}processResponse(e,t,i,r=!1){f.validResponseStatus(e)&&void 0===i&&void 0!==t&&(this.ad=new Qe(t,this.rtbClickMode))}}function et(e=globalThis.HYPRNativeAudioListener){if(void 0===e)return{};return{outputVolume:e.getVolume(),isMuted:e.getIsMuted(),audioCategory:e.getAudioCategory()}}function tt(e){let t;switch(e.getConnectionType()){case"Ethernet":t=1;break;case"WIFI":t=2;break;case"NR":t=3;break;case"CDMA":case"CDMA - EvDo rev. 0":case"CDMA - EvDo rev. A":case"CDMA - EvDo rev. B":case"CDMA - 1xRTT":case"CDMA - eHRPD":case"EDGE":t=4;break;case"GPRS":case"UMTS":case"HSPA":case"HSDPA":case"HSPA+":case"HSUPA":case"GSM":case"3G":t=5;break;case"LTE_CA":case"LTE":t=6;break;default:t=0}const i={connectiontype:t};if(void 0===e.getCarriers())return i;const r=JSON.parse(e.getCarriers()),s=Object.keys(r).sort();if(s.length>0){const e=r[s[0]];i.carrier=e.carrier_name,i.mccmnc=`${e.mobile_country_code},${e.mobile_network_code}`}return i}class it{static addStatus(e={}){if("object"==typeof HYPRTransparencyTrackingManager){const t=HYPRTransparencyTrackingManager.getTrackingPermissionStatus();console.debug(`TransparencyTracking received status of ${t}`),e.privacy_tracking_status=t}return e}static canPrompt(e={}){const t="object"==typeof HYPRTransparencyTrackingManager&&void 0!==e.enable_tracking_prompt&&e.enable_tracking_prompt&&"not_determined"===HYPRTransparencyTrackingManager.getTrackingPermissionStatus();return console.debug(`TransparencyTracking.canPrompt result: ${t}`),t}static prompt(e){if(void 0===e||e.length<1)throw new Error("No callback supplied to Transparency Tracking prompt");console.debug("TransparencyTracking will present prompt to user."),HYPRTransparencyTrackingManager.promptForTrackingPermissionWithCallback(e)}}const rt="distributor_id",st="uid",nt="bundle_id",ot="bundle_version",at="ats_settings",lt="supported_interface_settings",dt="xcode_version",ct="mobile_js_version",ht="identifier_for_vendor",ut="permissions",pt="msdkv",gt="sdk_version",mt="device_type",ft="device_model",vt="device_os_version",bt="connection_type",wt="carrier_data",Pt="persistent_id",At="preloaded_mraid_ads",St="low_power_enabled",Ct="privacy_tracking_status",yt="screen_traits",Et="supports_multiple_scenes",Tt="maccatalyst",_t="ios_app_on_mac",Rt="device_width",Nt="device_height",Vt="pxratio",Ot="age_restricted_user",It="ad_id_opted_out",kt="preloaded_ads",Mt="cleartext_traffic_permitted",xt="SKAdNetworkItems",Ft="platform",Dt="device_fingerprint",Bt="device_product",Lt="device_manufacturer",$t="device_brand",Ut="device",Wt="supports_multiwindow",qt="consent",Ht="android_id",Jt="gaid",Yt="target_sdk_version",jt="placement_id";class zt{constructor(e,t=HYPRConsentController,i=HYPRRequestParamListener){this.consentController=t,e.preloaded_ads?this.vastStateCache=JSON.stringify(e.preloaded_ads):this.vastStateCache="[]",this.uid=void 0,this.distributorID=void 0,this.nativeParams=i,this.preloadController=void 0}setPreloadController(e){this.preloadController=e}getInitializationParams(){let e=this.baseParameters();return e=Object.assign(e,JSON.parse(this.nativeParams.getUnityParams())),e=Object.assign(e,JSON.parse(this.nativeParams.getMediationParams())),h.compact(e)}getErrorParams(){return h.compact(this.baseParameters())}getTrackingParams(){return h.compact(this.baseParameters())}getCatalogFrameParams(){return h.compact(this.baseParameters())}getInventoryCheckParams(e={}){const t=this.baseParameters();return t[At]=this.preloadController?.getPreloadedMraidAds(),void 0===e.context&&(t.context="inventoryCheck"),h.compact(Object.assign(t,e))}getBaseRtbParams(){return h.compact({app:this.buildApp(),device:this.buildDevice(),user:this.buildUser()})}baseParameters(){let e={};return e=Object.assign(e,this.buildSegment()),e=Object.assign(e,this.deviceParams()),e=Object.assign(e,this.cachedAppParams()),it.addStatus(e),e[st]=this.getUserId(),e[kt]=JSON.parse(this.vastStateCache),e}getUserId(){return void 0!==this.uid||(this.uid=this.nativeParams.getUID()),this.uid}getDistributorID(){return void 0!==this.distributorID||(this.distributorID=this.nativeParams.getDistributorID()),this.distributorID}getSDKVersion(){return void 0!==this.sdkVersion||(this.sdkVersion=this.nativeParams.getSDKVersion()),this.sdkVersion}buildUser(){return{id:this.getUserId(),data:[{segment:[this.buildSegment(!0)]}]}}buildApp(){const e=_(this.cachedAppParams());return{ver:e[ot],bundle:e[nt]}}buildSegment(e=!1){const t=_(this.cachedSegmentParams());t[qt]=this.consentController.getConsentParameters(),t[Mt]=this.nativeParams.getClearTextPermitted(),t[Ot]=this.nativeParams.getIsAgeRestrictedUser(),t[St]=this.nativeParams.getIsLowPowerEnabled(),t[Ct]=this.nativeParams.getPrivacyTrackingStatus(),t[bt]=this.nativeParams.getConnectionType(),t[Ht]=this.nativeParams.getAndroidId();const i=parseFloat(this.nativeParams.getTargetSDKVersion().toFixed(1));return i>0&&(t[Yt]=i),this.nativeParams.getIsAgeRestrictedUser()||"function"!=typeof this.nativeParams.getGAID||(t[Jt]=this.nativeParams.getGAID()),e&&(t[wt]=JSON.parse(this.nativeParams.getCarriers())),t[yt]=this.nativeParams.getScreenTraits(),t}cachedSegmentParams(){if(void 0!==this.cachedSegment)return this.cachedSegment;const e={};return e[gt]=this.nativeParams.getSDKVersion(),e[lt]=this.nativeParams.getSupportedInterfaceSettings(),e[pt]=this.nativeParams.getMSDKV(),e[at]=this.nativeParams.getATSSettings(),e[Tt]=this.nativeParams.getMacCatalyst(),e[_t]=this.nativeParams.getIOSAppOnMac(),e[ht]=this.nativeParams.getIdentifierForVendor(),e[dt]=this.nativeParams.getXcodeVersion(),e[Et]=this.nativeParams.getSupportsMultipleScenes(),e[Wt]=this.nativeParams.getSupportsMultipleWindow(),e[ut]=JSON.parse(this.nativeParams.getPermissions()),e[rt]=this.nativeParams.getDistributorID(),e[ct]=globalThis.version(),e[mt]=this.nativeParams.getDeviceType(),e[xt]=this.nativeParams.getSKAdNetworkItems(),this.cachedSegment=e,this.cachedSegment}buildDevice(){const e=_(this.cachedDeviceParams()),t={device_fingerprint:e[Dt],device_product:e[Bt]};Object.assign(t,et());const i={model:e[ft],os:e[Ft],osv:e[vt],h:e[Nt],w:e[Rt],pxratio:e[Vt],make:e[$t],ext:t};return this.nativeParams.getIsAgeRestrictedUser()||(i.lmt=this.formatLimitAdTracking(this.nativeParams.getAdIdOptedOut()),i.ifa=this.nativeParams.getPersistentID()),Object.assign(i,this.rtbDeviceCarrierData())}deviceParams(){const e=_(this.cachedDeviceParams());return this.nativeParams.getIsAgeRestrictedUser()||(e[Pt]=this.nativeParams.getPersistentID(),"function"==typeof this.nativeParams.getGAID&&(e[Jt]=this.nativeParams.getGAID()),e[It]=this.nativeParams.getAdIdOptedOut()),e[wt]=JSON.parse(this.nativeParams.getCarriers()),e}cachedDeviceParams(){if(void 0!==this.cachedDevice)return this.cachedDevice;const e={};return e[ft]=this.nativeParams.getDeviceModel(),e[vt]=this.nativeParams.getOSVersion(),e[Nt]=this.nativeParams.getDeviceHeight(),e[Rt]=this.nativeParams.getDeviceWidth(),e[Vt]=this.nativeParams.getPxRatio(),e[Bt]=this.nativeParams.getDeviceProduct(),e[Dt]=this.nativeParams.getDeviceFingerPrint(),e[$t]=this.nativeParams.getDeviceBrand(),e[Ut]=this.nativeParams.getDevice(),e[Ft]=this.nativeParams.getPlatform(),e[Lt]=this.nativeParams.getDeviceManufacturer(),this.cachedDevice=e,this.cachedDevice}cachedAppParams(){if(void 0!==this.cachedApp)return this.cachedApp;const e={};return e[nt]=this.nativeParams.getBundleID(),e[ot]=this.nativeParams.getBundleVersion(),this.cachedApp=e,this.cachedApp}updateVastCacheState(e){const t=JSON.parse(this.vastStateCache);let i=-1;const r=e.identifier;return t.forEach(((e,t)=>{e.identifier===r&&(i=t)})),i>-1?(console.debug(`[RPM] Updating cache state for identifier: ${e.identifier}`),t[i]=e):(console.debug(`[RPM] Adding identifier: ${e.identifier} to cache`),t.push(e)),this.vastStateCache=JSON.stringify(t),t}getCompressedParameters(){return JSON.stringify({})}formatLimitAdTracking(e){return e?1:0}rtbDeviceCarrierData(){let e;switch(this.nativeParams.getConnectionType()){case"Ethernet":e=1;break;case"WIFI":e=2;break;case"NR":e=3;break;case"CDMA":case"CDMA - EvDo rev. 0":case"CDMA - EvDo rev. A":case"CDMA - EvDo rev. B":case"CDMA - 1xRTT":case"CDMA - eHRPD":case"EDGE":e=4;break;case"GPRS":case"UMTS":case"HSPA":case"HSDPA":case"HSPA+":case"HSUPA":case"GSM":case"3G":e=5;break;case"LTE_CA":case"LTE":e=6;break;default:e=0}const t={connectiontype:e};if(void 0===this.nativeParams.getCarriers())return t;const i=JSON.parse(this.nativeParams.getCarriers()),r=Object.keys(i).sort();if(r.length>0){const e=i[r[0]];t.carrier=e.carrier_name,t.mccmnc=`${e.mobile_country_code},${e.mobile_network_code}`}return t}}globalThis.RequestParameterManager=zt;const Kt="1YY-",Gt="1YN-";function Xt(e,t,i,r,s,n){return(o,a)=>{const l=function(){let e=(new Date).getTime(),t="undefined"!=typeof performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(i=>{let r=16*Math.random();return e>0?(r=(e+r)%16|0,e=Math.floor(e/16)):(r=(t+r)%16|0,t=Math.floor(t/16)),("x"===i?r:3&r|8).toString(16)}))}();return{id:l,...e,app:t(),device:i(),user:r(a),imp:s(l,o),regs:n()}}}function Qt(e={},t={}){const i=N(_(e),_(t)),r=function(e={},t=HYPRRequestParamListener){const i={..._(e),ver:t.getBundleVersion()};return()=>i}(i.app),s=function(e={},t=HYPRRequestParamListener,i=et){const r={..._(e),model:t.getDeviceModel(),os:t.getPlatform(),osv:t.getOSVersion(),h:t.getDeviceHeight(),w:t.getDeviceWidth(),pxratio:t.getPxRatio(),make:t.getDeviceBrand()};r.ext=r.ext||{},r.ext.hyprmx={...r.ext.hyprmx,device_fingerprint:t.getDeviceFingerPrint(),device_product:t.getDeviceProduct()};let s=JSON.stringify(r);return()=>{const e={...JSON.parse(s),...tt(t)};return t.getIsAgeRestrictedUser()||(e.lmt=t.getAdIdOptedOut()?1:0,e.ifa=t.getPersistentID()),e.ext.hyprmx={...e.ext.hyprmx,...i()},s=JSON.stringify(e),e}}(i.device),n=function(e={},t=HYPRRequestParamListener,i=HYPRConsentController){const r={};r[gt]=t.getSDKVersion(),r[lt]=t.getSupportedInterfaceSettings(),r[pt]=t.getMSDKV(),r[at]=t.getATSSettings(),r[Tt]=t.getMacCatalyst(),r[_t]=t.getIOSAppOnMac(),r[ht]=t.getIdentifierForVendor(),r[dt]=t.getXcodeVersion(),r[Et]=t.getSupportsMultipleScenes(),r[Wt]=t.getSupportsMultipleWindow(),r[ut]=JSON.parse(t.getPermissions()),r[rt]=t.getDistributorID(),r[ct]=globalThis.version(),r[mt]=t.getDeviceType(),r[xt]=t.getSKAdNetworkItems(),r[Ot]=t.getIsAgeRestrictedUser(),r[Ht]=t.getAndroidId();const s=parseFloat(t.getTargetSDKVersion().toFixed(1));s>0&&(r[Yt]=s),t.getIsAgeRestrictedUser()||"function"!=typeof t.getGAID||(r[Jt]=t.getGAID());const n=JSON.stringify(r),o=t.getUID(),a=_(e);return e=>{const r=JSON.parse(n);return r[qt]=i.getConsentParameters(),r[St]=t.getIsLowPowerEnabled(),r[Ct]=t.getPrivacyTrackingStatus(),r[bt]=t.getConnectionType(),r[wt]=JSON.parse(t.getCarriers()),r[yt]=t.getScreenTraits(),r[jt]=e,{...a,id:o,data:[{segment:[{id:"hyprmx",ext:r}]}]}}}(i.user),o=function(e=[{}],t=HYPRRequestParamListener){const i=[{...e?.[0]}];return i[0].banner={...i[0].banner},(e,r)=>{const s=_(i);return s[0].id=e,s[0].banner.h=r.definedSize.height,s[0].banner.w=r.definedSize.width,s[0].secure=!1===t.getClearTextPermitted()?1:0,s}}(t.imp),a=function(e={},t=HYPRConsentController){return()=>{const i=t.consentStatus===J.CONSENT_DECLINED?Kt:Gt,r=_(e);return r.us_privacy=i,r.ext=r.ext?r.ext:{},r.ext.us_privacy=i,r}}(i.regs);return delete i.app,delete i.device,delete i.user,delete i.imp,delete i.regs,Xt(i,r,s,n,o,a)}class Zt{static BASE_RTB_REQUEST={};static fromObject(e,t,i=globalThis.HYPRNetworkController,r=globalThis.HYPRTimerController){return E(ue.BANNER,e.type)?new Ze(e.id,e.name,e.type,e.inventory_check_url,t,Qt(this.BASE_RTB_REQUEST,e.placement_rtb_request),i,r):E(ue.REWARDED,e.type)||E(ue.INTERSTITIAL,e.type)?new fe(e.id,e.name,e.type,e.inventory_check_url,t,i,r):(console.error(`PlacementFactory received unknown placement type ${e.type}`),new pe(e.id,e.name,e.type,e.inventory_check_url,t,i,r))}static deepCopy(e){const t=new e.constructor;for(const i in e)t[i]=e[i];return t}}class ei{constructor(e,t=HYPRConsentController,i=HYPRPreloadController){if(this.placementMap=new Map,this.preloadController=i,console.debug(`Placement Controller initialized with ${JSON.stringify(e)}`),Array.isArray(e))for(const t of e)this.placementMap.set(t.name,Zt.fromObject(t,this));else void 0!==e&&"object"==typeof e&&this.placementMap.set(e.name,Zt.fromObject(e,this));t.setConsentChangedListener(this),globalThis.HYPRBiddingController=new ze(this)}getPlacements(){return this.placementMap}getBannerPlacements(){return[...this.placementMap.values()].filter((e=>e.isBannerAdType()))}getPlacement(e){const t=this.placementMap.get(e);return void 0!==t&&void 0===t.placementListener&&(t.placementListener=this),this.placementMap.get(e)}isAdAvailable(e){const t=this.getPlacement(e);return void 0===t?(console.debug(`PlacementController.isAdAvailable(${e}) reports undefined placement. Returning false.`),!1):t.isAdAvailable()}clearAllPlacementsAdStateAndTimers(){this.placementMap.forEach(((e,t,i)=>{e.clearAdAndStopAdAvailableTimer()}))}startAdRefresh(e,t){console.debug(`PlacementController - Start Ad Refresh for context: ${e} placementName: ${t}`);const i={context:e};void 0===t?this.placementMap.forEach((t=>{t.handleRefresh(e,i)})):this.getPlacement(t).handleRefresh(e,i)}loadAd(e,t={}){const i=this.getPlacement(e);void 0===i?(console.debug("PlacementController loadAd reports undefined placement. Returning onLoadAdFailure."),HYPRPlacementListener.onLoadAdFailure(e,"placement name is invalid")):i.loadAd(t,((e,t)=>{e.placementListener.onLoadAdResponse(e,t)}))}handlePreloading(e){this.preloadController.handleMraidAdToPreload(e),this.preloadController.handleAdsToPreloadResponse(e.ads_to_preload),this.preloadController.handleUIComponentsToPreloadResponse(e.ui_components)}onLoadAdResponse(e,t){void 0!==t?(console.debug(`PlacementController loadAd failure ${t}`),this.onPlacementLoadAdFailure(e,t)):(console.debug(`PlacementController onPlacementLoadAdSuccess for ${e}`),this.onPlacementLoadAdSuccess(e),this.handlePreloading(e))}onRefreshAdResponse(e,t){void 0===t&&this.handlePreloading(e)}onPlacementLoadAdSuccess(e){HYPRPlacementListener.onLoadAdSuccess(e.name,e.isAdAvailable())}onPlacementLoadAdFailure(e,t){HYPRPlacementListener.onLoadAdFailure(e.name,t)}onPlacementAdCleared(e){console.debug(`Cleared ad state for ${e}`),HYPRPlacementListener.onAdCleared(e.name)}onPlacementAdExpired(e){console.debug(`Ad expired for ${e}`),HYPRPlacementListener.onAdExpired(e.name)}onConsentChanged(){console.debug("Consent status changed.  Clearing all ad state."),this.startAdRefresh(me)}}globalThis.PlacementController=ei;class ti{constructor(e,t){this.decision=e,this.url=t}}const ii="NAVIGATION_ALLOWED",ri="NAVIGATION_BLOCKED",si="OPEN_OUTSIDE_APPLICATION",ni="NAVIGATION_REDIRECTED",oi="NATIVE_APP_STORE",ai="fullscreen",li="overlay",di="outside_app";class ci{constructor(e,t,i=globalThis.HYPRNetworkController){this.configuration=e,this.networkRequestController=i,this.adnetworkSignatureEndpoint=t,this.presentationModes=ci.getSupportedPresentationModes(e)}async presentStore(e,o,a,l,d){console.debug(`presentStore: AD MODEL: ${l}`);const c=this.getStorePresentationMode(l,d),h=new t(!0,s,n,{"Content-Type":r,Accept:i}),u=o.appStoreSignatureParams(e,l);console.debug(`fetchAttributionSignature: Request with paramters ${JSON.stringify(u)}`);const{response:p,body:g,error:m}=await this.networkRequestController.postAsync(this.adnetworkSignatureEndpoint,u,h);let v;console.debug(`SKAdNetwork Signature response received with status: ${p} error: ${m}`),204!==p&&f.validResponseStatus(p)?(v=JSON.stringify({presentationMode:c,...ce.parseJSON(g)}),console.debug(`Store Presentation with updated parameters: ${v}`)):(v=JSON.stringify({presentationMode:c,...e}),console.debug(`Store Presentation with original parameters: ${v}`)),a.showAppStore(c,v)}getStorePresentationMode(e,t){let i=t;return console.debug(`StorePresentationController: initial mode is: ${i}`),void 0===i&&(i=this.presentationModeForPlacement(e)),console.debug(`StorePresentationController: preferred store presentation mode: ${i}`),this.presentationModes.indexOf(i)>-1?(console.debug(`StorePresentationController: using preferred store presentation mode: ${i}`),i):(console.debug(`StorePresentationController: fallback to store presentation mode: ${this.presentationModes[0]}`),this.presentationModes[0])}presentationModeForPlacement(e){return e?.shouldAppStoreUseOverlay()?li:ai}static getSupportedPresentationModes(e){const t=[];return e.isIos()&&e.isPortraitSupported()&&t.push(ai),e.isIos()&&e.version>=14&&t.push(li),t.push(di),console.debug(`StorePresentationController: available presentation modes: ${JSON.stringify(t)}`),t}}const hi=["itunes.apple.com","apps.apple.com"],ui=["play.google.com","market://details"];class pi{constructor(e,t,i,r,s=globalThis.HYPRNetworkController,n=HYPRInitializationController.deviceConfiguration){this.initialUrl=e,this.placement=t,this.baseAdInstanceId=i,this.ad=r,this.networkRequestController=s,this.resolvedStoreUrl=void 0,this.complete=!1,this.networkRequest=void 0,this.configuration=n}customUserAgent(){return`HyprMX/${this.configuration.sdkVersion}`}shouldPresentNativeBrowser(){return void 0!==this.ad&&this.ad.openClickInNativeBrowser()}navigationDecisionBasedOnProtocol(){return this.configuration.isAndroid()&&this.isPlayStoreUrl()?new ti(si,this.resolvedStoreUrl):this.configuration.isIos()&&this.resolveAppStoreUrl()?new ti(oi,this.resolvedStoreUrl):U.indexOf(this.initialUrl.split(":").shift())>=0?new ti(ii,this.initialUrl):new ti(si,this.initialUrl)}async evaluateUrl(){const e=new t(!0,s,n,{"User-Agent":this.customUserAgent()});this.networkRequest=await this.networkRequestController.getAsync(this.initialUrl,e),this.networkRequest?.response>=200&&this.networkRequest?.response<400&&void 0!==this.networkRequest?.headers?.Location&&(console.debug(`will re-resolve url: ${this.networkRequest?.headers?.Location}`),this.resolveAppStoreUrl(this.networkRequest?.headers?.Location))}isStoreClickMode(){return"store"===this.ad?.getClickMode()}isPlayStoreUrl(e=this.initialUrl){return this.compareUrlWithPattern(e,ui)}resolveAppStoreUrl(e=this.initialUrl){return this.compareUrlWithPattern(e,hi)}compareUrlWithPattern(e,t){return t.filter((t=>e.includes(t))).length>=1&&(this.resolvedStoreUrl=e,this.complete=!0),this.complete}getAppStoreOverlayParams(){let e;if(this.complete||this.resolveAppStoreUrl(this.initialUrl),void 0===this.resolvedStoreUrl)return e;const t=pi.getUrlParams(this.resolvedStoreUrl),i=pi.getAppStoreId(this.resolvedStoreUrl.split("?").shift(),t);return void 0===i?e:{url:this.resolvedStoreUrl,SKStoreProductParameterITunesItemIdentifier:i,SKStoreProductParameterAffiliateToken:t.at,SKStoreProductParameterCampaignToken:t.ct,SKStoreProductParameterProviderToken:t.pt}}static getAppStoreId(e,t){if(void 0!==t.id)return parseInt(t.id,10);let i=e.split("/").slice(-1).shift();0===i.indexOf("id")&&(i=i.split("id").slice(-1).shift());const r=parseInt(i,10);return Number.isNaN(r)?void 0:r}static getUrlParams(e){const t={},i=e.indexOf("?");if(-1===i||i+1===e.length)return t;return e.slice(e.indexOf("?")+1).split("&").map((e=>{const[i,r]=e.split("=");t[i]=decodeURIComponent(r)})),t}}globalThis.UrlResolver=pi;class gi{constructor(e,t=!0,i=!0,r="",s="ffffff",n="ff",o=!1,a=!0,l=!0){this.isWebViewScrollable=e,this.isWebViewScrollBounceEnabled=t,this.allowsPinchGesture=i,this.alpha=n,this.backgroundColor=s,this.customUserAgent=r,this.headScripts=['document.onreadystatechange = function () {if(typeof window.webkit === "object" && typeof window.webkit.messageHandlers === "object"){window.webkit.messageHandlers["setReadyState"].postMessage(document.readyState); document.onreadystatechange = null;}}'],l&&this.headScripts.push('!function(){let e=document.querySelector("meta[name=viewport]");e||((e=document.createElement("meta")).name="viewport",document.getElementsByTagName("head")[0].appendChild(e)),e.setAttribute("content",e.getAttribute("content")+", initial-scale=1.0"),setTimeout(function(){window.scrollTo(0,0)},100)}();'),this.allowsLinkPreview=a,this.playbackRequiresUserAction=o,this.allowsInlineMediaPlayback=!0,this.allowsAirPlayForMediaPlayback=!0,this.allowsPictureInPictureMediaPlayback=!1,this.isNavigationLimited=!1,this.javaScriptEnabled=!0,this.domStorageEnabled=!0,this.loadWithOverviewMode=!0,this.useWideViewPort=!0,this.displayZoomControls=!1,this.builtInZoomControls=!0,this.supportsMultipleWindows=!0}setWebViewNavigationLimited(e){if("base_ad"===e&&"object"==typeof hyprAppDomainController&&hyprAppDomainController.isAppBoundDomainEnabled()){const e=hyprAppDomainController.getAppBoundDomains();this.isNavigationLimited=e.indexOf("hyprmx.com")>-1}else this.isNavigationLimited=!1}}const mi="inline",fi="interstitial";class vi{constructor(e,t){this.viewModel=t,this.data=e,this.scripts=[]}generateEvent(e){return this.scripts.push(this[e](this.data)),this}generateBootstrapScripts(){return this.scripts.push(this.setPlacementType(this.data)),this.scripts.push(wi),this.scripts.push(this.fireStateChangeEvent("loading")),this.scripts.push(this.setSupports()),this.scripts.push(this.setMaxSize()),this.scripts.push(this.setScreenSize()),this.scripts.push(this.setDefaultPosition(this.data)),this.scripts.push(this.setCurrentPosition(this.data)),this.scripts.push(this.fireStateChangeEvent("default")),void 0!==this.data.containerWidth&&void 0!==this.data.containerHeight&&this.scripts.push(this.fireSizeChangeEvent(this.data)),this}generateAdReadyScripts(){return this.scripts.push(this.fireViewableChangeEvent(this.data)),this.scripts.push(this.fireReadyEvent()),this}fire(){this.scripts.forEach((e=>this.viewModel.publishASyncScriptEvent(e)))}setPlacementType(e){return"string"==typeof e.type?this.mraidEventScript("setPlacementType",`'${e.type}'`):""}fireSizeChangeEvent(e){if(void 0!==e.containerWidth&&void 0!==e.containerHeight){const t=JSON.stringify({width:e.containerWidth,height:e.containerHeight});return this.mraidEventScript("fireSizeChangeEvent",t)}return""}setCurrentPosition(e){if(void 0!==e.containerWidth&&void 0!==e.containerHeight){const t=JSON.stringify({x:0,y:0,width:e.containerWidth,height:e.containerHeight});return this.mraidEventScript("setCurrentPosition",t)}return""}setDefaultPosition(e){if(void 0!==e.containerWidth&&void 0!==e.containerHeight){const t=JSON.stringify({x:0,y:0,width:e.containerWidth,height:e.containerHeight});return this.mraidEventScript("setDefaultPosition",t)}return""}fireStateChangeEvent(e){return void 0!==e?this.mraidEventScript("fireStateChangeEvent",`'${e}'`):""}fireViewableChangeEvent(e){return void 0!==e&&void 0!==e.viewable?this.mraidEventScript("fireViewableChangeEvent",`${e.viewable}`):""}setMaxSize(){if("object"!=typeof this.data||void 0===this.data.containerWidth||void 0===this.data.containerHeight)return"";const e=JSON.stringify({width:this.data.containerWidth,height:this.data.containerHeight});return this.mraidEventScript("setMaxSize",e)}setScreenSize(){const e=JSON.parse(HYPRRequestParamListener.getScreenSize()||"{}");if(void 0===e||void 0!==e.width&&void 0!==e.height){const t=JSON.stringify({width:e.width,height:e.height});return this.mraidEventScript("setScreenSize",t)}return""}setSupports(){const e=HYPRRequestParamListener.getMraidSupportsString();return void 0!==e?this.mraidEventScript("setSupports",e):""}fireReadyEvent(){return this.mraidEventScript("fireReadyEvent","{}")}mraidEventScript(e,t){if(void 0!==e)return`window.dispatchEvent(new CustomEvent("${e}", {detail: ${t}}));`}static getMraidJSTag(){return`<script language="javascript" type="text/javascript">\n${bi}\n<\/script>\n`}}const bi='"undefined"==typeof mraid&&function(){var e=window.mraid={VERSION:"2.0",STATES:{LOADING:"loading",DEFAULT:"default",EXPANDED:"expanded",RESIZED:"resized",HIDDEN:"hidden"},EVENTS:{READY:"ready",ERROR:"error",STATECHANGE:"stateChange",VIEWABLECHANGE:"viewableChange",SIZECHANGE:"sizeChange"}},n={sms:!1,tel:!1,calendar:!1,storePicture:!1,inlineVideo:!1},t=e.STATES.LOADING,i=!1,o="",r={x:0,y:0,width:0,height:0},E={x:0,y:0,width:0,height:0},a={width:0,height:0},s={width:0,height:0},d={width:0,height:0,useCustomClose:!1,isModal:!0},u={allowOrientationChange:!0,forceOrientation:"none"},f={};e.getVersion=function(){return e.VERSION},e.getState=function(){return t},e.getPlacementType=function(){return o},e.getDefaultPosition=function(){return E},e.getCurrentPosition=function(){return r},e.getScreenSize=function(){return a},e.getMaxSize=function(){return s},e.getExpandProperties=function(){return d},e.setExpandProperties=function(e){void 0!==e&&void 0!==e.useCustomClose&&(d.useCustomClose=e.useCustomClose)},e.getResizeProperties=function(){c("getResizeProperties unsupported","getResizeProperties")},e.setResizeProperties=function(e){c("setResizeProperties unsupported","setResizeProperties")},e.getOrientationProperties=function(){return u},e.setOrientationProperties=function(e){void 0!==e&&(void 0!==e.allowOrientationChange&&(u.allowOrientationChange=e.allowOrientationChange),void 0!==e.forceOrientation&&(u.forceOrientation=e.forceOrientation),l("setOrientationProperties",u))},e.isViewable=function(){return i},e.addEventListener=function(n,t){if((n===e.EVENTS.READY||n===e.EVENTS.ERROR||n===e.EVENTS.STATECHANGE||n===e.EVENTS.VIEWABLECHANGE||n===e.EVENTS.SIZECHANGE)&&"function"==typeof t){f[n]=f[n]||[];for(var i=f[n],o=0;o<i.length;o++)if(i[o]===t)return;f[n].push(t)}},e.removeEventListener=function(n,t){if(n===e.EVENTS.READY||n===e.EVENTS.ERROR||n===e.EVENTS.STATECHANGE||n===e.EVENTS.VIEWABLECHANGE||n===e.EVENTS.SIZECHANGE)if(f[n]=f[n]||[],t){for(var i=f[n],o=-1,r=0;r<i.length;r++)if(i[r]===t){o=r;break}i.splice(o,1),o>=0&&(f[n]=i)}else f[n]=[]},e.open=function(e){l("open",e)},e.expand=function(e){c("expand unsupported","expand")},e.resize=function(){c("resize unsupported","resize")},e.close=function(){t===e.STATES.HIDDEN?c("Ad state is already hidden so cannot close.","close"):l("close")},e.supports=function(e){return n[e]},e.useCustomClose=function(e){d.useCustomClose=e,l("useCustomClose",e)},e.createCalendarEvent=function(e){l("createCalendarEvent",JSON.stringify(e))},e.storePicture=function(e){l("storePicture",e)},e.playVideo=function(e){c("playVideo unsupported","playVideo")};var c=function(n,t){f[e.EVENTS.ERROR]=f[e.EVENTS.ERROR]||[];var i=f[e.EVENTS.ERROR];console.log("fireErrorEvent: "+n);for(var o=0;o<i.length;o++)i[o].apply(void 0,[n,t])},l=function(e,n){if("object"==typeof window.mraidJSInterface)S(e,n);else{if("object"!=typeof window.webkit||"object"!=typeof window.webkit.messageHandlers)return console.error("SDK Interface not found"),null;p(e,n)}},S=function(e,n){try{"setOrientationProperties"===e?window.mraidJSInterface[e](n.allowOrientationChange,n.forceOrientation):void 0!==n?window.mraidJSInterface[e](n):window.mraidJSInterface[e]()}catch(n){console.error("error when invoking Android mraidJSInterface."+e,n)}},p=function(e,n){try{"setOrientationProperties"===e?window.webkit.messageHandlers[e].postMessage(JSON.stringify(n)):window.webkit.messageHandlers[e].postMessage(n)}catch(n){console.error("error when invoking iosJSInterface."+e,n)}};window.addEventListener("setPlacementType",(function(e){o=e.detail})),window.addEventListener("setScreenSize",(function(e){a=e.detail})),window.addEventListener("setMaxSize",(function(e){s=e.detail})),window.addEventListener("setCurrentPosition",(function(e){r=e.detail})),window.addEventListener("setDefaultPosition",(function(e){E=e.detail})),window.addEventListener("setSupports",(function(e){n=e.detail})),window.addEventListener("fireStateChangeEvent",(function(n){!function(n){console.log("fireStateChangeEvent - "+n),t=n,f[e.EVENTS.STATECHANGE]=f[e.EVENTS.STATECHANGE]||[];for(var i=f[e.EVENTS.STATECHANGE],o=0;o<i.length;o++)i[o].apply(void 0,[n])}(n.detail)})),window.addEventListener("fireReadyEvent",(function(n){!function(){f[e.EVENTS.READY]=f[e.EVENTS.READY]||[];var n=f[e.EVENTS.READY];console.log("fireReadyEvent: "+n);for(var t=0;t<n.length;t++)n[t].apply(void 0)}()})),window.addEventListener("fireViewableChangeEvent",(function(n){!function(n){console.log("fireViewableChangeEvent - "+n),i=n,f[e.EVENTS.VIEWABLECHANGE]=f[e.EVENTS.VIEWABLECHANGE]||[];for(var t=f[e.EVENTS.VIEWABLECHANGE],o=0;o<t.length;o++)t[o].apply(void 0,[n])}(n.detail)})),window.addEventListener("fireSizeChangeEvent",(function(n){!function(n,t){f[e.EVENTS.SIZECHANGE]=f[e.EVENTS.SIZECHANGE]||[];for(var i=f[e.EVENTS.SIZECHANGE],o=0;o<i.length;o++)i[o].apply(void 0,[n,t])}(n.detail.width,n.detail.height)}))}();',wi="var hyprmx_celtra_mraid_check = function(time) {if (typeof celtra !== 'undefined') { var frames = document.querySelectorAll(\"iframe\");for (let i=0; i < frames.length; i++){ frames[i].contentWindow.mraid = window.mraid; }} else {setTimeout(function() {hyprmx_celtra_mraid_check(time+1)}, time + 500);}};hyprmx_celtra_mraid_check(500);";class Pi{static bootstrapEvent(e,t){new vi(e,t).generateBootstrapScripts().fire()}static adReadyEvent(e,t){new vi(e,t).generateAdReadyScripts().fire()}static containerEvents(e,t,i){const r=new vi(t,i);for(const t of e)r.generateEvent(t);r.fire()}}const Ai={EVENT_NAME:"hyprAdPresentationChanged",EVENT_SHARING_CLOSED:"sharing_closed",EVENT_SHARING_PRESENTED:"sharing_presented",EVENT_AD_CLOSED:"ad_closed",EVENT_APP_PAUSED:"app_paused",EVENT_APP_RESUMED:"app_resumed",EVENT_NAVIGATION_BLOCKED:"hyprWebViewNavigationBlocked",EVENT_VIEWABLE:"viewable",EVENT_NOT_VIEWABLE:"not_viewable"},Si="notInitialized",Ci="initialized",yi="ready";class Ei{constructor(e){this.currentIndex=e.currentIndex,this.currentUrl=e.currentUrl,this.currentHost=e.currentHost,this.currentTitle=e.currentTitle,this.history=e.history,this.canNavigateForward=e.canNavigateForward,this.canNavigateBack=e.canNavigateBack}}const Ti={webViewSizeData:{},adBaseUrl:W,adBaseEncoding:H,adBaseMime:q,mraidState:Si,currentInstanceId(){return"string"==typeof this.preloadInstanceId?this.preloadInstanceId:this.instanceId},getWebViewConfigurationString(e){return"object"==typeof e&&"string"==typeof e.mode&&this.getWebViewConfiguration().setWebViewNavigationLimited(e.mode),JSON.stringify(this.getWebViewConfiguration())},windowOpenAttempt(e={}){const{url:t}=e;if("string"!=typeof t||void 0===this.placement)return void console.error("Window.open attempt could not parse url");if(console.debug(`Window.open attempt for ${t.split("?").shift()}`),!this.shouldAllowWindowOpenEvent(e))return;const i=new pi(t,this.placement,this.instanceId,this.getAdModel());if(i.isStoreClickMode())return void this.handlePotentialStoreClick(i);const r=i.navigationDecisionBasedOnProtocol();switch(r.decision){case si:return console.debug("Window.open will open outside app"),void this.openOutsideApplication(r.url);case oi:return console.debug("Window.open found store url without resolving"),void this.startStorePresentation(i);default:return console.debug("Window.open will show browser"),this.showBrowser(i)}},shouldTakeFocus(){return!this.placement?.isBannerAdType()||this.onSharePressed},shouldKeepFocus(){return!this.placement?.isBannerAdType()||this.onSharePressed},webviewDestroyScript:()=>'window.addEventListener("pagehide", (e) => {window.webkit.messageHandlers.hypr_pagehide_complete.postMessage("hypr_pagehide_complete");});setTimeout(() => {window.webkit.messageHandlers.hypr_pagehide_complete.postMessage("hypr_pagehide_complete");}, 2000);',shouldLoadAboutBlank:()=>!0,shouldRedirectURL(e){const t="object"==typeof e?e.url:void 0,i="object"==typeof e?e.mimeType:void 0;return"text/html"===i?JSON.stringify(new ti(ii,e.url)):"string"!=typeof t||void 0===this.placement?JSON.stringify(new ti(ri,t)):"application/pdf"===i||t.endsWith(".pdf")||"application/msword"===i||t.endsWith(".doc")||"application/vnd.openxmlformats-officedocument.wordprocessingml.document"===i||t.endsWith("docx")||"application/vnd.ms-excel"===i||t.endsWith("xls")||"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===i||t.endsWith("xlsx")||"application/vnd.ms-powerpoint"===i||t.endsWith("ppt")||"application/vnd.openxmlformats-officedocument.presentationml.presentation"===i||t.endsWith(".pptx")?JSON.stringify(new ti(ni,`https://docs.google.com/viewer?url=${t}&embedded=true`)):JSON.stringify(new ti(ii,e.url))},shouldInterceptRequest(e){"http"===e.scheme&&"function"==typeof this.webViewPresenter.removeJavascriptInterface&&(console.debug(`Insecure data loaded:  ${e.url} Removing Javascript Interface.`),this.webViewPresenter.removeJavascriptInterface())},getWebViewContainerData(){const e={};return e.containerWidth=Math.floor(this.webViewSizeData.width),e.containerHeight=Math.floor(this.webViewSizeData.height),e.viewable=this.isViewable(),e.type=this.placement?.isBannerAdType()?mi:fi,e},onPageFinished(e){this.loadInProgress=!1,this.handlePageFinishFromWebView(e.url),this.shouldBootstrapMraid()&&(console.debug(`[mraid loading] Starting Bootstrap Load for instance: ${this.currentInstanceId()}`),Pi.bootstrapEvent(this.getWebViewContainerData(),this),this.mraidState=Ci,this.isViewable()&&this.fireMraidReady(),console.debug(`[mraid loading] onPageFinished() MRAID State is: ${this.mraidState}`))},onJSMessage(e){this.handleJSMessageFromWebView(e)},onLoadData(){this.onWebViewLoadData()},onPageStarted(e){this.mraidState=Si,this.loadInProgress=!0,this.webViewPresenter.updateWebViewConfiguration(JSON.stringify(this.getWebViewConfiguration())),this.handlePageStartedFromWebView(e.url)},onReceivedError(e){this.handleErrorFromWebView(e)},onWebViewCrash(){return this.onWebViewTermination()},fireMraidReady(){console.debug(`[mraid loading] Firing MRAID AdReady to instance: ${this.currentInstanceId()}`),Pi.adReadyEvent(this.getWebViewContainerData(),this),this.mraidState=yi},webViewSizeChange(e){this.webViewSizeData=e,Pi.containerEvents(["setMaxSize","setDefaultPosition","setCurrentPosition","fireSizeChangeEvent"],this.getWebViewContainerData(),this),console.debug(`[mraid loading] webViewSizeChange() MRAID State is: ${this.mraidState}`)},reportContainerSizeChange(){Pi.containerEvents(["setScreenSize","fireSizeChangeEvent"],this.getWebViewContainerData(),this),console.debug(`[mraid loading] reportContainerSizeChange() MRAID State is: ${this.mraidState}`)},reportVisibilityChanged(){this.isViewable()&&this.mraidState!==yi&&this.fireMraidReady(),Pi.containerEvents(["fireViewableChangeEvent"],this.getWebViewContainerData(),this);const e=this.isViewable()?Ai.EVENT_SHARING_CLOSED:Ai.EVENT_SHARING_PRESENTED;this.publishCustomEvent(Ai.EVENT_NAME,e),console.debug(`[mraid loading] reportVisibilityChanged() MRAID State is: ${this.mraidState}`)},reportLifecycleChanged(e){const t=e?Ai.EVENT_APP_PAUSED:Ai.EVENT_APP_RESUMED;this.publishCustomEvent(Ai.EVENT_NAME,t),this.publishJSExecutionState(e)},adWillClose(){this.publishCustomEvent(Ai.EVENT_NAME,Ai.EVENT_AD_CLOSED)},setCurrentUrl(e,t){void 0!==t&&(this.userAgent=t),this.queryParams=void 0,this.url=e},setCurrentData(e,t=W){console.debug(`Setting current data to: ${e}`),t!==this.adBaseUrl&&(this.adBaseUrl=t),this.url=void 0;const i=this.adBaseMime,r=this.adBaseEncoding;this.adHtml=JSON.stringify({data:e,baseUrl:t,mimeType:i,encoding:r})},openFileChooser(e){return e.acceptTypes.indexOf("image/*")<0?(console.error(`Unsupported acceptTypes ${JSON.stringify(e.acceptTypes)}`),!1):this.captureImage()},onHistoryChanged(e){console.log(JSON.stringify(e)),this.webViewHistory=new Ei(e),this.onWebViewHistoryChanged(this.webViewHistory)},navigateBack(){this.webViewPresenter.navigateBack()},navigateForward(){this.webViewPresenter.navigateForward()},notifyWindowOpenURLBlock(e){this.publishCustomEvent(Ai.EVENT_NAVIGATION_BLOCKED,e)},publishASyncScriptEvent(e){this.webViewPresenter?.runScript(e)},publishJSExecutionState(e){"function"==typeof this.webViewPresenter.pauseJSExecution&&"function"==typeof this.webViewPresenter.resumeJSExecution&&(e?this.webViewPresenter.pauseJSExecution():this.webViewPresenter.resumeJSExecution())},publishCustomEvent(e,t,i=!1){const r=`window.dispatchEvent(new CustomEvent('${e}', { detail: '${t}'}));${i?`\nwindow.${e} = ${t};`:""}`;this.publishASyncScriptEvent(r)},setWebViewPresenter(e){this.webViewPresenter=e,this.webViewPresenterSubscriptions.forEach((e=>{try{this[e]=this[e]}catch(t){console.error(`Error setting binded property ${e} on webview presenter`)}}))},imageCaptured(e){this.webViewPresenter.imageCaptured(e.url)},denyPermissionRequest(e){console.debug(`Unsupported permission request: ${JSON.stringify(e)}`);const t=[];e.permissions?.forEach((e=>{t.push({permission:e,granted:!1})}));const i=JSON.stringify({permissions:t,permissionId:e.permissionId});this.webViewPresenter.permissionResponse(i)},permissionResponse(e){console.debug(`permissionResponse: ${JSON.stringify(e)}`);for(let t=0;t<e.permissions.length;t+=1)"android.permission.CAMERA"===e.permissions[t].permission?e.permissions[t].permission="android.webkit.resource.VIDEO_CAPTURE":"android.permission.RECORD_AUDIO"===e.permissions[t].permission&&(e.permissions[t].permission="android.webkit.resource.AUDIO_CAPTURE");this.webViewPresenter.permissionResponse(JSON.stringify(e))}},_i=["start","description","end","id","location","summary","status","transparent","freebusy","reminder","recurrence"];class Ri{constructor(e,t="https://0606delr85.execute-api.us-east-1.amazonaws.com/default/calendar_proxy"){const i=JSON.parse(e);i.recurrence=this.processRecurrenceData(i.recurrence),this.calendarEventParams=i,this.proxyUrl=t}processRecurrenceData(e){try{const t=[];switch(e?.frequency){case"daily":t.push("FREQ=DAILY");break;case"weekly":t.push("FREQ=WEEKLY");break;case"monthly":t.push("FREQ=MONTHLY");break;case"yearly":t.push("FREQ=YEARLY");break;default:return void console.error("processRecurrenceData: No parsable recurrence rule without frequency")}if(void 0!==e.daysInWeek){const i=[];for(const t of e.daysInWeek)switch(t){case 1:i.push("MO");break;case 2:i.push("TU");break;case 3:i.push("WE");break;case 4:i.push("TH");break;case 5:i.push("FR");break;case 6:i.push("SA");break;case 7:i.push("SU");break;default:console.error(`processRecurrenceData: Invalid weekday data: ${t}`)}t.push(`BYDAY=${i.join(",")}`)}return void 0!==e.daysInMonth&&t.push(`BYMONTHDAY=${e.daysInMonth.join(",")}`),void 0!==e.monthsInYear&&t.push(`BYMONTH=${e.monthsInYear.join(",")}`),void 0!==e.daysInYear&&t.push(`BYYEARDAY=${e.daysInYear.join(",")}`),void 0!==e.expires&&t.push(`UNTIL=${e.expires}`),t.join(";")}catch(e){return void console.error(`Error parsing recurrence rule: ${e}`)}}webcalUrl(){return`webcal://${this.proxyUrl.split("://").pop()}`}buildProxyQuery(){const e=[];for(const t of _i)void 0!==this.calendarEventParams[t]&&e.push(`${t}=${this.calendarEventParams[t]}`);return`?${e.join("&")}`}toProxyRequest(){const e=encodeURI(`${this.webcalUrl()}${this.buildProxyQuery()}`);return console.debug(`toProxyRequest() generated final url ${e}`),e}}const Ni=["onStop","UISceneDidEnterBackgroundNotification","UIApplicationDidEnterBackgroundNotification"],Vi=["onResume","UISceneWillEnterForegroundNotification","UIApplicationWillEnterForegroundNotification"];class Oi{constructor(e,t,i="",r=HYPRRequestParamListener,s=globalThis.HYPRNetworkController,n=globalThis.HYPRStorePresentationController,o=HYPRInitializationController.deviceConfiguration,a=globalThis.HYPREventController,l=HYPRRequestParameterManager,d=globalThis.HYPRTimerController){this.placement=e,this.listener=t,this.paramRequestListener=r,this.networkRequestController=s,this.storePresentationController=n,this.configuration=o,this.presentationListener=void 0,this.eventController=a,this.requestParameterManager=l,this.instanceId=i,this.preloadInstanceId=void 0,this.lastTransition="",this.hasParentView=!1,this.currentSizeData=void 0,this.visible=!1,this.hasBecomeVisible=!1,this.timerController=d,this.backgrounded=!1,this.browserInstance=void 0,this.webViewHistory=void 0,this.currentSizeData={},this.loadInProgress=!1,this.WebViewConfiguration=void 0,this._url=void 0,this._adHtml=void 0,this.presenterSubscriptions=[],this.webViewPresenterSubscriptions=["url","adHtml"]}get url(){return this._url}set url(e){this._url=e,void 0!==e&&this.webViewPresenter?.setUrl(e)}get adHtml(){return this._adHtml}set adHtml(e){this._adHtml=e,void 0!==e&&this.webViewPresenter?.setAdHtml(e)}destroy(){console.debug(`[BAVM] destroy for ${this.instanceId}`),this.pageReadyController?.stopPageReadyTimer()}onBackButtonPressed(){}getWebViewConfiguration(){const e=this.getAdModel()?.user_agent||"";return void 0===this.webViewConfiguration&&(this.webViewConfiguration=new gi(this.scrollingEnabled(),this.shouldScrollBounce(),this.isPinchEnabled(),e,this.webViewBackground(),this.webViewAlpha(),this.playbackRequiresUserAction(),this.allowsWebViewLinkPreview(),this.shouldScaleViewport())),this.webViewConfiguration}onLifecycleEvent(e){console.debug(`[BAVM] onLifecycleEvent: ${e.event} received.`),this.handleLifecycleTransition(e.event)}onWebViewLoadData(){}onParentViewChangeEvent(e){console.debug(`[BAVM] onParentViewChangeEvent: View has superview: ${e.parentView}.`),this.hasParentView=e.parentView}containerSizeChange(e){console.debug(`[BAVM] Received new container size: ${JSON.stringify(e)}`),this.currentSizeData=e,"function"==typeof this.reportContainerSizeChange&&this.reportContainerSizeChange(e)}containerVisibleChange(e){if(!0===e.visible&&(this.hasBecomeVisible=!0),console.debug(`[BAVM] Received new visible state: ${e.visible}`),this.visible!==e.visible&&(this.visible=e.visible,"function"==typeof this.reportVisibilityChanged))try{this.reportVisibilityChanged()}catch(e){console.debug(`[BAVM] Error reporting visibility change: ${JSON.stringify(e)}`)}}handleLifecycleTransition(e){this.isBackgroundTransition(e)?(this.onBackgroundTransition(),this.lastTransition=e):this.isForegroundTransition(e)&&(this.onForegroundTransition(),this.lastTransition=e),this.reportVisibilityChanged()}onForegroundTransition(){this.backgrounded=!1,"function"==typeof this.reportLifecycleChanged&&this.reportLifecycleChanged(!1)}onBackgroundTransition(){this.backgrounded=!0,"function"==typeof this.reportLifecycleChanged&&this.reportLifecycleChanged(!0)}isBackgroundTransition(e){return Ni.includes(e)&&!Ni.includes(this.lastTransition)}isForegroundTransition(e){return Vi.includes(e)&&!Vi.includes(this.lastTransition)}isValid(){return void 0!==this.placement}getPlacementName(){return this.placement?.name||""}getPlacementType(){return this.placement?.type||""}shouldBootstrapMraid(){return!1}shouldScrollBounce(){return!0}isPinchEnabled(){return!0}scrollingEnabled(){return!0}allowsWebViewLinkPreview(){return!0}playbackRequiresUserAction(){return!1}webViewBackground(){return"ffffff"}webViewAlpha(){return"ff"}shouldScaleViewport(){return!1}handleJSMessageFromWebView(e){const{name:t,body:i}=e;switch(t){case"open":case"openInSafariVC":this.windowOpenAttempt({url:i});break;case"createCalendarEvent":this.createCalendarEvent(i);break;case"storePicture":this.storePicture(i);break;case"presentStoreView":this.launchStore({url:JSON.parse(i).url},JSON.parse(i).mode);break;case"setOrientationProperties":{const{allowOrientationChange:e,forceOrientation:t}=JSON.parse(i);this.presenter.setOrientationProperties("true"===e,t);break}case"useCustomClose":this.presenter.useCustomClose("true"===i);break;default:"function"==typeof this[t]?(console.debug(`[BAVM] applying JS Event: ${t} with params ${i}`),this[t].apply(this,[i])):console.error(`[BAVM] Unsupported JS Event: ${t} with params ${i}`)}}handleErrorFromWebView(e){}handlePageFinishFromWebView(e){}handlePageStartedFromWebView(e){}onWebViewHistoryChanged(e){}javaScriptAlertAttempt(e){return!0}permissionRequest(e){if(console.debug(`[BAVM] Permission Request for ${JSON.stringify(e)}`),null!=e.permissions){for(let t=0;t<e.permissions.length;t+=1)"android.webkit.resource.VIDEO_CAPTURE"===e.permissions[t]?e.permissions[t]="android.permission.CAMERA":"android.webkit.resource.AUDIO_CAPTURE"===e.permissions[t]&&(e.permissions[t]="android.permission.RECORD_AUDIO");"function"==typeof this.presenter?.permissionRequest&&this.presenter.permissionRequest(JSON.stringify(e.permissions),e.permissionId)}else this.denyPermissionRequest(e)}shouldAllowWindowOpenEvent(e){return!0}nativeBrowserWillPresent(e){}async handlePotentialStoreClick(e){if(console.debug("[BAVM] Window.open evaluating url for resolution"),e.isPlayStoreUrl()&&(console.debug("[BAVM] Window.open will open outside app"),this.openOutsideApplication(e.resolvedStoreUrl)),await e.evaluateUrl(),console.debug("[BAVM] Window.open url evaluation complete"),e.complete)return console.debug("[BAVM] Window.open resolved to good store url"),void this.startStorePresentation(e);console.debug("[BAVM] Window.open failed resolution"),this.showBrowser(e)}showAppStore(e,t){console.debug(`[BAVM] Will show AppStore with mode: ${e}`),e!==di?(this.presenter.showAppStore(t),this.storePresentationPromise=void 0):this.openOutsideApplication(JSON.parse(t).url)}showBrowser(e){if(this.nativeBrowserWillPresent(e),e.shouldPresentNativeBrowser())return void this.presenter.showPlatformBrowser(e.initialUrl);const t=this.listener.initializeBrowserViewModel(this.instanceId,e,this,this.placement);return this.presenter.showHyprMXBrowser(t),t}onModalClosed(){this.browserInstance=void 0}urlNavigationAttempt(e){const t="object"==typeof e?e.url:void 0;if("string"!=typeof t||void 0===this.placement)return JSON.stringify(new ti(ri,t));console.debug(`[BAVM] urlNavigationAttempt() Navigation Attempt check for ${t.split("?").shift()};\n\n    request is main frame: ${e.isMainFrame}`);const i=new pi(t),r=i.navigationDecisionBasedOnProtocol();return r.decision===si?(console.debug(`[BAVM] urlNavigationAttempt() will open outside App: ${t.split("?").shift()}`),this.openOutsideApplication(r.url),JSON.stringify(new ti(ri,t))):r.decision===oi?(console.debug(`[BAVM] urlNavigationAttempt() will open native App Store: ${t.split("?").shift()}`),this.startStorePresentation(i),JSON.stringify(new ti(ri,t))):(console.debug(`[BAVM] urlNavigationAttempt() navigation result: ${r.decision}`),JSON.stringify(r))}startStorePresentation(e,t){console.debug("[BAVM] startStorePresentation() starting store presentation");const i=e.getAppStoreOverlayParams();return"object"==typeof i?(console.debug("[BAVM] startStorePresentation() launching app store"),this.launchStore(i,t),!0):(console.debug("[BAVM] startStorePresentation() failed to parse params"),!1)}launchStore(e,t){void 0===this.storePresentationPromise?this.storePresentationPromise=this.storePresentationController.presentStore(e,this.placement,this,this.getAdModel(),t):console.debug("[BAVM] Debounced app store presentation events")}openOutsideApplication(e){this.presenter.openOutsideApplication(e)}createCalendarEvent(e){if(this.configuration.isIos()){console.debug("[BAVM] createCalendarEvent on iOS Device - building proxy request");const t=new Ri(e);this.openOutsideApplication(t.toProxyRequest())}else console.debug("[BAVM] createCalendarEvent on Android Device - sending data for native Intent"),this.presenter.createCalendarEvent(e)}storePicture(e){this.presenter.storePicture(e)}captureImage(){return this.presenter.captureImage(),!0}generateTimeOnSiteTracking(){}onWebViewTermination(){return!0}onClose(){}clearPreloadId(){this.preloadInstanceId=void 0}getAdModel(){return this.ad}setPresenter(e){console.debug("[BAVM] Setting Presenter"),this.presenter=e,this.presenterSubscriptions.forEach((e=>{console.debug(`[BAVM] rebinding: ${e}`);try{this[e]=this[e]}catch(t){console.error(`[BAVM] Error setting binded property ${e} on presenter`)}}))}isViewable(){return this.visible&&!this.backgrounded}}Object.assign(Oi.prototype,Ti);class Ii{constructor(e=Date.now){this.timeReporter=e,this.duration=0,this.isActive=!1,this.startTime=0}start(){this.isActive||(this.isActive=!0,this.startTime=this.timeReporter())}pause(){this.isActive&&(this.isActive=!1,this.duration+=this.timeReporter()-this.startTime)}}class ki{constructor(e,t=new Ii,i=new Ii,r=new Ii,s=new Ii){this.trackingUrl=e,this.startTimeStamp=void 0,this.timeDuration=0,this.loadingRecorder=t,this.loadingInBackgroundRecorder=i,this.onPageRecorder=r,this.onPageBackgroundRecorder=s,this.isLoading=!1,this.isOnPage=!1,this.inBackground=!1,this.reason=""}startPageLoadingTimer(e){this.isLoading=!0,this.inBackground=e,this.notifyTimers(this.inBackground,this.loadingRecorder,this.loadingInBackgroundRecorder)}stopPageLoadingTimer(e){this.isLoading&&(this.isLoading=!1,this.reason=e,this.loadingInBackgroundRecorder.pause(),this.loadingRecorder.pause())}startOnPageTimer(e){this.isOnPage=!0,this.inBackground=e,this.notifyTimers(e,this.onPageRecorder,this.onPageBackgroundRecorder)}stopOnPageTimer(){this.isOnPage&&(this.isOnPage=!1,this.onPageRecorder.pause(),this.onPageBackgroundRecorder.pause())}setBackGroundState(e){this.inBackground=e,this.isLoading&&this.notifyTimers(e,this.loadingRecorder,this.loadingInBackgroundRecorder),this.isOnPage&&this.notifyTimers(e,this.onPageRecorder,this.onPageBackgroundRecorder)}notifyTimers(e,t,i){e?(t.pause(),i.start()):(t.start(),i.pause())}onForegrounded(){this.setBackGroundState(!1)}onBackgrounded(){this.setBackGroundState(!0)}stopTracking(){this.loadingRecorder.pause(),this.loadingInBackgroundRecorder.pause(),this.onPageRecorder.pause(),this.onPageBackgroundRecorder.pause()}}class Mi extends ki{constructor(e,t=globalThis.HYPRNetworkController){super(e),this.networkRequestController=t}onBrowserClosed(){if(this.stopTracking(),console.debug(`onBrowserClosed with time ${this.onPageRecorder.duration}`),!T(this.trackingUrl))return void console.error("Invalid BrowserTrackingDurationUrl");const e=this.trackingUrl.replace("TIME_ON_SITE",this.onPageRecorder.duration);this.networkRequestController.get(e)}}const xi="NONE",Fi="STARTED",Di="COMPLETED",Bi={_audioAdState:xi,setAudioAdState(e){if(e!==this._audioAdState){if(e===Fi)this.audioEventPublisher?.audioStarted();else if(this._audioAdState===Fi)this.audioEventPublisher?.audioEnded();else if(e===Di)return void console.error(`[BVM] Audio state cannot be set to complete.  Currently set to ${this._audioAdState}`);this._audioAdState=e}},audioEvent(e){if("complete"===e)console.debug("[BVM] Ending audio on complete audio event"),this.setAudioAdState(Di);else if("start"===e){console.debug("[BVM] starting audio on start audio event"),this.setAudioAdState(Fi);const{outputVolume:e,isMuted:t}=et();this.audioStatusManager?.onVolumeChange(e),this.audioStatusManager?.onMuteChange(t)}else console.error(`[BVM] Unknown audio event received: ${e}`)}},Li="</head>";class $i extends Oi{constructor({audioStatusManager:e,audioEventPublisher:t},i,r,s,n,...o){super(...o),console.debug(`[BVM] ${this.instanceId}`),this.hasFiredImpression=!1,this.hasFiredWin=!1,this.userInteracted=!1,this.visibilityRateCheck=200,this.opacityThresholdPercent=100,this.currentAdData=void 0,this.visibilityData=void 0,this.audioEventPublisher=t,this.audioStatusManager=e,this.audioStatusManager?.addObserver(this),this.impressionTracker=i(this.placement,this.networkRequestController),this.winTracker=n(this.placement,this.networkRequestController),this.clickReporting=r(this.networkRequestController),this.timeOnSiteFactory=s(this.placement,this.networkRequestController)}get audioAdState(){return this._audioAdState}set audioAdState(e){this.setAudioAdState?.apply(this,[e])}loadAd(e){if(console.debug(`[BVM] Loading ads with ${JSON.stringify(e)}`),this.audioAdState=xi,this.hasFiredImpression=!1,this.hasFiredWin=!1,!this.hasPlacement())return this.presenter.loadAdFailed("PLACEMENT_DOES_NOT_EXIST"),void(this.audioAdState=xi);this.placement.loadAd(e,((e,t)=>{console.debug(`[BVM] Ad load complete for Banner Placement ${e}, isAdAvailable: ${this.placement.isAdAvailable()}, error: ${t}`),void 0===t&&this.placement.isAdAvailable()?(this.presenter.loadAdSuccess(),this.currentAdData=this.getMraidEnabledAdHTML(),this.isViewable()||this.setCurrentUrl("about:blank"),this.attemptToShowAd()):(this.audioAdState=xi,this.currentAdData=void 0,this.setCurrentUrl("about:blank"),this.presenter.loadAdFailed("NO_FILL"))}))}hasPlacement(){return void 0!==this.placement}getMraidEnabledAdHTML(){return this.placement.ad.ad_html.replace(Li,vi.getMraidJSTag()+Li)}onParentViewChangeEvent(e){super.onParentViewChangeEvent(e),this.hasParentView||(this.audioAdState=Di),this.updateVisibilityTracking()}containerVisibleChange(e){super.containerVisibleChange(e),this.updateVisibilityTracking()}onWebViewLoadData(){}onModalClosed(){super.onModalClosed()}fireBannerImpressionAttemptIfReady(){if(this.hasFiredImpression||!this.hasParentView||!1===this.visible)return!1;const e={width:0,height:0,...this.currentSizeData};if(e.width<=0&&e.height<=0)return console.debug(`[BVM] Container size not set for ${this.instanceId} when attempting impression`),!1;this.hasFiredImpression=!0,console.debug(`[BVM] Firing Impression attempt for placement: ${this.placement.name} with id ${this.instanceId} and impression id: ${this.placement.getImpressionId()}`);const t=this.placement.getBannerImpressionSize();return this.validateContainerSize(t,e),this.impressionTracker(),!0}fireBannerWinAttemptIfReady(){return!(this.hasFiredWin||!this.hasParentView||!1===this.visible)&&(this.hasFiredWin=!0,console.debug(`[BVM] Firing Win attempt for placement: ${this.placement.name} with id ${this.instanceId}`),this.winTracker(),!0)}addContainerToSegment(e={}){if(!(e.user?.data&&e.user.data[0]&&e.user.data[0].segment&&e.user.data[0].segment[0]))return;const t=e.user?.data[0]?.segment[0],i={width:0,height:0,...this.currentSizeData};t.banner_container_width=i.width,t.banner_container_height=i.height}validateContainerSize(e,t){const i=this.placement.ad.acceptableAdSizeVariance;(i<e.w-t.width||i<e.h-t.height)&&this.eventController.onClientErrorEvent(re.getBannerContainerSizeMismatchedError(`Mismatched banner size on impression(${this.instanceId}).  Expected container size (${e.w}x${e.h}) found (${t.width}x${t.height})`))}javaScriptAlertAttempt(e){return this.userInteracted}permissionRequest(e){this.denyPermissionRequest(e)}shouldBootstrapMraid(){return!0}shouldAllowWindowOpenEvent(e){return this.onBannerClicked(),!0}nativeBrowserWillPresent(e){super.nativeBrowserWillPresent(e),this.fireClickTraffic(e.initialUrl)}fireClickTraffic(e){this.clickReporting(this.placement.getClickReportingUrl(),e)}onBannerClicked(){this.presenter.onAdClicked()}captureImage(){return!1}generateTimeOnSiteTracking(){return new Mi(this.placement.getTimeOnSiteUrl())}scrollingEnabled(){return!1}shouldScrollBounce(){return!1}allowsWebViewLinkPreview(){return!1}webViewAlpha(){return"00"}isPinchEnabled(){return!1}getAdModel(){return this.placement?.ad}setUserInteracted(e){void 0!==e.interacted&&(this.userInteracted=e.interacted)}onVisibleEvent(e){const t=this.isViewable();this.visibilityData=e,this.attemptToShowAd(),t!==this.isViewable()&&this.reportVisibilityChanged()}reportVisibilityChanged(){super.reportVisibilityChanged(),this.publishCustomEvent(Ai.EVENT_NAME,this.isViewable()?Ai.EVENT_VIEWABLE:Ai.EVENT_NOT_VIEWABLE)}updateVisibilityTracking(){console.debug(`[BVM] updateVisibilityTracking ${this.visible} ${this.hasParentView}`),this.visible&&this.hasParentView?this.presenter.startVisibilityTracking(this.visibilityRateCheck,this.opacityThresholdPercent):(this.presenter.stopVisibilityTracking(),this.visibilityData=void 0,this.reportVisibilityChanged())}attemptToShowAd(){this.isViewable()&&void 0!==this.currentAdData&&(console.debug("[BVM] Banner ad will be shown."),this.setCurrentData(this.currentAdData),this.fireBannerImpressionAttemptIfReady(),this.fireBannerWinAttemptIfReady(),this.currentAdData=void 0,void 0===this.placement.ad?console.debug("[BVM] Ad Undefined"):console.debug("[BVM] Ad Defined"))}isViewable(){return!(!this.visible||!this.hasParentView||this.backgrounded||!1!==this.visibilityData?.fullyOffscreen||!0!==this.visibilityData?.parentAlphaPassesThreshold||!0!==this.visibilityData?.isShown)}storePicture(e){super.storePicture(e),this.fireClickTraffic(e)}createCalendarEvent(e){this.fireClickTraffic(null),super.createCalendarEvent(e)}destroy(){this.audioAdState=Di,this.audioStatusManager?.removeObserver(this)}}Object.assign($i.prototype,Bi);class Ui{constructor(e,t,i,r=globalThis.HYPRNetworkController,s=HYPRRequestParameterManager){this.catalogFrameUrl=e,this.recoveryParams=void 0,this.placement=t,this.ad=i,this.requestParameterManager=s,this.networkRequestController=r,this.clickReportingUrl=void 0,this.thankYouURL=void 0,this.trampoline=void 0,this.htmlBody=void 0,this.catalogFrameError=void 0,this.preloading=!1}async getWebAd(e=!1){this.preloading=e;const t=await this.startCatalogFrameRequest();let i;i=void 0!==this.htmlBody?this.catalogFrameUrl:this.trampoline?.redirection_url;return{error:t,pageUrl:i,html:this.htmlBody}}async getTrampolineResponse(){const e=await this.startCatalogFrameRequest();console.debug("[CatalogFramePromise] completed trampoline request");const{trampoline:t}=this;return{error:e,trampoline:t}}mergeTrampoline(e){const t=JSON.parse(e);void 0===this.htmlBody&&void 0===this.trampoline?console.debug("[CatalogFrame] not setting trampoline"):this.htmlBody&&void 0===this.trampoline?(console.debug("[CatalogFrame] setting trampoline from app.js"),this.trampoline=t):void 0!==this.trampoline.viewing_id&&""!==this.trampoline.viewing_id||""===t.viewing_id?y(this.trampoline.click_reporting_url)&&""!==t.click_reporting_url&&(console.debug("[CatalogFrame] Merging click reporting url from app.js"),this.trampoline.click_reporting_url=`${t.click_reporting_url}`):(console.debug("[CatalogFrame] Merging viewing ID from app.js for preloaded mraid"),this.trampoline.viewing_id=`${t.viewing_id}`)}storeRecoveryParams(e){this.recoveryParams=e}shouldReloadCatalogFrame(e){const{url:t}=e;return t.startsWith(this.catalogFrameUrl)&&void 0!==this.recoveryParams}webtrafficSdkConfiguration(){return void 0===this.trampoline||Object.keys(this.trampoline).length<1?{}:{completion_url:this.completionUrl(),maximum_page_load_wait_time_in_seconds:this.trampoline.maximum_page_load_wait_time_in_seconds,viewing_id:this.trampoline.viewing_id,minimum_visit_time_in_seconds:this.trampoline.visit_length,urls:this.webTrafficPagesArray()}}pageUrl(){return this.trampoline?.redirection_url}completionUrl(){return void 0!==this.trampoline.redirection_url?`${this.trampoline.redirection_url}&do_completion=1&phase=thank_you&recovery=1`:""}async startCatalogFrameRequest(){this.updateCatalogFrameUrl();const{response:e,body:t,error:i,headers:r}=await this.networkRequestController.postAsync(this.catalogFrameUrl,this.requestParams(),Ui.requestConfig());let s;if(void 0===i&&f.validResponseStatus(e)&&void 0!==r){if(f.validHtmlType(r)&&void 0!==t)return void(this.htmlBody=t);f.validJSONType(r)||(s="Unparsable catalog frame response")}else console.error(`catalogFrame error received: ${i}`),s=`CatalogFrame error: ${i}, status Code: ${e}`;return void 0!==s?(this.catalogFrameError=s,s):(s=this.handleTrampolineBody(t),void 0!==s&&(this.catalogFrameError=s),s)}requestParams(e=this.placement,t=this.ad){const i=this.requestParameterManager.getCatalogFrameParams(),r=e.compileRequestParamsFromParams(i,!1,t);return h.compact(r)}updateCatalogFrameUrl(){void 0!==this.recoveryParams&&(this.catalogFrameUrl=`${this.catalogFrameUrl.split("?")[0]}?${this.recoveryParams}`,this.recoveryParams=void 0)}handleTrampolineBody(e){console.debug("CatalogFrame.handleTrampolineBody()");const t=ce.parseJSON(e);return"object"==typeof t&&(0===Object.keys(t).length?"No trampoline keys":!1===this.preloading&&void 0===t.token?"No token parameter":void 0===t.reward_token?"No reward_token parameter":!1===this.preloading&&void 0===t.viewing_id?"No viewing_id":void(this.trampoline=t))}webTrafficDynamicPageArray(e){const t=this.webTrafficPagesArray();return 1!==t.length?(console.error(`Unexpected webtraffic dynamic page length: ${t.length}`),t):"placeholder"!==t[0].url?(console.error(`webtraffic dynamic page missing expected token, found url: ${t[0].url}`),t):(t[0].url=e,t)}webTrafficPagesArray(){const e="object"==typeof this.trampoline.page_load_js?this.trampoline.page_load_js:{},t=e.map,i=e.js,r=Array.isArray(this.trampoline.wtu_ids)&&this.trampoline.urls.length===this.trampoline.wtu_ids.length?this.trampoline.wtu_ids:void 0,s=[];for(const e in this.trampoline.urls)if(this.trampoline.urls.hasOwnProperty(e)){const n=this.trampoline.urls[e];let o;void 0!==t&&void 0!==i&&(o=i[t[e]]),void 0===o&&(o="");const a={url:n,on_page_load_js:[o]};void 0!==r&&(a.wtu_id=r[e]),s.push(a)}return s}impressionURLs(){const e=[];if(this.trampoline.tracking_impression_html.length>0){const t=this.trampoline.tracking_impression_html.replace(/"/g,"'").split("'");for(const i of t)ce.urlValidation(i)&&e.push(i)}return e}static requestConfig(){return new t(!0,s,n,{"Content-Type":r,Accept:i})}}class Wi extends Oi{constructor(e,t,i,r={},...s){super(...s),this.pageReadyController=t,this.pageReadyController.pageReadyListener=this,this.presentationListener=e,this.customData=r,this.clickReporting=i(this.networkRequestController),void 0!==this.placement&&(r.placementId=this.placement.id),this.catalogFrame=void 0,this.impressionFired=!1,this.recoveryParams=void 0,this.presenter=void 0,this.adCompleted=!1,void 0!==this.placement&&(this.ad=this.placement.ad),this.thankYouUrl=void 0,this.viewingId=void 0,this.queryParams=void 0,this.payoutComplete=!1,this.storedProgressStates=[],this.closable=!1,this.backButtonEnabled=!1,this.presenterSubscriptions.push("closable"),this.presenterSubscriptions.push("backButtonEnabled"),this.closableWithoutDialog=!1}get closable(){return this._closable}set closable(e){this._closable=e,this.presenter?.setClosable(e)}get backButtonEnabled(){return this._backButtonEnabled}set backButtonEnabled(e){this._backButtonEnabled=e,this.presenter?.setBackButtonEnabled(e)}beginFullScreenPresentation(e){this.ad=e,void 0!==this.ad?(this.catalogFrame=this.getCatalogFrame(),this.presentAdForPlacement(this.placement,this.ad),this.pageReadyController.beginPageReadyTimer(this.computePageReadyTime()),this.closable=void 0!==this?.ad?.show_close_button&&this.ad.show_close_button):this.presentNoAdForPlacement(this.placement)}presentNoAdForPlacement(e){console.debug(`[FSVM] PresentationController.showFullscreenAd(${e.name}) has no ad to show`),this.pageReadyController.stopPageReadyTimer(),this.eventController.sendNoAdTracking(e),this.presentationListener.showNoAd(e.getUIComponentsString())}presentAdForPlacement(e,t){if(void 0===t)return console.debug(`[FSVM] PresentationController.presentAdForPlacement(${e.name}) has no ad to show`),void this.presentNoAdForPlacement(e);console.debug(`[FSVM] PresentationController.presentAdForPlacement(${e.name}) to show ${t.getAdType()} offer`),t.hasAd()?(this.presentationListener.onDisplayAd(this.instanceId,t.getAdType(),t.getAdString()),this.loadPageFromCatalogFrame()):(console.debug(`[FSVM] PresentationController.presentAdForPlacement(${e.name}) has no ad to show`),this.presentNoAdForPlacement(e))}handleJSMessageFromWebView(e){const{name:t,body:i}=e;switch(t){case"pageReady":this.pageReadyController.onPageReadyFinished(),this.presenter.reportPowerState();break;case"setRecoveryPostParameters":this.catalogFrame?.storeRecoveryParams(i);break;case"payoutComplete":this.payoutComplete=!0,this.updateAdProgressState(Y.PAYOUT_COMPLETE);break;case"setClosable":this.closable=!0;break;case"close":case"closeAd":this.updateAdClosedAction("close"===t?j.MRAID_CLOSE:j.CLOSE_AD),this.adCompleted||void 0===this.ad?.cancellation_dialog?this.presenter.closeAdExperience():this.presenter.showCancelDialog(this.ad.cancellation_dialog.message,this.ad.cancellation_dialog.exit,this.ad.cancellation_dialog.continue);break;case"adDidComplete":this.updateAdProgressState(Y.COMPLETED),this.closable=!0,this.adCompleted=!0,this.presenter.dismissOfferCancellationDialog();break;case"presentDialog":this.presenter.showDialog(i);break;case"abort":"presentDialog"===i?this.updateAdClosedAction(j.PRESENT_DIALOG_OK):this.updateAdClosedAction(j.ABORT),this.presenter.closeAdExperience();break;case"startOMSession":this.presenter.startOMSession(i);break;case"endOMSession":this.presenter.endOMSession();break;case"useCustomClose":this.adCompleted?console.error("[FSVM] useCustomClose invoked after ad completed"):this.presenter.useCustomClose("true"===i);break;case"setTrampoline":console.debug(`[FSVM] setTrampoline ${i}`),this.catalogFrame?.mergeTrampoline(i),this.onCatalogFrameSuccess();break;default:super.handleJSMessageFromWebView(e)}}getCatalogFrame(){return void 0===this.catalogFrame&&(this.catalogFrame=new Ui(this.ad?.catalog_frame_url,this.placement,this.ad)),this.catalogFrame}async loadPageFromCatalogFrame(){console.debug("[FSVM] loadPageFromCatalogFrame() started");const{error:e,pageUrl:t,html:i}=await this.catalogFrame.getWebAd();void 0===e?(void 0!==i?this.setCurrentData(i,t):this.setCurrentUrl(t),this.onCatalogFrameSuccess()):this.onShowError(e)}urlNavigationAttempt(e){const{url:t}=e;return this.catalogFrame?.shouldReloadCatalogFrame(e)?(console.debug(`[FSVM] CatalogFrame Reload for placement: ${this.placement.name} params: ${this.catalogFrame?.recoveryParams}`),this.loadPageFromCatalogFrame(),JSON.stringify(new ti(ri,t))):super.urlNavigationAttempt(e)}shouldAllowWindowOpenEvent(e){return!1===this.hasBecomeVisible?(console.error("[FSVM] rejecting Window.open attempt before Ad was displayed"),!1):super.shouldAllowWindowOpenEvent(e)}nativeBrowserWillPresent(e){super.nativeBrowserWillPresent(e),this.fireClickTraffic(e.initialUrl)}fireClickTraffic(e){void 0!==this.clickReporting?this.clickReporting(this.clickReportingUrl,e):console.debug(`[FSVM] Click reporting will be ignore for ${this.placement.name}.`)}javaScriptAlertAttempt(e){return!1===this.hasBecomeVisible?(console.error("[FSVM] rejecting javaScriptAlertAttempt before Ad was displayed"),!1):super.javaScriptAlertAttempt(e)}openMeasurementCustomData(){return JSON.stringify(this.customData)}shouldBootstrapMraid(){return!1}shouldScrollBounce(){return!0}webViewBackground(){return this.ad.getAdType()===x?"ffffff":"000000"}playbackRequiresUserAction(){return void 0===this.ad?super.playbackRequiresUserAction():this.ad.video_requires_user_action||super.playbackRequiresUserAction()}onShowError(e){console.debug(`[FSVM] onShowError: ${e}`),this.presenter.showErrorDialog("There was an error displaying the ad.")}onCatalogFrameSuccess(){if(void 0===this.catalogFrame.trampoline)return void console.debug("[FSVM] onCatalogFrameSuccess cannot proceed.  No trampoline");console.debug(`[FSVM] Attempting Catalog Frame response from onCatalogFrameSuccess callback${JSON.stringify(this.catalogFrame.trampoline)}`);const e={viewingID:this.catalogFrame.trampoline.viewing_id,distributorID:this.catalogFrame.trampoline.distributor_id,userID:this.catalogFrame.trampoline.uid,offerType:this.ad.getAdType()};this.viewingId=this.catalogFrame.trampoline.viewing_id,this.thankYouUrl=this.catalogFrame.trampoline.redirection_url,this.clickReportingUrl=this.catalogFrame.trampoline.click_reporting_url,this.startAdProgressTracking(e)}computePageReadyTime(){return void 0===this.ad?8:void 0!==this.ad.preloaded_mraid_page_ready_timeout&&void 0!==this.preloadInstanceId?this.ad.preloaded_mraid_page_ready_timeout:this.ad.offer_initiation_timeout_in_seconds||8}onClose(){this.adWillClose()}onWebViewTermination(){const e=void 0!==this.ad?.enable_webview_reload?this.ad.enable_webview_reload:super.onWebViewTermination();return!1===e&&this.updateAdClosedAction(j.WEBVIEW_CRASH),e}permissionRequest(e){if(!1===this.hasBecomeVisible)return console.error("[FSVM] rejecting permissionRequest attempt before Ad was displayed"),void this.denyPermissionRequest(e);super.permissionRequest(e)}createCalendarEvent(e){!1!==this.hasBecomeVisible?super.createCalendarEvent(e):console.error("[FSVM] rejecting createCalendarEvent attempt before Ad was displayed")}storePicture(e){!1!==this.hasBecomeVisible?super.storePicture(e):console.error("[FSVM] rejecting storePicture attempt before Ad was displayed")}captureImage(){return!1===this.hasBecomeVisible?(console.error("[FSVM] rejecting captureImage attempt before Ad was displayed"),!1):super.captureImage()}isPageReadyActiveOrFinished(){return this.pageReadyController.isPageReadyActiveOrFinished()}isPageReady(){return this.pageReadyController.pageReady}onPageReadyFinished(){}onPageReadyExpired(){console.debug("[FSVM] onPageReadyExpired. Setting ad closable"),this.closable=!0,this.closableWithoutDialog=!0}shouldScaleViewport(){return void 0!==this.getAdModel()?.scale_viewport?this.getAdModel().scale_viewport:super.shouldScaleViewport()}startAdProgressTracking(e){let t="";const i=Object.keys(e);for(const r of["viewingID","distributorID","userID","offerType"])i.includes(r)&&"string"==typeof e[r]||(t+=`Valid ${r} missing from parameters. `);if(t.length>0)return console.debug(`[FSVM] error with startAdProgressTracking() - ${t}`),t;const{viewingID:r,distributorID:s,userID:n,offerType:o}=e;return void 0!==this.adProgress?"Ad Progress already in progress.":(this.adProgress=new ne(r,s,n,o),this.storedProgressStates.forEach((e=>this.updateAdProgressState(e))),null)}updateAdProgressState(e){if(console.debug(`[FSVM] updateAdProgressState to ${e}`),void 0!==this.adProgress||e!==Y.IN_PROGRESS)return void 0===this.adProgress?(console.debug(`[FSVM] updateAdProgressState before adProgress set ${e}`),void this.storedProgressStates.push(e)):void this.adProgress.setProgressState(e);console.debug("[FSVM] Ad Progress set to IN_PROGRESS before ad started.  Ignoring.")}updateAdClosedAction(e){console.debug(`[FSVM] updateAdClosedAction to ${JSON.stringify(e)}`),void 0!==this.adProgress?this.adProgress.setClosedAction(e):console.debug(`[FSVM] updateAdClosedAction before adProgress set ${e}`)}getPresenterPromise(){return new Promise((e=>{this.resolvePresenter=()=>{console.debug("[FSVM] [CatalogFramePromise] resolving presenter"),e(void 0!==this.presenter)}}))}async waitForTrampolineAndPresenter(){this.catalogFrame=this.getCatalogFrame();const e=this.catalogFrame.getTrampolineResponse(),t=this.getPresenterPromise();console.debug("[FSVM] [CatalogFramePromise] will start promise");const[{error:i,trampoline:r},s]=await Promise.all([e,t]);return console.debug("[FSVM] [CatalogFramePromise] completed promise"),s&&void 0===i?(console.debug("[FSVM] [CatalogFramePromise] success"),r):(console.debug("[FSVM] [CatalogFramePromise] error"),void this.onShowError(i))}setPresenter(e){super.setPresenter(e),"function"==typeof this.resolvePresenter&&(console.debug("[FSVM] [CatalogFramePromise] will resolve presenter promise"),this.resolvePresenter(),this.resolvePresenter=void 0)}onForegroundTransition(){super.onForegroundTransition(),this.updateAdProgressState(Y.IN_PROGRESS)}onBackgroundTransition(){super.onBackgroundTransition(),this.updateAdProgressState(Y.BACKGROUNDED)}nativeClosePressed(){this.exitAdExperience(j.NATIVE_CLOSE_BUTTON)}cancelDialogExitPressed(){this.updateAdClosedAction(j.CANCELLATION_DIALOG_OK),this.presenter.closeAdExperience()}onErrorDialogOKPressed(){this.updateAdClosedAction(j.ERROR_DIALOG_OK),this.presenter.closeAdExperience()}unknownErrorOccurred(e){console.error(`[FSVM] Unknown error occurred:  ${e}. Closing Ad.`),this.updateAdClosedAction(j.UNKNOWN),this.onShowError(e)}onBackButtonPressed(){if(console.debug("[FSVM] onBackButtonPressed"),this.webViewHistory?.canNavigateBack)return console.debug("[FSVM] Navigating Back"),void this.navigateBack();this.closable||this.adCompleted?this.exitAdExperience(j.BACK_PRESS):console.debug("[FSVM] This ad is non-closable.")}exitAdExperience(e){console.debug(`[FSVM] exitAdExperience ${e}`),this.adCompleted||this.closableWithoutDialog||void 0===this.ad.cancellation_dialog?(console.debug("[FSVM] closeAdExperience"),this.updateAdClosedAction(e),this.presenter.closeAdExperience()):(console.debug("[FSVM] showCancelDialog"),this.presenter.showCancelDialog(this.ad.cancellation_dialog.message,this.ad.cancellation_dialog.exit,this.ad.cancellation_dialog.continue))}internetLossDetected(){this.closable=!0}onWebViewHistoryChanged(e){super.onWebViewHistoryChanged(e),this.backButtonEnabled=e.canNavigateBack}}const qi="hyprmx.com/adinfo.html";class Hi extends Oi{constructor(e,t="webview",i="",r,s,...n){super(...n),this.baseViewModel=r,this.clickMode=t,this.onPageJS=i,this.timeOnSiteTracker=void 0,this.isPresenting=!1,"store"!==this.clickMode&&(this.timeOnSiteTracker=s),this._backButtonEnabled=!1,this._forwardButtonEnabled=!1,this._header="",this.presenterSubscriptions.push("backButtonEnabled"),this.presenterSubscriptions.push("forwardButtonEnabled"),this.presenterSubscriptions.push("header"),this.setCurrentUrl(e)}get forwardButtonEnabled(){return this._forwardButtonEnabled}set forwardButtonEnabled(e){this._forwardButtonEnabled=e,this.presenter?.setForwardButtonEnabled(e)}get backButtonEnabled(){return this._backButtonEnabled}set backButtonEnabled(e){this._backButtonEnabled=e,this.presenter?.setBackButtonEnabled(e)}get header(){return this._header}set header(e){this._header=e,this.presenter?.setHeader(e)}onBrowserReady(){console.debug("onBrowserReady"),this.timeOnSiteTracker?.startOnPageTimer(!1)}adInfoPattern(){return"undefined"!=typeof HYPRInitializationController&&HYPRInitializationController.getConfiguration().ad_info_url||qi}onNavigateBackPressed(){this.navigateBack()}onNavigateForwardPressed(){this.navigateForward()}onSharePressed(){const e=this.webViewHistory.currentUrl;this.presenter.openShareSheet(JSON.stringify({data:e}))}onClose(){this.timeOnSiteTracker?.onBrowserClosed(),this.baseViewModel.onModalClosed()}onBackButtonPressed(){this.webViewHistory.canNavigateBack?this.navigateBack():this.triggerClose()}hasOnPageJS(){return this.onPageJS.length>0}showBrowser(e){this.setCurrentUrl(e.initialUrl)}triggerClose(){this.presenter.closeBrowser()}openOutsideApplication(e){super.openOutsideApplication(e),this.triggerClose()}handlePageStartedFromWebView(e){this.hasOnPageJS()&&void 0===this.onPageResolve&&new Promise((e=>{this.onPageResolve=e,console.debug("[BrowserOnPageJS] promise stored"),this.onPageJsTimeout=this.timerController.startTimer(8e3,(()=>{console.debug("[BrowserOnPageJS] timeout reached"),this.onPageJsTimeout=void 0,this.resolveOnPageJS()}))})).then((()=>{console.debug(`[BrowserOnPageJS] Firing onPageJS on ClickThrough: ${this.url}, for Placement: ${this.placement}`),this.publishASyncScriptEvent(this.onPageJS)})),this.presenter.webViewLoadStarted(e)}handlePageFinishFromWebView(e){console.debug(`handlePageFinishFromWebView: ${e}`),this.resolveOnPageJS(),super.handlePageFinishFromWebView(e)}resolveOnPageJS(){"function"==typeof this.onPageResolve&&(console.debug("[BrowserOnPageJS] will resolve onPageJS Promise"),this.onPageResolve()),this.onPageResolve=void 0,void 0!==this.onPageJsTimeout&&(this.timerController.stopTimer(this.onPageJsTimeout),console.debug("[BrowserOnPageJS] stopped timer")),this.onPageJsTimeout=void 0}onForegroundTransition(){super.onForegroundTransition(),this.timeOnSiteTracker?.onForegrounded()}onBackgroundTransition(){super.onBackgroundTransition(),this.timeOnSiteTracker?.onBackgrounded()}getAdModel(){return this.baseViewModel?.getAdModel()}shouldScaleViewport(){return!0}onWebViewHistoryChanged(e){this.backButtonEnabled!==e.canNavigateBack&&(this.backButtonEnabled=e.canNavigateBack),this.forwardButtonEnabled!==e.canNavigateForward&&(this.forwardButtonEnabled=e.canNavigateForward),this.header!==e.currentHost&&(this.header=e.currentHost)}}const Ji={viewModelMap:new Map,baseAdIdentifierIndex:0,removeViewModel(e){if(console.debug(`[VMC] removeViewModel ${e}`),this.viewModelMap.has(e)){console.debug(`[VMC] ViewModel found for ${e} and will be destroyed`);const t=this.viewModelMap.get(e);t.webViewPresenter=null,t.presenter=null,this.viewModelMap.delete(e),t.destroy()}},getViewModel(e){if(this.viewModelMap.has(e))return this.viewModelMap.get(e);throw new Error(`No matching viewModel for id: ${e}`)},getFullScreenViewModelForPlacementName(e){console.debug(this.toContentString());for(const[,t]of this.viewModelMap.entries())if(t.placement.name===e&&t instanceof Wi)return console.debug(`[VMC] ViewModel found for placement: ${e}`),t;console.debug(`[VMC] ViewModel not found for placement: ${e}`)},storeViewModel(e,t){this.viewModelMap.has(e)&&console.debug(`[VMC] ViewModel already found for identifier: ${e}.  Replacing VM in store`),this.viewModelMap.set(e,t)},generateUniqueId(){const e=`ViewModel-${this.baseAdIdentifierIndex}`;return this.baseAdIdentifierIndex+=1,e},publishEvent(e,t,i){try{const r=this.getViewModel(e);return r[t].apply(r,i)}catch(e){return`publishEventError: ${e.toString()}`}},reset(){this.viewModelMap=new Map,this.baseAdIdentifierIndex=0},toContentString(){const e=[];for(const[t,i]of this.viewModelMap.entries()){let r="unknown";i instanceof Wi?r="FullscreenWebAdViewModel":i instanceof Hi?r="HyprMXBrowserViewModel":i instanceof $i&&(r="BannerViewModel"),e.push(`${t}: type ${r}, placement: ${i?.placement?.name}`)}return JSON.stringify(e)}};globalThis.ViewModelController=Ji;class Yi{constructor(e){this.timerController=e,this.pageReadyListener=void 0,this.pageReady=!1,this.pageReadyTimer=void 0}beginPageReadyTimer(e){if(void 0===this.pageReadyListener)throw new Error("PageReadyController.beginPageReadyTimer called with no pageReadyListener set");return this.pageReady?(console.log("[pageReady] already complete.  Not starting timer."),!1):this.isPageReadyTimerActive()?(console.log("[pageReady] already active.  Not starting timer."),!1):e<=0?(console.log(`[pageReady] Invalid time ${e}.  Not starting timer.`),!1):(console.debug(`[pageReady] initiating timer for ${e}s`),this.pageReadyTimer=this.timerController.startTimer(1e3*e,(()=>{this.onPageReadyExpired()})),!0)}onPageReadyExpired(){console.debug("[pageReady] timer expired"),this.pageReadyTimer=void 0,this.pageReadyListener.onPageReadyExpired()}onPageReadyFinished(){console.debug("[pageReady] onPageReadyFinished"),this.pageReady=!0,this.stopPageReadyTimer(),this.pageReadyListener.onPageReadyFinished()}stopPageReadyTimer(){console.debug("[pageReady] stopPageReadyTimer"),this.isPageReadyTimerActive()&&(console.debug("[pageReady] stopping timer"),this.timerController?.stopTimer(this.pageReadyTimer),console.debug("[pageReady] stopped timer"),this.pageReadyTimer=void 0)}isPageReadyTimerActive(){return void 0!==this.pageReadyTimer}isPageReady(){return this.pageReady}isPageReadyActiveOrFinished(){return this.isPageReady()||this.isPageReadyTimerActive()}}class ji extends ki{constructor(e,t=globalThis.HYPREventController){super(e),this.eventController=t}sendTracking(){void 0!==this.trackingUrl&&(this.stopTracking(),this.eventController.sendWebTrafficTimeSpent(this.trackingUrl,JSON.stringify(this.getTimeSpent())),this.trackingUrl=void 0)}getTimeSpent(){return{reason:this.reason,page_load_time:{foreground:this.loadingRecorder.duration,background:this.loadingInBackgroundRecorder.duration},time_on_page:{foreground:this.onPageRecorder.duration,background:this.onPageBackgroundRecorder.duration}}}}const zi="not_started",Ki="waiting_on_catalog",Gi="proscenium",Xi="wt_start_experience",Qi="wt_loading",Zi="wt_counting",er="wt_waiting_on_next",tr="thank_you",ir="offer_completion";class rr extends Wi{constructor(...e){super(...e),this.currentStepIndex=0,this.webtrafficConfiguration=void 0,this.currentTrackingSession=void 0,this.state=zi,this.hasStartedWTExperience=!1,this.webTrafficDynamicUrl=void 0,this.maxWaitTimeTimer=void 0,this.delayedWT=!1,this._forwardButtonEnabled=!1,this.presenterSubscriptions.push("forwardButtonEnabled")}get forwardButtonEnabled(){return this._forwardButtonEnabled}set forwardButtonEnabled(e){this._forwardButtonEnabled=e,this.presenter?.setForwardButtonEnabled(e)}async presentAdForPlacement(e,t){if(console.debug(`[WTVM] WebTrafficViewModel.presentAdForPlacement(${e.name}) to show ${t.getAdType()} offer`),this.presentationListener.onDisplayAd(this.instanceId,t.getAdType(),t.getAdString()),this.updateWebTrafficHeader(),!0!==t.skip_proscenium)return;this.state=Ki;void 0!==await this.waitForTrampolineAndPresenter()&&(this.pageReadyController.onPageReadyFinished(),this.startWebTraffic(),this.onCatalogFrameSuccess())}setPresenter(e){super.setPresenter(e),!1===this.ad.skip_proscenium&&this.showProscenium()}showProscenium(){this.state===zi&&(this.state=Gi,this.loadPageFromCatalogFrame())}startWebTraffic(){if(this.backgrounded)return this.delayedWT=!0,void console.debug("[WTVM] delaying startWebTraffic until foregrounded");console.debug("[WTVM] startWebTraffic"),this.hasStartedWTExperience?console.debug("[WTVM] Webtraffic Experience has already started."):void 0!==this.presenter?(void 0===this.webtrafficConfiguration&&(this.webtrafficConfiguration=this.catalogFrame.webtrafficSdkConfiguration()),void 0!==this.webtrafficConfiguration?(this.url=void 0,this.hasStartedWTExperience=!0,this.state=Xi,this.updateWebTrafficHeader(),this.sendDurationUpdateTracking(),this.fireImpressionUrls(),this.loadNextPageOfWebTraffic()):console.debug("[WTVM] webtrafficConfiguration not set.  Cannot start.")):console.debug("[WTVM] WTVM presenter not attached.  Cannot start.")}updateWebTrafficHeader(){this.closable=this.ad.show_close_button,this.state===Xi&&this.presenter.showWebTrafficHeader(this.webtrafficConfiguration.urls.length)}sendDurationUpdateTracking(){this.state===Xi&&this.ad.skip_proscenium&&this.eventController.sendDurationUpdateTracking(this.catalogFrame.trampoline.token,"0",this.webtrafficConfiguration.viewing_id)}fireImpressionUrls(){this.state===Xi&&this.ad.skip_proscenium&&this.eventController.sendPixelTrackingEvents(this.catalogFrame.impressionURLs())}loadNextPageOfWebTraffic(){const{url:e,wtu_id:t}=this.webtrafficConfiguration.urls[this.currentStepIndex];this.maxWaitTimeTimer=this.timerController.startTimer(1e3*this.webtrafficConfiguration.maximum_page_load_wait_time_in_seconds,(()=>{this.webTrafficPageLoadTimeout()})),this.state=Qi,this.backButtonEnabled=!1,this.forwardButtonEnabled=!1,this.presenter.loadWebTrafficPage(e,this.currentStepIndex),this.eventController.sendWebTrafficVisitEvent(e,this.webtrafficConfiguration?.viewing_id,t),this.currentTrackingSession=new ji(e),this.currentTrackingSession.startPageLoadingTimer(this.backgrounded)}executeJS(){if(this.state===Zi||this.state===Qi||this.state===er)for(const e of this.webtrafficConfiguration.urls[this.currentStepIndex].on_page_load_js)console.debug("[WTVM] Attaching onPage JS"),this.publishASyncScriptEvent(e);else console.debug("[WTVM] Cannot insert JS.  Not on WT Page")}didTapNext(){this.currentTrackingSession.sendTracking(),this.currentStepIndex+=1,this.loadNextPageOfWebTraffic()}didTapFinish(){this.currentTrackingSession.sendTracking(),this.finishAd()}didTapClose(){console.debug("[WTVM] didTapClose"),(this.adCompleted||this.closableWithoutDialog||void 0===this.ad.cancellation_dialog)&&void 0!==this.maxWaitTimeTimer&&this.timerController.stopTimer(this.maxWaitTimeTimer),this.exitAdExperience(j.NATIVE_CLOSE_BUTTON)}finishAd(){this.ad.skip_thank_you_screen?this.state===ir?console.debug("[WTVM] Debounced finish Ad Call"):(this.state=ir,console.debug("[WTVM] Skipping thank you page"),this.offerCompletionRequest()):(console.debug("[WTVM] Loading thank you"),this.state=tr,this.presenter.loadThankYouPage(this.webtrafficConfiguration.completion_url))}handleJSMessageFromWebView(e){const{name:t,body:i}=e;if("startWebtraffic"===t)this.webtrafficConfiguration=JSON.parse(i),this.startWebTraffic();else super.handleJSMessageFromWebView(e)}handlePageFinishFromWebView(e){super.handlePageFinishFromWebView(e),this.timerController.stopTimer(this.maxWaitTimeTimer),this.transitionToCountdown(G.LOADED)}onWebViewHistoryChanged(e){this.backButtonEnabled=e.canNavigateBack,this.forwardButtonEnabled=e.canNavigateForward}webTrafficPageLoadTimeout(){console.debug("[WTVM] webview maximum page load wait time hit"),this.transitionToCountdown(G.TIMED_OUT)}transitionToCountdown(e){this.executeJS(),this.state===Qi&&(this.state=Zi,this.presenter.startCountDownTimer(this.webtrafficConfiguration.minimum_visit_time_in_seconds),this.currentTrackingSession.stopPageLoadingTimer(e),this.currentTrackingSession.startOnPageTimer(),this.backgrounded&&this.presenter.pauseCountDownTimer())}webTrafficPageMinTimeComplete(){this.state=er,this.currentStepIndex<this.webtrafficConfiguration.urls.length-1?this.presenter.showNextButton():(this.presenter.showFinishButton(),this.closable=!1)}async offerCompletionRequest(){console.debug("[WTVM] offerCompletionRequest");const{code:e,body:t,error:i}=await this.networkRequestController.postAsync(globalThis.COMPLETION_URL,this.getCompletionParams(),l);let r=!0;void 0===i&&f.validResponseStatus(e)||(console.error(`[WTVM] offerCompletionRequest error received: ${i}`),r=!1),this.skipThankYouPage(r)}skipThankYouPage(e){this.payoutComplete=e,this.adCompleted=!0,e&&(this.updateAdProgressState(Y.COMPLETED),this.updateAdProgressState(Y.PAYOUT_COMPLETE)),this.updateAdClosedAction(j.COMPLETE_NO_THANK_YOU),this.presenter.closeAdExperience()}getCompletionParams(){const e={};return e[K.USER_ID]=HYPRRequestParameterManager?.getUserId(),e[K.TOKEN]=this.catalogFrame?.trampoline?.token,e[K.VIEWING_ID]=this.webtrafficConfiguration?.viewing_id,e[K.REWARD_TOKEN]=this.catalogFrame.trampoline?.reward_token,e[K.DISTRIBUTOR_ID]=HYPRRequestParameterManager?.getDistributorID(),e}restoreState(){this.state===ir||this.state===tr?this.finishAd():(this.updateAdClosedAction(j.UNKNOWN),this.presenter.closeAdExperience())}onForegroundTransition(){super.onForegroundTransition(),this.state===Zi&&void 0===this.browserInstance&&this.presenter.resumeCountDownTimer(),console.debug("[WTVM] TimeOnSite resuming from foreground event"),this.currentTrackingSession?.setBackGroundState(!1),this.delayedWT&&(this.delayedWT=!1,this.startWebTraffic())}onBackgroundTransition(){super.onBackgroundTransition(),this.state===Zi&&this.presenter.pauseCountDownTimer(),console.debug("[WTVM] TimeOnSite pausing from background event"),this.currentTrackingSession?.setBackGroundState(!0)}onModalClosed(){super.onModalClosed(),console.debug("[WTVM] Resuming TimeOnSite from Presentation"),this.currentTrackingSession?.setBackGroundState(!1)}nativeBrowserWillPresent(e){super.nativeBrowserWillPresent(e),console.debug("[WTVM] Pausing TimeOnSite for Presentation"),this.currentTrackingSession?.setBackGroundState(!0)}shouldAllowWindowOpenEvent(e){const{url:t}=e;return this.state!==Gi||!this.ad.isNavigationRuleMatch(t)||(this.notifyWindowOpenURLBlock(t),!1)}onWebViewTermination(){const e=void 0!==this.ad?.enable_webview_reload&&this.ad?.enable_webview_reload;return!1===e&&this.updateAdClosedAction(j.WEBVIEW_CRASH),e}}class sr extends Wi{async presentAdForPlacement(e,t){console.debug(`[VVM] PresentationController.presentAdForPlacement(${e.name}) to show ${t.getAdType()} offer`),this.presentationListener.onDisplayAd(this.instanceId,t.getAdType(),t.getAdString());const i=await this.waitForTrampolineAndPresenter();void 0!==i&&(this.onCatalogFrameSuccess(),this.startVast(i))}onCatalogFrameSuccess(){this.pageReadyController.onPageReadyFinished(),super.onCatalogFrameSuccess()}startVast(e){console.debug("[VVM] startVast."),void 0!==this.presenter?void 0!==e?(this.presenter.showLearnMore(),this.presenter.startCatalogDurationTracking(e.probabilityOfDurationUpdate??-1,e.token,e.viewing_id)):console.debug("[VVM] trampoline not set.  Cannot start."):console.debug("[VVM] Presenter not attached.  Cannot start.")}vastVideoNotFound(){console.error("[VVM] Vast video not found. Closing Ad."),this.updateAdClosedAction(j.VAST_VIDEO_DOES_NOT_EXIST),this.onShowError("Video not found")}onBackButtonPressed(){this.closable||this.adCompleted?this.exitAdExperience(j.BACK_PRESS):console.debug("[VVM] This ad is non-closable.")}}class nr extends Wi{presentAdForPlacement(e,t){console.debug(`[MRVM] PresentationController.presentAdForPlacement(${e.name}) to show ${t.getAdType()} offer`),this.presentationListener.onDisplayAd(this.instanceId,t.getAdType(),t.getAdString())}setWebViewPresenter(e){console.debug("[MRVM] mraid setWebViewPresenter."),super.setWebViewPresenter(e),this.lazyLoadCatalogFrame()}setPresenter(e){console.debug("[MRVM] mraid setPresenter."),super.setPresenter(e),void 0===this.catalogFrame?.catalogFrameError?this.pageReadyController.beginPageReadyTimer(this.computePageReadyTime()):this.onShowError(this.catalogFrame?.catalogFrameError)}getCatalogFrame(){let e;return console.debug("[MRVM] presenter status: "+typeof this.presenter),void 0===this.presenter&&void 0!==this.ad?.preload_player_url?(console.debug("[MRVM] selected preload_player_url"),e=this.ad.preload_player_url):(console.debug("[MRVM] selected catalog_frame_url"),e=this.ad?.catalog_frame_url),void 0===this.catalogFrame&&(this.catalogFrame=new Ui(e,this.placement,this.ad)),this.catalogFrame}async lazyLoadCatalogFrame(){if(void 0!==this.catalogFrame&&void 0!==this.catalogFrame?.trampoline||(console.debug("[MRVM] setting catalogFrame."),this.catalogFrame=void 0,this.catalogFrame=this.getCatalogFrame()),console.debug("[MRVM] lazyLoadCatalogFrame."),void 0===this.catalogFrame.trampoline){console.debug(`[MRVM] starting catalog frame load to url: ${this.catalogFrame?.catalogFrameUrl}`);const{pageUrl:e}=await this.catalogFrame.getWebAd(void 0===this.presenter);console.debug("[MRVM] finished catalog frame load."),void 0!==e?(console.debug("[MRVM] setPageUrl()."),this.url=e):console.debug("[MRVM] lazyLoadCatalogFrame - undefined pageUrl.")}void 0!==this.presenter&&void 0!==this.catalogFrame?.catalogFrameError&&this.onShowError(this.catalogFrame?.catalogFrameError)}onCheckMraidReady(){console.debug("[MRVM] onCheckMraidReady()")}handleJSMessageFromWebView(e){const{name:t}=e;if("pageReady"===t)console.debug("[MRVM] pageReady()."),this.pageReadyController.onPageReadyFinished(),this.presenter?.reportPowerState(),this.onCheckMraidReady();else super.handleJSMessageFromWebView(e)}shouldBootstrapMraid(){return!0}shouldScrollBounce(){return!1}}function or(e,t,i,r){f.validResponseStatus(t)&&void 0===r?console.debug(`[BVM] ${e} Attempt completed with body: ${i}`):console.debug(`[BVM] ${e} Attempt completed with status code ${t} and with error: ${r}`)}function ar(e,t,i){i.get(t,((t,i,r)=>{or(e,t,i,r)}))}function lr(e){return(t,i)=>{if(y(t))return void or("ClickThrough",400,void 0,"No ClickThrough URL found.");if(!t.includes(Xe))return void or("ClickThrough",400,void 0,"No replacement token found on ClickThrough URL.");const r=t.replace(Xe,encodeURIComponent(i));e.get(r,((e,t,i)=>{or("ClickReporting",e,t,i)}))}}function dr(e){return lr(e)}class cr{static viewModel(e,t,i,r,s,n,o=dr){const a=new Yi(globalThis.HYPRTimerController);switch(t){case x:return new rr(r,a,o,s,e,n,i);case k:return new sr(r,a,o,s,e,n,i);case M:return new nr(r,a,o,s,e,n,i);default:return new Wi(r,a,o,s,e,n,i)}}}const hr=4,ur=3;class pr{constructor(e,t=globalThis.HYPRNetworkController,i=HYPRRequestParameterManager){this.networkRequestController=t,this.requestParameterManager=i,this.errorSeverityLevel=ur,this.errorReportingEndpoint=`https://${e}/client_error_captures`}setErrorConfiguration(e,t){this.errorReportingEndpoint=e,this.errorSeverityLevel=t}sendClientErrorCapture(e,t,i){if(console.debug(`Client Error Capture:\n                      errorTypeKey: ${t}\n                      message: ${e}\n                      severity: ${i}`),i<=this.errorSeverityLevel)return;const r=this.requestParameterManager.getErrorParams();r.errorMessage=`${e}`,r.errorTypeKey=t,"function"==typeof console.messages&&(r.value=console.messages()),this.request=this.networkRequestController.post(this.errorReportingEndpoint,r)}}class gr{constructor(e=globalThis.HYPRAudioEventPublisherNative){this.listener=e,this.currentAudioStreams=0}audioStarted(){this.currentAudioStreams+=1,console.debug(`[AEP] audioStarted with ${this.currentAudioStreams} streams`),1===this.currentAudioStreams&&(console.debug("[AEP] calling onAudioStart native"),this.listener.onAudioStart())}audioEnded(){this.currentAudioStreams-=1,console.debug(`[AEP] audioEnded with ${this.currentAudioStreams} streams`),0===this.currentAudioStreams&&(console.debug("[AEP] calling onAudioEnd native"),this.listener.onAudioEnd())}}class mr{eventName=void 0;execute(e,t){void 0!==e?"function"==typeof t.publishCustomEvent&&t.publishCustomEvent(this.eventName,e,!0):console.error(`[WE] ${this.eventName} received with no value.`)}}class fr extends mr{eventName="hyprmx_volume_change"}class vr extends mr{eventName="hyprmx_mute_change"}class br extends mr{eventName="hyprmx_audio_category_change"}class wr{constructor(e,t=globalThis.HYPRNativeAudioListener){this.isActive=!1,this.muteCheckRate=e,this.listener=t,this.observers=[]}activate(e){this.isActive=e,this.listener.setActive(this.isActive,this.muteCheckRate)}addObserver(e){this.observers.push(e)}removeObserver(e){this.observers=this.observers.filter((t=>t!==e))}onVolumeChange(e,t=new fr){console.debug(`[ASM] New volume value: ${e}`),this.observers.forEach((i=>t.execute(e,i)))}onMuteChange(e,t=new vr){this.observers.forEach((i=>t.execute(e,i)))}onAudioCategoryChange(e,t=new br){console.debug(`[ASM] New audio category: ${e}`),this.observers.forEach((i=>t.execute(e,i)))}}function Pr(){return void 0===globalThis.HYPRAudioStatusManager&&(globalThis.HYPRAudioStatusManager=new wr(1,globalThis.HYPRNativeAudioListener)),void 0===globalThis.HYPRAudioEventPublisher&&(globalThis.HYPRAudioEventPublisher=new gr(globalThis.HYPRAudioEventPublisherNative)),{audioStatusManager:globalThis.HYPRAudioStatusManager,audioEventPublisher:globalThis.HYPRAudioEventPublisher}}class Ar{constructor(e,t,i,r,s=globalThis.HYPREventController){this.placement=e,this.nativeListener=r,this.eventController=s,this.setInfo(t),this.uiComponents=globalThis.defaultUIComponents||{},this.setUiComponents(i)}setInfo(e=[]){this.info=e}setUiComponents(e){void 0!==e&&(this.uiComponents=e)}hasQuestions(){return this.info.length>0}count(){return this.info.length}presentRequiredInfo(){const e=JSON.stringify(this.info);this.setInfo(),console.debug(`PresentationController.showFullscreenAd(${this.placement.name}) showing ReqInfo`),this.eventController.sendUserInfoTrackingEvent(this.placement,e,this.placement.ad),this.nativeListener.showRequiredInfo(e,JSON.stringify(this.uiComponents))}async reloadPlacement(e){const t=await new Promise((t=>{console.debug("[Presentation][RIVM] start placement reload");const i=Zt.deepCopy(this.placement);i.loadAd(e,((e,r)=>{console.debug("[Presentation][RIVM] reload network request completed"),void 0!==r&&console.debug(`Error received on loading Ad: ${r}`);const{ad:s,requiredInfo:n,uiComponents:o}=i.popAdData();this.setInfo(n),this.setUiComponents(o),console.debug("[Presentation][RIVM] prequal state updated"),t(s)}))}));return console.debug("[Presentation][RIVM] resolving placement reload"),t}}class Sr{constructor(e,t,i=globalThis.HYPREventController){this.placement=e,this.impressionFired=!1,this.eventController=i;const{ad:r,requiredInfo:s,uiComponents:n}=e?.popAdData?.apply(e)||{};this.ad=r,this.requiredInfoViewModel=new Ar(e,s,n,t)}questionCount(){return this.requiredInfoViewModel.count()}isSession(e){return this.getPlacementName()===e}isValid(){return void 0!==this.placement&&this.placement instanceof fe}getPlacementName(){return this.placement?.name}getAdType(){return this.ad?.getAdType()||""}getAdRewardText(){return this.ad?.getAdRewardText()||""}getAdRewardQuantity(){return this.ad?.getAdRewardQuantity()||0}isRewarded(){return"rewarded"===this.placement?.type}fireImpressionOnce(){!this.impressionFired&&(void 0!==this.ad||this.questionCount()>0)&&(this.eventController.sendAdImpressionTrackingEvent(this.placement,this.ad),this.impressionFired=!0)}async performReload(e){this.ad=await this.requiredInfoViewModel.reloadPlacement(e)}presentRequiredInfo(){this.requiredInfoViewModel.presentRequiredInfo()}showViewModel(e){this.instanceId=e.instanceId,e.beginFullScreenPresentation(this.ad)}}function Cr(e,t){return()=>{const i=e.getImpressionUrl();console.debug(`[BE] Impression Attempt for placement: ${e.name} with url: ${i}`),y(i)?or("Impression",400,void 0,"No impression URL found."):ar("Impression",i,t)}}function yr(e,t){return()=>{const i=e.getWinUrl();console.debug(`[BE] Win Attempt for placement: ${e.name} with url: ${i}`),y(i)?or("Win",400,void 0,"No Win URL found."):ar("Win",i,t)}}function Er(e){return lr(e)}function Tr(e,t){return()=>{if(!y(e.getTimeOnSiteUrl()))return new Mi(e.getTimeOnSiteUrl(),t)}}const _r="PresentationController already locked by";class Rr{constructor(e={},t=globalThis.HYPREventController,i=HYPRPresentationListener,r=HYPRPreloadController,s=globalThis.HYPRPlacementController,n=Ji){this.args=e,this.listener=i,this.eventController=t,this.preloadController=r,this.placementController=s,this.initConfiguration=HYPRInitializationController?.getConfiguration(),this.vmController=n,this.presentedSession=void 0}getFullscreenViewModel(e,t){let i,r;try{i=t||this.presentedSession.getAdType(),console.debug(`[Presentation] retreiving viewModel for placement: ${e}, ad type: ${i}`),r=this.vmController.getFullScreenViewModelForPlacementName(e)}catch(e){const t=`Error accessing viewModelMap: ${e}\nCurrent Contents: ${this.vmController.toContentString()}`;console.error(t),function(e,t="shared_js_error",i=hr){void 0!==globalThis.HYPRErrorController?globalThis.HYPRErrorController.sendClientErrorCapture(e,t,i):console.error("Failed to dispatch CEC")}(t,"shared_js.PresentationController.getFullscreenViewModel")}if(void 0!==r)return r;const s=this.placementController.getPlacement(e);if(void 0===s)return;const n=this.vmController.generateUniqueId();return r=cr.viewModel(s,i,n,this.listener,this.args,this),this.vmController.storeViewModel(n,r),r}getPreloadedViewModel(e){try{return this.vmController.getViewModel(e)}catch(t){return void console.error(`Error getting preloaded ViewModel: ${e} error: ${t}`)}}removePreloadedViewModel(e){e!==this.presentedSession?.instanceId?(console.debug(`[PresentationControler] removing instance from map: ${e}`),this.vmController.removeViewModel(e)):console.error("Error - trying to remove a ViewModel being presented")}showFullscreenAd(e){if(console.debug(`[Presentation] request to show for ${e}`),it.canPrompt(this.initConfiguration)){console.debug("PresentationController will prompt for TransparencyTracking approval");try{return void it.prompt(`HYPRPresentationController.showFullscreenAd('${e}')`)}catch(t){console.error(`PresentationController.showFullscreenAd(${e}) error displaying prompt.`)}}const t=this.placementController.getPlacement(e),i=new Sr(t,this.listener);i.isValid()?this.isPresentationLocked()?this.listener.adDisplayError(e,`PresentationController already showing ad for placement ${e}.`):this.beginPresentation(i):this.adFailedToDisplay(e,"Placement not a valid fullscreen Ad.")}beginPresentation(e){console.debug(`[Presentation] transition to beginPresentation to lock display ${e.getPlacementName()}`);try{this.lockPresentationWithSession(e)}catch(t){return this.adFailedToDisplay(e.getPlacementName(),`SDK reported presentation error: ${t.message}`),void(t.message.includes(_r)||this.endPresentation(!1))}this.presentedSession.fireImpressionOnce(),this.onDisplayQuestions()}onDisplayQuestions(){if(!this.presentedSession)return console.error("[Presentation] Error presenting questions, no session"),void this.endPresentation(!1);console.debug(`[Presentation] transition to onDisplayQuestions with ${this.presentedSession.questionCount()} questions to show`),this.presentedSession.questionCount()>0?this.presentedSession.presentRequiredInfo():this.onDisplayAd()}onDisplayAd(){if(!this.presentedSession)return console.error("[Presentation] Error presenting ad, no session"),void this.endPresentation(!1);console.debug(`[Presentation] transition to onDisplayAd for placement ${this.presentedSession.getPlacementName()}`);const e=this.getFullscreenViewModel(this.presentedSession.getPlacementName());this.presentedSession.showViewModel(e)}endPresentation(e){if("object"!=typeof this.presentedSession)return void console.debug("[Presentation] endPresentation called without a presentedSession (see PLAYER-15335)");const t=this.presentedSession.getPlacementName();console.debug(`[Presentation] transition endPresentation for placement ${t}`),this.placementController.startAdRefresh("refresh"),this.preloadController.refreshAdForPlacement(this.presentedSession.ad),console.debug(`[Presentation] will remove viewModel instance: ${this.presentedSession.instanceId}`),this.clearFullscreenViewModel(this.presentedSession.instanceId),this.presentedSession=void 0,e?this.listener.adFinished(t):this.listener.adCanceled(t)}clearFullscreenViewModel(e){this.vmController.removeViewModel(e)}lockPresentationWithSession(e){const t=e.getPlacementName();if(this.isPresentationLockedWithAnotherPlacement(t))throw new Error(`${_r} ${this.presentedSession.getPlacementName()}`);this.placementController.getPlacement(t).stopAdAvailableTimer(),this.isPresentationLocked()||(console.debug(`[Presentation] PresentationController.lockPresentationWithPlacement(${t})`),this.listener.adStarted(t),this.presentedSession=e)}adFailedToDisplay(e,t){console.debug(t),this.presentedSession=void 0,this.listener.adStarted(e),this.listener.adDisplayError(e,t),this.listener.adFinished(e)}isPresentationLockedWithAnotherPlacement(e){return void 0!==this.presentedSession&&!this.presentedSession.isSession(e)}isPresentationLocked(){return void 0!==this.presentedSession}bindBannerViewModel(e){let t=this.placementController.getPlacement(e);"object"==typeof t&&t.isBannerAdType()||(console.error(`error binding Banner for placement: ${e}`),t=void 0);const i=this.vmController.generateUniqueId(),r=new $i(Pr(),Cr,Er,Tr,yr,t,this,i);return this.vmController.storeViewModel(i,r),i}initializeBrowserViewModel(e,t,i,r){let s,n;const o=i.getAdModel();void 0!==o&&(s=o.getClickMode(),n=o.onPageJS);const a=this.vmController.generateUniqueId();console.debug(`Initialize BrowserViewModel for requester ${e} creating vm ${a}`);const l=i.generateTimeOnSiteTracking(),d=new Hi(t.initialUrl,s,n,i,l,r,this,a);return this.vmController.storeViewModel(a,d),i.browserInstance=d,a}destroyBrowserViewModel(e){this.vmController.removeViewModel(e)}async requiredInfoPresentationCompletedWithParams(e){console.debug("[Presentation] Prequal form finished with questions answered"),e.context="userInfoSubmission",await this.presentedSession.performReload(e),console.debug("[Presentation] Reload of placement completed"),this.onDisplayQuestions()}requiredInfoPresentationCancelled(){console.debug("[Presentation] Prequal form was cancelled"),this.onDisplayQuestions()}adDismissed(e){console.debug(`[Presentation] adDismissed(${e})`),this.endPresentation(e)}adRewarded(){this.presentedSession.isRewarded()&&(console.debug(`Ad Rewarded for ${this.presentedSession.getPlacementName()}`),this.listener.adRewarded(this.presentedSession.getPlacementName(),this.presentedSession.getAdRewardText(),this.presentedSession.getAdRewardQuantity()))}presentationSceneBackgrounded(){this.isPresentationLocked()&&console.debug(`Ad Window backgrounded for ${this.presentedSession.getPlacementName()}`)}presentationSceneForegrounded(){this.isPresentationLocked()&&console.debug(`Ad Window foregrounded for ${this.presentedSession.getPlacementName()}`)}preloadedWebViewPageReadyExpired(e){this.preloadController.clearMraidPreload(e)}static attributesForWebtrafficText(e){return e===D||e===B?JSON.stringify({Color:"FFFFFFFF",Font:{fontName:"Helvetica Neue",size:13.33},NSKern:0,NSParagraphStyle:{alignment:"left"},NSStrokeWidth:0}):e===L?JSON.stringify({Color:"3A3A3AFF",Font:{fontName:"Helvetica Neue",size:13.33},NSKern:0,NSParagraphStyle:{alignment:"left"},NSStrokeWidth:0}):e===$?JSON.stringify({Color:"5D5D5DFF",Font:{fontName:"HelveticaNeue-Bold",size:18.67},NSKern:0,NSParagraphStyle:{alignment:"left",minimumLineHeight:17},NSStrokeWidth:0}):"{}"}}globalThis.PresentationController=Rr;class Nr{constructor(e){this.version=Nr.osVersion(e.device_os_version),this.platform=Nr.devicePlatform(e.device_type),this.orientations=Nr.supportedInterfaceSettings(e.supported_interface_settings),this.sdkVersion=e.sdk_version||"0"}isIos(){return"iOS"===this.platform}isAndroid(){return"Android"===this.platform}isPortraitSupported(){return this.version>=14||this.orientations.indexOf("portrait")>-1}static osVersion(e){return void 0===e||-1===e.indexOf(".")?0:parseFloat(e.match(/[0-9]*.[0-9]*/)[0])}static devicePlatform(e){return void 0===e?"unknown":e.includes("iP")||e.toLowerCase().includes("mac")?"iOS":e.toLowerCase().includes("android")?"Android":"unknown"}static supportedInterfaceSettings(e){const t=[];return void 0===e||e.forEach((e=>{const i=e.split("UIInterfaceOrientation")[1];void 0!==i&&t.push(i.toLowerCase())})),t}}class Vr{constructor(e="staging.hyprmx.com",t=globalThis.HYPRNetworkController,i=HYPRConsentController,r=HYPRPreloadController,s=HYPRRequestParameterManager){this.host=e,this.initialized=!1,this.configuration=void 0,this.networkRequestController=t,this.initializationURL=`https://${e}/v1/initialization`,this.consentController=i,this.preloadController=r,this.deviceConfiguration=void 0,this.requestParameterManager=s}initialize(){this.initialized=!1,this.configuration=void 0,this.requestParameterManager.setPreloadController(this.preloadController);const e=this.requestParameterManager.getInitializationParams();this.uid=e.uid;const t=JSON.parse(hyprMXLocalStorage.getItem(I)),i=hyprMXLocalStorage.getItem(O);console.debug(`oldPersistentId: ${i}`),console.debug(`oldOptedOut: ${t}`),(void 0!==e[I]&&null!=t&&t!==e[I]||void 0!==e.persistent_id&&null!=i&&i!==e.persistent_id)&&(console.debug("Persistent Id reset detected"),e.reset_user_data=!0,this.preloadController.resetVastCache()&&delete e.preloaded_ads),globalThis.HYPRErrorController=new pr(this.host),this.deviceConfiguration=new Nr(e),this.networkRequestController.post(this.initializationURL,e,((t,i,r)=>{this.response(t,i,r,(()=>{void 0!==e[I]&&hyprMXLocalStorage.setItem(I,e[I].toString()),void 0!==e.persistent_id&&hyprMXLocalStorage.setItem(O,e.persistent_id.toString())}))}))}response(e,t,i,r=(()=>{})){const s=ce.parseJSON(t);if(void 0!==HYPRInitListener.setEnableAllLogs&&HYPRInitListener.setEnableAllLogs(void 0!==s&&void 0!==s.enable_all_logs&&s.enable_all_logs),f.validResponseStatus(e)&&void 0===i&&this.validateResponse(s)){if(r(),this.configuration=s,globalThis.HYPRErrorController.setErrorConfiguration(s.error_reporting_endpoint,s.error_severity_level),this.updateDefaultUIComponents(s.ui_components),void 0!==s.new_mobile_js?this.updateJavascript(s):(this.initializeNativeControllers(s),ne.checkStoredData()),void 0!==s.open_measurement){const e=s.open_measurement;HYPRInitListener.initializeOMSDK(e.omsdk_url,e.partner_name,e.api_version)}}else this.initialized=!1,console.error(`Initialization Failed Response: ${t} code ${e} error: ${i}`),HYPRInitListener.initializationFailed(`${e}`)}validateResponse(e){return void 0!==e&&ce.hasRequiredKeys(e,["sharing_endpoint","completion_endpoint","ad_impression_tracking_endpoint","user_info_tracking_endpoint","duration_update_endpoint","error_reporting_endpoint","webtraffic_visit_endpoint","no_ad_tracking_endpoint","ad_progress_endpoint"],"url")&&ce.hasRequiredKeys(e,["placements","ads_to_preload"],"object")}javascriptUpgradeFailed(e){this.initializeNativeControllers(this.configuration)}initializeNativeControllers(e){this.initialized=!0;const t=JSON.stringify(e.placements);HYPRInitListener.setSharingEndpoint(e.sharing_endpoint),globalThis.COMPLETION_URL=e.completion_endpoint,Zt.BASE_RTB_REQUEST=e.base_rtb_request,void 0!==e.banner_html_wrapper_tag&&(Qe.wrapperHtml=e.banner_html_wrapper_tag),this.createEventController(e),globalThis.HYPRErrorController.setErrorConfiguration(e.error_reporting_endpoint,e.error_severity_level),globalThis.HYPRStorePresentationController=new ci(this.deviceConfiguration,e.skadnetwork_signature_endpoint),globalThis.HYPRPlacementController=new ei(e.placements),globalThis.HYPRPresentationController=new Rr({userId:this.uid});const{audioStatusManager:i}=Pr();i?.activate(!0),HYPRInitListener.initializationSuccessWithPlacements(t,globalThis.version()),this.preloadController.setEventController(globalThis.HYPREventController),this.preloadController.setPresentationController(globalThis.HYPRPresentationController),this.preloadController.handleAdsToPreloadResponse(e.ads_to_preload),this.preloadController.handleUIComponentsToPreloadResponse(e.ui_components)}createEventController(e){globalThis.HYPREventController=new he(e.ad_impression_tracking_endpoint,e.user_info_tracking_endpoint,e.webtraffic_visit_endpoint,e.error_reporting_endpoint,e.error_severity_level,e.no_ad_tracking_endpoint,e.ad_progress_endpoint,e.duration_update_endpoint)}updateJavascript(e){let t=8;void 0!==e.new_mobile_js.timeout&&(t=e.new_mobile_js.timeout),HYPRInitListener.updateJavascript(e.new_mobile_js.url,e.new_mobile_js.version,t)}isInitialized(){return this.initialized}allowsInitialization(){return"object"!=typeof HYPRPresentationController||!HYPRPresentationController.isPresentationLocked()}requestInitializationAllowed(e){HYPRInitListener.initializationIsAllowed(this.allowsInitialization(),JSON.stringify(e))}getConfiguration(){return this.configuration}updateDefaultUIComponents(e){void 0!==e&&"object"==typeof JSON.parse(JSON.stringify(e))&&(globalThis.defaultUIComponents=e)}}globalThis.InitializationController=Vr;const Or="IABConsent_CMPPresent",Ir="IABConsent_SubjectToGDPR",kr="IABConsent_ConsentString",Mr="IABConsent_ParsedPurposeConsents",xr="IABConsent_ParsedVendorConsents",Fr=[Or,Ir,kr,Mr,xr];class Dr{constructor(e=HYPRNativeConsentController,t=HYPRSharedDataController){this.sharedDataController=t,this.nativeConsentController=e,this.consentStatus=this.nativeConsentController.getConsentStatus();for(const e of Fr)t.monitorSharedValue("HYPRConsentController",e)}setConsentChangedListener(e){this.consentListener=e}consentStatusChanged(e){this.consentStatus!==e?(this.consentStatus=e,console.debug(`[CC] Consent status changed to ${Object.keys(J)[e]}`),void 0!==this.consentListener&&this.consentListener.onConsentChanged()):console.debug("[CC] Consent status has not changed.  Ignoring.")}onValueChanged(e){console.debug(`[CC] Monitored consent string ${e.key} changed to ${e.value}`),void 0!==this.consentListener&&this.consentListener.onConsentChanged()}getConsentParameters(){const e={},t=this.nativeConsentController.getConsentStatus();t!==J.CONSENT_STATUS_UNKNOWN&&(e.is_consent_given=t===J.CONSENT_GIVEN);const i=JSON.parse(this.sharedDataController.getSharedValue(Or)).value;void 0!==i&&(e.iab_consent_cmppresent=i);const r=JSON.parse(this.sharedDataController.getSharedValue(Ir)).value;void 0!==r&&(e.iab_consent_subject_to_gdpr=r);const s=JSON.parse(this.sharedDataController.getSharedValue(kr)).value;void 0!==s&&(e.iab_consent_string=s);const n=JSON.parse(this.sharedDataController.getSharedValue(Mr)).value;void 0!==n&&(e.iab_consent_parsed_purpose_consents=n);const o=JSON.parse(this.sharedDataController.getSharedValue(xr)).value;return void 0!==o&&(e.iab_consent_parsed_vendor_consents=o),console.debug(`[CC] ${JSON.stringify(e)}`),e}}globalThis.ConsentController=Dr;var Br={},Lr={},$r={};!function(e){const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",i="["+t+"][:A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*",r=new RegExp("^"+i+"$");e.isExist=function(e){return void 0!==e},e.isEmptyObject=function(e){return 0===Object.keys(e).length},e.merge=function(e,t,i){if(t){const r=Object.keys(t),s=r.length;for(let n=0;n<s;n++)e[r[n]]="strict"===i?[t[r[n]]]:t[r[n]]}},e.getValue=function(t){return e.isExist(t)?t:""},e.buildOptions=function(e,t,i){let r={};if(!e)return t;for(let s=0;s<i.length;s++)void 0!==e[i[s]]?r[i[s]]=e[i[s]]:r[i[s]]=t[i[s]];return r},e.isTagNameInArrayMode=function(e,t,i){return!1!==t&&(t instanceof RegExp?t.test(e):"function"==typeof t?!!t(e,i):"strict"===t)},e.isName=function(e){const t=r.exec(e);return!(null==t)},e.getAllMatches=function(e,t){const i=[];let r=t.exec(e);for(;r;){const s=[];s.startIndex=t.lastIndex-r[0].length;const n=r.length;for(let e=0;e<n;e++)s.push(r[e]);i.push(s),r=t.exec(e)}return i},e.nameRegexp=i}($r);const Ur=$r,Wr=function(e,t,i){const r={};if(!t.alwaysCreateTextNode&&(!e.child||Ur.isEmptyObject(e.child))&&(!e.attrsMap||Ur.isEmptyObject(e.attrsMap)))return Ur.isExist(e.val)?e.val:"";if(Ur.isExist(e.val)&&("string"!=typeof e.val||""!==e.val&&e.val!==t.cdataPositionChar)){const s=Ur.isTagNameInArrayMode(e.tagname,t.arrayMode,i);r[t.textNodeName]=s?[e.val]:e.val}Ur.merge(r,e.attrsMap,t.arrayMode);const s=Object.keys(e.child);for(let n=0;n<s.length;n++){const o=s[n];if(e.child[o]&&e.child[o].length>1){r[o]=[];for(let i in e.child[o])e.child[o].hasOwnProperty(i)&&r[o].push(Wr(e.child[o][i],t,o))}else{const s=Wr(e.child[o][0],t,o),n=!0===t.arrayMode&&"object"==typeof s||Ur.isTagNameInArrayMode(o,t.arrayMode,i);r[o]=n?[s]:s}}return r};Lr.convertToJson=Wr;var qr={};const Hr=/^[-+]?0x[a-fA-F0-9]+$/,Jr=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const Yr={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};const jr=$r,zr=$r.buildOptions,Kr=function(e,t,i){this.tagname=e,this.parent=t,this.child={},this.attrsMap={},this.val=i,this.addChild=function(e){Array.isArray(this.child[e.tagname])?this.child[e.tagname].push(e):this.child[e.tagname]=[e]}},Gr=function(e,t={}){if(t=Object.assign({},Yr,t),!e||"string"!=typeof e)return e;let i=e.trim();if(void 0!==t.skipLike&&t.skipLike.test(i))return e;if(t.hex&&Hr.test(i))return Number.parseInt(i,16);{const r=Jr.exec(i);if(r){const s=r[1],n=r[2];let o=function(e){if(e&&-1!==e.indexOf("."))return"."===(e=e.replace(/0+$/,""))?e="0":"."===e[0]?e="0"+e:"."===e[e.length-1]&&(e=e.substr(0,e.length-1)),e;return e}(r[3]);const a=r[4]||r[6];if(!t.leadingZeros&&n.length>0&&s&&"."!==i[2])return e;if(!t.leadingZeros&&n.length>0&&!s&&"."!==i[1])return e;{const r=Number(i),l=""+r;return-1!==l.search(/[eE]/)||a?t.eNotation?r:e:-1!==i.indexOf(".")?"0"===l&&""===o||l===o||s&&l==="-"+o?r:e:n?o===l||s+o===l?r:e:i===l||i===s+l?r:e}}return e}};"<((!\\[CDATA\\[([\\s\\S]*?)(]]>))|((NAME:)?(NAME))([^>]*)>|((\\/)(NAME)\\s*>))([^<]*)".replace(/NAME/g,jr.nameRegexp),!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const Xr={attributeNamePrefix:"@_",attrNodeName:!1,textNodeName:"#text",ignoreAttributes:!0,ignoreNameSpace:!1,allowBooleanAttributes:!1,parseNodeValue:!0,parseAttributeValue:!1,arrayMode:!1,trimValues:!0,cdataTagName:!1,cdataPositionChar:"\\c",numParseOptions:{hex:!0,leadingZeros:!0},tagValueProcessor:function(e,t){return e},attrValueProcessor:function(e,t){return e},stopNodes:[],alwaysCreateTextNode:!1};qr.defaultOptions=Xr;const Qr=["attributeNamePrefix","attrNodeName","textNodeName","ignoreAttributes","ignoreNameSpace","allowBooleanAttributes","parseNodeValue","parseAttributeValue","arrayMode","trimValues","cdataTagName","cdataPositionChar","tagValueProcessor","attrValueProcessor","parseTrueNumberOnly","numParseOptions","stopNodes","alwaysCreateTextNode"];function Zr(e,t,i){return t&&(i.trimValues&&(t=t.trim()),t=ts(t=i.tagValueProcessor(t,e),i.parseNodeValue,i.numParseOptions)),t}function es(e,t){if(t.ignoreNameSpace){const t=e.split(":"),i="/"===e.charAt(0)?"/":"";if("xmlns"===t[0])return"";2===t.length&&(e=i+t[1])}return e}function ts(e,t,i){if(t&&"string"==typeof e){const t=e.trim();return"true"===t||"false"!==t&&Gr(e,i)}return jr.isExist(e)?e:""}qr.props=Qr;const is=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])(.*?)\\3)?","g");function rs(e,t){if(!t.ignoreAttributes&&"string"==typeof e){e=e.replace(/\r?\n/g," ");const i=jr.getAllMatches(e,is),r=i.length,s={};for(let e=0;e<r;e++){const r=es(i[e][1],t);r.length&&(void 0!==i[e][4]?(t.trimValues&&(i[e][4]=i[e][4].trim()),i[e][4]=t.attrValueProcessor(i[e][4],r),s[t.attributeNamePrefix+r]=ts(i[e][4],t.parseAttributeValue,t.numParseOptions)):t.allowBooleanAttributes&&(s[t.attributeNamePrefix+r]=!0))}if(!Object.keys(s).length)return;if(t.attrNodeName){const e={};return e[t.attrNodeName]=s,e}return s}}function ss(e,t){let i,r="";for(let s=t;s<e.length;s++){let t=e[s];if(i)t===i&&(i="");else if('"'===t||"'"===t)i=t;else{if(">"===t)return{data:r,index:s};"\t"===t&&(t=" ")}r+=t}}function ns(e,t,i,r){const s=e.indexOf(t,i);if(-1===s)throw new Error(r);return s+t.length-1}qr.getTraversalObj=function(e,t){e=e.replace(/\r\n?/g,"\n"),t=zr(t,Xr,Qr);const i=new Kr("!xml");let r=i,s="";for(let i=0;i<e.length;i++){if("<"===e[i])if("/"===e[i+1]){const n=ns(e,">",i,"Closing Tag is not closed.");let o=e.substring(i+2,n).trim();if(t.ignoreNameSpace){const e=o.indexOf(":");-1!==e&&(o=o.substr(e+1))}r&&(r.val?r.val=jr.getValue(r.val)+""+Zr(o,s,t):r.val=Zr(o,s,t)),t.stopNodes.length&&t.stopNodes.includes(r.tagname)&&(r.child=[],null==r.attrsMap&&(r.attrsMap={}),r.val=e.substr(r.startIndex+1,i-r.startIndex-1)),r=r.parent,s="",i=n}else if("?"===e[i+1])i=ns(e,"?>",i,"Pi Tag is not closed.");else if("!--"===e.substr(i+1,3))i=ns(e,"--\x3e",i,"Comment is not closed.");else if("!D"===e.substr(i+1,2)){const t=ns(e,">",i,"DOCTYPE is not closed.");i=e.substring(i,t).indexOf("[")>=0?e.indexOf("]>",i)+1:t}else if("!["===e.substr(i+1,2)){const n=ns(e,"]]>",i,"CDATA is not closed.")-2,o=e.substring(i+9,n);if(s&&(r.val=jr.getValue(r.val)+""+Zr(r.tagname,s,t),s=""),t.cdataTagName){const e=new Kr(t.cdataTagName,r,o);r.addChild(e),r.val=jr.getValue(r.val)+t.cdataPositionChar,o&&(e.val=o)}else r.val=(r.val||"")+(o||"");i=n+2}else{const n=ss(e,i+1);let o=n.data;const a=n.index,l=o.indexOf(" ");let d=o,c=!0;if(-1!==l&&(d=o.substr(0,l).replace(/\s\s*$/,""),o=o.substr(l+1)),t.ignoreNameSpace){const e=d.indexOf(":");-1!==e&&(d=d.substr(e+1),c=d!==n.data.substr(e+1))}if(r&&s&&"!xml"!==r.tagname&&(r.val=jr.getValue(r.val)+""+Zr(r.tagname,s,t)),o.length>0&&o.lastIndexOf("/")===o.length-1){"/"===d[d.length-1]?(d=d.substr(0,d.length-1),o=d):o=o.substr(0,o.length-1);const e=new Kr(d,r,"");d!==o&&(e.attrsMap=rs(o,t)),r.addChild(e)}else{const e=new Kr(d,r);t.stopNodes.length&&t.stopNodes.includes(e.tagname)&&(e.startIndex=a),d!==o&&c&&(e.attrsMap=rs(o,t)),r.addChild(e),r=e}s="",i=a}else s+=e[i]}return i};var os={};const as=$r,ls={allowBooleanAttributes:!1},ds=["allowBooleanAttributes"];function cs(e,t){const i=t;for(;t<e.length;t++)if("?"!=e[t]&&" "!=e[t]);else{const r=e.substr(i,t-i);if(t>5&&"xml"===r)return fs("InvalidXml","XML declaration allowed only at the start of the document.",bs(e,t));if("?"==e[t]&&">"==e[t+1]){t++;break}}return t}function hs(e,t){if(e.length>t+5&&"-"===e[t+1]&&"-"===e[t+2]){for(t+=3;t<e.length;t++)if("-"===e[t]&&"-"===e[t+1]&&">"===e[t+2]){t+=2;break}}else if(e.length>t+8&&"D"===e[t+1]&&"O"===e[t+2]&&"C"===e[t+3]&&"T"===e[t+4]&&"Y"===e[t+5]&&"P"===e[t+6]&&"E"===e[t+7]){let i=1;for(t+=8;t<e.length;t++)if("<"===e[t])i++;else if(">"===e[t]&&(i--,0===i))break}else if(e.length>t+9&&"["===e[t+1]&&"C"===e[t+2]&&"D"===e[t+3]&&"A"===e[t+4]&&"T"===e[t+5]&&"A"===e[t+6]&&"["===e[t+7])for(t+=8;t<e.length;t++)if("]"===e[t]&&"]"===e[t+1]&&">"===e[t+2]){t+=2;break}return t}os.validate=function(e,t){t=as.buildOptions(t,ls,ds);const i=[];let r=!1,s=!1;"\ufeff"===e[0]&&(e=e.substr(1));for(let o=0;o<e.length;o++)if("<"===e[o]&&"?"===e[o+1]){if(o+=2,o=cs(e,o),o.err)return o}else{if("<"!==e[o]){if(" "===e[o]||"\t"===e[o]||"\n"===e[o]||"\r"===e[o])continue;return fs("InvalidChar","char '"+e[o]+"' is not expected.",bs(e,o))}{let a=o;if(o++,"!"===e[o]){o=hs(e,o);continue}{let l=!1;"/"===e[o]&&(l=!0,o++);let d="";for(;o<e.length&&">"!==e[o]&&" "!==e[o]&&"\t"!==e[o]&&"\n"!==e[o]&&"\r"!==e[o];o++)d+=e[o];if(d=d.trim(),"/"===d[d.length-1]&&(d=d.substring(0,d.length-1),o--),n=d,!as.isName(n)){let t;return t=0===d.trim().length?"Invalid space after '<'.":"Tag '"+d+"' is an invalid name.",fs("InvalidTag",t,bs(e,o))}const c=us(e,o);if(!1===c)return fs("InvalidAttr","Attributes for '"+d+"' have open quote.",bs(e,o));let h=c.value;if(o=c.index,"/"===h[h.length-1]){const i=o-h.length;h=h.substring(0,h.length-1);const s=gs(h,t);if(!0!==s)return fs(s.err.code,s.err.msg,bs(e,i+s.err.line));r=!0}else if(l){if(!c.tagClosed)return fs("InvalidTag","Closing tag '"+d+"' doesn't have proper closing.",bs(e,o));if(h.trim().length>0)return fs("InvalidTag","Closing tag '"+d+"' can't have attributes or invalid starting.",bs(e,a));{const t=i.pop();if(d!==t.tagName){let i=bs(e,t.tagStartPos);return fs("InvalidTag","Expected closing tag '"+t.tagName+"' (opened in line "+i.line+", col "+i.col+") instead of closing tag '"+d+"'.",bs(e,a))}0==i.length&&(s=!0)}}else{const n=gs(h,t);if(!0!==n)return fs(n.err.code,n.err.msg,bs(e,o-h.length+n.err.line));if(!0===s)return fs("InvalidXml","Multiple possible root nodes found.",bs(e,o));i.push({tagName:d,tagStartPos:a}),r=!0}for(o++;o<e.length;o++)if("<"===e[o]){if("!"===e[o+1]){o++,o=hs(e,o);continue}if("?"!==e[o+1])break;if(o=cs(e,++o),o.err)return o}else if("&"===e[o]){const t=ms(e,o);if(-1==t)return fs("InvalidChar","char '&' is not expected.",bs(e,o));o=t}"<"===e[o]&&o--}}}var n;return r?1==i.length?fs("InvalidTag","Unclosed tag '"+i[0].tagName+"'.",bs(e,i[0].tagStartPos)):!(i.length>0)||fs("InvalidXml","Invalid '"+JSON.stringify(i.map((e=>e.tagName)),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):fs("InvalidXml","Start tag expected.",1)};function us(e,t){let i="",r="",s=!1;for(;t<e.length;t++){if('"'===e[t]||"'"===e[t])""===r?r=e[t]:r!==e[t]||(r="");else if(">"===e[t]&&""===r){s=!0;break}i+=e[t]}return""===r&&{value:i,index:t,tagClosed:s}}const ps=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function gs(e,t){const i=as.getAllMatches(e,ps),r={};for(let e=0;e<i.length;e++){if(0===i[e][1].length)return fs("InvalidAttr","Attribute '"+i[e][2]+"' has no space in starting.",ws(i[e]));if(void 0===i[e][3]&&!t.allowBooleanAttributes)return fs("InvalidAttr","boolean attribute '"+i[e][2]+"' is not allowed.",ws(i[e]));const s=i[e][2];if(!vs(s))return fs("InvalidAttr","Attribute '"+s+"' is an invalid name.",ws(i[e]));if(r.hasOwnProperty(s))return fs("InvalidAttr","Attribute '"+s+"' is repeated.",ws(i[e]));r[s]=1}return!0}function ms(e,t){if(";"===e[++t])return-1;if("#"===e[t])return function(e,t){let i=/\d/;for("x"===e[t]&&(t++,i=/[\da-fA-F]/);t<e.length;t++){if(";"===e[t])return t;if(!e[t].match(i))break}return-1}(e,++t);let i=0;for(;t<e.length;t++,i++)if(!(e[t].match(/\w/)&&i<20)){if(";"===e[t])break;return-1}return t}function fs(e,t,i){return{err:{code:e,msg:t,line:i.line||i,col:i.col}}}function vs(e){return as.isName(e)}function bs(e,t){const i=e.substring(0,t).split(/\r?\n/);return{line:i.length,col:i[i.length-1].length+1}}function ws(e){return e.startIndex+e[1].length}var Ps,As={};function Ss(){if(Ps)return As;Ps=1;const e=function(e){return String.fromCharCode(e)},t={nilChar:e(176),missingChar:e(201),nilPremitive:e(175),missingPremitive:e(200),emptyChar:e(178),emptyValue:e(177),boundryChar:e(179),objStart:e(198),arrStart:e(204),arrayEnd:e(185)},i=[t.nilChar,t.nilPremitive,t.missingChar,t.missingPremitive,t.boundryChar,t.emptyChar,t.emptyValue,t.arrayEnd,t.objStart,t.arrStart],r=function(e,i,o){if("string"==typeof i)return e&&e[0]&&void 0!==e[0].val?s(e[0].val):s(e);{const l=void 0===(a=e)?t.missingChar:null===a?t.nilChar:!(a.child&&0===Object.keys(a.child).length&&(!a.attrsMap||0===Object.keys(a.attrsMap).length))||t.emptyChar;if(!0===l){let a="";if(Array.isArray(i)){a+=t.arrStart;const l=i[0],d=e.length;if("string"==typeof l)for(let t=0;t<d;t++){const i=s(e[t].val);a=n(a,i)}else for(let t=0;t<d;t++){const i=r(e[t],l,o);a=n(a,i)}a+=t.arrayEnd}else{a+=t.objStart;const s=Object.keys(i);Array.isArray(e)&&(e=e[0]);for(let t in s){const l=s[t];let d;d=!o.ignoreAttributes&&e.attrsMap&&e.attrsMap[l]?r(e.attrsMap[l],i[l],o):l===o.textNodeName?r(e.val,i[l],o):r(e.child[l],i[l],o),a=n(a,d)}}return a}return l}var a},s=function(e){switch(e){case void 0:return t.missingPremitive;case null:return t.nilPremitive;case"":return t.emptyValue;default:return e}},n=function(e,i){return o(i[0])||o(e[e.length-1])||(e+=t.boundryChar),e+i},o=function(e){return-1!==i.indexOf(e)};const a=qr,l=$r.buildOptions;return As.convert2nimn=function(e,t,i){return i=l(i,a.defaultOptions,a.props),r(e,t,i)},As}var Cs,ys,Es,Ts={};function _s(){if(Cs)return Ts;Cs=1;const e=$r,t=$r.buildOptions,i=qr,r=function(t,i,s){let n="{";const o=Object.keys(t.child);for(let e=0;e<o.length;e++){const s=o[e];if(t.child[s]&&t.child[s].length>1){n+='"'+s+'" : [ ';for(let e in t.child[s])n+=r(t.child[s][e],i)+" , ";n=n.substr(0,n.length-1)+" ] "}else n+='"'+s+'" : '+r(t.child[s][0],i)+" ,"}return e.merge(n,t.attrsMap),e.isEmptyObject(n)?e.isExist(t.val)?t.val:"":(e.isExist(t.val)&&("string"!=typeof t.val||""!==t.val&&t.val!==i.cdataPositionChar)&&(n+='"'+i.textNodeName+'" : '+(!0!==(a=t.val)&&!1!==a&&isNaN(a)?'"'+a+'"':a)),","===n[n.length-1]&&(n=n.substr(0,n.length-2)),n+"}");var a};return Ts.convertToJsonString=function(e,s){return(s=t(s,i.defaultOptions,i.props)).indentBy=s.indentBy||"",r(e,s)},Ts}!function(e){const t=Lr,i=qr,r=qr,s=$r.buildOptions,n=os;e.parse=function(e,o={},a){if(a){!0===a&&(a={});const t=n.validate(e,a);if(!0!==t)throw Error(t.err.msg)}o.parseTrueNumberOnly&&!1!==o.parseNodeValue&&!o.numParseOptions&&(o.numParseOptions={leadingZeros:!1});let l=s(o,r.defaultOptions,r.props);const d=i.getTraversalObj(e,l);return t.convertToJson(d,l)},e.convertTonimn=Ss().convert2nimn,e.getTraversalObj=i.getTraversalObj,e.convertToJson=t.convertToJson,e.convertToJsonString=_s().convertToJsonString,e.validate=n.validate,e.j2xParser=function(){if(Es)return ys;Es=1;const e=$r.buildOptions,t={attributeNamePrefix:"@_",attrNodeName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataTagName:!1,cdataPositionChar:"\\c",format:!1,indentBy:"  ",supressEmptyNode:!1,tagValueProcessor:function(e){return e},attrValueProcessor:function(e){return e}},i=["attributeNamePrefix","attrNodeName","textNodeName","ignoreAttributes","cdataTagName","cdataPositionChar","format","indentBy","supressEmptyNode","tagValueProcessor","attrValueProcessor","rootNodeName"];function r(r){this.options=e(r,t,i),this.options.ignoreAttributes||this.options.attrNodeName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=u),this.options.cdataTagName?this.isCDATA=p:this.isCDATA=function(){return!1},this.replaceCDATAstr=n,this.replaceCDATAarr=o,this.processTextOrObjNode=s,this.options.format?(this.indentate=h,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine=""),this.options.supressEmptyNode?(this.buildTextNode=c,this.buildObjNode=l):(this.buildTextNode=d,this.buildObjNode=a),this.buildTextValNode=d,this.buildObjectNode=a}function s(e,t,i){const r=this.j2x(e,i+1);return void 0!==e[this.options.textNodeName]&&1===Object.keys(e).length?this.buildTextNode(r.val,t,r.attrStr,i):this.buildObjNode(r.val,t,r.attrStr,i)}function n(e,t){return e=this.options.tagValueProcessor(""+e),""===this.options.cdataPositionChar||""===e?e+"<![CDATA["+t+"]]"+this.tagEndChar:e.replace(this.options.cdataPositionChar,"<![CDATA["+t+"]]"+this.tagEndChar)}function o(e,t){if(e=this.options.tagValueProcessor(""+e),""===this.options.cdataPositionChar||""===e)return e+"<![CDATA["+t.join("]]><![CDATA[")+"]]"+this.tagEndChar;for(let i in t)e=e.replace(this.options.cdataPositionChar,"<![CDATA["+t[i]+"]]>");return e+this.newLine}function a(e,t,i,r){return i&&-1===e.indexOf("<")?this.indentate(r)+"<"+t+i+">"+e+"</"+t+this.tagEndChar:this.indentate(r)+"<"+t+i+this.tagEndChar+e+this.indentate(r)+"</"+t+this.tagEndChar}function l(e,t,i,r){return""!==e?this.buildObjectNode(e,t,i,r):this.indentate(r)+"<"+t+i+"/"+this.tagEndChar}function d(e,t,i,r){return this.indentate(r)+"<"+t+i+">"+this.options.tagValueProcessor(e)+"</"+t+this.tagEndChar}function c(e,t,i,r){return""!==e?this.buildTextValNode(e,t,i,r):this.indentate(r)+"<"+t+i+"/"+this.tagEndChar}function h(e){return this.options.indentBy.repeat(e)}function u(e){return!!e.startsWith(this.options.attributeNamePrefix)&&e.substr(this.attrPrefixLen)}function p(e){return e===this.options.cdataTagName}return r.prototype.parse=function(e){return Array.isArray(e)&&this.options.rootNodeName&&this.options.rootNodeName.length>1&&(e={[this.options.rootNodeName]:e}),this.j2x(e,0).val},r.prototype.j2x=function(e,t){let i="",r="";for(let s in e)if(void 0===e[s]);else if(null===e[s])r+=this.indentate(t)+"<"+s+"/"+this.tagEndChar;else if(e[s]instanceof Date)r+=this.buildTextNode(e[s],s,"",t);else if("object"!=typeof e[s]){const n=this.isAttribute(s);n?i+=" "+n+'="'+this.options.attrValueProcessor(""+e[s])+'"':this.isCDATA(s)?e[this.options.textNodeName]?r+=this.replaceCDATAstr(e[this.options.textNodeName],e[s]):r+=this.replaceCDATAstr("",e[s]):s===this.options.textNodeName?e[this.options.cdataTagName]||(r+=this.options.tagValueProcessor(""+e[s])):r+=this.buildTextNode(e[s],s,"",t)}else if(Array.isArray(e[s]))if(this.isCDATA(s))r+=this.indentate(t),e[this.options.textNodeName]?r+=this.replaceCDATAarr(e[this.options.textNodeName],e[s]):r+=this.replaceCDATAarr("",e[s]);else{const i=e[s].length;for(let n=0;n<i;n++){const i=e[s][n];void 0===i||(r+=null===i?this.indentate(t)+"<"+s+"/"+this.tagEndChar:"object"==typeof i?this.processTextOrObjNode(i,s,t):this.buildTextNode(i,s,"",t))}}else if(this.options.attrNodeName&&s===this.options.attrNodeName){const t=Object.keys(e[s]),r=t.length;for(let n=0;n<r;n++)i+=" "+t[n]+'="'+this.options.attrValueProcessor(""+e[s][t[n]])+'"'}else r+=this.processTextOrObjNode(e[s],s,t);return{attrStr:i,val:r}},ys=r}(),e.parseToNimn=function(t,i,r){return e.convertTonimn(e.getTraversalObj(t,r),i,r)}}(Br);var Rs=ae(Br);class Ns{constructor(e,t,i=globalThis.HYPRNetworkController){this.width=e,this.height=t,this.networkRequestController=i}parse(e,t,i){console.debug(`Requesting vast tag for ${e}`),this.request=this.networkRequestController.get(e,((r,s,n,o)=>{f.validResponseStatus(r)&&void 0===n&&f.validXMLType(o)?(console.debug(`Requesting vast tag ${e} completed with response.`),this.handleRequestSuccess(s,t,i)):(console.debug(`Requesting vast tag for ${e} failed with error: ${n}`),this.handleRequestFailure(n,t,i))}))}static parseXML(e){return void 0===e||!0!==Rs.validate(e)?re.getVastValidateError():Rs.parse(e,{attributeNamePrefix:"",attrNodeName:"attr",textNodeName:"value",ignoreAttributes:!1,parseAttributeValue:!0})}static selectFirstAd(e){return void 0===e||0===e.length?re.getVastNoAdsAvailableError():void 0===e[0].attr.sequence?e[0]:e.reduce(((e,t)=>parseInt(t.attr.sequence,10)<parseInt(e.attr.sequence,10)?t:e),e[0])}static selectAdsContainingLinear(e){let t=re.getVastNoAdsAvailableError();if(void 0===e||void 0===e.VAST||void 0===e.VAST.Ad)return t;const i=[];z(i,e.VAST.Ad);const r=i.filter((e=>void 0!==this.selectFirstLinearFromAd(e)));return 0===r.length&&void 0!==i.find((e=>void 0!==e.Wrapper))&&(t=re.getVastAdWithWrapperError()),r.length>0?r:t}static selectFirstLinearFromAd(e){if(void 0===e||void 0===e.InLine||void 0===e.InLine.Creatives||void 0===e.InLine.Creatives.Creative)return;const t=[];return z(t,e.InLine.Creatives.Creative),t.find((e=>void 0!==e.Linear))}static convertToSimplifiedModel(e,t,i){if(void 0===e||void 0===e.VAST)return re.getVastEmptyTagError();if(void 0===e.VAST.attr&&0===Object.keys(e.VAST).length)return re.getVastEmptyTagError();if(void 0!==e.VAST.attr&&1===Object.keys(e.VAST).length)return re.getVastEmptyTagError();if(void 0!==e.VAST.Error)return re.getVastNoAdsAvailableError();const r=this.selectAdsContainingLinear(e);if(void 0!==r.error)return r;const s=this.selectFirstAd(r);if(void 0!==s.error)return s;const n=this.selectFirstLinearFromAd(s),o=this.extractVerificationFromExtensions(s.InLine.Extensions);if(void 0===n.Linear||void 0===n.Linear.MediaFiles)return re.getVastNoMediaError();const a=this.extractMediaFiles(n.Linear.MediaFiles.MediaFile);if(void 0!==a.error)return a;const l=this.getBestFitMediaFile(a,t,i),d=this.extractDuration(n.Linear.Duration);if(void 0!==d.error)return d;const c=this.extractImpressions(s.InLine.Impression);if(void 0!==c.error)return c;const h={Ad:{Impressions:c,Linear:{MediaFile:l,skipoffset:this.extractSkipOffset(n.Linear),Duration:d,Trackings:this.extractTrackings(n.Linear.TrackingEvents),VideoClicks:this.extractVideoClicks(n.Linear.VideoClicks)},ViewableImpression:this.extractViewableImpressions(s.InLine.ViewableImpression),AdVerifications:this.extractAdVerifications(s.InLine.AdVerifications,o)}};return Ns.postProcessTimes(h.Ad),h}static extractMediaFiles(e){let t=[];return t.push(...this.buildArrayOfBasicElements("MediaFile",e)),t=t.filter((e=>this.isSupportedMediaFileType(e.type))),t.length>0?t:re.getVastNoMediaError()}static isSupportedMediaFileType(e){return!!/video\/3gpp/.test(e.toLowerCase())||(!!/video\/3gp/.test(e.toLowerCase())||(!!/video\/m4v/.test(e.toLowerCase())||!!/video\/mp/.test(e.toLowerCase())))}static extractSkipOffset(e){if(void 0!==e&&void 0!==e.attr)return e.attr.skipoffset}static extractDuration(e){return void 0===e?re.getVastNoDurationError():e}static extractTrackings(e){const t=[];if(void 0!==e&&void 0!==e.Tracking)return t.push(...this.buildArrayOfBasicElements("Tracking",e.Tracking)),t.length>0?t:void 0}static extractVideoClicks(e){const t=[];if(void 0!==e)return t.push(...Ns.buildArrayOfBasicElements("ClickThrough",e.ClickThrough)),t.push(...Ns.buildArrayOfBasicElements("ClickTracking",e.ClickTracking)),t.length>0?t:void 0}static extractImpressions(e){const t=[];return void 0===e?re.getVastNoImpressionsError():(t.push(...this.buildArrayOfBasicElements("Impression",e)),t.length>0?t:"NO_IMPRESSIONS_ERROR")}static extractViewableImpressions(e){const t=[];if(void 0!==e)return t.push(...this.buildArrayOfBasicElements("Viewable",e.Viewable)),t.push(...this.buildArrayOfBasicElements("NotViewable",e.NotViewable)),t.push(...this.buildArrayOfBasicElements("ViewUndetermined",e.ViewUndetermined)),t.length>0?t:void 0}static extractAdVerifications(e,t){const i=[],r=[];return void 0!==e&&void 0!==e.Verification&&z(r,e.Verification),void 0!==t&&t.forEach((e=>{z(r,e.Verification)})),r.forEach((e=>{i.push(Ns.buildVerification(e))})),i.length>0?i:void 0}static extractVerificationFromExtensions(e){const t=[];if(void 0===e||void 0===e.Extension)return t;const i=[];return z(i,e.Extension),i.forEach((e=>{z(t,e.AdVerifications)})),t}static buildVerification(e){const t=this.buildArrayOfBasicElements("JavaScriptResource",e.JavaScriptResource);return{name:"Verification",value:e.value,vendor:void 0!==e.attr?e.attr.vendor:void 0,Trackings:this.extractTrackings(e.TrackingEvents),JavaScriptResources:t.length>0?t:void 0,VerificationParameters:this.buildBasicElement("VerificationParameters",e.VerificationParameters)}}static buildArrayOfBasicElements(e,t){const i=[],r=[];return void 0===t||(z(r,t),r.forEach((t=>{i.push(Ns.buildBasicElement(e,t))}))),i}static buildBasicElement(e,t){if(void 0===t)return;let i="";void 0!==t.value?i=t.value:"string"==typeof t&&(i=t);const r={name:e,value:i};return void 0!==t.attr&&Object.keys(t.attr).forEach((e=>{r[e]=t.attr[e]})),r}handleRequestFailure(e,t,i){void 0!==i&&i.parsingFailed(re.getVastTagDownloadError(),t)}handleRequestSuccess(e,t,i){if(void 0===i)return;const r=Ns.parseXML(e);if(void 0!==r.error)return void i.parsingFailed(r,t);const s=Ns.convertToSimplifiedModel(r,this.width,this.height);void 0!==s.error?i.parsingFailed(s,t):i.parsingCompleted(s,t)}static convertTimeToMS(e){const t=e.split(":");let i=0;if(t[2].includes(".")){const e=t[2].split(".");t[2]=e[0],i=e[1]}return 60*+t[0]*60*1e3+60*+t[1]*1e3+1e3*+t[2]+ +i}static convertPercentageTimeToMS(e,t){return t*(+e.split("%")[0]/100)}static postProcessTimes(e){e.Linear.Duration=this.convertTimeToMS(e.Linear.Duration),void 0!==e.Linear.skipoffset&&(e.Linear.skipoffset=e.Linear.skipoffset.includes("%")?this.convertPercentageTimeToMS(e.Linear.skipoffset,e.Linear.Duration):this.convertTimeToMS(e.Linear.skipoffset)),void 0!==e.Linear.Trackings&&e.Linear.Trackings.forEach((t=>{void 0!==t.offset&&(t.offset=t.offset.includes("%")?Ns.convertPercentageTimeToMS(t.offset,e.Linear.Duration):Ns.convertTimeToMS(t.offset))}))}static getBestFitMediaFile(e,t,i){const r=Math.max(t,i),s=Math.min(t,i),n=e.sort(((e,t)=>{const i=r-e.width,n=s-e.height,o=r-t.width,a=s-t.height,l=Math.max(Math.abs(i),Math.abs(n)),d=Math.max(Math.abs(o),Math.abs(a));return l===d?(0|t.bitrate)-(0|e.bitrate):l-d}));if(n.length>0)return n[0]}}const Vs={mraidPreloadMap:new Map,receivedPreloadRequest(e){console.debug(`[PreloadController] receivedPreloadRequest: ${e.name}`);const t=e.ad?.webview_timeout,i=e.name;let r;try{let t=this.presentationController.getFullscreenViewModel(i,M);console.debug(`[PreloadController] found viewModel: ${t?.instanceId}`),t.getAdModel()?.reward_token!==e.ad?.reward_token&&(console.debug(`[PreloadController] viewModel offer id's do not match: ${t?.instanceId}`),this.removePreload(r),t=this.presentationController.getFullscreenViewModel(i,M)),r=t?.instanceId}catch(e){return void console.error(`[PreloadController] caught error getting viewModel instance: ${e}`)}console.debug(`[PreloadController] setting up preload for instance: ${r}`);const s=this.setupTimer(r,t);console.debug(`[PreloadController] storing timerId: ${s} for instance:${r} `),this.mraidPreloadMap.set(r,s),this.storeNativePreload(r)},setupTimer(e,t){const i=1e3*t;if(this.mraidPreloadMap.has(e)){const t=this.mraidPreloadMap.get(e);return console.debug(`[PreloadController] storing timerId: ${t}`),this.timerController.updateTimeRemaining(t,i),this.mraidPreloadMap.get(e)}const r=this.timerController.startTimer(i,(()=>{console.debug(`[PreloadController] preload ttl timer ended for instance:${e} `),this.removeNativePreload(e)}));return console.debug(`[PreloadController] created new timerId: ${r}`),r},removePreload(e){console.debug(`[PreloadController] will remove preload for instance: ${e} `);try{this.presentationController.removePreloadedViewModel(e)}catch(e){console.error(`[PreloadController] caught error releasing viewModel instance: ${e}`)}if(this.mraidPreloadMap.has(e)){console.debug(`[PreloadController] removing instance:${e} from timer map`);const t=this.mraidPreloadMap.get(e);void 0!==t?this.timerController.stopTimer(t):console.error("[PreloadController] Could not find timer id in preloaded map."),this.mraidPreloadMap.delete(e)}},getPreloadedMraidAds(){const e=[];return this.mraidPreloadMap.forEach(((t,i)=>{const r=this.timerController.getTimeLeft(t),s=this.presentationController.getPreloadedViewModel(i),n={ad_id:s?.getAdModel()?.id,placement_id:s?.placement.id,time_to_expiration:r};e.push(n)})),e}};class Os{constructor(e,t,i=HYPRCacheListener,r=HYPRRequestParameterManager,s=V){this.width=e,this.height=t,this.nativeCacheListener=i,this.requestParameterManager=r,this.presentationController=void 0,this.timerController=s,this.mraidPreloadMap=new Map}setEventController(e){this.eventController=e}setPresentationController(e){this.presentationController=e}handleAdsToPreloadResponse(e){if(void 0!==e&&void 0!==this.nativeCacheListener)for(const t of e)switch(console.debug(`Requesting preload for (id = ${t.id}, directive=${t.directive}, url=${t.vast_tag_url})`),t.directive){case"cache":case"retain":case"refresh":console.debug(JSON.stringify(t)),this.nativeCacheListener.retrieveVastOffer(JSON.stringify(t));break;case"remove":this.nativeCacheListener.removeVastOffer(t.id)}}refreshAdForPlacement(e){if(void 0!==e&&e.getAdType()===k){const t=[{directive:"refresh",id:e.id,vast_tag_url:void 0}];this.handleAdsToPreloadResponse(t)}}handleUIComponentsToPreloadResponse(e){void 0!==e&&void 0!==this.nativeCacheListener&&this.preloadImages(e)}preloadImages(e){if(void 0===e||void 0===this.nativeCacheListener)return;for(const t in e)if(e.hasOwnProperty(t))if("image"!==t&&"submit_button_image"!==t&&"close_button_image"!==t||e[t]instanceof Array)"object"==typeof e[t]&&this.preloadImages(e[t]);else{const i=e[t];i.hasOwnProperty("portrait_url")?(console.debug(`Requesting image to preload for (url = ${i.portrait_url}, height=${i.height}, width=${i.width}, fill_screen_width=${i.fill_screen_width})`),this.nativeCacheListener.preloadPortraitImage(i.portrait_url,i.height,i.width,i.fill_screen_width)):i.hasOwnProperty("url")&&(console.debug(`Requesting image to preload for (url = ${i.url}, height=${i.height}, width=${i.width}, scale=${i.scale}, tiled=${i.tiled}, x=${i.x}, y=${i.y})`),this.nativeCacheListener.preloadUIImage(i.url,i.height,i.width,i.scale,i.tiled,i.x,i.y))}}handleMraidAdToPreload(e){void 0!==e&&void 0!==this.nativeCacheListener&&"mraid"===e.getAdType()&&void 0!==e.ad.preload_player_url&&"number"==typeof e.ad.webview_timeout&&(e.ad.webview_timeout<1?this.removeNativePreload(e):this.receivedPreloadRequest(e))}storeNativePreload(e){console.debug(`[PreloadController] requesting native storage for: ${e}`),this.nativeCacheListener.storeInstance(e)}removeNativePreload(e){console.debug(`[PreloadController] requesting native to remove storage for: ${e}`),this.nativeCacheListener.removeInstance(e)}nativePreloadDidRemove(e){console.debug(`[PreloadController] notified: ${e} was removed by native`),this.removePreload(e)}resetVastCache(){return void 0!==this.nativeCacheListener.resetVastCache&&(this.nativeCacheListener.resetVastCache(),!0)}cacheVastOffer(e,t,i=new Ns(this.width,this.height)){console.debug("cacheVastOffer");const r={parsingCompleted:(e,i)=>{console.debug(`cacheVastOffer:Parsing succeeded offer ${i}`),console.debug(`cacheVastOffer:offer ${JSON.stringify(e)}`),t.last_parse_date=(new Date).toISOString(),t.vastJSONString=Ye(JSON.stringify(e)),t.mediaAssetURL=e.Ad.Linear.MediaFile.value,this.nativeCacheListener.commitVastOffer(JSON.stringify(t),i),this.nativeCacheListener.cacheVastAssetForOffer(i,t.mediaAssetURL,!0)},parsingFailed:(r,s)=>{console.debug(`cacheVastOffer:Parsing failed ${r.error.message}`),r.error.code===re.getVastTagDownloadError().error.code?t.tag_download_failures+=1:t.tag_parse_failures+=1,this.nativeCacheListener.commitVastOffer(JSON.stringify(t),s),r.error.code===re.getVastEmptyTagError().error.code&&t.tag_parse_failures<3&&t.tag_download_failures<3&&this.cacheVastOffer(e,t,i),void 0!==this.eventController&&(r.error.additionalInfo=`Vast tag url: ${t.url}`,this.eventController.onClientErrorEvent(r))}};i.parse(t.url,t.identifier,r)}refreshVastOffer(e,t){console.debug("refreshVastOffer"),t.tag_download_failures=0,t.tag_parse_failures=0,t.media_download_failures=0,delete t.last_parse_date,delete t.vastJSONString,this.nativeCacheListener.commitVastOffer(JSON.stringify(t),t.identifier),this.cacheVastOffer(e,t)}retainVastOffer(e,t){console.debug(`retainVastOffer for ${e.id} with url ${t.mediaAssetURL}`),void 0!==t.vastJSONString?this.nativeCacheListener.cacheVastAssetForOffer(e.id,t.mediaAssetURL,!1):this.cacheVastOffer(e,t)}cachedVastOfferWithDirective(e,t){switch(console.debug(`cachedVastOfferWithDirective -- offerState: ${JSON.stringify(t)}`),e.directive){case"cache":this.cacheVastOffer(e,t);break;case"retain":this.retainVastOffer(e,t);break;case"refresh":this.refreshVastOffer(e,t)}}}Object.assign(Os.prototype,Vs),globalThis.PreloadController=Os,e.AD_CLOSED_ACTION=j,e.AD_CLOSED_ACTION_KEY="action",e.AD_PROGRESS_STATE=Y,e.APPSTORE_URL_FALLBACK_PRESENT_BROWSER=!0,e.BANNER_OFFER=F,e.CONSENT_STATUS=J,e.ConsentController=Dr,e.HYPRTimerController=V,e.HYPR_BANNER_ENCODING=H,e.HYPR_BANNER_MIME_TYPE=q,e.HYPR_BANNER_URL=W,e.HYPR_COUNTDOWN_TEXT_KEY=$,e.HYPR_DEFAULT_ACCEPTABLE_BANNER_SIZE_VARIANCE=1,e.HYPR_FINISH_BUTTON_TEXT_KEY=B,e.HYPR_NEXT_BUTTON_TEXT_KEY=D,e.HYPR_TITLE_TEXT_KEY=L,e.HYPR_WEB_VIEW_PROTOCOLS=U,e.InitializationController=Vr,e.KEYS=K,e.MRAID_OFFER=M,e.OptedOutKey=I,e.PAGE_LOADING_STATE=G,e.PLACEMENT_TYPE=ue,e.PersistentIdKey=O,e.Placement=pe,e.PlacementController=ei,e.PreloadController=Os,e.PresentationController=Rr,e.RequestParameterManager=zt,e.SKAdNetworkItemsKey="SKAdNetworkItems",e.TimerController=b,e.VAST_VIDEO_OFFER=k,e.VIEW_MODEL_PREFIX={BASE:"HyprMXAd",WEBVIEW:"HyprMXWebView",BROWSER:"HyprMXBrowser"},e.WEB_TRAFFIC_OFFER=x,e.addToArray=z,e.cdnDomain=A,e.deepClone=_,e.defaultAdAvailableFor=C,e.defaultWebViewReleaseSeconds=0,e.dispatch=function(e,t,i){t.apply(e,i)},e.dispatchToQueue=function(e,t,i,r,s,n){"undefined"!=typeof HYPRSharedQueueController?HYPRSharedQueueController.dispatchToQueue(e,`${t}.${i}('${n.join("','")}')`):s.apply(r,n)},e.equalsIgnoreCase=E,e.initializationHost=P,e.initializationPath=S,e.isNullOrEmpty=y,e.isObject=R,e.isValidUrl=T,e.mergeDeep=N,e.numberOrZero=function(e){const t=parseFloat(e);return Number.isNaN(t)?0:t},Object.defineProperty(e,"__esModule",{value:!0})}));
